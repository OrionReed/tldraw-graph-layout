var B5=Object.defineProperty;var U5=(e,t,n)=>t in e?B5(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var v=(e,t,n)=>(U5(e,typeof t!="symbol"?t+"":t,n),n);var fw,gw,mw,yw,vw,bw,ww,xw,Sw,kw,_w,Cw,Ew,Pw,Iw,Mw,Aw,Tw,jw,Ow;function V5(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in e)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(e,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();var Oe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ns(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var nx={exports:{}},ld={},rx={exports:{}},we={};/**
* @license React
* react.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var jl=Symbol.for("react.element"),H5=Symbol.for("react.portal"),K5=Symbol.for("react.fragment"),W5=Symbol.for("react.strict_mode"),Y5=Symbol.for("react.profiler"),X5=Symbol.for("react.provider"),G5=Symbol.for("react.context"),q5=Symbol.for("react.forward_ref"),Z5=Symbol.for("react.suspense"),Q5=Symbol.for("react.memo"),J5=Symbol.for("react.lazy"),ix=Symbol.iterator;function eO(e){return e===null||typeof e!="object"?null:(e=ix&&e[ix]||e["@@iterator"],typeof e=="function"?e:null)}var ox={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},sx=Object.assign,ax={};function Ks(e,t,n){this.props=e,this.context=t,this.refs=ax,this.updater=n||ox}Ks.prototype.isReactComponent={},Ks.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},Ks.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function lx(){}lx.prototype=Ks.prototype;function Rg(e,t,n){this.props=e,this.context=t,this.refs=ax,this.updater=n||ox}var Fg=Rg.prototype=new lx;Fg.constructor=Rg,sx(Fg,Ks.prototype),Fg.isPureReactComponent=!0;var cx=Array.isArray,ux=Object.prototype.hasOwnProperty,$g={current:null},dx={key:!0,ref:!0,__self:!0,__source:!0};function hx(e,t,n){var r,i={},o=null,s=null;if(t!=null)for(r in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(o=""+t.key),t)ux.call(t,r)&&!dx.hasOwnProperty(r)&&(i[r]=t[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:jl,type:e,key:o,ref:s,props:i,_owner:$g.current}}function tO(e,t){return{$$typeof:jl,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Bg(e){return typeof e=="object"&&e!==null&&e.$$typeof===jl}function nO(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var px=/\/+/g;function Ug(e,t){return typeof e=="object"&&e!==null&&e.key!=null?nO(""+e.key):t.toString(36)}function cd(e,t,n,r,i){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var s=!1;if(e===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case jl:case H5:s=!0}}if(s)return s=e,i=i(s),e=r===""?"."+Ug(s,0):r,cx(i)?(n="",e!=null&&(n=e.replace(px,"$&/")+"/"),cd(i,t,n,"",function(c){return c})):i!=null&&(Bg(i)&&(i=tO(i,n+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(px,"$&/")+"/")+e)),t.push(i)),1;if(s=0,r=r===""?".":r+":",cx(e))for(var a=0;a<e.length;a++){o=e[a];var l=r+Ug(o,a);s+=cd(o,t,n,l,i)}else if(l=eO(e),typeof l=="function")for(e=l.call(e),a=0;!(o=e.next()).done;)o=o.value,l=r+Ug(o,a++),s+=cd(o,t,n,l,i);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function ud(e,t,n){if(e==null)return e;var r=[],i=0;return cd(e,r,"","",function(o){return t.call(n,o,i++)}),r}function rO(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var rn={current:null},dd={transition:null},iO={ReactCurrentDispatcher:rn,ReactCurrentBatchConfig:dd,ReactCurrentOwner:$g};we.Children={map:ud,forEach:function(e,t,n){ud(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return ud(e,function(){t++}),t},toArray:function(e){return ud(e,function(t){return t})||[]},only:function(e){if(!Bg(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},we.Component=Ks,we.Fragment=K5,we.Profiler=Y5,we.PureComponent=Rg,we.StrictMode=W5,we.Suspense=Z5,we.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=iO,we.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=sx({},e.props),i=e.key,o=e.ref,s=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,s=$g.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(l in t)ux.call(t,l)&&!dx.hasOwnProperty(l)&&(r[l]=t[l]===void 0&&a!==void 0?a[l]:t[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:jl,type:e.type,key:i,ref:o,props:r,_owner:s}},we.createContext=function(e){return e={$$typeof:G5,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:X5,_context:e},e.Consumer=e},we.createElement=hx,we.createFactory=function(e){var t=hx.bind(null,e);return t.type=e,t},we.createRef=function(){return{current:null}},we.forwardRef=function(e){return{$$typeof:q5,render:e}},we.isValidElement=Bg,we.lazy=function(e){return{$$typeof:J5,_payload:{_status:-1,_result:e},_init:rO}},we.memo=function(e,t){return{$$typeof:Q5,type:e,compare:t===void 0?null:t}},we.startTransition=function(e){var t=dd.transition;dd.transition={};try{e()}finally{dd.transition=t}},we.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},we.useCallback=function(e,t){return rn.current.useCallback(e,t)},we.useContext=function(e){return rn.current.useContext(e)},we.useDebugValue=function(){},we.useDeferredValue=function(e){return rn.current.useDeferredValue(e)},we.useEffect=function(e,t){return rn.current.useEffect(e,t)},we.useId=function(){return rn.current.useId()},we.useImperativeHandle=function(e,t,n){return rn.current.useImperativeHandle(e,t,n)},we.useInsertionEffect=function(e,t){return rn.current.useInsertionEffect(e,t)},we.useLayoutEffect=function(e,t){return rn.current.useLayoutEffect(e,t)},we.useMemo=function(e,t){return rn.current.useMemo(e,t)},we.useReducer=function(e,t,n){return rn.current.useReducer(e,t,n)},we.useRef=function(e){return rn.current.useRef(e)},we.useState=function(e){return rn.current.useState(e)},we.useSyncExternalStore=function(e,t,n){return rn.current.useSyncExternalStore(e,t,n)},we.useTransition=function(){return rn.current.useTransition()},we.version="18.2.0",rx.exports=we;var x=rx.exports;const J=ns(x),oO=V5({__proto__:null,default:J},[x]);/**
* @license React
* react-jsx-runtime.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var sO=x,aO=Symbol.for("react.element"),lO=Symbol.for("react.fragment"),cO=Object.prototype.hasOwnProperty,uO=sO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,dO={key:!0,ref:!0,__self:!0,__source:!0};function fx(e,t,n){var r,i={},o=null,s=null;n!==void 0&&(o=""+n),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(s=t.ref);for(r in t)cO.call(t,r)&&!dO.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)i[r]===void 0&&(i[r]=t[r]);return{$$typeof:aO,type:e,key:o,ref:s,props:i,_owner:uO.current}}ld.Fragment=lO,ld.jsx=fx,ld.jsxs=fx,nx.exports=ld;var y=nx.exports,Vg={},gx={exports:{}},Tn={},mx={exports:{}},yx={};/**
* @license React
* scheduler.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/(function(e){function t(V,D){var B=V.length;V.push(D);e:for(;0<B;){var X=B-1>>>1,ie=V[X];if(0<i(ie,D))V[X]=D,V[B]=ie,B=X;else break e}}function n(V){return V.length===0?null:V[0]}function r(V){if(V.length===0)return null;var D=V[0],B=V.pop();if(B!==D){V[0]=B;e:for(var X=0,ie=V.length,ue=ie>>>1;X<ue;){var ge=2*(X+1)-1,ce=V[ge],be=ge+1,ft=V[be];if(0>i(ce,B))be<ie&&0>i(ft,ce)?(V[X]=ft,V[be]=B,X=be):(V[X]=ce,V[ge]=B,X=ge);else if(be<ie&&0>i(ft,B))V[X]=ft,V[be]=B,X=be;else break e}}return D}function i(V,D){var B=V.sortIndex-D.sortIndex;return B!==0?B:V.id-D.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();e.unstable_now=function(){return s.now()-a}}var l=[],c=[],u=1,d=null,h=3,p=!1,g=!1,f=!1,m=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(V){for(var D=n(c);D!==null;){if(D.callback===null)r(c);else if(D.startTime<=V)r(c),D.sortIndex=D.expirationTime,t(l,D);else break;D=n(c)}}function S(V){if(f=!1,k(V),!g)if(n(l)!==null)g=!0,R(C);else{var D=n(c);D!==null&&W(S,D.startTime-V)}}function C(V,D){g=!1,f&&(f=!1,w(I),I=-1),p=!0;var B=h;try{for(k(D),d=n(l);d!==null&&(!(d.expirationTime>D)||V&&!L());){var X=d.callback;if(typeof X=="function"){d.callback=null,h=d.priorityLevel;var ie=X(d.expirationTime<=D);D=e.unstable_now(),typeof ie=="function"?d.callback=ie:d===n(l)&&r(l),k(D)}else r(l);d=n(l)}if(d!==null)var ue=!0;else{var ge=n(c);ge!==null&&W(S,ge.startTime-D),ue=!1}return ue}finally{d=null,h=B,p=!1}}var _=!1,P=null,I=-1,M=5,A=-1;function L(){return!(e.unstable_now()-A<M)}function z(){if(P!==null){var V=e.unstable_now();A=V;var D=!0;try{D=P(!0,V)}finally{D?$():(_=!1,P=null)}}else _=!1}var $;if(typeof b=="function")$=function(){b(z)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,F=j.port2;j.port1.onmessage=z,$=function(){F.postMessage(null)}}else $=function(){m(z,0)};function R(V){P=V,_||(_=!0,$())}function W(V,D){I=m(function(){V(e.unstable_now())},D)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(V){V.callback=null},e.unstable_continueExecution=function(){g||p||(g=!0,R(C))},e.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<V?Math.floor(1e3/V):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(V){switch(h){case 1:case 2:case 3:var D=3;break;default:D=h}var B=h;h=D;try{return V()}finally{h=B}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(V,D){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var B=h;h=V;try{return D()}finally{h=B}},e.unstable_scheduleCallback=function(V,D,B){var X=e.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?X+B:X):B=X,V){case 1:var ie=-1;break;case 2:ie=250;break;case 5:ie=1073741823;break;case 4:ie=1e4;break;default:ie=5e3}return ie=B+ie,V={id:u++,callback:D,priorityLevel:V,startTime:B,expirationTime:ie,sortIndex:-1},B>X?(V.sortIndex=B,t(c,V),n(l)===null&&V===n(c)&&(f?(w(I),I=-1):f=!0,W(S,B-X))):(V.sortIndex=ie,t(l,V),g||p||(g=!0,R(C))),V},e.unstable_shouldYield=L,e.unstable_wrapCallback=function(V){var D=h;return function(){var B=h;h=D;try{return V.apply(this,arguments)}finally{h=B}}}})(yx),mx.exports=yx;var hO=mx.exports;/**
* @license React
* react-dom.production.min.js
*
* Copyright (c) Facebook, Inc. and its affiliates.
*
* This source code is licensed under the MIT license found in the
* LICENSE file in the root directory of this source tree.
*/var vx=x,jn=hO;function G(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var bx=new Set,Ol={};function rs(e,t){Ws(e,t),Ws(e+"Capture",t)}function Ws(e,t){for(Ol[e]=t,e=0;e<t.length;e++)bx.add(t[e])}var vi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Hg=Object.prototype.hasOwnProperty,pO=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wx={},xx={};function fO(e){return Hg.call(xx,e)?!0:Hg.call(wx,e)?!1:pO.test(e)?xx[e]=!0:(wx[e]=!0,!1)}function gO(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function mO(e,t,n,r){if(t===null||typeof t>"u"||gO(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function on(e,t,n,r,i,o,s){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var It={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){It[e]=new on(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];It[t]=new on(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){It[e]=new on(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){It[e]=new on(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){It[e]=new on(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){It[e]=new on(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){It[e]=new on(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){It[e]=new on(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){It[e]=new on(e,5,!1,e.toLowerCase(),null,!1,!1)});var Kg=/[\-:]([a-z])/g;function Wg(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Kg,Wg);It[t]=new on(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Kg,Wg);It[t]=new on(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Kg,Wg);It[t]=new on(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){It[e]=new on(e,1,!1,e.toLowerCase(),null,!1,!1)}),It.xlinkHref=new on("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){It[e]=new on(e,1,!1,e.toLowerCase(),null,!0,!0)});function Yg(e,t,n,r){var i=It.hasOwnProperty(t)?It[t]:null;(i!==null?i.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(mO(t,n,i,r)&&(n=null),r||i===null?fO(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=n===null?i.type===3?!1:"":n:(t=i.attributeName,r=i.attributeNamespace,n===null?e.removeAttribute(t):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var bi=vx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,hd=Symbol.for("react.element"),Ys=Symbol.for("react.portal"),Xs=Symbol.for("react.fragment"),Xg=Symbol.for("react.strict_mode"),Gg=Symbol.for("react.profiler"),Sx=Symbol.for("react.provider"),kx=Symbol.for("react.context"),qg=Symbol.for("react.forward_ref"),Zg=Symbol.for("react.suspense"),Qg=Symbol.for("react.suspense_list"),Jg=Symbol.for("react.memo"),io=Symbol.for("react.lazy"),_x=Symbol.for("react.offscreen"),Cx=Symbol.iterator;function Ll(e){return e===null||typeof e!="object"?null:(e=Cx&&e[Cx]||e["@@iterator"],typeof e=="function"?e:null)}var tt=Object.assign,em;function Dl(e){if(em===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);em=t&&t[1]||""}return`
`+em+e}var tm=!1;function nm(e,t){if(!e||tm)return"";tm=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),o=r.stack.split(`
`),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(s!==1||a!==1)do if(s--,a--,0>a||i[s]!==o[a]){var l=`
`+i[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=s&&0<=a);break}}}finally{tm=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Dl(e):""}function yO(e){switch(e.tag){case 5:return Dl(e.type);case 16:return Dl("Lazy");case 13:return Dl("Suspense");case 19:return Dl("SuspenseList");case 0:case 2:case 15:return e=nm(e.type,!1),e;case 11:return e=nm(e.type.render,!1),e;case 1:return e=nm(e.type,!0),e;default:return""}}function rm(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Xs:return"Fragment";case Ys:return"Portal";case Gg:return"Profiler";case Xg:return"StrictMode";case Zg:return"Suspense";case Qg:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case kx:return(e.displayName||"Context")+".Consumer";case Sx:return(e._context.displayName||"Context")+".Provider";case qg:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Jg:return t=e.displayName||null,t!==null?t:rm(e.type)||"Memo";case io:t=e._payload,e=e._init;try{return rm(e(t))}catch{}}return null}function vO(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return rm(t);case 8:return t===Xg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function oo(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ex(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function bO(e){var t=Ex(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,o.call(this,s)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function pd(e){e._valueTracker||(e._valueTracker=bO(e))}function Px(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Ex(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function fd(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function im(e,t){var n=t.checked;return tt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Ix(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=oo(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Mx(e,t){t=t.checked,t!=null&&Yg(e,"checked",t,!1)}function om(e,t){Mx(e,t);var n=oo(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?sm(e,t.type,n):t.hasOwnProperty("defaultValue")&&sm(e,t.type,oo(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Ax(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function sm(e,t,n){(t!=="number"||fd(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var zl=Array.isArray;function Gs(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+oo(n),t=null,i=0;i<e.length;i++){if(e[i].value===n){e[i].selected=!0,r&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function am(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(G(91));return tt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Tx(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(G(92));if(zl(n)){if(1<n.length)throw Error(G(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:oo(n)}}function jx(e,t){var n=oo(t.value),r=oo(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function Ox(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Lx(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lm(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Lx(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var gd,Dx=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,i){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(gd=gd||document.createElement("div"),gd.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=gd.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Nl(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Rl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},wO=["Webkit","ms","Moz","O"];Object.keys(Rl).forEach(function(e){wO.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Rl[t]=Rl[e]})});function zx(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Rl.hasOwnProperty(e)&&Rl[e]?(""+t).trim():t+"px"}function Nx(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=zx(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}var xO=tt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function cm(e,t){if(t){if(xO[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(G(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(G(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(G(61))}if(t.style!=null&&typeof t.style!="object")throw Error(G(62))}}function um(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dm=null;function hm(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var pm=null,qs=null,Zs=null;function Rx(e){if(e=sc(e)){if(typeof pm!="function")throw Error(G(280));var t=e.stateNode;t&&(t=Rd(t),pm(e.stateNode,e.type,t))}}function Fx(e){qs?Zs?Zs.push(e):Zs=[e]:qs=e}function $x(){if(qs){var e=qs,t=Zs;if(Zs=qs=null,Rx(e),t)for(e=0;e<t.length;e++)Rx(t[e])}}function Bx(e,t){return e(t)}function Ux(){}var fm=!1;function Vx(e,t,n){if(fm)return e(t,n);fm=!0;try{return Bx(e,t,n)}finally{fm=!1,(qs!==null||Zs!==null)&&(Ux(),$x())}}function Fl(e,t){var n=e.stateNode;if(n===null)return null;var r=Rd(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(G(231,t,typeof n));return n}var gm=!1;if(vi)try{var $l={};Object.defineProperty($l,"passive",{get:function(){gm=!0}}),window.addEventListener("test",$l,$l),window.removeEventListener("test",$l,$l)}catch{gm=!1}function SO(e,t,n,r,i,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Bl=!1,md=null,yd=!1,mm=null,kO={onError:function(e){Bl=!0,md=e}};function _O(e,t,n,r,i,o,s,a,l){Bl=!1,md=null,SO.apply(kO,arguments)}function CO(e,t,n,r,i,o,s,a,l){if(_O.apply(this,arguments),Bl){if(Bl){var c=md;Bl=!1,md=null}else throw Error(G(198));yd||(yd=!0,mm=c)}}function is(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Hx(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Kx(e){if(is(e)!==e)throw Error(G(188))}function EO(e){var t=e.alternate;if(!t){if(t=is(e),t===null)throw Error(G(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return Kx(i),e;if(o===r)return Kx(i),t;o=o.sibling}throw Error(G(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,a=i.child;a;){if(a===n){s=!0,n=i,r=o;break}if(a===r){s=!0,r=i,n=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===n){s=!0,n=o,r=i;break}if(a===r){s=!0,r=o,n=i;break}a=a.sibling}if(!s)throw Error(G(189))}}if(n.alternate!==r)throw Error(G(190))}if(n.tag!==3)throw Error(G(188));return n.stateNode.current===n?e:t}function Wx(e){return e=EO(e),e!==null?Yx(e):null}function Yx(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Yx(e);if(t!==null)return t;e=e.sibling}return null}var Xx=jn.unstable_scheduleCallback,Gx=jn.unstable_cancelCallback,PO=jn.unstable_shouldYield,IO=jn.unstable_requestPaint,ht=jn.unstable_now,MO=jn.unstable_getCurrentPriorityLevel,ym=jn.unstable_ImmediatePriority,qx=jn.unstable_UserBlockingPriority,vd=jn.unstable_NormalPriority,AO=jn.unstable_LowPriority,Zx=jn.unstable_IdlePriority,bd=null,Wr=null;function TO(e){if(Wr&&typeof Wr.onCommitFiberRoot=="function")try{Wr.onCommitFiberRoot(bd,e,void 0,(e.current.flags&128)===128)}catch{}}var wr=Math.clz32?Math.clz32:LO,jO=Math.log,OO=Math.LN2;function LO(e){return e>>>=0,e===0?32:31-(jO(e)/OO|0)|0}var wd=64,xd=4194304;function Ul(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Sd(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,s=n&268435455;if(s!==0){var a=s&~i;a!==0?r=Ul(a):(o&=s,o!==0&&(r=Ul(o)))}else s=n&~i,s!==0?r=Ul(s):o!==0&&(r=Ul(o));if(r===0)return 0;if(t!==0&&t!==r&&!(t&i)&&(i=r&-r,o=t&-t,i>=o||i===16&&(o&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-wr(t),i=1<<n,r|=e[n],t&=~i;return r}function DO(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zO(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-wr(o),a=1<<s,l=i[s];l===-1?(!(a&n)||a&r)&&(i[s]=DO(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}}function vm(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Qx(){var e=wd;return wd<<=1,!(wd&4194240)&&(wd=64),e}function bm(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Vl(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-wr(t),e[t]=n}function NO(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-wr(n),o=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~o}}function wm(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-wr(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var Le=0;function Jx(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var eS,xm,tS,nS,rS,Sm=!1,kd=[],so=null,ao=null,lo=null,Hl=new Map,Kl=new Map,co=[],RO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function iS(e,t){switch(e){case"focusin":case"focusout":so=null;break;case"dragenter":case"dragleave":ao=null;break;case"mouseover":case"mouseout":lo=null;break;case"pointerover":case"pointerout":Hl.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Kl.delete(t.pointerId)}}function Wl(e,t,n,r,i,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},t!==null&&(t=sc(t),t!==null&&xm(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function FO(e,t,n,r,i){switch(t){case"focusin":return so=Wl(so,e,t,n,r,i),!0;case"dragenter":return ao=Wl(ao,e,t,n,r,i),!0;case"mouseover":return lo=Wl(lo,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return Hl.set(o,Wl(Hl.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Kl.set(o,Wl(Kl.get(o)||null,e,t,n,r,i)),!0}return!1}function oS(e){var t=os(e.target);if(t!==null){var n=is(t);if(n!==null){if(t=n.tag,t===13){if(t=Hx(n),t!==null){e.blockedOn=t,rS(e.priority,function(){tS(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function _d(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=_m(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);dm=r,n.target.dispatchEvent(r),dm=null}else return t=sc(n),t!==null&&xm(t),e.blockedOn=n,!1;t.shift()}return!0}function sS(e,t,n){_d(e)&&n.delete(t)}function $O(){Sm=!1,so!==null&&_d(so)&&(so=null),ao!==null&&_d(ao)&&(ao=null),lo!==null&&_d(lo)&&(lo=null),Hl.forEach(sS),Kl.forEach(sS)}function Yl(e,t){e.blockedOn===t&&(e.blockedOn=null,Sm||(Sm=!0,jn.unstable_scheduleCallback(jn.unstable_NormalPriority,$O)))}function Xl(e){function t(i){return Yl(i,e)}if(0<kd.length){Yl(kd[0],e);for(var n=1;n<kd.length;n++){var r=kd[n];r.blockedOn===e&&(r.blockedOn=null)}}for(so!==null&&Yl(so,e),ao!==null&&Yl(ao,e),lo!==null&&Yl(lo,e),Hl.forEach(t),Kl.forEach(t),n=0;n<co.length;n++)r=co[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<co.length&&(n=co[0],n.blockedOn===null);)oS(n),n.blockedOn===null&&co.shift()}var Qs=bi.ReactCurrentBatchConfig,Cd=!0;function BO(e,t,n,r){var i=Le,o=Qs.transition;Qs.transition=null;try{Le=1,km(e,t,n,r)}finally{Le=i,Qs.transition=o}}function UO(e,t,n,r){var i=Le,o=Qs.transition;Qs.transition=null;try{Le=4,km(e,t,n,r)}finally{Le=i,Qs.transition=o}}function km(e,t,n,r){if(Cd){var i=_m(e,t,n,r);if(i===null)Bm(e,t,r,Ed,n),iS(e,r);else if(FO(i,e,t,n,r))r.stopPropagation();else if(iS(e,r),t&4&&-1<RO.indexOf(e)){for(;i!==null;){var o=sc(i);if(o!==null&&eS(o),o=_m(e,t,n,r),o===null&&Bm(e,t,r,Ed,n),o===i)break;i=o}i!==null&&r.stopPropagation()}else Bm(e,t,r,null,n)}}var Ed=null;function _m(e,t,n,r){if(Ed=null,e=hm(r),e=os(e),e!==null)if(t=is(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Hx(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ed=e,null}function aS(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(MO()){case ym:return 1;case qx:return 4;case vd:case AO:return 16;case Zx:return 536870912;default:return 16}default:return 16}}var uo=null,Cm=null,Pd=null;function lS(){if(Pd)return Pd;var e,t=Cm,n=t.length,r,i="value"in uo?uo.value:uo.textContent,o=i.length;for(e=0;e<n&&t[e]===i[e];e++);var s=n-e;for(r=1;r<=s&&t[n-r]===i[o-r];r++);return Pd=i.slice(e,1<r?1-r:void 0)}function Id(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Md(){return!0}function cS(){return!1}function On(e){function t(n,r,i,o,s){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var a in e)e.hasOwnProperty(a)&&(n=e[a],this[a]=n?n(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Md:cS,this.isPropagationStopped=cS,this}return tt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Md)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Md)},persist:function(){},isPersistent:Md}),t}var Js={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Em=On(Js),Gl=tt({},Js,{view:0,detail:0}),VO=On(Gl),Pm,Im,ql,Ad=tt({},Gl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Am,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ql&&(ql&&e.type==="mousemove"?(Pm=e.screenX-ql.screenX,Im=e.screenY-ql.screenY):Im=Pm=0,ql=e),Pm)},movementY:function(e){return"movementY"in e?e.movementY:Im}}),uS=On(Ad),HO=tt({},Ad,{dataTransfer:0}),KO=On(HO),WO=tt({},Gl,{relatedTarget:0}),Mm=On(WO),YO=tt({},Js,{animationName:0,elapsedTime:0,pseudoElement:0}),XO=On(YO),GO=tt({},Js,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),qO=On(GO),ZO=tt({},Js,{data:0}),dS=On(ZO),QO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},JO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},e4={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function t4(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=e4[e])?!!t[e]:!1}function Am(){return t4}var n4=tt({},Gl,{key:function(e){if(e.key){var t=QO[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Id(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?JO[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Am,charCode:function(e){return e.type==="keypress"?Id(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Id(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),r4=On(n4),i4=tt({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hS=On(i4),o4=tt({},Gl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Am}),s4=On(o4),a4=tt({},Js,{propertyName:0,elapsedTime:0,pseudoElement:0}),l4=On(a4),c4=tt({},Ad,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),u4=On(c4),d4=[9,13,27,32],Tm=vi&&"CompositionEvent"in window,Zl=null;vi&&"documentMode"in document&&(Zl=document.documentMode);var h4=vi&&"TextEvent"in window&&!Zl,pS=vi&&(!Tm||Zl&&8<Zl&&11>=Zl),fS=String.fromCharCode(32),gS=!1;function mS(e,t){switch(e){case"keyup":return d4.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function yS(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ea=!1;function p4(e,t){switch(e){case"compositionend":return yS(t);case"keypress":return t.which!==32?null:(gS=!0,fS);case"textInput":return e=t.data,e===fS&&gS?null:e;default:return null}}function f4(e,t){if(ea)return e==="compositionend"||!Tm&&mS(e,t)?(e=lS(),Pd=Cm=uo=null,ea=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return pS&&t.locale!=="ko"?null:t.data;default:return null}}var g4={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vS(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!g4[e.type]:t==="textarea"}function bS(e,t,n,r){Fx(r),t=Dd(t,"onChange"),0<t.length&&(n=new Em("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Ql=null,Jl=null;function m4(e){NS(e,0)}function Td(e){var t=oa(e);if(Px(t))return e}function y4(e,t){if(e==="change")return t}var wS=!1;if(vi){var jm;if(vi){var Om="oninput"in document;if(!Om){var xS=document.createElement("div");xS.setAttribute("oninput","return;"),Om=typeof xS.oninput=="function"}jm=Om}else jm=!1;wS=jm&&(!document.documentMode||9<document.documentMode)}function SS(){Ql&&(Ql.detachEvent("onpropertychange",kS),Jl=Ql=null)}function kS(e){if(e.propertyName==="value"&&Td(Jl)){var t=[];bS(t,Jl,e,hm(e)),Vx(m4,t)}}function v4(e,t,n){e==="focusin"?(SS(),Ql=t,Jl=n,Ql.attachEvent("onpropertychange",kS)):e==="focusout"&&SS()}function b4(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Td(Jl)}function w4(e,t){if(e==="click")return Td(t)}function x4(e,t){if(e==="input"||e==="change")return Td(t)}function S4(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var xr=typeof Object.is=="function"?Object.is:S4;function ec(e,t){if(xr(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!Hg.call(t,i)||!xr(e[i],t[i]))return!1}return!0}function _S(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function CS(e,t){var n=_S(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=_S(n)}}function ES(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?ES(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function PS(){for(var e=window,t=fd();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=fd(e.document)}return t}function Lm(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function k4(e){var t=PS(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ES(n.ownerDocument.documentElement,n)){if(r!==null&&Lm(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=CS(n,o);var s=CS(n,r);i&&s&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var _4=vi&&"documentMode"in document&&11>=document.documentMode,ta=null,Dm=null,tc=null,zm=!1;function IS(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;zm||ta==null||ta!==fd(r)||(r=ta,"selectionStart"in r&&Lm(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),tc&&ec(tc,r)||(tc=r,r=Dd(Dm,"onSelect"),0<r.length&&(t=new Em("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=ta)))}function jd(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var na={animationend:jd("Animation","AnimationEnd"),animationiteration:jd("Animation","AnimationIteration"),animationstart:jd("Animation","AnimationStart"),transitionend:jd("Transition","TransitionEnd")},Nm={},MS={};vi&&(MS=document.createElement("div").style,"AnimationEvent"in window||(delete na.animationend.animation,delete na.animationiteration.animation,delete na.animationstart.animation),"TransitionEvent"in window||delete na.transitionend.transition);function Od(e){if(Nm[e])return Nm[e];if(!na[e])return e;var t=na[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in MS)return Nm[e]=t[n];return e}var AS=Od("animationend"),TS=Od("animationiteration"),jS=Od("animationstart"),OS=Od("transitionend"),LS=new Map,DS="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ho(e,t){LS.set(e,t),rs(t,[e])}for(var Rm=0;Rm<DS.length;Rm++){var Fm=DS[Rm],C4=Fm.toLowerCase(),E4=Fm[0].toUpperCase()+Fm.slice(1);ho(C4,"on"+E4)}ho(AS,"onAnimationEnd"),ho(TS,"onAnimationIteration"),ho(jS,"onAnimationStart"),ho("dblclick","onDoubleClick"),ho("focusin","onFocus"),ho("focusout","onBlur"),ho(OS,"onTransitionEnd"),Ws("onMouseEnter",["mouseout","mouseover"]),Ws("onMouseLeave",["mouseout","mouseover"]),Ws("onPointerEnter",["pointerout","pointerover"]),Ws("onPointerLeave",["pointerout","pointerover"]),rs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),rs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),rs("onBeforeInput",["compositionend","keypress","textInput","paste"]),rs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),rs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),rs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var nc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),P4=new Set("cancel close invalid load scroll toggle".split(" ").concat(nc));function zS(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,CO(r,t,void 0,e),e.currentTarget=null}function NS(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var s=r.length-1;0<=s;s--){var a=r[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break e;zS(i,a,c),o=l}else for(s=0;s<r.length;s++){if(a=r[s],l=a.instance,c=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break e;zS(i,a,c),o=l}}}if(yd)throw e=mm,yd=!1,mm=null,e}function Ge(e,t){var n=t[Ym];n===void 0&&(n=t[Ym]=new Set);var r=e+"__bubble";n.has(r)||(RS(t,e,2,!1),n.add(r))}function $m(e,t,n){var r=0;t&&(r|=4),RS(n,e,r,t)}var Ld="_reactListening"+Math.random().toString(36).slice(2);function rc(e){if(!e[Ld]){e[Ld]=!0,bx.forEach(function(n){n!=="selectionchange"&&(P4.has(n)||$m(n,!1,e),$m(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Ld]||(t[Ld]=!0,$m("selectionchange",!1,t))}}function RS(e,t,n,r){switch(aS(t)){case 1:var i=BO;break;case 4:i=UO;break;default:i=km}n=i.bind(null,t,n,e),i=void 0,!gm||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),r?i!==void 0?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):i!==void 0?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Bm(e,t,n,r,i){var o=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(s===4)for(s=r.return;s!==null;){var l=s.tag;if((l===3||l===4)&&(l=s.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;s=s.return}for(;a!==null;){if(s=os(a),s===null)return;if(l=s.tag,l===5||l===6){r=o=s;continue e}a=a.parentNode}}r=r.return}Vx(function(){var c=o,u=hm(n),d=[];e:{var h=LS.get(e);if(h!==void 0){var p=Em,g=e;switch(e){case"keypress":if(Id(n)===0)break e;case"keydown":case"keyup":p=r4;break;case"focusin":g="focus",p=Mm;break;case"focusout":g="blur",p=Mm;break;case"beforeblur":case"afterblur":p=Mm;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=uS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=KO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=s4;break;case AS:case TS:case jS:p=XO;break;case OS:p=l4;break;case"scroll":p=VO;break;case"wheel":p=u4;break;case"copy":case"cut":case"paste":p=qO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=hS}var f=(t&4)!==0,m=!f&&e==="scroll",w=f?h!==null?h+"Capture":null:h;f=[];for(var b=c,k;b!==null;){k=b;var S=k.stateNode;if(k.tag===5&&S!==null&&(k=S,w!==null&&(S=Fl(b,w),S!=null&&f.push(ic(b,S,k)))),m)break;b=b.return}0<f.length&&(h=new p(h,g,null,n,u),d.push({event:h,listeners:f}))}}if(!(t&7)){e:{if(h=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",h&&n!==dm&&(g=n.relatedTarget||n.fromElement)&&(os(g)||g[wi]))break e;if((p||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,p?(g=n.relatedTarget||n.toElement,p=c,g=g?os(g):null,g!==null&&(m=is(g),g!==m||g.tag!==5&&g.tag!==6)&&(g=null)):(p=null,g=c),p!==g)){if(f=uS,S="onMouseLeave",w="onMouseEnter",b="mouse",(e==="pointerout"||e==="pointerover")&&(f=hS,S="onPointerLeave",w="onPointerEnter",b="pointer"),m=p==null?h:oa(p),k=g==null?h:oa(g),h=new f(S,b+"leave",p,n,u),h.target=m,h.relatedTarget=k,S=null,os(u)===c&&(f=new f(w,b+"enter",g,n,u),f.target=k,f.relatedTarget=m,S=f),m=S,p&&g)t:{for(f=p,w=g,b=0,k=f;k;k=ra(k))b++;for(k=0,S=w;S;S=ra(S))k++;for(;0<b-k;)f=ra(f),b--;for(;0<k-b;)w=ra(w),k--;for(;b--;){if(f===w||w!==null&&f===w.alternate)break t;f=ra(f),w=ra(w)}f=null}else f=null;p!==null&&FS(d,h,p,f,!1),g!==null&&m!==null&&FS(d,m,g,f,!0)}}e:{if(h=c?oa(c):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var C=y4;else if(vS(h))if(wS)C=x4;else{C=b4;var _=v4}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(C=w4);if(C&&(C=C(e,c))){bS(d,C,n,u);break e}_&&_(e,h,c),e==="focusout"&&(_=h._wrapperState)&&_.controlled&&h.type==="number"&&sm(h,"number",h.value)}switch(_=c?oa(c):window,e){case"focusin":(vS(_)||_.contentEditable==="true")&&(ta=_,Dm=c,tc=null);break;case"focusout":tc=Dm=ta=null;break;case"mousedown":zm=!0;break;case"contextmenu":case"mouseup":case"dragend":zm=!1,IS(d,n,u);break;case"selectionchange":if(_4)break;case"keydown":case"keyup":IS(d,n,u)}var P;if(Tm)e:{switch(e){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else ea?mS(e,n)&&(I="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(I="onCompositionStart");I&&(pS&&n.locale!=="ko"&&(ea||I!=="onCompositionStart"?I==="onCompositionEnd"&&ea&&(P=lS()):(uo=u,Cm="value"in uo?uo.value:uo.textContent,ea=!0)),_=Dd(c,I),0<_.length&&(I=new dS(I,e,null,n,u),d.push({event:I,listeners:_}),P?I.data=P:(P=yS(n),P!==null&&(I.data=P)))),(P=h4?p4(e,n):f4(e,n))&&(c=Dd(c,"onBeforeInput"),0<c.length&&(u=new dS("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:c}),u.data=P))}NS(d,t)})}function ic(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Dd(e,t){for(var n=t+"Capture",r=[];e!==null;){var i=e,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Fl(e,n),o!=null&&r.unshift(ic(e,o,i)),o=Fl(e,t),o!=null&&r.push(ic(e,o,i))),e=e.return}return r}function ra(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function FS(e,t,n,r,i){for(var o=t._reactName,s=[];n!==null&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=Fl(n,o),l!=null&&s.unshift(ic(n,l,a))):i||(l=Fl(n,o),l!=null&&s.push(ic(n,l,a)))),n=n.return}s.length!==0&&e.push({event:t,listeners:s})}var I4=/\r\n?/g,M4=/\u0000|\uFFFD/g;function $S(e){return(typeof e=="string"?e:""+e).replace(I4,`
`).replace(M4,"")}function zd(e,t,n){if(t=$S(t),$S(e)!==t&&n)throw Error(G(425))}function Nd(){}var Um=null,Vm=null;function Hm(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Km=typeof setTimeout=="function"?setTimeout:void 0,A4=typeof clearTimeout=="function"?clearTimeout:void 0,BS=typeof Promise=="function"?Promise:void 0,T4=typeof queueMicrotask=="function"?queueMicrotask:typeof BS<"u"?function(e){return BS.resolve(null).then(e).catch(j4)}:Km;function j4(e){setTimeout(function(){throw e})}function Wm(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){e.removeChild(i),Xl(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Xl(t)}function po(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function US(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var ia=Math.random().toString(36).slice(2),Yr="__reactFiber$"+ia,oc="__reactProps$"+ia,wi="__reactContainer$"+ia,Ym="__reactEvents$"+ia,O4="__reactListeners$"+ia,L4="__reactHandles$"+ia;function os(e){var t=e[Yr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[wi]||n[Yr]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=US(e);e!==null;){if(n=e[Yr])return n;e=US(e)}return t}e=n,n=e.parentNode}return null}function sc(e){return e=e[Yr]||e[wi],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function oa(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(G(33))}function Rd(e){return e[oc]||null}var Xm=[],sa=-1;function fo(e){return{current:e}}function qe(e){0>sa||(e.current=Xm[sa],Xm[sa]=null,sa--)}function Ue(e,t){sa++,Xm[sa]=e.current,e.current=t}var go={},Ft=fo(go),mn=fo(!1),ss=go;function aa(e,t){var n=e.type.contextTypes;if(!n)return go;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in n)i[o]=t[o];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function yn(e){return e=e.childContextTypes,e!=null}function Fd(){qe(mn),qe(Ft)}function VS(e,t,n){if(Ft.current!==go)throw Error(G(168));Ue(Ft,t),Ue(mn,n)}function HS(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in t))throw Error(G(108,vO(e)||"Unknown",i));return tt({},n,r)}function $d(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||go,ss=Ft.current,Ue(Ft,e),Ue(mn,mn.current),!0}function KS(e,t,n){var r=e.stateNode;if(!r)throw Error(G(169));n?(e=HS(e,t,ss),r.__reactInternalMemoizedMergedChildContext=e,qe(mn),qe(Ft),Ue(Ft,e)):qe(mn),Ue(mn,n)}var xi=null,Bd=!1,Gm=!1;function WS(e){xi===null?xi=[e]:xi.push(e)}function D4(e){Bd=!0,WS(e)}function mo(){if(!Gm&&xi!==null){Gm=!0;var e=0,t=Le;try{var n=xi;for(Le=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}xi=null,Bd=!1}catch(i){throw xi!==null&&(xi=xi.slice(e+1)),Xx(ym,mo),i}finally{Le=t,Gm=!1}}return null}var la=[],ca=0,Ud=null,Vd=0,tr=[],nr=0,as=null,Si=1,ki="";function ls(e,t){la[ca++]=Vd,la[ca++]=Ud,Ud=e,Vd=t}function YS(e,t,n){tr[nr++]=Si,tr[nr++]=ki,tr[nr++]=as,as=e;var r=Si;e=ki;var i=32-wr(r)-1;r&=~(1<<i),n+=1;var o=32-wr(t)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Si=1<<32-wr(t)+i|n<<i|r,ki=o+e}else Si=1<<o|n<<i|r,ki=e}function qm(e){e.return!==null&&(ls(e,1),YS(e,1,0))}function Zm(e){for(;e===Ud;)Ud=la[--ca],la[ca]=null,Vd=la[--ca],la[ca]=null;for(;e===as;)as=tr[--nr],tr[nr]=null,ki=tr[--nr],tr[nr]=null,Si=tr[--nr],tr[nr]=null}var Ln=null,Dn=null,Qe=!1,Sr=null;function XS(e,t){var n=sr(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function GS(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Ln=e,Dn=po(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Ln=e,Dn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=as!==null?{id:Si,overflow:ki}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=sr(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,Ln=e,Dn=null,!0):!1;default:return!1}}function Qm(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Jm(e){if(Qe){var t=Dn;if(t){var n=t;if(!GS(e,t)){if(Qm(e))throw Error(G(418));t=po(n.nextSibling);var r=Ln;t&&GS(e,t)?XS(r,n):(e.flags=e.flags&-4097|2,Qe=!1,Ln=e)}}else{if(Qm(e))throw Error(G(418));e.flags=e.flags&-4097|2,Qe=!1,Ln=e}}}function qS(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Ln=e}function Hd(e){if(e!==Ln)return!1;if(!Qe)return qS(e),Qe=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Hm(e.type,e.memoizedProps)),t&&(t=Dn)){if(Qm(e))throw ZS(),Error(G(418));for(;t;)XS(e,t),t=po(t.nextSibling)}if(qS(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(G(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Dn=po(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Dn=null}}else Dn=Ln?po(e.stateNode.nextSibling):null;return!0}function ZS(){for(var e=Dn;e;)e=po(e.nextSibling)}function ua(){Dn=Ln=null,Qe=!1}function ey(e){Sr===null?Sr=[e]:Sr.push(e)}var z4=bi.ReactCurrentBatchConfig;function kr(e,t){if(e&&e.defaultProps){t=tt({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}var Kd=fo(null),Wd=null,da=null,ty=null;function ny(){ty=da=Wd=null}function ry(e){var t=Kd.current;qe(Kd),e._currentValue=t}function iy(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function ha(e,t){Wd=e,ty=da=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(vn=!0),e.firstContext=null)}function rr(e){var t=e._currentValue;if(ty!==e)if(e={context:e,memoizedValue:t,next:null},da===null){if(Wd===null)throw Error(G(308));da=e,Wd.dependencies={lanes:0,firstContext:e}}else da=da.next=e;return t}var cs=null;function oy(e){cs===null?cs=[e]:cs.push(e)}function QS(e,t,n,r){var i=t.interleaved;return i===null?(n.next=n,oy(t)):(n.next=i.next,i.next=n),t.interleaved=n,_i(e,r)}function _i(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var yo=!1;function sy(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function JS(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ci(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function vo(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,_e&2){var i=r.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),r.pending=t,_i(e,n)}return i=r.interleaved,i===null?(t.next=t,oy(r)):(t.next=i.next,i.next=t),r.interleaved=t,_i(e,n)}function Yd(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,wm(e,n)}}function ek(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?i=o=s:o=o.next=s,n=n.next}while(n!==null);o===null?i=o=t:o=o.next=t}else i=o=t;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Xd(e,t,n,r){var i=e.updateQueue;yo=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,s===null?o=c:s.next=c,s=l;var u=e.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==s&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(o!==null){var d=i.baseState;s=0,u=c=l=null,a=o;do{var h=a.lane,p=a.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=e,f=a;switch(h=t,p=n,f.tag){case 1:if(g=f.payload,typeof g=="function"){d=g.call(p,d,h);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=f.payload,h=typeof g=="function"?g.call(p,d,h):g,h==null)break e;d=tt({},d,h);break e;case 2:yo=!0}}a.callback!==null&&a.lane!==0&&(e.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=p,l=d):u=u.next=p,s|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(1);if(u===null&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,t=i.shared.interleaved,t!==null){i=t;do s|=i.lane,i=i.next;while(i!==t)}else o===null&&(i.shared.lanes=0);hs|=s,e.lanes=s,e.memoizedState=d}}function tk(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(G(191,i));i.call(r)}}}var nk=new vx.Component().refs;function ay(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:tt({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Gd={isMounted:function(e){return(e=e._reactInternals)?is(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=an(),i=So(e),o=Ci(r,i);o.payload=t,n!=null&&(o.callback=n),t=vo(e,o,i),t!==null&&(Er(t,e,i,r),Yd(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=an(),i=So(e),o=Ci(r,i);o.tag=1,o.payload=t,n!=null&&(o.callback=n),t=vo(e,o,i),t!==null&&(Er(t,e,i,r),Yd(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=an(),r=So(e),i=Ci(n,r);i.tag=2,t!=null&&(i.callback=t),t=vo(e,i,r),t!==null&&(Er(t,e,r,n),Yd(t,e,r))}};function rk(e,t,n,r,i,o,s){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,o,s):t.prototype&&t.prototype.isPureReactComponent?!ec(n,r)||!ec(i,o):!0}function ik(e,t,n){var r=!1,i=go,o=t.contextType;return typeof o=="object"&&o!==null?o=rr(o):(i=yn(t)?ss:Ft.current,r=t.contextTypes,o=(r=r!=null)?aa(e,i):go),t=new t(n,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Gd,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function ok(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Gd.enqueueReplaceState(t,t.state,null)}function ly(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=nk,sy(e);var o=t.contextType;typeof o=="object"&&o!==null?i.context=rr(o):(o=yn(t)?ss:Ft.current,i.context=aa(e,o)),i.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(ay(e,t,o,n),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&Gd.enqueueReplaceState(i,i.state,null),Xd(e,n,i,r),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function ac(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(G(309));var r=n.stateNode}if(!r)throw Error(G(147,e));var i=r,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(s){var a=i.refs;a===nk&&(a=i.refs={}),s===null?delete a[o]:a[o]=s},t._stringRef=o,t)}if(typeof e!="string")throw Error(G(284));if(!n._owner)throw Error(G(290,e))}return e}function qd(e,t){throw e=Object.prototype.toString.call(t),Error(G(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function sk(e){var t=e._init;return t(e._payload)}function ak(e){function t(w,b){if(e){var k=w.deletions;k===null?(w.deletions=[b],w.flags|=16):k.push(b)}}function n(w,b){if(!e)return null;for(;b!==null;)t(w,b),b=b.sibling;return null}function r(w,b){for(w=new Map;b!==null;)b.key!==null?w.set(b.key,b):w.set(b.index,b),b=b.sibling;return w}function i(w,b){return w=_o(w,b),w.index=0,w.sibling=null,w}function o(w,b,k){return w.index=k,e?(k=w.alternate,k!==null?(k=k.index,k<b?(w.flags|=2,b):k):(w.flags|=2,b)):(w.flags|=1048576,b)}function s(w){return e&&w.alternate===null&&(w.flags|=2),w}function a(w,b,k,S){return b===null||b.tag!==6?(b=Hy(k,w.mode,S),b.return=w,b):(b=i(b,k),b.return=w,b)}function l(w,b,k,S){var C=k.type;return C===Xs?u(w,b,k.props.children,S,k.key):b!==null&&(b.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===io&&sk(C)===b.type)?(S=i(b,k.props),S.ref=ac(w,b,k),S.return=w,S):(S=gh(k.type,k.key,k.props,null,w.mode,S),S.ref=ac(w,b,k),S.return=w,S)}function c(w,b,k,S){return b===null||b.tag!==4||b.stateNode.containerInfo!==k.containerInfo||b.stateNode.implementation!==k.implementation?(b=Ky(k,w.mode,S),b.return=w,b):(b=i(b,k.children||[]),b.return=w,b)}function u(w,b,k,S,C){return b===null||b.tag!==7?(b=ms(k,w.mode,S,C),b.return=w,b):(b=i(b,k),b.return=w,b)}function d(w,b,k){if(typeof b=="string"&&b!==""||typeof b=="number")return b=Hy(""+b,w.mode,k),b.return=w,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case hd:return k=gh(b.type,b.key,b.props,null,w.mode,k),k.ref=ac(w,null,b),k.return=w,k;case Ys:return b=Ky(b,w.mode,k),b.return=w,b;case io:var S=b._init;return d(w,S(b._payload),k)}if(zl(b)||Ll(b))return b=ms(b,w.mode,k,null),b.return=w,b;qd(w,b)}return null}function h(w,b,k,S){var C=b!==null?b.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return C!==null?null:a(w,b,""+k,S);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case hd:return k.key===C?l(w,b,k,S):null;case Ys:return k.key===C?c(w,b,k,S):null;case io:return C=k._init,h(w,b,C(k._payload),S)}if(zl(k)||Ll(k))return C!==null?null:u(w,b,k,S,null);qd(w,k)}return null}function p(w,b,k,S,C){if(typeof S=="string"&&S!==""||typeof S=="number")return w=w.get(k)||null,a(b,w,""+S,C);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case hd:return w=w.get(S.key===null?k:S.key)||null,l(b,w,S,C);case Ys:return w=w.get(S.key===null?k:S.key)||null,c(b,w,S,C);case io:var _=S._init;return p(w,b,k,_(S._payload),C)}if(zl(S)||Ll(S))return w=w.get(k)||null,u(b,w,S,C,null);qd(b,S)}return null}function g(w,b,k,S){for(var C=null,_=null,P=b,I=b=0,M=null;P!==null&&I<k.length;I++){P.index>I?(M=P,P=null):M=P.sibling;var A=h(w,P,k[I],S);if(A===null){P===null&&(P=M);break}e&&P&&A.alternate===null&&t(w,P),b=o(A,b,I),_===null?C=A:_.sibling=A,_=A,P=M}if(I===k.length)return n(w,P),Qe&&ls(w,I),C;if(P===null){for(;I<k.length;I++)P=d(w,k[I],S),P!==null&&(b=o(P,b,I),_===null?C=P:_.sibling=P,_=P);return Qe&&ls(w,I),C}for(P=r(w,P);I<k.length;I++)M=p(P,w,I,k[I],S),M!==null&&(e&&M.alternate!==null&&P.delete(M.key===null?I:M.key),b=o(M,b,I),_===null?C=M:_.sibling=M,_=M);return e&&P.forEach(function(L){return t(w,L)}),Qe&&ls(w,I),C}function f(w,b,k,S){var C=Ll(k);if(typeof C!="function")throw Error(G(150));if(k=C.call(k),k==null)throw Error(G(151));for(var _=C=null,P=b,I=b=0,M=null,A=k.next();P!==null&&!A.done;I++,A=k.next()){P.index>I?(M=P,P=null):M=P.sibling;var L=h(w,P,A.value,S);if(L===null){P===null&&(P=M);break}e&&P&&L.alternate===null&&t(w,P),b=o(L,b,I),_===null?C=L:_.sibling=L,_=L,P=M}if(A.done)return n(w,P),Qe&&ls(w,I),C;if(P===null){for(;!A.done;I++,A=k.next())A=d(w,A.value,S),A!==null&&(b=o(A,b,I),_===null?C=A:_.sibling=A,_=A);return Qe&&ls(w,I),C}for(P=r(w,P);!A.done;I++,A=k.next())A=p(P,w,I,A.value,S),A!==null&&(e&&A.alternate!==null&&P.delete(A.key===null?I:A.key),b=o(A,b,I),_===null?C=A:_.sibling=A,_=A);return e&&P.forEach(function(z){return t(w,z)}),Qe&&ls(w,I),C}function m(w,b,k,S){if(typeof k=="object"&&k!==null&&k.type===Xs&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case hd:e:{for(var C=k.key,_=b;_!==null;){if(_.key===C){if(C=k.type,C===Xs){if(_.tag===7){n(w,_.sibling),b=i(_,k.props.children),b.return=w,w=b;break e}}else if(_.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===io&&sk(C)===_.type){n(w,_.sibling),b=i(_,k.props),b.ref=ac(w,_,k),b.return=w,w=b;break e}n(w,_);break}else t(w,_);_=_.sibling}k.type===Xs?(b=ms(k.props.children,w.mode,S,k.key),b.return=w,w=b):(S=gh(k.type,k.key,k.props,null,w.mode,S),S.ref=ac(w,b,k),S.return=w,w=S)}return s(w);case Ys:e:{for(_=k.key;b!==null;){if(b.key===_)if(b.tag===4&&b.stateNode.containerInfo===k.containerInfo&&b.stateNode.implementation===k.implementation){n(w,b.sibling),b=i(b,k.children||[]),b.return=w,w=b;break e}else{n(w,b);break}else t(w,b);b=b.sibling}b=Ky(k,w.mode,S),b.return=w,w=b}return s(w);case io:return _=k._init,m(w,b,_(k._payload),S)}if(zl(k))return g(w,b,k,S);if(Ll(k))return f(w,b,k,S);qd(w,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,b!==null&&b.tag===6?(n(w,b.sibling),b=i(b,k),b.return=w,w=b):(n(w,b),b=Hy(k,w.mode,S),b.return=w,w=b),s(w)):n(w,b)}return m}var pa=ak(!0),lk=ak(!1),lc={},Xr=fo(lc),cc=fo(lc),uc=fo(lc);function us(e){if(e===lc)throw Error(G(174));return e}function cy(e,t){switch(Ue(uc,t),Ue(cc,e),Ue(Xr,lc),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:lm(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=lm(t,e)}qe(Xr),Ue(Xr,t)}function fa(){qe(Xr),qe(cc),qe(uc)}function ck(e){us(uc.current);var t=us(Xr.current),n=lm(t,e.type);t!==n&&(Ue(cc,e),Ue(Xr,n))}function uy(e){cc.current===e&&(qe(Xr),qe(cc))}var nt=fo(0);function Zd(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var dy=[];function hy(){for(var e=0;e<dy.length;e++)dy[e]._workInProgressVersionPrimary=null;dy.length=0}var Qd=bi.ReactCurrentDispatcher,py=bi.ReactCurrentBatchConfig,ds=0,rt=null,yt=null,wt=null,Jd=!1,dc=!1,hc=0,N4=0;function $t(){throw Error(G(321))}function fy(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!xr(e[n],t[n]))return!1;return!0}function gy(e,t,n,r,i,o){if(ds=o,rt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Qd.current=e===null||e.memoizedState===null?B4:U4,e=n(r,i),dc){o=0;do{if(dc=!1,hc=0,25<=o)throw Error(G(301));o+=1,wt=yt=null,t.updateQueue=null,Qd.current=V4,e=n(r,i)}while(dc)}if(Qd.current=nh,t=yt!==null&&yt.next!==null,ds=0,wt=yt=rt=null,Jd=!1,t)throw Error(G(300));return e}function my(){var e=hc!==0;return hc=0,e}function Gr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wt===null?rt.memoizedState=wt=e:wt=wt.next=e,wt}function ir(){if(yt===null){var e=rt.alternate;e=e!==null?e.memoizedState:null}else e=yt.next;var t=wt===null?rt.memoizedState:wt.next;if(t!==null)wt=t,yt=e;else{if(e===null)throw Error(G(310));yt=e,e={memoizedState:yt.memoizedState,baseState:yt.baseState,baseQueue:yt.baseQueue,queue:yt.queue,next:null},wt===null?rt.memoizedState=wt=e:wt=wt.next=e}return wt}function pc(e,t){return typeof t=="function"?t(e):t}function yy(e){var t=ir(),n=t.queue;if(n===null)throw Error(G(311));n.lastRenderedReducer=e;var r=yt,i=r.baseQueue,o=n.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(i!==null){o=i.next,r=r.baseState;var a=s=null,l=null,c=o;do{var u=c.lane;if((ds&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,s=r):l=l.next=d,rt.lanes|=u,hs|=u}c=c.next}while(c!==null&&c!==o);l===null?s=r:l.next=a,xr(r,t.memoizedState)||(vn=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=l,n.lastRenderedState=r}if(e=n.interleaved,e!==null){i=e;do o=i.lane,rt.lanes|=o,hs|=o,i=i.next;while(i!==e)}else i===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function vy(e){var t=ir(),n=t.queue;if(n===null)throw Error(G(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(i!==null){n.pending=null;var s=i=i.next;do o=e(o,s.action),s=s.next;while(s!==i);xr(o,t.memoizedState)||(vn=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function uk(){}function dk(e,t){var n=rt,r=ir(),i=t(),o=!xr(r.memoizedState,i);if(o&&(r.memoizedState=i,vn=!0),r=r.queue,by(fk.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||wt!==null&&wt.memoizedState.tag&1){if(n.flags|=2048,fc(9,pk.bind(null,n,r,i,t),void 0,null),xt===null)throw Error(G(349));ds&30||hk(n,t,i)}return i}function hk(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=rt.updateQueue,t===null?(t={lastEffect:null,stores:null},rt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function pk(e,t,n,r){t.value=n,t.getSnapshot=r,gk(t)&&mk(e)}function fk(e,t,n){return n(function(){gk(t)&&mk(e)})}function gk(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!xr(e,n)}catch{return!0}}function mk(e){var t=_i(e,1);t!==null&&Er(t,e,1,-1)}function yk(e){var t=Gr();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:pc,lastRenderedState:e},t.queue=e,e=e.dispatch=$4.bind(null,rt,e),[t.memoizedState,e]}function fc(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=rt.updateQueue,t===null?(t={lastEffect:null,stores:null},rt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function vk(){return ir().memoizedState}function eh(e,t,n,r){var i=Gr();rt.flags|=e,i.memoizedState=fc(1|t,n,void 0,r===void 0?null:r)}function th(e,t,n,r){var i=ir();r=r===void 0?null:r;var o=void 0;if(yt!==null){var s=yt.memoizedState;if(o=s.destroy,r!==null&&fy(r,s.deps)){i.memoizedState=fc(t,n,o,r);return}}rt.flags|=e,i.memoizedState=fc(1|t,n,o,r)}function bk(e,t){return eh(8390656,8,e,t)}function by(e,t){return th(2048,8,e,t)}function wk(e,t){return th(4,2,e,t)}function xk(e,t){return th(4,4,e,t)}function Sk(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function kk(e,t,n){return n=n!=null?n.concat([e]):null,th(4,4,Sk.bind(null,t,e),n)}function wy(){}function _k(e,t){var n=ir();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&fy(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ck(e,t){var n=ir();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&fy(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Ek(e,t,n){return ds&21?(xr(n,t)||(n=Qx(),rt.lanes|=n,hs|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,vn=!0),e.memoizedState=n)}function R4(e,t){var n=Le;Le=n!==0&&4>n?n:4,e(!0);var r=py.transition;py.transition={};try{e(!1),t()}finally{Le=n,py.transition=r}}function Pk(){return ir().memoizedState}function F4(e,t,n){var r=So(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Ik(e))Mk(t,n);else if(n=QS(e,t,n,r),n!==null){var i=an();Er(n,e,r,i),Ak(n,t,r)}}function $4(e,t,n){var r=So(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ik(e))Mk(t,i);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var s=t.lastRenderedState,a=o(s,n);if(i.hasEagerState=!0,i.eagerState=a,xr(a,s)){var l=t.interleaved;l===null?(i.next=i,oy(t)):(i.next=l.next,l.next=i),t.interleaved=i;return}}catch{}finally{}n=QS(e,t,i,r),n!==null&&(i=an(),Er(n,e,r,i),Ak(n,t,r))}}function Ik(e){var t=e.alternate;return e===rt||t!==null&&t===rt}function Mk(e,t){dc=Jd=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ak(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,wm(e,n)}}var nh={readContext:rr,useCallback:$t,useContext:$t,useEffect:$t,useImperativeHandle:$t,useInsertionEffect:$t,useLayoutEffect:$t,useMemo:$t,useReducer:$t,useRef:$t,useState:$t,useDebugValue:$t,useDeferredValue:$t,useTransition:$t,useMutableSource:$t,useSyncExternalStore:$t,useId:$t,unstable_isNewReconciler:!1},B4={readContext:rr,useCallback:function(e,t){return Gr().memoizedState=[e,t===void 0?null:t],e},useContext:rr,useEffect:bk,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,eh(4194308,4,Sk.bind(null,t,e),n)},useLayoutEffect:function(e,t){return eh(4194308,4,e,t)},useInsertionEffect:function(e,t){return eh(4,2,e,t)},useMemo:function(e,t){var n=Gr();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Gr();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=F4.bind(null,rt,e),[r.memoizedState,e]},useRef:function(e){var t=Gr();return e={current:e},t.memoizedState=e},useState:yk,useDebugValue:wy,useDeferredValue:function(e){return Gr().memoizedState=e},useTransition:function(){var e=yk(!1),t=e[0];return e=R4.bind(null,e[1]),Gr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=rt,i=Gr();if(Qe){if(n===void 0)throw Error(G(407));n=n()}else{if(n=t(),xt===null)throw Error(G(349));ds&30||hk(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,bk(fk.bind(null,r,o,e),[e]),r.flags|=2048,fc(9,pk.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=Gr(),t=xt.identifierPrefix;if(Qe){var n=ki,r=Si;n=(r&~(1<<32-wr(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=hc++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=N4++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},U4={readContext:rr,useCallback:_k,useContext:rr,useEffect:by,useImperativeHandle:kk,useInsertionEffect:wk,useLayoutEffect:xk,useMemo:Ck,useReducer:yy,useRef:vk,useState:function(){return yy(pc)},useDebugValue:wy,useDeferredValue:function(e){var t=ir();return Ek(t,yt.memoizedState,e)},useTransition:function(){var e=yy(pc)[0],t=ir().memoizedState;return[e,t]},useMutableSource:uk,useSyncExternalStore:dk,useId:Pk,unstable_isNewReconciler:!1},V4={readContext:rr,useCallback:_k,useContext:rr,useEffect:by,useImperativeHandle:kk,useInsertionEffect:wk,useLayoutEffect:xk,useMemo:Ck,useReducer:vy,useRef:vk,useState:function(){return vy(pc)},useDebugValue:wy,useDeferredValue:function(e){var t=ir();return yt===null?t.memoizedState=e:Ek(t,yt.memoizedState,e)},useTransition:function(){var e=vy(pc)[0],t=ir().memoizedState;return[e,t]},useMutableSource:uk,useSyncExternalStore:dk,useId:Pk,unstable_isNewReconciler:!1};function ga(e,t){try{var n="",r=t;do n+=yO(r),r=r.return;while(r);var i=n}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:i,digest:null}}function xy(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Sy(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var H4=typeof WeakMap=="function"?WeakMap:Map;function Tk(e,t,n){n=Ci(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){ch||(ch=!0,zy=r),Sy(e,t)},n}function jk(e,t,n){n=Ci(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){Sy(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Sy(e,t),typeof r!="function"&&(wo===null?wo=new Set([this]):wo.add(this));var s=t.stack;this.componentDidCatch(t.value,{componentStack:s!==null?s:""})}),n}function Ok(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new H4;var i=new Set;r.set(t,i)}else i=r.get(t),i===void 0&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=iL.bind(null,e,t,n),t.then(e,e))}function Lk(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Dk(e,t,n,r,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Ci(-1,1),t.tag=2,vo(n,t,1))),n.lanes|=1),e)}var K4=bi.ReactCurrentOwner,vn=!1;function sn(e,t,n,r){t.child=e===null?lk(t,null,n,r):pa(t,e.child,n,r)}function zk(e,t,n,r,i){n=n.render;var o=t.ref;return ha(t,i),r=gy(e,t,n,r,o,i),n=my(),e!==null&&!vn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ei(e,t,i)):(Qe&&n&&qm(t),t.flags|=1,sn(e,t,r,i),t.child)}function Nk(e,t,n,r,i){if(e===null){var o=n.type;return typeof o=="function"&&!Vy(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=o,Rk(e,t,o,r,i)):(e=gh(n.type,null,r,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&i)){var s=o.memoizedProps;if(n=n.compare,n=n!==null?n:ec,n(s,r)&&e.ref===t.ref)return Ei(e,t,i)}return t.flags|=1,e=_o(o,r),e.ref=t.ref,e.return=t,t.child=e}function Rk(e,t,n,r,i){if(e!==null){var o=e.memoizedProps;if(ec(o,r)&&e.ref===t.ref)if(vn=!1,t.pendingProps=r=o,(e.lanes&i)!==0)e.flags&131072&&(vn=!0);else return t.lanes=e.lanes,Ei(e,t,i)}return ky(e,t,n,r,i)}function Fk(e,t,n){var r=t.pendingProps,i=r.children,o=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ue(ya,zn),zn|=n;else{if(!(n&1073741824))return e=o!==null?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ue(ya,zn),zn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:n,Ue(ya,zn),zn|=r}else o!==null?(r=o.baseLanes|n,t.memoizedState=null):r=n,Ue(ya,zn),zn|=r;return sn(e,t,i,n),t.child}function $k(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function ky(e,t,n,r,i){var o=yn(n)?ss:Ft.current;return o=aa(t,o),ha(t,i),n=gy(e,t,n,r,o,i),r=my(),e!==null&&!vn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ei(e,t,i)):(Qe&&r&&qm(t),t.flags|=1,sn(e,t,n,i),t.child)}function Bk(e,t,n,r,i){if(yn(n)){var o=!0;$d(t)}else o=!1;if(ha(t,i),t.stateNode===null)ih(e,t),ik(t,n,r),ly(t,n,r,i),r=!0;else if(e===null){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=n.contextType;typeof c=="object"&&c!==null?c=rr(c):(c=yn(n)?ss:Ft.current,c=aa(t,c));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof s.getSnapshotBeforeUpdate=="function";d||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==r||l!==c)&&ok(t,s,r,c),yo=!1;var h=t.memoizedState;s.state=h,Xd(t,r,s,i),l=t.memoizedState,a!==r||h!==l||mn.current||yo?(typeof u=="function"&&(ay(t,n,u,r),l=t.memoizedState),(a=yo||rk(t,n,a,r,h,l,c))?(d||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(t.flags|=4194308)):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),s.props=r,s.state=l,s.context=c,r=a):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,JS(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:kr(t.type,a),s.props=c,d=t.pendingProps,h=s.context,l=n.contextType,typeof l=="object"&&l!==null?l=rr(l):(l=yn(n)?ss:Ft.current,l=aa(t,l));var p=n.getDerivedStateFromProps;(u=typeof p=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==d||h!==l)&&ok(t,s,r,l),yo=!1,h=t.memoizedState,s.state=h,Xd(t,r,s,i);var g=t.memoizedState;a!==d||h!==g||mn.current||yo?(typeof p=="function"&&(ay(t,n,p,r),g=t.memoizedState),(c=yo||rk(t,n,c,r,h,g,l)||!1)?(u||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,g,l),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,g,l)),typeof s.componentDidUpdate=="function"&&(t.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=g),s.props=r,s.state=g,s.context=l,r=c):(typeof s.componentDidUpdate!="function"||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return _y(e,t,n,r,o,i)}function _y(e,t,n,r,i,o){$k(e,t);var s=(t.flags&128)!==0;if(!r&&!s)return i&&KS(t,n,!1),Ei(e,t,o);r=t.stateNode,K4.current=t;var a=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&s?(t.child=pa(t,e.child,null,o),t.child=pa(t,null,a,o)):sn(e,t,a,o),t.memoizedState=r.state,i&&KS(t,n,!0),t.child}function Uk(e){var t=e.stateNode;t.pendingContext?VS(e,t.pendingContext,t.pendingContext!==t.context):t.context&&VS(e,t.context,!1),cy(e,t.containerInfo)}function Vk(e,t,n,r,i){return ua(),ey(i),t.flags|=256,sn(e,t,n,r),t.child}var Cy={dehydrated:null,treeContext:null,retryLane:0};function Ey(e){return{baseLanes:e,cachePool:null,transitions:null}}function Hk(e,t,n){var r=t.pendingProps,i=nt.current,o=!1,s=(t.flags&128)!==0,a;if((a=s)||(a=e!==null&&e.memoizedState===null?!1:(i&2)!==0),a?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),Ue(nt,i&1),e===null)return Jm(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=r.children,e=r.fallback,o?(r=t.mode,o=t.child,s={mode:"hidden",children:s},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=mh(s,r,0,null),e=ms(e,r,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Ey(n),t.memoizedState=Cy,e):Py(t,s));if(i=e.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return W4(e,t,s,r,a,i,n);if(o){o=r.fallback,s=t.mode,i=e.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(s&1)&&t.child!==i?(r=t.child,r.childLanes=0,r.pendingProps=l,t.deletions=null):(r=_o(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?o=_o(a,o):(o=ms(o,s,n,null),o.flags|=2),o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,s=e.child.memoizedState,s=s===null?Ey(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=e.childLanes&~n,t.memoizedState=Cy,r}return o=e.child,e=o.sibling,r=_o(o,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Py(e,t){return t=mh({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function rh(e,t,n,r){return r!==null&&ey(r),pa(t,e.child,null,n),e=Py(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function W4(e,t,n,r,i,o,s){if(n)return t.flags&256?(t.flags&=-257,r=xy(Error(G(422))),rh(e,t,s,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=r.fallback,i=t.mode,r=mh({mode:"visible",children:r.children},i,0,null),o=ms(o,i,s,null),o.flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,t.mode&1&&pa(t,e.child,null,s),t.child.memoizedState=Ey(s),t.memoizedState=Cy,o);if(!(t.mode&1))return rh(e,t,s,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,o=Error(G(419)),r=xy(o,r,void 0),rh(e,t,s,r)}if(a=(s&e.childLanes)!==0,vn||a){if(r=xt,r!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|s)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,_i(e,i),Er(r,e,i,-1))}return Uy(),r=xy(Error(G(421))),rh(e,t,s,r)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=oL.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,Dn=po(i.nextSibling),Ln=t,Qe=!0,Sr=null,e!==null&&(tr[nr++]=Si,tr[nr++]=ki,tr[nr++]=as,Si=e.id,ki=e.overflow,as=t),t=Py(t,r.children),t.flags|=4096,t)}function Kk(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),iy(e.return,t,n)}function Iy(e,t,n,r,i){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function Wk(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(sn(e,t,r.children,n),r=nt.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Kk(e,n,t);else if(e.tag===19)Kk(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ue(nt,r),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;n!==null;)e=n.alternate,e!==null&&Zd(e)===null&&(i=n),n=n.sibling;n=i,n===null?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Iy(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&Zd(e)===null){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Iy(t,!0,n,null,o);break;case"together":Iy(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ih(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ei(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),hs|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(G(153));if(t.child!==null){for(e=t.child,n=_o(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=_o(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Y4(e,t,n){switch(t.tag){case 3:Uk(t),ua();break;case 5:ck(t);break;case 1:yn(t.type)&&$d(t);break;case 4:cy(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ue(Kd,r._currentValue),r._currentValue=i;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(Ue(nt,nt.current&1),t.flags|=128,null):n&t.child.childLanes?Hk(e,t,n):(Ue(nt,nt.current&1),e=Ei(e,t,n),e!==null?e.sibling:null);Ue(nt,nt.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return Wk(e,t,n);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ue(nt,nt.current),r)break;return null;case 22:case 23:return t.lanes=0,Fk(e,t,n)}return Ei(e,t,n)}var Yk,My,Xk,Gk;Yk=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},My=function(){},Xk=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,us(Xr.current);var o=null;switch(n){case"input":i=im(e,i),r=im(e,r),o=[];break;case"select":i=tt({},i,{value:void 0}),r=tt({},r,{value:void 0}),o=[];break;case"textarea":i=am(e,i),r=am(e,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Nd)}cm(n,r);var s;n=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(s in a)a.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Ol.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in r){var l=r[c];if(a=i==null?void 0:i[c],r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(s in a)!a.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in l)l.hasOwnProperty(s)&&a[s]!==l[s]&&(n||(n={}),n[s]=l[s])}else n||(o||(o=[]),o.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(o=o||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(o=o||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Ol.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Ge("scroll",e),o||a===l||(o=[])):(o=o||[]).push(c,l))}n&&(o=o||[]).push("style",n);var c=o;(t.updateQueue=c)&&(t.flags|=4)}},Gk=function(e,t,n,r){n!==r&&(t.flags|=4)};function gc(e,t){if(!Qe)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Bt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function X4(e,t,n){var r=t.pendingProps;switch(Zm(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bt(t),null;case 1:return yn(t.type)&&Fd(),Bt(t),null;case 3:return r=t.stateNode,fa(),qe(mn),qe(Ft),hy(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Hd(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Sr!==null&&(Fy(Sr),Sr=null))),My(e,t),Bt(t),null;case 5:uy(t);var i=us(uc.current);if(n=t.type,e!==null&&t.stateNode!=null)Xk(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(G(166));return Bt(t),null}if(e=us(Xr.current),Hd(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[Yr]=t,r[oc]=o,e=(t.mode&1)!==0,n){case"dialog":Ge("cancel",r),Ge("close",r);break;case"iframe":case"object":case"embed":Ge("load",r);break;case"video":case"audio":for(i=0;i<nc.length;i++)Ge(nc[i],r);break;case"source":Ge("error",r);break;case"img":case"image":case"link":Ge("error",r),Ge("load",r);break;case"details":Ge("toggle",r);break;case"input":Ix(r,o),Ge("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Ge("invalid",r);break;case"textarea":Tx(r,o),Ge("invalid",r)}cm(n,o),i=null;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];s==="children"?typeof a=="string"?r.textContent!==a&&(o.suppressHydrationWarning!==!0&&zd(r.textContent,a,e),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&zd(r.textContent,a,e),i=["children",""+a]):Ol.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&Ge("scroll",r)}switch(n){case"input":pd(r),Ax(r,o,!0);break;case"textarea":pd(r),Ox(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=Nd)}r=i,t.updateQueue=r,r!==null&&(t.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Lx(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=s.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=s.createElement(n,{is:r.is}):(e=s.createElement(n),n==="select"&&(s=e,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):e=s.createElementNS(e,n),e[Yr]=t,e[oc]=r,Yk(e,t,!1,!1),t.stateNode=e;e:{switch(s=um(n,r),n){case"dialog":Ge("cancel",e),Ge("close",e),i=r;break;case"iframe":case"object":case"embed":Ge("load",e),i=r;break;case"video":case"audio":for(i=0;i<nc.length;i++)Ge(nc[i],e);i=r;break;case"source":Ge("error",e),i=r;break;case"img":case"image":case"link":Ge("error",e),Ge("load",e),i=r;break;case"details":Ge("toggle",e),i=r;break;case"input":Ix(e,r),i=im(e,r),Ge("invalid",e);break;case"option":i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=tt({},r,{value:void 0}),Ge("invalid",e);break;case"textarea":Tx(e,r),i=am(e,r),Ge("invalid",e);break;default:i=r}cm(n,i),a=i;for(o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="style"?Nx(e,l):o==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Dx(e,l)):o==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Nl(e,l):typeof l=="number"&&Nl(e,""+l):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Ol.hasOwnProperty(o)?l!=null&&o==="onScroll"&&Ge("scroll",e):l!=null&&Yg(e,o,l,s))}switch(n){case"input":pd(e),Ax(e,r,!1);break;case"textarea":pd(e),Ox(e);break;case"option":r.value!=null&&e.setAttribute("value",""+oo(r.value));break;case"select":e.multiple=!!r.multiple,o=r.value,o!=null?Gs(e,!!r.multiple,o,!1):r.defaultValue!=null&&Gs(e,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=Nd)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Bt(t),null;case 6:if(e&&t.stateNode!=null)Gk(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(G(166));if(n=us(uc.current),us(Xr.current),Hd(t)){if(r=t.stateNode,n=t.memoizedProps,r[Yr]=t,(o=r.nodeValue!==n)&&(e=Ln,e!==null))switch(e.tag){case 3:zd(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&zd(r.nodeValue,n,(e.mode&1)!==0)}o&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Yr]=t,t.stateNode=r}return Bt(t),null;case 13:if(qe(nt),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Qe&&Dn!==null&&t.mode&1&&!(t.flags&128))ZS(),ua(),t.flags|=98560,o=!1;else if(o=Hd(t),r!==null&&r.dehydrated!==null){if(e===null){if(!o)throw Error(G(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(G(317));o[Yr]=t}else ua(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Bt(t),o=!1}else Sr!==null&&(Fy(Sr),Sr=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||nt.current&1?vt===0&&(vt=3):Uy())),t.updateQueue!==null&&(t.flags|=4),Bt(t),null);case 4:return fa(),My(e,t),e===null&&rc(t.stateNode.containerInfo),Bt(t),null;case 10:return ry(t.type._context),Bt(t),null;case 17:return yn(t.type)&&Fd(),Bt(t),null;case 19:if(qe(nt),o=t.memoizedState,o===null)return Bt(t),null;if(r=(t.flags&128)!==0,s=o.rendering,s===null)if(r)gc(o,!1);else{if(vt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(s=Zd(e),s!==null){for(t.flags|=128,gc(o,!1),r=s.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)o=n,e=r,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,e=s.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ue(nt,nt.current&1|2),t.child}e=e.sibling}o.tail!==null&&ht()>va&&(t.flags|=128,r=!0,gc(o,!1),t.lanes=4194304)}else{if(!r)if(e=Zd(s),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),gc(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!Qe)return Bt(t),null}else 2*ht()-o.renderingStartTime>va&&n!==1073741824&&(t.flags|=128,r=!0,gc(o,!1),t.lanes=4194304);o.isBackwards?(s.sibling=t.child,t.child=s):(n=o.last,n!==null?n.sibling=s:t.child=s,o.last=s)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=ht(),t.sibling=null,n=nt.current,Ue(nt,r?n&1|2:n&1),t):(Bt(t),null);case 22:case 23:return By(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?zn&1073741824&&(Bt(t),t.subtreeFlags&6&&(t.flags|=8192)):Bt(t),null;case 24:return null;case 25:return null}throw Error(G(156,t.tag))}function G4(e,t){switch(Zm(t),t.tag){case 1:return yn(t.type)&&Fd(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return fa(),qe(mn),qe(Ft),hy(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return uy(t),null;case 13:if(qe(nt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(G(340));ua()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return qe(nt),null;case 4:return fa(),null;case 10:return ry(t.type._context),null;case 22:case 23:return By(),null;case 24:return null;default:return null}}var oh=!1,Ut=!1,q4=typeof WeakSet=="function"?WeakSet:Set,ee=null;function ma(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ct(e,t,r)}else n.current=null}function qk(e,t,n){try{n()}catch(r){ct(e,t,r)}}var Zk=!1;function Z4(e,t){if(Um=Cd,e=PS(),Lm(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var s=0,a=-1,l=-1,c=0,u=0,d=e,h=null;t:for(;;){for(var p;d!==n||i!==0&&d.nodeType!==3||(a=s+i),d!==o||r!==0&&d.nodeType!==3||(l=s+r),d.nodeType===3&&(s+=d.nodeValue.length),(p=d.firstChild)!==null;)h=d,d=p;for(;;){if(d===e)break t;if(h===n&&++c===i&&(a=s),h===o&&++u===r&&(l=s),(p=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=p}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Vm={focusedElem:e,selectionRange:n},Cd=!1,ee=t;ee!==null;)if(t=ee,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ee=e;else for(;ee!==null;){t=ee;try{var g=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var f=g.memoizedProps,m=g.memoizedState,w=t.stateNode,b=w.getSnapshotBeforeUpdate(t.elementType===t.type?f:kr(t.type,f),m);w.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var k=t.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(G(163))}}catch(S){ct(t,t.return,S)}if(e=t.sibling,e!==null){e.return=t.return,ee=e;break}ee=t.return}return g=Zk,Zk=!1,g}function mc(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,o!==void 0&&qk(t,n,o)}i=i.next}while(i!==r)}}function sh(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Ay(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function Qk(e){var t=e.alternate;t!==null&&(e.alternate=null,Qk(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Yr],delete t[oc],delete t[Ym],delete t[O4],delete t[L4])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Jk(e){return e.tag===5||e.tag===3||e.tag===4}function e_(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Jk(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Ty(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Nd));else if(r!==4&&(e=e.child,e!==null))for(Ty(e,t,n),e=e.sibling;e!==null;)Ty(e,t,n),e=e.sibling}function jy(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(jy(e,t,n),e=e.sibling;e!==null;)jy(e,t,n),e=e.sibling}var Mt=null,_r=!1;function bo(e,t,n){for(n=n.child;n!==null;)t_(e,t,n),n=n.sibling}function t_(e,t,n){if(Wr&&typeof Wr.onCommitFiberUnmount=="function")try{Wr.onCommitFiberUnmount(bd,n)}catch{}switch(n.tag){case 5:Ut||ma(n,t);case 6:var r=Mt,i=_r;Mt=null,bo(e,t,n),Mt=r,_r=i,Mt!==null&&(_r?(e=Mt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Mt.removeChild(n.stateNode));break;case 18:Mt!==null&&(_r?(e=Mt,n=n.stateNode,e.nodeType===8?Wm(e.parentNode,n):e.nodeType===1&&Wm(e,n),Xl(e)):Wm(Mt,n.stateNode));break;case 4:r=Mt,i=_r,Mt=n.stateNode.containerInfo,_r=!0,bo(e,t,n),Mt=r,_r=i;break;case 0:case 11:case 14:case 15:if(!Ut&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&qk(n,t,s),i=i.next}while(i!==r)}bo(e,t,n);break;case 1:if(!Ut&&(ma(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){ct(n,t,a)}bo(e,t,n);break;case 21:bo(e,t,n);break;case 22:n.mode&1?(Ut=(r=Ut)||n.memoizedState!==null,bo(e,t,n),Ut=r):bo(e,t,n);break;default:bo(e,t,n)}}function n_(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new q4),t.forEach(function(r){var i=sL.bind(null,e,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Cr(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var o=e,s=t,a=s;e:for(;a!==null;){switch(a.tag){case 5:Mt=a.stateNode,_r=!1;break e;case 3:Mt=a.stateNode.containerInfo,_r=!0;break e;case 4:Mt=a.stateNode.containerInfo,_r=!0;break e}a=a.return}if(Mt===null)throw Error(G(160));t_(o,s,i),Mt=null,_r=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){ct(i,t,c)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)r_(t,e),t=t.sibling}function r_(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Cr(t,e),qr(e),r&4){try{mc(3,e,e.return),sh(3,e)}catch(f){ct(e,e.return,f)}try{mc(5,e,e.return)}catch(f){ct(e,e.return,f)}}break;case 1:Cr(t,e),qr(e),r&512&&n!==null&&ma(n,n.return);break;case 5:if(Cr(t,e),qr(e),r&512&&n!==null&&ma(n,n.return),e.flags&32){var i=e.stateNode;try{Nl(i,"")}catch(f){ct(e,e.return,f)}}if(r&4&&(i=e.stateNode,i!=null)){var o=e.memoizedProps,s=n!==null?n.memoizedProps:o,a=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&Mx(i,o),um(a,s);var c=um(a,o);for(s=0;s<l.length;s+=2){var u=l[s],d=l[s+1];u==="style"?Nx(i,d):u==="dangerouslySetInnerHTML"?Dx(i,d):u==="children"?Nl(i,d):Yg(i,u,d,c)}switch(a){case"input":om(i,o);break;case"textarea":jx(i,o);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var p=o.value;p!=null?Gs(i,!!o.multiple,p,!1):h!==!!o.multiple&&(o.defaultValue!=null?Gs(i,!!o.multiple,o.defaultValue,!0):Gs(i,!!o.multiple,o.multiple?[]:"",!1))}i[oc]=o}catch(f){ct(e,e.return,f)}}break;case 6:if(Cr(t,e),qr(e),r&4){if(e.stateNode===null)throw Error(G(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(f){ct(e,e.return,f)}}break;case 3:if(Cr(t,e),qr(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Xl(t.containerInfo)}catch(f){ct(e,e.return,f)}break;case 4:Cr(t,e),qr(e);break;case 13:Cr(t,e),qr(e),i=e.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(Dy=ht())),r&4&&n_(e);break;case 22:if(u=n!==null&&n.memoizedState!==null,e.mode&1?(Ut=(c=Ut)||u,Cr(t,e),Ut=c):Cr(t,e),qr(e),r&8192){if(c=e.memoizedState!==null,(e.stateNode.isHidden=c)&&!u&&e.mode&1)for(ee=e,u=e.child;u!==null;){for(d=ee=u;ee!==null;){switch(h=ee,p=h.child,h.tag){case 0:case 11:case 14:case 15:mc(4,h,h.return);break;case 1:ma(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){r=h,n=h.return;try{t=r,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(f){ct(r,n,f)}}break;case 5:ma(h,h.return);break;case 22:if(h.memoizedState!==null){s_(d);continue}}p!==null?(p.return=h,ee=p):s_(d)}u=u.sibling}e:for(u=null,d=e;;){if(d.tag===5){if(u===null){u=d;try{i=d.stateNode,c?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=d.stateNode,l=d.memoizedProps.style,s=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=zx("display",s))}catch(f){ct(e,e.return,f)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(f){ct(e,e.return,f)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Cr(t,e),qr(e),r&4&&n_(e);break;case 21:break;default:Cr(t,e),qr(e)}}function qr(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(Jk(n)){var r=n;break e}n=n.return}throw Error(G(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Nl(i,""),r.flags&=-33);var o=e_(e);jy(e,o,i);break;case 3:case 4:var s=r.stateNode.containerInfo,a=e_(e);Ty(e,a,s);break;default:throw Error(G(161))}}catch(l){ct(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Q4(e,t,n){ee=e,i_(e)}function i_(e,t,n){for(var r=(e.mode&1)!==0;ee!==null;){var i=ee,o=i.child;if(i.tag===22&&r){var s=i.memoizedState!==null||oh;if(!s){var a=i.alternate,l=a!==null&&a.memoizedState!==null||Ut;a=oh;var c=Ut;if(oh=s,(Ut=l)&&!c)for(ee=i;ee!==null;)s=ee,l=s.child,s.tag===22&&s.memoizedState!==null?a_(i):l!==null?(l.return=s,ee=l):a_(i);for(;o!==null;)ee=o,i_(o),o=o.sibling;ee=i,oh=a,Ut=c}o_(e)}else i.subtreeFlags&8772&&o!==null?(o.return=i,ee=o):o_(e)}}function o_(e){for(;ee!==null;){var t=ee;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ut||sh(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Ut)if(n===null)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:kr(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&tk(t,o,r);break;case 3:var s=t.updateQueue;if(s!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}tk(t,s,n)}break;case 5:var a=t.stateNode;if(n===null&&t.flags&4){n=a;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var c=t.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Xl(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(G(163))}Ut||t.flags&512&&Ay(t)}catch(h){ct(t,t.return,h)}}if(t===e){ee=null;break}if(n=t.sibling,n!==null){n.return=t.return,ee=n;break}ee=t.return}}function s_(e){for(;ee!==null;){var t=ee;if(t===e){ee=null;break}var n=t.sibling;if(n!==null){n.return=t.return,ee=n;break}ee=t.return}}function a_(e){for(;ee!==null;){var t=ee;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{sh(4,t)}catch(l){ct(t,n,l)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var i=t.return;try{r.componentDidMount()}catch(l){ct(t,i,l)}}var o=t.return;try{Ay(t)}catch(l){ct(t,o,l)}break;case 5:var s=t.return;try{Ay(t)}catch(l){ct(t,s,l)}}}catch(l){ct(t,t.return,l)}if(t===e){ee=null;break}var a=t.sibling;if(a!==null){a.return=t.return,ee=a;break}ee=t.return}}var J4=Math.ceil,ah=bi.ReactCurrentDispatcher,Oy=bi.ReactCurrentOwner,or=bi.ReactCurrentBatchConfig,_e=0,xt=null,mt=null,At=0,zn=0,ya=fo(0),vt=0,yc=null,hs=0,lh=0,Ly=0,vc=null,bn=null,Dy=0,va=1/0,Pi=null,ch=!1,zy=null,wo=null,uh=!1,xo=null,dh=0,bc=0,Ny=null,hh=-1,ph=0;function an(){return _e&6?ht():hh!==-1?hh:hh=ht()}function So(e){return e.mode&1?_e&2&&At!==0?At&-At:z4.transition!==null?(ph===0&&(ph=Qx()),ph):(e=Le,e!==0||(e=window.event,e=e===void 0?16:aS(e.type)),e):1}function Er(e,t,n,r){if(50<bc)throw bc=0,Ny=null,Error(G(185));Vl(e,n,r),(!(_e&2)||e!==xt)&&(e===xt&&(!(_e&2)&&(lh|=n),vt===4&&ko(e,At)),wn(e,r),n===1&&_e===0&&!(t.mode&1)&&(va=ht()+500,Bd&&mo()))}function wn(e,t){var n=e.callbackNode;zO(e,t);var r=Sd(e,e===xt?At:0);if(r===0)n!==null&&Gx(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&Gx(n),t===1)e.tag===0?D4(c_.bind(null,e)):WS(c_.bind(null,e)),T4(function(){!(_e&6)&&mo()}),n=null;else{switch(Jx(r)){case 1:n=ym;break;case 4:n=qx;break;case 16:n=vd;break;case 536870912:n=Zx;break;default:n=vd}n=y_(n,l_.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function l_(e,t){if(hh=-1,ph=0,_e&6)throw Error(G(327));var n=e.callbackNode;if(ba()&&e.callbackNode!==n)return null;var r=Sd(e,e===xt?At:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=fh(e,r);else{t=r;var i=_e;_e|=2;var o=d_();(xt!==e||At!==t)&&(Pi=null,va=ht()+500,fs(e,t));do try{nL();break}catch(a){u_(e,a)}while(1);ny(),ah.current=o,_e=i,mt!==null?t=0:(xt=null,At=0,t=vt)}if(t!==0){if(t===2&&(i=vm(e),i!==0&&(r=i,t=Ry(e,i))),t===1)throw n=yc,fs(e,0),ko(e,r),wn(e,ht()),n;if(t===6)ko(e,r);else{if(i=e.current.alternate,!(r&30)&&!eL(i)&&(t=fh(e,r),t===2&&(o=vm(e),o!==0&&(r=o,t=Ry(e,o))),t===1))throw n=yc,fs(e,0),ko(e,r),wn(e,ht()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(G(345));case 2:gs(e,bn,Pi);break;case 3:if(ko(e,r),(r&130023424)===r&&(t=Dy+500-ht(),10<t)){if(Sd(e,0)!==0)break;if(i=e.suspendedLanes,(i&r)!==r){an(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Km(gs.bind(null,e,bn,Pi),t);break}gs(e,bn,Pi);break;case 4:if(ko(e,r),(r&4194240)===r)break;for(t=e.eventTimes,i=-1;0<r;){var s=31-wr(r);o=1<<s,s=t[s],s>i&&(i=s),r&=~o}if(r=i,r=ht()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*J4(r/1960))-r,10<r){e.timeoutHandle=Km(gs.bind(null,e,bn,Pi),r);break}gs(e,bn,Pi);break;case 5:gs(e,bn,Pi);break;default:throw Error(G(329))}}}return wn(e,ht()),e.callbackNode===n?l_.bind(null,e):null}function Ry(e,t){var n=vc;return e.current.memoizedState.isDehydrated&&(fs(e,t).flags|=256),e=fh(e,t),e!==2&&(t=bn,bn=n,t!==null&&Fy(t)),e}function Fy(e){bn===null?bn=e:bn.push.apply(bn,e)}function eL(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!xr(o(),i))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ko(e,t){for(t&=~Ly,t&=~lh,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-wr(t),r=1<<n;e[n]=-1,t&=~r}}function c_(e){if(_e&6)throw Error(G(327));ba();var t=Sd(e,0);if(!(t&1))return wn(e,ht()),null;var n=fh(e,t);if(e.tag!==0&&n===2){var r=vm(e);r!==0&&(t=r,n=Ry(e,r))}if(n===1)throw n=yc,fs(e,0),ko(e,t),wn(e,ht()),n;if(n===6)throw Error(G(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,gs(e,bn,Pi),wn(e,ht()),null}function $y(e,t){var n=_e;_e|=1;try{return e(t)}finally{_e=n,_e===0&&(va=ht()+500,Bd&&mo())}}function ps(e){xo!==null&&xo.tag===0&&!(_e&6)&&ba();var t=_e;_e|=1;var n=or.transition,r=Le;try{if(or.transition=null,Le=1,e)return e()}finally{Le=r,or.transition=n,_e=t,!(_e&6)&&mo()}}function By(){zn=ya.current,qe(ya)}function fs(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,A4(n)),mt!==null)for(n=mt.return;n!==null;){var r=n;switch(Zm(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Fd();break;case 3:fa(),qe(mn),qe(Ft),hy();break;case 5:uy(r);break;case 4:fa();break;case 13:qe(nt);break;case 19:qe(nt);break;case 10:ry(r.type._context);break;case 22:case 23:By()}n=n.return}if(xt=e,mt=e=_o(e.current,null),At=zn=t,vt=0,yc=null,Ly=lh=hs=0,bn=vc=null,cs!==null){for(t=0;t<cs.length;t++)if(n=cs[t],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,o=n.pending;if(o!==null){var s=o.next;o.next=i,r.next=s}n.pending=r}cs=null}return e}function u_(e,t){do{var n=mt;try{if(ny(),Qd.current=nh,Jd){for(var r=rt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Jd=!1}if(ds=0,wt=yt=rt=null,dc=!1,hc=0,Oy.current=null,n===null||n.return===null){vt=1,yc=t,mt=null;break}e:{var o=e,s=n.return,a=n,l=t;if(t=At,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=Lk(s);if(p!==null){p.flags&=-257,Dk(p,s,a,o,t),p.mode&1&&Ok(o,c,t),t=p,l=c;var g=t.updateQueue;if(g===null){var f=new Set;f.add(l),t.updateQueue=f}else g.add(l);break e}else{if(!(t&1)){Ok(o,c,t),Uy();break e}l=Error(G(426))}}else if(Qe&&a.mode&1){var m=Lk(s);if(m!==null){!(m.flags&65536)&&(m.flags|=256),Dk(m,s,a,o,t),ey(ga(l,a));break e}}o=l=ga(l,a),vt!==4&&(vt=2),vc===null?vc=[o]:vc.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var w=Tk(o,l,t);ek(o,w);break e;case 1:a=l;var b=o.type,k=o.stateNode;if(!(o.flags&128)&&(typeof b.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(wo===null||!wo.has(k)))){o.flags|=65536,t&=-t,o.lanes|=t;var S=jk(o,a,t);ek(o,S);break e}}o=o.return}while(o!==null)}p_(n)}catch(C){t=C,mt===n&&n!==null&&(mt=n=n.return);continue}break}while(1)}function d_(){var e=ah.current;return ah.current=nh,e===null?nh:e}function Uy(){(vt===0||vt===3||vt===2)&&(vt=4),xt===null||!(hs&268435455)&&!(lh&268435455)||ko(xt,At)}function fh(e,t){var n=_e;_e|=2;var r=d_();(xt!==e||At!==t)&&(Pi=null,fs(e,t));do try{tL();break}catch(i){u_(e,i)}while(1);if(ny(),_e=n,ah.current=r,mt!==null)throw Error(G(261));return xt=null,At=0,vt}function tL(){for(;mt!==null;)h_(mt)}function nL(){for(;mt!==null&&!PO();)h_(mt)}function h_(e){var t=m_(e.alternate,e,zn);e.memoizedProps=e.pendingProps,t===null?p_(e):mt=t,Oy.current=null}function p_(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=G4(n,t),n!==null){n.flags&=32767,mt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{vt=6,mt=null;return}}else if(n=X4(n,t,zn),n!==null){mt=n;return}if(t=t.sibling,t!==null){mt=t;return}mt=t=e}while(t!==null);vt===0&&(vt=5)}function gs(e,t,n){var r=Le,i=or.transition;try{or.transition=null,Le=1,rL(e,t,n,r)}finally{or.transition=i,Le=r}return null}function rL(e,t,n,r){do ba();while(xo!==null);if(_e&6)throw Error(G(327));n=e.finishedWork;var i=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(G(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(NO(e,o),e===xt&&(mt=xt=null,At=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||uh||(uh=!0,y_(vd,function(){return ba(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=or.transition,or.transition=null;var s=Le;Le=1;var a=_e;_e|=4,Oy.current=null,Z4(e,n),r_(n,e),k4(Vm),Cd=!!Um,Vm=Um=null,e.current=n,Q4(n),IO(),_e=a,Le=s,or.transition=o}else e.current=n;if(uh&&(uh=!1,xo=e,dh=i),o=e.pendingLanes,o===0&&(wo=null),TO(n.stateNode),wn(e,ht()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(ch)throw ch=!1,e=zy,zy=null,e;return dh&1&&e.tag!==0&&ba(),o=e.pendingLanes,o&1?e===Ny?bc++:(bc=0,Ny=e):bc=0,mo(),null}function ba(){if(xo!==null){var e=Jx(dh),t=or.transition,n=Le;try{if(or.transition=null,Le=16>e?16:e,xo===null)var r=!1;else{if(e=xo,xo=null,dh=0,_e&6)throw Error(G(331));var i=_e;for(_e|=4,ee=e.current;ee!==null;){var o=ee,s=o.child;if(ee.flags&16){var a=o.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(ee=c;ee!==null;){var u=ee;switch(u.tag){case 0:case 11:case 15:mc(8,u,o)}var d=u.child;if(d!==null)d.return=u,ee=d;else for(;ee!==null;){u=ee;var h=u.sibling,p=u.return;if(Qk(u),u===c){ee=null;break}if(h!==null){h.return=p,ee=h;break}ee=p}}}var g=o.alternate;if(g!==null){var f=g.child;if(f!==null){g.child=null;do{var m=f.sibling;f.sibling=null,f=m}while(f!==null)}}ee=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,ee=s;else e:for(;ee!==null;){if(o=ee,o.flags&2048)switch(o.tag){case 0:case 11:case 15:mc(9,o,o.return)}var w=o.sibling;if(w!==null){w.return=o.return,ee=w;break e}ee=o.return}}var b=e.current;for(ee=b;ee!==null;){s=ee;var k=s.child;if(s.subtreeFlags&2064&&k!==null)k.return=s,ee=k;else e:for(s=b;ee!==null;){if(a=ee,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:sh(9,a)}}catch(C){ct(a,a.return,C)}if(a===s){ee=null;break e}var S=a.sibling;if(S!==null){S.return=a.return,ee=S;break e}ee=a.return}}if(_e=i,mo(),Wr&&typeof Wr.onPostCommitFiberRoot=="function")try{Wr.onPostCommitFiberRoot(bd,e)}catch{}r=!0}return r}finally{Le=n,or.transition=t}}return!1}function f_(e,t,n){t=ga(n,t),t=Tk(e,t,1),e=vo(e,t,1),t=an(),e!==null&&(Vl(e,1,t),wn(e,t))}function ct(e,t,n){if(e.tag===3)f_(e,e,n);else for(;t!==null;){if(t.tag===3){f_(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(wo===null||!wo.has(r))){e=ga(n,e),e=jk(t,e,1),t=vo(t,e,1),e=an(),t!==null&&(Vl(t,1,e),wn(t,e));break}}t=t.return}}function iL(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=an(),e.pingedLanes|=e.suspendedLanes&n,xt===e&&(At&n)===n&&(vt===4||vt===3&&(At&130023424)===At&&500>ht()-Dy?fs(e,0):Ly|=n),wn(e,t)}function g_(e,t){t===0&&(e.mode&1?(t=xd,xd<<=1,!(xd&130023424)&&(xd=4194304)):t=1);var n=an();e=_i(e,t),e!==null&&(Vl(e,t,n),wn(e,n))}function oL(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),g_(e,n)}function sL(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(G(314))}r!==null&&r.delete(t),g_(e,n)}var m_;m_=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||mn.current)vn=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return vn=!1,Y4(e,t,n);vn=!!(e.flags&131072)}else vn=!1,Qe&&t.flags&1048576&&YS(t,Vd,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;ih(e,t),e=t.pendingProps;var i=aa(t,Ft.current);ha(t,n),i=gy(null,t,r,e,i,n);var o=my();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,yn(r)?(o=!0,$d(t)):o=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,sy(t),i.updater=Gd,t.stateNode=i,i._reactInternals=t,ly(t,r,e,n),t=_y(null,t,r,!0,o,n)):(t.tag=0,Qe&&o&&qm(t),sn(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(ih(e,t),e=t.pendingProps,i=r._init,r=i(r._payload),t.type=r,i=t.tag=lL(r),e=kr(r,e),i){case 0:t=ky(null,t,r,e,n);break e;case 1:t=Bk(null,t,r,e,n);break e;case 11:t=zk(null,t,r,e,n);break e;case 14:t=Nk(null,t,r,kr(r.type,e),n);break e}throw Error(G(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:kr(r,i),ky(e,t,r,i,n);case 1:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:kr(r,i),Bk(e,t,r,i,n);case 3:e:{if(Uk(t),e===null)throw Error(G(387));r=t.pendingProps,o=t.memoizedState,i=o.element,JS(e,t),Xd(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){i=ga(Error(G(423)),t),t=Vk(e,t,r,n,i);break e}else if(r!==i){i=ga(Error(G(424)),t),t=Vk(e,t,r,n,i);break e}else for(Dn=po(t.stateNode.containerInfo.firstChild),Ln=t,Qe=!0,Sr=null,n=lk(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(ua(),r===i){t=Ei(e,t,n);break e}sn(e,t,r,n)}t=t.child}return t;case 5:return ck(t),e===null&&Jm(t),r=t.type,i=t.pendingProps,o=e!==null?e.memoizedProps:null,s=i.children,Hm(r,i)?s=null:o!==null&&Hm(r,o)&&(t.flags|=32),$k(e,t),sn(e,t,s,n),t.child;case 6:return e===null&&Jm(t),null;case 13:return Hk(e,t,n);case 4:return cy(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=pa(t,null,r,n):sn(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:kr(r,i),zk(e,t,r,i,n);case 7:return sn(e,t,t.pendingProps,n),t.child;case 8:return sn(e,t,t.pendingProps.children,n),t.child;case 12:return sn(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,o=t.memoizedProps,s=i.value,Ue(Kd,r._currentValue),r._currentValue=s,o!==null)if(xr(o.value,s)){if(o.children===i.children&&!mn.current){t=Ei(e,t,n);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var a=o.dependencies;if(a!==null){s=o.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(o.tag===1){l=Ci(-1,n&-n),l.tag=2;var c=o.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),iy(o.return,n,t),a.lanes|=n;break}l=l.next}}else if(o.tag===10)s=o.type===t.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(G(341));s.lanes|=n,a=s.alternate,a!==null&&(a.lanes|=n),iy(s,n,t),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===t){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}sn(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,ha(t,n),i=rr(i),r=r(i),t.flags|=1,sn(e,t,r,n),t.child;case 14:return r=t.type,i=kr(r,t.pendingProps),i=kr(r.type,i),Nk(e,t,r,i,n);case 15:return Rk(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:kr(r,i),ih(e,t),t.tag=1,yn(r)?(e=!0,$d(t)):e=!1,ha(t,n),ik(t,r,i),ly(t,r,i,n),_y(null,t,r,!0,e,n);case 19:return Wk(e,t,n);case 22:return Fk(e,t,n)}throw Error(G(156,t.tag))};function y_(e,t){return Xx(e,t)}function aL(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function sr(e,t,n,r){return new aL(e,t,n,r)}function Vy(e){return e=e.prototype,!(!e||!e.isReactComponent)}function lL(e){if(typeof e=="function")return Vy(e)?1:0;if(e!=null){if(e=e.$$typeof,e===qg)return 11;if(e===Jg)return 14}return 2}function _o(e,t){var n=e.alternate;return n===null?(n=sr(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function gh(e,t,n,r,i,o){var s=2;if(r=e,typeof e=="function")Vy(e)&&(s=1);else if(typeof e=="string")s=5;else e:switch(e){case Xs:return ms(n.children,i,o,t);case Xg:s=8,i|=8;break;case Gg:return e=sr(12,n,t,i|2),e.elementType=Gg,e.lanes=o,e;case Zg:return e=sr(13,n,t,i),e.elementType=Zg,e.lanes=o,e;case Qg:return e=sr(19,n,t,i),e.elementType=Qg,e.lanes=o,e;case _x:return mh(n,i,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Sx:s=10;break e;case kx:s=9;break e;case qg:s=11;break e;case Jg:s=14;break e;case io:s=16,r=null;break e}throw Error(G(130,e==null?e:typeof e,""))}return t=sr(s,n,t,i),t.elementType=e,t.type=r,t.lanes=o,t}function ms(e,t,n,r){return e=sr(7,e,r,t),e.lanes=n,e}function mh(e,t,n,r){return e=sr(22,e,r,t),e.elementType=_x,e.lanes=n,e.stateNode={isHidden:!1},e}function Hy(e,t,n){return e=sr(6,e,null,t),e.lanes=n,e}function Ky(e,t,n){return t=sr(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function cL(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=bm(0),this.expirationTimes=bm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bm(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Wy(e,t,n,r,i,o,s,a,l){return e=new cL(e,t,n,a,l),t===1?(t=1,o===!0&&(t|=8)):t=0,o=sr(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},sy(o),e}function uL(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ys,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function v_(e){if(!e)return go;e=e._reactInternals;e:{if(is(e)!==e||e.tag!==1)throw Error(G(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(yn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(G(171))}if(e.tag===1){var n=e.type;if(yn(n))return HS(e,n,t)}return t}function b_(e,t,n,r,i,o,s,a,l){return e=Wy(n,r,!0,e,i,o,s,a,l),e.context=v_(null),n=e.current,r=an(),i=So(n),o=Ci(r,i),o.callback=t??null,vo(n,o,i),e.current.lanes=i,Vl(e,i,r),wn(e,r),e}function yh(e,t,n,r){var i=t.current,o=an(),s=So(i);return n=v_(n),t.context===null?t.context=n:t.pendingContext=n,t=Ci(o,s),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=vo(i,t,s),e!==null&&(Er(e,i,s,o),Yd(e,i,s)),s}function vh(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function w_(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Yy(e,t){w_(e,t),(e=e.alternate)&&w_(e,t)}function dL(){return null}var x_=typeof reportError=="function"?reportError:function(e){console.error(e)};function Xy(e){this._internalRoot=e}bh.prototype.render=Xy.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(G(409));yh(e,t,null,null)},bh.prototype.unmount=Xy.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;ps(function(){yh(null,e,null,null)}),t[wi]=null}};function bh(e){this._internalRoot=e}bh.prototype.unstable_scheduleHydration=function(e){if(e){var t=nS();e={blockedOn:null,target:e,priority:t};for(var n=0;n<co.length&&t!==0&&t<co[n].priority;n++);co.splice(n,0,e),n===0&&oS(e)}};function Gy(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function wh(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function S_(){}function hL(e,t,n,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var c=vh(s);o.call(c)}}var s=b_(t,r,e,0,null,!1,!1,"",S_);return e._reactRootContainer=s,e[wi]=s.current,rc(e.nodeType===8?e.parentNode:e),ps(),s}for(;i=e.lastChild;)e.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=vh(l);a.call(c)}}var l=Wy(e,0,!1,null,null,!1,!1,"",S_);return e._reactRootContainer=l,e[wi]=l.current,rc(e.nodeType===8?e.parentNode:e),ps(function(){yh(t,l,n,r)}),l}function xh(e,t,n,r,i){var o=n._reactRootContainer;if(o){var s=o;if(typeof i=="function"){var a=i;i=function(){var l=vh(s);a.call(l)}}yh(t,s,e,i)}else s=hL(n,t,e,i,r);return vh(s)}eS=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Ul(t.pendingLanes);n!==0&&(wm(t,n|1),wn(t,ht()),!(_e&6)&&(va=ht()+500,mo()))}break;case 13:ps(function(){var r=_i(e,1);if(r!==null){var i=an();Er(r,e,1,i)}}),Yy(e,1)}},xm=function(e){if(e.tag===13){var t=_i(e,134217728);if(t!==null){var n=an();Er(t,e,134217728,n)}Yy(e,134217728)}},tS=function(e){if(e.tag===13){var t=So(e),n=_i(e,t);if(n!==null){var r=an();Er(n,e,t,r)}Yy(e,t)}},nS=function(){return Le},rS=function(e,t){var n=Le;try{return Le=e,t()}finally{Le=n}},pm=function(e,t,n){switch(t){case"input":if(om(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=Rd(r);if(!i)throw Error(G(90));Px(r),om(r,i)}}}break;case"textarea":jx(e,n);break;case"select":t=n.value,t!=null&&Gs(e,!!n.multiple,t,!1)}},Bx=$y,Ux=ps;var pL={usingClientEntryPoint:!1,Events:[sc,oa,Rd,Fx,$x,$y]},wc={findFiberByHostInstance:os,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},fL={bundleType:wc.bundleType,version:wc.version,rendererPackageName:wc.rendererPackageName,rendererConfig:wc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:bi.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Wx(e),e===null?null:e.stateNode},findFiberByHostInstance:wc.findFiberByHostInstance||dL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Sh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Sh.isDisabled&&Sh.supportsFiber)try{bd=Sh.inject(fL),Wr=Sh}catch{}}Tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pL,Tn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Gy(t))throw Error(G(200));return uL(e,t,null,n)},Tn.createRoot=function(e,t){if(!Gy(e))throw Error(G(299));var n=!1,r="",i=x_;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=Wy(e,1,!1,null,null,n,!1,r,i),e[wi]=t.current,rc(e.nodeType===8?e.parentNode:e),new Xy(t)},Tn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(G(188)):(e=Object.keys(e).join(","),Error(G(268,e)));return e=Wx(t),e=e===null?null:e.stateNode,e},Tn.flushSync=function(e){return ps(e)},Tn.hydrate=function(e,t,n){if(!wh(t))throw Error(G(200));return xh(null,e,t,!0,n)},Tn.hydrateRoot=function(e,t,n){if(!Gy(e))throw Error(G(405));var r=n!=null&&n.hydratedSources||null,i=!1,o="",s=x_;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),t=b_(t,null,e,1,n??null,i,!1,o,s),e[wi]=t.current,rc(e),r)for(e=0;e<r.length;e++)n=r[e],i=n._getVersion,i=i(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new bh(t)},Tn.render=function(e,t,n){if(!wh(t))throw Error(G(200));return xh(null,e,t,!1,n)},Tn.unmountComponentAtNode=function(e){if(!wh(e))throw Error(G(40));return e._reactRootContainer?(ps(function(){xh(null,null,e,!1,function(){e._reactRootContainer=null,e[wi]=null})}),!0):!1},Tn.unstable_batchedUpdates=$y,Tn.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!wh(n))throw Error(G(200));if(e==null||e._reactInternals===void 0)throw Error(G(38));return xh(e,t,n,!1,r)},Tn.version="18.2.0-next-9e3b772b8-20220608";function k_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(k_)}catch(e){console.error(e)}}k_(),gx.exports=Tn;var wa=gx.exports;const gL=ns(wa);var __=wa;Vg.createRoot=__.createRoot,Vg.hydrateRoot=__.hydrateRoot;function C_(e){return e&&typeof e=="object"&&"parents"in e}function E_(e){for(let t=0,n=e.parents.length;t<n;t++)if(e.parents[t].__unsafe__getWithoutCapture(),e.parents[t].lastChangedEpoch!==e.parentEpochs[t])return!0;return!1}const kh=(e,t)=>{if(e.children.remove(t)&&e.children.isEmpty&&C_(e))for(let n=0,r=e.parents.length;n<r;n++)kh(e.parents[n],e)},qy=(e,t)=>{if(e.children.add(t)&&C_(e))for(let n=0,r=e.parents.length;n<r;n++)qy(e.parents[n],e)};function P_(e,t){return e===t||Object.is(e,t)||!!(e&&t&&typeof e.equals=="function"&&e.equals(t))}function Co(e,t){const n=Symbol.for(`com.tldraw.state/${e}`),r=globalThis;return r[n]??(r[n]=t()),r[n]}const Ii=Co("empty_array",()=>Object.freeze([])),I_=8;class M_{constructor(){v(this,"arraySize",0);v(this,"array",Array(I_));v(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(t){if(this.array)return this.array.indexOf(t)!==-1?!1:this.arraySize<I_?(this.array[this.arraySize]=t,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(t),!0);if(this.set)return this.set.has(t)?!1:(this.set.add(t),!0);throw new Error("no set or array")}remove(t){if(this.array){const n=this.array.indexOf(t);return n===-1?!1:(this.array[n]=void 0,this.arraySize--,n!==this.arraySize&&(this.array[n]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(t)?(this.set.delete(t),!0):!1;throw new Error("no set or array")}visit(t){if(this.array){for(let n=0;n<this.arraySize;n++){const r=this.array[n];typeof r<"u"&&t(r)}return}if(this.set){this.set.forEach(t);return}throw new Error("no set or array")}}const Nn=Symbol.for("com.tldraw.state/RESET_VALUE");class A_{constructor(t){v(this,"index",0);v(this,"buffer");this.capacity=t,this.buffer=new Array(t)}pushEntry(t,n,r){if(r!==void 0){if(r===Nn){this.clear();return}this.buffer[this.index]=[t,n,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(t){const{index:n,capacity:r,buffer:i}=this;for(let o=0;o<r;o++){const s=(n-1+r-o)%r,a=i[s];if(!a)return Nn;const[l,c]=a;if(o===0&&t>=c)return[];if(l<=t&&t<c){const u=o+1,d=new Array(u);for(let h=0;h<u;h++)d[h]=i[(s+h)%r][2];return d}}return Nn}}class mL{constructor(t,n){v(this,"offset",0);v(this,"numNewParents",0);v(this,"maybeRemoved");this.below=t,this.child=n}}const Ze=Co("capture",()=>({stack:null}));function T_(e){Ze.stack=new mL(Ze.stack,e)}function j_(){var t;const e=Ze.stack;if(Ze.stack=e.below,e.numNewParents>0||e.offset!==e.child.parents.length){for(let n=e.offset;n<e.child.parents.length;n++){const r=e.child.parents[n];e.child.parents.indexOf(r)>=e.offset&&kh(r,e.child)}if(e.child.parents.length=e.offset,e.child.parentEpochs.length=e.offset,(t=Ze.stack)==null?void 0:t.maybeRemoved)for(let n=0;n<Ze.stack.maybeRemoved.length;n++){const r=Ze.stack.maybeRemoved[n];e.child.parents.indexOf(r)===-1&&kh(r,e.child)}}}function Zy(e){if(Ze.stack){const t=Ze.stack.child.parents.indexOf(e);if(t<0&&(Ze.stack.numNewParents++,Ze.stack.child.isActivelyListening&&qy(e,Ze.stack.child)),t<0||t>=Ze.stack.offset){if(t!==Ze.stack.offset&&t>0){const n=Ze.stack.child.parents[Ze.stack.offset];Ze.stack.maybeRemoved?Ze.stack.maybeRemoved.indexOf(n)===-1&&Ze.stack.maybeRemoved.push(n):Ze.stack.maybeRemoved=[n]}Ze.stack.child.parents[Ze.stack.offset]=e,Ze.stack.child.parentEpochs[Ze.stack.offset]=e.lastChangedEpoch,Ze.stack.offset++}}}const ys=-1;class yL{constructor(t,n,r){v(this,"_isActivelyListening",!1);v(this,"lastTraversedEpoch",ys);v(this,"lastReactedEpoch",ys);v(this,"_scheduleCount",0);v(this,"parentEpochs",[]);v(this,"parents",[]);v(this,"_scheduleEffect");v(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=t,this.runEffect=n,this._scheduleEffect=r==null?void 0:r.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==Rn()){if(this.parents.length&&!E_(this)){this.lastReactedEpoch=Rn();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let t=0,n=this.parents.length;t<n;t++)qy(this.parents[t],this)}detach(){this._isActivelyListening=!1;for(let t=0,n=this.parents.length;t<n;t++)kh(this.parents[t],this)}execute(){try{T_(this);const t=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=Rn(),t}finally{j_()}}}const xa=Co("EffectScheduler",()=>yL);function xc(e,t,n){const r=new xa(e,t,n);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function vL(e,t,n){const r=new xa(e,t,n);return{scheduler:r,start:i=>{const o=(i==null?void 0:i.force)??!1;r.attach(),o?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}class bL{constructor(t){v(this,"initialAtomValues",new Map);this.parent=t}get isRoot(){return this.parent===null}commit(){if(this.isRoot){const t=this.initialAtomValues;this.initialAtomValues=new Map,O_(t.keys())}else this.initialAtomValues.forEach((t,n)=>{this.parent.initialAtomValues.has(n)||this.parent.initialAtomValues.set(n,t)})}abort(){Vt.globalEpoch++,this.initialAtomValues.forEach((t,n)=>{var r;n.set(t),(r=n.historyBuffer)==null||r.clear()}),this.commit()}}const Vt=Co("transactions",()=>({globalEpoch:ys+1,globalIsReacting:!1,currentTransaction:null}));function Rn(){return Vt.globalEpoch}function O_(e){if(Vt.globalIsReacting)throw new Error("cannot change atoms during reaction cycle");try{Vt.globalIsReacting=!0;const t=new Set,n=r=>{r.lastTraversedEpoch!==Vt.globalEpoch&&(r.lastTraversedEpoch=Vt.globalEpoch,r instanceof xa?t.add(r):r.children.visit(n))};for(const r of e)r.children.visit(n);for(const r of t)r.maybeScheduleEffect()}finally{Vt.globalIsReacting=!1}}function wL(e,t){Vt.currentTransaction?Vt.currentTransaction.initialAtomValues.has(e)||Vt.currentTransaction.initialAtomValues.set(e,t):O_([e])}function xL(){Vt.globalEpoch++}function SL(e){const t=new bL(Vt.currentTransaction);Vt.currentTransaction=t;try{let n=!1;const r=e(()=>n=!0);return n?t.abort():t.commit(),r}catch(n){throw t.abort(),n}finally{Vt.currentTransaction=Vt.currentTransaction.parent}}function Pr(e){return Vt.currentTransaction?e():SL(e)}class kL{constructor(t,n,r){v(this,"isEqual");v(this,"computeDiff");v(this,"lastChangedEpoch",Rn());v(this,"children",new M_);v(this,"historyBuffer");this.name=t,this.current=n,this.isEqual=(r==null?void 0:r.isEqual)??null,r&&(r.historyLength&&(this.historyBuffer=new A_(r.historyLength)),this.computeDiff=r.computeDiff)}__unsafe__getWithoutCapture(){return this.current}get(){return Zy(this),this.current}set(t,n){var i,o;if(((i=this.isEqual)==null?void 0:i.call(this,this.current,t))??P_(this.current,t))return this.current;xL(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,Rn(),n??((o=this.computeDiff)==null?void 0:o.call(this,this.current,t,this.lastChangedEpoch,Rn()))??Nn),this.lastChangedEpoch=Rn();const r=this.current;return this.current=t,wL(this,r),t}update(t){return this.set(t(this.current))}getDiffSince(t){var n;return Zy(this),t>=this.lastChangedEpoch?Ii:((n=this.historyBuffer)==null?void 0:n.getChangesSince(t))??Nn}}const _L=Co("Atom",()=>kL);function ln(e,t,n){return new _L(e,t,n)}let L_=!1;function CL(){L_||(L_=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const Qy=Symbol.for("com.tldraw.state/UNINITIALIZED"),Sa=e=>e===Qy,Jy=Co("WithDiff",()=>class{constructor(e,t){this.value=e,this.diff=t}});function Sc(e,t){return new Jy(e,t)}class EL{constructor(t,n,r){v(this,"lastChangedEpoch",ys);v(this,"lastTraversedEpoch",ys);v(this,"lastCheckedEpoch",ys);v(this,"parents",[]);v(this,"parentEpochs",[]);v(this,"children",new M_);v(this,"historyBuffer");v(this,"state",Qy);v(this,"computeDiff");v(this,"isEqual");this.name=t,this.derive=n,r!=null&&r.historyLength&&(this.historyBuffer=new A_(r.historyLength)),this.computeDiff=r==null?void 0:r.computeDiff,this.isEqual=(r==null?void 0:r.isEqual)??P_}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(){var n;const t=this.lastChangedEpoch===ys;if(!t&&(this.lastCheckedEpoch===Rn()||!E_(this)))return this.lastCheckedEpoch=Rn(),this.state;try{T_(this);const r=this.derive(this.state,this.lastCheckedEpoch),i=r instanceof Jy?r.value:r;if(this.state===Qy||!this.isEqual(i,this.state)){if(this.historyBuffer&&!t){const o=r instanceof Jy?r.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,Rn(),o??((n=this.computeDiff)==null?void 0:n.call(this,this.state,i,this.lastCheckedEpoch,Rn()))??Nn)}this.lastChangedEpoch=Rn(),this.state=i}return this.lastCheckedEpoch=Rn(),this.state}finally{j_()}}get(){const t=this.__unsafe__getWithoutCapture();return Zy(this),t}getDiffSince(t){var n;return this.get(),t>=this.lastChangedEpoch?Ii:((n=this.historyBuffer)==null?void 0:n.getChangesSince(t))??Nn}}const e0=Co("Computed",()=>EL);function PL(e={},t,n,r){const i=r.value,o=Symbol.for("__@tldraw/state__computed__"+n);return r.value=function(){let s=this[o];return s||(s=new e0(n,i.bind(this),e),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()},r.value[ML]=!0,r}function D_(e={},t,n,r){return r.get?(CL(),IL(e,t,n,r)):PL(e,t,n,r)}function IL(e={},t,n,r){const i=r.get,o=Symbol.for("__@tldraw/state__computed__"+n);return r.get=function(){let s=this[o];return s||(s=new e0(n,i.bind(this),e),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()},r}const ML="@@__isComputedMethod__@@";function q(){if(arguments.length===1){const e=arguments[0];return(t,n,r)=>D_(e,t,n,r)}else return typeof arguments[0]=="string"?new e0(arguments[0],arguments[1],arguments[2]):D_(void 0,arguments[0],arguments[1],arguments[2])}const z_=1,AL=Co("apiVersion",()=>z_);if(AL!==z_)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");function _h(e,t){const n=J.useRef(t);n.current=t;const[r,i,o]=J.useMemo(()=>{let s=null;const a=c=>(s=c,()=>{s=null}),l=new xa(`useStateTracking(${e})`,()=>{var c;return(c=n.current)==null?void 0:c.call(n)},{scheduleEffect(){s==null||s()}});return[l,a,()=>l.scheduleCount]},[e]);return J.useSyncExternalStore(i,o,o),J.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}const N_={apply(e,t,n){return _h(e.displayName??e.name??"tracked(???)",()=>e.apply(t,n))}},TL=Symbol.for("react.memo"),jL=Symbol.for("react.forward_ref");function Pe(e){let t=null;const n=e.$$typeof;return n===TL&&(e=e.type,t=e.compare),n===jL?x.memo(x.forwardRef(new Proxy(e.render,N_))):x.memo(new Proxy(e,N_),t)}function R_(){const e=arguments[0],t=arguments[1],n=arguments.length===3?void 0:arguments[2],r=arguments.length===3?arguments[2]:arguments[3];return x.useMemo(()=>q(`useComputed(${e})`,t,n),r)}function vs(e,t,n=Ii){x.useEffect(()=>{const r=new xa(e,t);return r.attach(),r.execute(),()=>{r.detach()}},n)}function Y(){const e=arguments,t=e.length===3?e[2]:[e[0]],n=e.length===3?e[0]:`useValue(${e[0].name})`,r=x.useRef(!0);r.current=!0;const i=x.useMemo(()=>e.length===1?e[0]:q(n,()=>{if(r.current)return e[1]();try{return e[1]()}catch{return{}}}),t);try{const{subscribe:o,getSnapshot:s}=x.useMemo(()=>({subscribe:a=>xc(`useValue(${n})`,()=>{i.get(),a()}),getSnapshot:()=>i.get()}),[i]);return x.useSyncExternalStore(o,s,s)}finally{r.current=!1}}class Ch{constructor(t){v(this,"nextValue");v(this,"diff");this.previousValue=t}get(){var r,i,o,s;const t=((i=(r=this.diff)==null?void 0:r.removed)==null?void 0:i.size)??0,n=((s=(o=this.diff)==null?void 0:o.added)==null?void 0:s.size)??0;if(!(t===0&&n===0))return{value:this.nextValue,diff:this.diff}}_add(t,n){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(t),this.diff??(this.diff={}),n?(r=this.diff.removed)==null||r.delete(t):((i=this.diff).added??(i.added=new Set),this.diff.added.add(t))}add(t){var r,i,o;const n=this.previousValue.has(t);if(n)return(i=(r=this.diff)==null?void 0:r.removed)!=null&&i.has(t)?this._add(t,n):void 0;(o=this.nextValue)!=null&&o.has(t)||this._add(t,n)}_remove(t,n){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(t),this.diff??(this.diff={}),n?((r=this.diff).removed??(r.removed=new Set),this.diff.removed.add(t)):(i=this.diff.added)==null||i.delete(t)}remove(t){var r,i,o,s;const n=this.previousValue.has(t);if(!n)return(i=(r=this.diff)==null?void 0:r.added)!=null&&i.has(t)?this._remove(t,n):void 0;(s=(o=this.diff)==null?void 0:o.removed)!=null&&s.has(t)||this._remove(t,n)}}function Eh(e,t){const n=[];e:for(const r of e){for(const i of n)if(t?t(r,i):r===i)continue e;n.push(r)}return n}function he(e){return e.filter(t=>t!=null)}function xn(e){return e[e.length-1]}function OL(e,t){let n,r=1/0;for(const i of e){const o=t(i);o<r&&(n=i,r=o)}return n}function LL(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0}function F_(e){const t=(...n)=>{try{return e(...n)}catch(r){throw r instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(r,t),r}};return t}function ka(e,t){const n=t&&e&&typeof e=="object"&&t in e?e[t]:e;throw new Error(`Unknown switch case ${n}`)}const bs=F_((e,t)=>{if(!e)throw new Error(t||"Assertion Error")}),DL=F_((e,t)=>{if(e==null)throw new Error(t??"value must be defined");return e});function $_(e,t){let n;const r=(...i)=>(n||(n={},n.promise=new Promise((o,s)=>{n.resolve=o,n.reject=s})),clearTimeout(n.timeout),n.latestArgs=i,n.timeout=setTimeout(()=>{const o=n;n=void 0;try{o.resolve(e(...o.latestArgs))}catch(s){o.reject(s)}},t),n.promise);return r.cancel=()=>{n&&clearTimeout(n.timeout)},r}const B_=new WeakMap;function t0(e,t){if(typeof e!="object"||e===null)return;let n=B_.get(e);n||(n={tags:{},extras:{}},B_.set(e,n)),t.tags&&(n.tags={...n.tags,...t.tags}),t.extras&&(n.extras={...n.extras,...t.extras})}class zL{static async base64ToFile(t){return fetch(t).then(function(n){return n.arrayBuffer()})}static async fileToBase64(t){return await new Promise((n,r)=>{if(t){const i=new FileReader;i.readAsDataURL(t),i.onload=()=>n(i.result),i.onerror=o=>r(o),i.onabort=o=>r(o)}})}}function Ph(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t+""}let n0=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(n0=new Int32Array(n0));const NL=(e,t)=>{let n=t===0?0:~~t^-1;for(let r=0;r<e.length;r++)n=n0[(n^e[r])&255]^n>>>8;return n^-1},U_=4,V_=4;class fi{static isPng(t,n){return t.getUint8(n+0)===137&&t.getUint8(n+1)===80&&t.getUint8(n+2)===78&&t.getUint8(n+3)===71&&t.getUint8(n+4)===13&&t.getUint8(n+5)===10&&t.getUint8(n+6)===26&&t.getUint8(n+7)===10}static getChunkType(t,n){return[String.fromCharCode(t.getUint8(n)),String.fromCharCode(t.getUint8(n+1)),String.fromCharCode(t.getUint8(n+2)),String.fromCharCode(t.getUint8(n+3))].join("")}static readChunks(t,n=0){const r={};if(!fi.isPng(t,n))throw new Error("Not a PNG");for(n+=8;n<=t.buffer.byteLength;){const i=n,o=t.getInt32(n);n+=4;const s=fi.getChunkType(t,n);if(s==="IDAT"&&r[s]){n+=o+U_+V_;continue}if(s==="IEND")break;r[s]={start:i,dataOffset:n+4,size:o},n+=o+U_+V_}return r}static parsePhys(t,n){return{ppux:t.getUint32(n),ppuy:t.getUint32(n+4),unit:t.getUint8(n+4)}}static findChunk(t,n){return fi.readChunks(t)[n]}static setPhysChunk(t,n=1,r){let i=46,o=0;const s=fi.findChunk(t,"pHYs");s&&(i=s.start,o=s.size);const a=fi.findChunk(t,"IDAT");a&&(i=a.start,o=0);const l=new ArrayBuffer(21),c=new DataView(l);c.setUint32(0,9),c.setUint8(4,"p".charCodeAt(0)),c.setUint8(5,"H".charCodeAt(0)),c.setUint8(6,"Y".charCodeAt(0)),c.setUint8(7,"s".charCodeAt(0));const u=2835.5;c.setInt32(8,u*n),c.setInt32(12,u*n),c.setInt8(16,1);const d=new Uint8Array(l.slice(4,17));c.setInt32(17,NL(d));const h=t.buffer.slice(0,i),p=t.buffer.slice(i+o);return new Blob([h,l,p],r)}}class H_{static async getVideoSizeFromSrc(t){return await new Promise((n,r)=>{const i=document.createElement("video");i.onloadeddata=()=>n({w:i.videoWidth,h:i.videoHeight}),i.onerror=o=>{console.error(o),r(new Error("Could not get video size"))},i.crossOrigin="anonymous",i.src=t})}static async getImageSizeFromSrc(t){return await new Promise((n,r)=>{const i=new Image;i.onload=async()=>{try{const o=await zL.base64ToFile(t),s=new DataView(o);if(fi.isPng(s,0)){const a=fi.findChunk(s,"pHYs");if(a){const l=fi.parsePhys(s,a.dataOffset);if(l.unit===0&&l.ppux===l.ppuy){const c=Math.max(l.ppux/2834.5,1);n({w:Math.round(i.width/c),h:Math.round(i.height/c)});return}}}n({w:i.width,h:i.height})}catch(o){console.error(o),n({w:i.width,h:i.height})}},i.onerror=o=>{console.error(o),r(new Error("Could not get image size"))},i.crossOrigin="anonymous",i.src=t})}}function Eo(e=""){let t=0,n=0,r=0,i=0;function o(){const s=t^t<<11;return t=n,n=r,r=i,i^=(i>>>19^s^s>>>8)>>>0,i/4294967296*2}for(let s=0;s<e.length+64;s++)t^=e.charCodeAt(s)|0,o();return o}function Ih(e,t,n,r=!1){const[i,o]=t,[s,a]=n,l=s+(e-i)/(o-i)*(a-s);return r?s<a?Math.max(Math.min(l,a),s):Math.max(Math.min(l,s),a):l}function Mh(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function ws(e,t){if(Mh(e,t))return e[t]}function Ht(e){if(!e)return e;if(Array.isArray(e)){const t=[],n=e.length;for(let r=0;r<n;r++)t.push(Ht(e[r]));return t}else if(typeof e=="object"){const t=Object.keys(e),n=t.length,r={};for(let i=0;i<n;i++){const o=t[i];r[o]=Ht(e[o])}return r}return e}function K_(e){return Object.keys(e)}function ut(e){return Object.values(e)}function Mi(e){return Object.entries(e)}function W_(e){return Object.fromEntries(e)}function r0(e,t){const n={};let r=!1;for(const[i,o]of Mi(e))t(i,o)?n[i]=o:r=!0;return r?n:e}function Y_(e,t){const n={};for(const[r,i]of Mi(e)){const o=t(r,i);n[r]=o}return n}function X_(e,t){if(e===t)return!0;const n=new Set(Object.keys(e)),r=new Set(Object.keys(t));if(n.size!==r.size)return!1;for(const i of n)if(!r.has(i)||!Object.is(e[i],t[i]))return!1;return!0}const RL=()=>typeof process<"u"&&!1,Ah=[],FL=()=>{const e=Ah.splice(0,Ah.length);for(const t of e)t()};let i0;function $L(){i0||(i0=requestAnimationFrame(()=>{i0=void 0,FL()}))}function BL(e){if(RL())return e();Ah.includes(e)||(Ah.push(e),$L())}function UL(e,t){return e.id>t.id?1:-1}function VL(e){return e!==null}const Po=typeof window<"u"&&window.structuredClone?window.structuredClone:e=>e&&JSON.parse(JSON.stringify(e));let Th=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>(n&=63,n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n>62?t+="-":t+="_",t),"");class Lw{constructor(t,n){v(this,"createDefaultProperties");v(this,"migrations");v(this,"validator");v(this,"scope");v(this,"isInstance",t=>(t==null?void 0:t.typeName)===this.typeName);this.typeName=t,this.createDefaultProperties=n.createDefaultProperties,this.migrations=n.migrations,this.validator=n.validator??{validate:r=>r},this.scope=n.scope??"document"}create(t){const n={...this.createDefaultProperties(),id:this.createId()};for(const[r,i]of Object.entries(t))i!==void 0&&(n[r]=i);return n.typeName=this.typeName,n}clone(t){return{...Po(t),id:this.createId()}}createId(t){return this.typeName+":"+(t??Th())}createCustomId(t){return this.typeName+":"+t}parseId(t){if(!this.isId(t))throw new Error(`ID "${t}" is not a valid ID for type "${this.typeName}"`);return t.slice(this.typeName.length+1)}isId(t){if(!t)return!1;for(let n=0;n<this.typeName.length;n++)if(t[n]!==this.typeName[n])return!1;return t[this.typeName.length]===":"}withDefaultProperties(t){return new Lw(this.typeName,{createDefaultProperties:t,migrations:this.migrations,validator:this.validator,scope:this.scope})}validate(t){return this.validator.validate(t)}}function Ai(e,t){return new Lw(e,{createDefaultProperties:()=>({}),migrations:t.migrations??{currentVersion:0,firstVersion:0,migrators:{}},validator:t.validator,scope:t.scope})}class G_{constructor(){v(this,"items",new WeakMap)}get(t,n){return this.items.has(t)||this.items.set(t,n(t)),this.items.get(t)}}var jh={exports:{}};jh.exports,function(e,t){var n=200,r="__lodash_hash_undefined__",i=1,o=2,s=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",d="[object Date]",h="[object Error]",p="[object Function]",g="[object GeneratorFunction]",f="[object Map]",m="[object Number]",w="[object Null]",b="[object Object]",k="[object Promise]",S="[object Proxy]",C="[object RegExp]",_="[object Set]",P="[object String]",I="[object Symbol]",M="[object Undefined]",A="[object WeakMap]",L="[object ArrayBuffer]",z="[object DataView]",$="[object Float32Array]",j="[object Float64Array]",F="[object Int8Array]",R="[object Int16Array]",W="[object Int32Array]",V="[object Uint8Array]",D="[object Uint8ClampedArray]",B="[object Uint16Array]",X="[object Uint32Array]",ie=/[\\^$.*+?()[\]{}|]/g,ue=/^\[object .+?Constructor\]$/,ge=/^(?:0|[1-9]\d*)$/,ce={};ce[$]=ce[j]=ce[F]=ce[R]=ce[W]=ce[V]=ce[D]=ce[B]=ce[X]=!0,ce[a]=ce[l]=ce[L]=ce[u]=ce[z]=ce[d]=ce[h]=ce[p]=ce[f]=ce[m]=ce[b]=ce[C]=ce[_]=ce[P]=ce[A]=!1;var be=typeof Oe=="object"&&Oe&&Oe.Object===Object&&Oe,ft=typeof self=="object"&&self&&self.Object===Object&&self,Ie=be||ft||Function("return this")(),Ce=t&&!t.nodeType&&t,Me=Ce&&!0&&e&&!e.nodeType&&e,vr=Me&&Me.exports===Ce,gn=vr&&be.process,Mn=function(){try{return gn&&gn.binding&&gn.binding("util")}catch{}}(),gt=Mn&&Mn.isTypedArray;function at(T,N){for(var K=-1,Q=T==null?0:T.length,Xe=0,ye=[];++K<Q;){var lt=T[K];N(lt,K,T)&&(ye[Xe++]=lt)}return ye}function gi(T,N){for(var K=-1,Q=N.length,Xe=T.length;++K<Q;)T[Xe+K]=N[K];return T}function Pl(T,N){for(var K=-1,Q=T==null?0:T.length;++K<Q;)if(N(T[K],K,T))return!0;return!1}function Ig(T,N){for(var K=-1,Q=Array(T);++K<T;)Q[K]=N(K);return Q}function Mg(T){return function(N){return T(N)}}function Ag(T,N){return T.has(N)}function Vs(T,N){return T==null?void 0:T[N]}function Rj(T){var N=-1,K=Array(T.size);return T.forEach(function(Q,Xe){K[++N]=[Xe,Q]}),K}function Fj(T,N){return function(K){return T(N(K))}}function $j(T){var N=-1,K=Array(T.size);return T.forEach(function(Q){K[++N]=Q}),K}var Bj=Array.prototype,Uj=Function.prototype,ed=Object.prototype,Tg=Ie["__core-js_shared__"],Rw=Uj.toString,Kr=ed.hasOwnProperty,Fw=function(){var T=/[^.]+$/.exec(Tg&&Tg.keys&&Tg.keys.IE_PROTO||"");return T?"Symbol(src)_1."+T:""}(),$w=ed.toString,Vj=RegExp("^"+Rw.call(Kr).replace(ie,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Bw=vr?Ie.Buffer:void 0,td=Ie.Symbol,Uw=Ie.Uint8Array,Vw=ed.propertyIsEnumerable,Hj=Bj.splice,Zo=td?td.toStringTag:void 0,Hw=Object.getOwnPropertySymbols,Kj=Bw?Bw.isBuffer:void 0,Wj=Fj(Object.keys,Object),jg=Hs(Ie,"DataView"),Il=Hs(Ie,"Map"),Og=Hs(Ie,"Promise"),Lg=Hs(Ie,"Set"),Dg=Hs(Ie,"WeakMap"),Ml=Hs(Object,"create"),Yj=es(jg),Xj=es(Il),Gj=es(Og),qj=es(Lg),Zj=es(Dg),Kw=td?td.prototype:void 0,zg=Kw?Kw.valueOf:void 0;function Qo(T){var N=-1,K=T==null?0:T.length;for(this.clear();++N<K;){var Q=T[N];this.set(Q[0],Q[1])}}function Qj(){this.__data__=Ml?Ml(null):{},this.size=0}function Jj(T){var N=this.has(T)&&delete this.__data__[T];return this.size-=N?1:0,N}function e5(T){var N=this.__data__;if(Ml){var K=N[T];return K===r?void 0:K}return Kr.call(N,T)?N[T]:void 0}function t5(T){var N=this.__data__;return Ml?N[T]!==void 0:Kr.call(N,T)}function n5(T,N){var K=this.__data__;return this.size+=this.has(T)?0:1,K[T]=Ml&&N===void 0?r:N,this}Qo.prototype.clear=Qj,Qo.prototype.delete=Jj,Qo.prototype.get=e5,Qo.prototype.has=t5,Qo.prototype.set=n5;function mi(T){var N=-1,K=T==null?0:T.length;for(this.clear();++N<K;){var Q=T[N];this.set(Q[0],Q[1])}}function r5(){this.__data__=[],this.size=0}function i5(T){var N=this.__data__,K=rd(N,T);if(K<0)return!1;var Q=N.length-1;return K==Q?N.pop():Hj.call(N,K,1),--this.size,!0}function o5(T){var N=this.__data__,K=rd(N,T);return K<0?void 0:N[K][1]}function s5(T){return rd(this.__data__,T)>-1}function a5(T,N){var K=this.__data__,Q=rd(K,T);return Q<0?(++this.size,K.push([T,N])):K[Q][1]=N,this}mi.prototype.clear=r5,mi.prototype.delete=i5,mi.prototype.get=o5,mi.prototype.has=s5,mi.prototype.set=a5;function Jo(T){var N=-1,K=T==null?0:T.length;for(this.clear();++N<K;){var Q=T[N];this.set(Q[0],Q[1])}}function l5(){this.size=0,this.__data__={hash:new Qo,map:new(Il||mi),string:new Qo}}function c5(T){var N=id(this,T).delete(T);return this.size-=N?1:0,N}function u5(T){return id(this,T).get(T)}function d5(T){return id(this,T).has(T)}function h5(T,N){var K=id(this,T),Q=K.size;return K.set(T,N),this.size+=K.size==Q?0:1,this}Jo.prototype.clear=l5,Jo.prototype.delete=c5,Jo.prototype.get=u5,Jo.prototype.has=d5,Jo.prototype.set=h5;function nd(T){var N=-1,K=T==null?0:T.length;for(this.__data__=new Jo;++N<K;)this.add(T[N])}function p5(T){return this.__data__.set(T,r),this}function f5(T){return this.__data__.has(T)}nd.prototype.add=nd.prototype.push=p5,nd.prototype.has=f5;function to(T){var N=this.__data__=new mi(T);this.size=N.size}function g5(){this.__data__=new mi,this.size=0}function m5(T){var N=this.__data__,K=N.delete(T);return this.size=N.size,K}function y5(T){return this.__data__.get(T)}function v5(T){return this.__data__.has(T)}function b5(T,N){var K=this.__data__;if(K instanceof mi){var Q=K.__data__;if(!Il||Q.length<n-1)return Q.push([T,N]),this.size=++K.size,this;K=this.__data__=new Jo(Q)}return K.set(T,N),this.size=K.size,this}to.prototype.clear=g5,to.prototype.delete=m5,to.prototype.get=y5,to.prototype.has=v5,to.prototype.set=b5;function w5(T,N){var K=od(T),Q=!K&&D5(T),Xe=!K&&!Q&&Ng(T),ye=!K&&!Q&&!Xe&&ex(T),lt=K||Q||Xe||ye,bt=lt?Ig(T.length,String):[],Pt=bt.length;for(var et in T)(N||Kr.call(T,et))&&!(lt&&(et=="length"||Xe&&(et=="offset"||et=="parent")||ye&&(et=="buffer"||et=="byteLength"||et=="byteOffset")||A5(et,Pt)))&&bt.push(et);return bt}function rd(T,N){for(var K=T.length;K--;)if(qw(T[K][0],N))return K;return-1}function x5(T,N,K){var Q=N(T);return od(T)?Q:gi(Q,K(T))}function Al(T){return T==null?T===void 0?M:w:Zo&&Zo in Object(T)?I5(T):L5(T)}function Ww(T){return Tl(T)&&Al(T)==a}function Yw(T,N,K,Q,Xe){return T===N?!0:T==null||N==null||!Tl(T)&&!Tl(N)?T!==T&&N!==N:S5(T,N,K,Q,Yw,Xe)}function S5(T,N,K,Q,Xe,ye){var lt=od(T),bt=od(N),Pt=lt?l:no(T),et=bt?l:no(N);Pt=Pt==a?b:Pt,et=et==a?b:et;var An=Pt==b,br=et==b,Rt=Pt==et;if(Rt&&Ng(T)){if(!Ng(N))return!1;lt=!0,An=!1}if(Rt&&!An)return ye||(ye=new to),lt||ex(T)?Xw(T,N,K,Q,Xe,ye):E5(T,N,Pt,K,Q,Xe,ye);if(!(K&i)){var Jn=An&&Kr.call(T,"__wrapped__"),er=br&&Kr.call(N,"__wrapped__");if(Jn||er){var ro=Jn?T.value():T,yi=er?N.value():N;return ye||(ye=new to),Xe(ro,yi,K,Q,ye)}}return Rt?(ye||(ye=new to),P5(T,N,K,Q,Xe,ye)):!1}function k5(T){if(!Jw(T)||j5(T))return!1;var N=Zw(T)?Vj:ue;return N.test(es(T))}function _5(T){return Tl(T)&&Qw(T.length)&&!!ce[Al(T)]}function C5(T){if(!O5(T))return Wj(T);var N=[];for(var K in Object(T))Kr.call(T,K)&&K!="constructor"&&N.push(K);return N}function Xw(T,N,K,Q,Xe,ye){var lt=K&i,bt=T.length,Pt=N.length;if(bt!=Pt&&!(lt&&Pt>bt))return!1;var et=ye.get(T);if(et&&ye.get(N))return et==N;var An=-1,br=!0,Rt=K&o?new nd:void 0;for(ye.set(T,N),ye.set(N,T);++An<bt;){var Jn=T[An],er=N[An];if(Q)var ro=lt?Q(er,Jn,An,N,T,ye):Q(Jn,er,An,T,N,ye);if(ro!==void 0){if(ro)continue;br=!1;break}if(Rt){if(!Pl(N,function(yi,ts){if(!Ag(Rt,ts)&&(Jn===yi||Xe(Jn,yi,K,Q,ye)))return Rt.push(ts)})){br=!1;break}}else if(!(Jn===er||Xe(Jn,er,K,Q,ye))){br=!1;break}}return ye.delete(T),ye.delete(N),br}function E5(T,N,K,Q,Xe,ye,lt){switch(K){case z:if(T.byteLength!=N.byteLength||T.byteOffset!=N.byteOffset)return!1;T=T.buffer,N=N.buffer;case L:return!(T.byteLength!=N.byteLength||!ye(new Uw(T),new Uw(N)));case u:case d:case m:return qw(+T,+N);case h:return T.name==N.name&&T.message==N.message;case C:case P:return T==N+"";case f:var bt=Rj;case _:var Pt=Q&i;if(bt||(bt=$j),T.size!=N.size&&!Pt)return!1;var et=lt.get(T);if(et)return et==N;Q|=o,lt.set(T,N);var An=Xw(bt(T),bt(N),Q,Xe,ye,lt);return lt.delete(T),An;case I:if(zg)return zg.call(T)==zg.call(N)}return!1}function P5(T,N,K,Q,Xe,ye){var lt=K&i,bt=Gw(T),Pt=bt.length,et=Gw(N),An=et.length;if(Pt!=An&&!lt)return!1;for(var br=Pt;br--;){var Rt=bt[br];if(!(lt?Rt in N:Kr.call(N,Rt)))return!1}var Jn=ye.get(T);if(Jn&&ye.get(N))return Jn==N;var er=!0;ye.set(T,N),ye.set(N,T);for(var ro=lt;++br<Pt;){Rt=bt[br];var yi=T[Rt],ts=N[Rt];if(Q)var tx=lt?Q(ts,yi,Rt,N,T,ye):Q(yi,ts,Rt,T,N,ye);if(!(tx===void 0?yi===ts||Xe(yi,ts,K,Q,ye):tx)){er=!1;break}ro||(ro=Rt=="constructor")}if(er&&!ro){var sd=T.constructor,ad=N.constructor;sd!=ad&&"constructor"in T&&"constructor"in N&&!(typeof sd=="function"&&sd instanceof sd&&typeof ad=="function"&&ad instanceof ad)&&(er=!1)}return ye.delete(T),ye.delete(N),er}function Gw(T){return x5(T,R5,M5)}function id(T,N){var K=T.__data__;return T5(N)?K[typeof N=="string"?"string":"hash"]:K.map}function Hs(T,N){var K=Vs(T,N);return k5(K)?K:void 0}function I5(T){var N=Kr.call(T,Zo),K=T[Zo];try{T[Zo]=void 0;var Q=!0}catch{}var Xe=$w.call(T);return Q&&(N?T[Zo]=K:delete T[Zo]),Xe}var M5=Hw?function(T){return T==null?[]:(T=Object(T),at(Hw(T),function(N){return Vw.call(T,N)}))}:F5,no=Al;(jg&&no(new jg(new ArrayBuffer(1)))!=z||Il&&no(new Il)!=f||Og&&no(Og.resolve())!=k||Lg&&no(new Lg)!=_||Dg&&no(new Dg)!=A)&&(no=function(T){var N=Al(T),K=N==b?T.constructor:void 0,Q=K?es(K):"";if(Q)switch(Q){case Yj:return z;case Xj:return f;case Gj:return k;case qj:return _;case Zj:return A}return N});function A5(T,N){return N=N??s,!!N&&(typeof T=="number"||ge.test(T))&&T>-1&&T%1==0&&T<N}function T5(T){var N=typeof T;return N=="string"||N=="number"||N=="symbol"||N=="boolean"?T!=="__proto__":T===null}function j5(T){return!!Fw&&Fw in T}function O5(T){var N=T&&T.constructor,K=typeof N=="function"&&N.prototype||ed;return T===K}function L5(T){return $w.call(T)}function es(T){if(T!=null){try{return Rw.call(T)}catch{}try{return T+""}catch{}}return""}function qw(T,N){return T===N||T!==T&&N!==N}var D5=Ww(function(){return arguments}())?Ww:function(T){return Tl(T)&&Kr.call(T,"callee")&&!Vw.call(T,"callee")},od=Array.isArray;function z5(T){return T!=null&&Qw(T.length)&&!Zw(T)}var Ng=Kj||$5;function N5(T,N){return Yw(T,N)}function Zw(T){if(!Jw(T))return!1;var N=Al(T);return N==p||N==g||N==c||N==S}function Qw(T){return typeof T=="number"&&T>-1&&T%1==0&&T<=s}function Jw(T){var N=typeof T;return T!=null&&(N=="object"||N=="function")}function Tl(T){return T!=null&&typeof T=="object"}var ex=gt?Mg(gt):_5;function R5(T){return z5(T)?w5(T):C5(T)}function F5(){return[]}function $5(){return!1}e.exports=N5}(jh,jh.exports);var HL=jh.exports;const KL=ns(HL);function WL(e){if(e.length===0)return new Set;const t=e[0],n=e.slice(1),r=new Set;for(const i of t)n.every(o=>o.has(i))&&r.add(i);return r}function YL(e,t){const n={};for(const r of t)e.has(r)||(n.added??(n.added=new Set),n.added.add(r));for(const r of e)t.has(r)||(n.removed??(n.removed=new Set),n.removed.add(r));return n.added||n.removed?n:void 0}function q_(e,t){for(const[n,r]of Object.entries(e)){const i=r,o=t[n];if("eq"in i&&o!==i.eq||"neq"in i&&o===i.neq||"gt"in i&&(typeof o!="number"||o<=i.gt))return!1}return!0}function Z_(e,t,n){const r=Object.fromEntries(Object.keys(n).map(i=>[i,new Set]));for(const[i,o]of Object.entries(n))if("eq"in o){const s=e.index(t,i).get().get(o.eq);if(s)for(const a of s)r[i].add(a)}else if("neq"in o){const s=e.index(t,i);for(const[a,l]of s.get())if(a!==o.neq)for(const c of l)r[i].add(c)}else if("gt"in o){const s=e.index(t,i);for(const[a,l]of s.get())if(a>o.gt)for(const c of l)r[i].add(c)}return WL(Object.values(r))}class XL{constructor(t,n){v(this,"indexCache",new Map);v(this,"historyCache",new Map);this.atoms=t,this.history=n}filterHistory(t){if(this.historyCache.has(t))return this.historyCache.get(t);const n=q("filterHistory:"+t,(r,i)=>{if(Sa(r))return this.history.get();const o=this.history.getDiffSince(i);if(o===Nn)return this.history.get();const s={added:{},removed:{},updated:{}};let a=0,l=0,c=0;for(const u of o){for(const d of ut(u.added))if(d.typeName===t)if(s.removed[d.id]){const h=s.removed[d.id];delete s.removed[d.id],l--,h!==d&&(s.updated[d.id]=[h,d],c++)}else s.added[d.id]=d,a++;for(const[d,h]of ut(u.updated))h.typeName===t&&(s.added[h.id]?s.added[h.id]=h:s.updated[h.id]?s.updated[h.id]=[s.updated[h.id][0],h]:(s.updated[h.id]=[d,h],c++));for(const d of ut(u.removed))d.typeName===t&&(s.added[d.id]?(delete s.added[d.id],a--):s.updated[d.id]?(s.removed[d.id]=s.updated[d.id][0],delete s.updated[d.id],c--,l++):(s.removed[d.id]=d,l++))}return a||l||c?Sc(this.history.get(),s):r},{historyLength:100});return this.historyCache.set(t,n),n}index(t,n){const r=t+":"+n;if(this.indexCache.has(r))return this.indexCache.get(r);const i=this.__uncached_createIndex(t,n);return this.indexCache.set(r,i),i}__uncached_createIndex(t,n){const r=this.filterHistory(t),i=()=>{r.get();const o=new Map;for(const s of ut(this.atoms.get())){const a=s.get();if(a.typeName===t){const l=a[n];o.has(l)||o.set(l,new Set),o.get(l).add(a.id)}}return o};return q("index:"+t+":"+n,(o,s)=>{if(Sa(o))return i();const a=r.getDiffSince(s);if(a===Nn)return i();const l=new Map,c=(p,g)=>{let f=l.get(p);f||(f=new Ch(o.get(p)??new Set)),f.add(g),l.set(p,f)},u=(p,g)=>{let f=l.get(p);f||(f=new Ch(o.get(p)??new Set)),f.remove(g),l.set(p,f)};for(const p of a){for(const g of ut(p.added))if(g.typeName===t){const f=g[n];c(f,g.id)}for(const[g,f]of ut(p.updated))if(f.typeName===t){const m=g[n],w=f[n];m!==w&&(u(m,f.id),c(w,f.id))}for(const g of ut(p.removed))if(g.typeName===t){const f=g[n];u(f,g.id)}}let d,h;for(const[p,g]of l){const f=g.get();f&&(d||(d=new Map(o)),h||(h=new Map),f.value.size===0?d.delete(p):d.set(p,f.value),h.set(p,f.diff))}return d&&h?Sc(d,h):o},{historyLength:100})}record(t,n=()=>({}),r="record:"+t+(n?":"+n.toString():"")){const i=this.ids(t,n,r);return q(r,()=>{var o;for(const s of i.get())return(o=this.atoms.get()[s])==null?void 0:o.get()})}records(t,n=()=>({}),r="records:"+t+(n?":"+n.toString():"")){const i=this.ids(t,n,"ids:"+r);return q(r,()=>[...i.get()].map(o=>{const s=this.atoms.get()[o];if(!s)throw new Error("no atom found for record id: "+o);return s.get()}))}ids(t,n=()=>({}),r="ids:"+t+(n?":"+n.toString():"")){const i=this.filterHistory(t),o=()=>{i.get();const l=n();return Object.keys(l).length===0?new Set(ut(this.atoms.get()).flatMap(c=>{const u=c.get();return u.typeName===t?u.id:[]})):Z_(this,t,l)},s=l=>{const c=o(),u=YL(l,c);return u?Sc(c,u):l},a=q("ids_query:"+r,n,{isEqual:KL});return q("query:"+r,(l,c)=>{const u=a.get();if(Sa(l))return o();if(c<a.lastChangedEpoch)return s(l);const d=i.getDiffSince(c);if(d===Nn)return s(l);const h=new Ch(l);for(const g of d){for(const f of ut(g.added))f.typeName===t&&q_(u,f)&&h.add(f.id);for(const[f,m]of ut(g.updated))m.typeName===t&&(q_(u,m)?h.add(m.id):h.remove(m.id));for(const f of ut(g.removed))f.typeName===t&&h.remove(f.id)}const p=h.get();return p?Sc(p.value,p.diff):l},{historyLength:50})}exec(t,n){const r=Z_(this,t,n);if(r.size===0)return Ii;const i=this.atoms.get();return[...r].map(o=>i[o].get())}}class Q_{constructor(t){v(this,"id",Th());v(this,"atoms",ln("store_atoms",{}));v(this,"history",ln("history",0,{historyLength:1e3}));v(this,"query",new XL(this.atoms,this.history));v(this,"listeners",new Set);v(this,"historyAccumulator",new qL);v(this,"historyReactor");v(this,"schema");v(this,"props");v(this,"scopedTypes");v(this,"onBeforeCreate");v(this,"onAfterCreate");v(this,"onBeforeChange");v(this,"onAfterChange");v(this,"onBeforeDelete");v(this,"onAfterDelete");v(this,"_runCallbacks",!0);v(this,"put",(t,n)=>{Pr(()=>{const r={},i={},o=this.atoms.__unsafe__getWithoutCapture();let s=null,a,l=!1;const c=this.onBeforeCreate&&this._runCallbacks?this.onBeforeCreate:null,u=this.onBeforeChange&&this._runCallbacks?this.onBeforeChange:null,d=this.isMergingRemoteChanges?"remote":"user";for(let h=0,p=t.length;h<p;h++){a=t[h];const g=(s??o)[a.id];if(g){const f=g.__unsafe__getWithoutCapture();u&&(a=u(f,a,d)),a=this.schema.validateRecord(this,a,n??"updateRecord",f),g.set(a);const m=g.__unsafe__getWithoutCapture();f!==m&&(l=!0,r[a.id]=[f,m])}else c&&(a=c(a,d)),l=!0,a=this.schema.validateRecord(this,a,n??"createRecord",null),i[a.id]=a,s||(s={...o}),s[a.id]=ln("atom:"+a.id,a)}if(s&&this.atoms.set(s),!!l&&(this.updateHistory({added:i,updated:r,removed:{}}),this._runCallbacks)){const{onAfterCreate:h,onAfterChange:p}=this;h&&Object.values(i).forEach(g=>{h(g,d)}),p&&Object.values(r).forEach(([g,f])=>{p(g,f,d)})}})});v(this,"remove",t=>{Pr(()=>{const n=[],r=this.isMergingRemoteChanges?"remote":"user";if(this.onBeforeDelete&&this._runCallbacks)for(const o of t){const s=this.atoms.__unsafe__getWithoutCapture()[o];s&&this.onBeforeDelete(s.get(),r)===!1&&n.push(o)}let i;if(this.atoms.update(o=>{let s;for(const a of t)n.includes(a)||a in o&&(s||(s={...o}),i||(i={}),delete s[a],i[a]=o[a].get());return s??o}),!!i&&(this.updateHistory({added:{},updated:{},removed:i}),this.onAfterDelete&&this._runCallbacks)){let o;for(let s=0,a=t.length;s<a;s++)o=i[t[s]],o&&this.onAfterDelete(o,r)}})});v(this,"get",t=>{var n;return(n=this.atoms.get()[t])==null?void 0:n.get()});v(this,"unsafeGetWithoutCapture",t=>{var n;return(n=this.atoms.get()[t])==null?void 0:n.__unsafe__getWithoutCapture()});v(this,"serialize",(t="document")=>{const n={};for(const[r,i]of Mi(this.atoms.get())){const o=i.get();(t==="all"||this.scopedTypes[t].has(o.typeName))&&(n[r]=o)}return n});v(this,"allRecords",()=>ut(this.atoms.get()).map(t=>t.get()));v(this,"clear",()=>{this.remove(K_(this.atoms.get()))});v(this,"update",(t,n)=>{const r=this.atoms.get()[t];if(!r){console.error(`Record ${t} not found. This is probably an error`);return}this.put([n(r.__unsafe__getWithoutCapture())])});v(this,"has",t=>!!this.atoms.get()[t]);v(this,"listen",(t,n)=>{this._flushHistory();const r={onHistory:t,filters:{source:(n==null?void 0:n.source)??"all",scope:(n==null?void 0:n.scope)??"all"}};return this.listeners.add(r),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(r),this.listeners.size===0&&this.historyReactor.stop()}});v(this,"isMergingRemoteChanges",!1);v(this,"mergeRemoteChanges",t=>{if(this.isMergingRemoteChanges)return t();try{this.isMergingRemoteChanges=!0,Pr(t)}finally{this.isMergingRemoteChanges=!1}});v(this,"createComputedCache",(t,n,r)=>{const i=new G_;return{get:o=>{const s=this.atoms.get()[o];if(s)return i.get(s,()=>{const a=r?q(s.name+":equals",()=>s.get(),{isEqual:r}):s;return q(t+":"+o,()=>n(a.get()))}).get()}}});v(this,"createSelectedComputedCache",(t,n,r)=>{const i=new G_;return{get:o=>{const s=this.atoms.get()[o];if(!s)return;const a=q(t+":"+o+":selector",()=>n(s.get()));return i.get(s,()=>q(t+":"+o,()=>r(a.get()))).get()}}});v(this,"getRecordType",t=>{const n=this.schema.types[t.typeName];if(!n)throw new Error(`Record type ${t.typeName} not found`);return n});v(this,"_integrityChecker");v(this,"_isPossiblyCorrupted",!1);const{initialData:n,schema:r}=t;this.schema=r,this.props=t.props,n&&this.atoms.set(W_(Mi(n).map(([i,o])=>[i,ln("atom:"+i,this.schema.validateRecord(this,o,"initialize",null))]))),this.historyReactor=vL("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:i=>BL(i)}),this.scopedTypes={document:new Set(ut(this.schema.types).filter(i=>i.scope==="document").map(i=>i.typeName)),session:new Set(ut(this.schema.types).filter(i=>i.scope==="session").map(i=>i.typeName)),presence:new Set(ut(this.schema.types).filter(i=>i.scope==="presence").map(i=>i.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const t=this.historyAccumulator.flush();for(const{changes:n,source:r}of t){let i=null,o=null,s=null;for(const{onHistory:a,filters:l}of this.listeners)if(!(l.source!=="all"&&l.source!==r))if(l.scope!=="all")if(l.scope==="document"){if(o??(o=this.filterChangesByScope(n,"document")),!o)continue;a({changes:o,source:r})}else if(l.scope==="session"){if(i??(i=this.filterChangesByScope(n,"session")),!i)continue;a({changes:i,source:r})}else{if(s??(s=this.filterChangesByScope(n,"presence")),!s)continue;a({changes:s,source:r})}else a({changes:n,source:r})}}}filterChangesByScope(t,n){const r={added:r0(t.added,(i,o)=>this.scopedTypes[n].has(o.typeName)),updated:r0(t.updated,(i,o)=>this.scopedTypes[n].has(o[1].typeName)),removed:r0(t.removed,(i,o)=>this.scopedTypes[n].has(o.typeName))};return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0?null:r}updateHistory(t){this.historyAccumulator.add({changes:t,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,t)}validate(t){this.allRecords().forEach(n=>this.schema.validateRecord(this,n,t,null))}getSnapshot(t="document"){return{store:this.serialize(t),schema:this.schema.serialize()}}migrateSnapshot(t){const n=this.schema.migrateStoreSnapshot(t);if(n.type==="error")throw new Error(`Failed to migrate snapshot: ${n.reason}`);return{store:n.value,schema:this.schema.serialize()}}loadSnapshot(t){const n=this.schema.migrateStoreSnapshot(t);if(n.type==="error")throw new Error(`Failed to migrate snapshot: ${n.reason}`);Pr(()=>{this.clear(),this.put(Object.values(n.value)),this.ensureStoreIsUsable()})}extractingChanges(t){const n=[],r=this.historyAccumulator.intercepting(i=>n.push(i.changes));try{return Pr(t),Oh(n)}finally{r()}}applyDiff(t,n=!0){const r=this._runCallbacks;try{this._runCallbacks=n,Pr(()=>{const i=ut(t.added).concat(ut(t.updated).map(([s,a])=>a)),o=K_(t.removed);i.length&&this.put(i),o.length&&this.remove(o)})}finally{this._runCallbacks=r}}ensureStoreIsUsable(){var t;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(t=this._integrityChecker)==null||t.call(this)}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}}function Oh(e){const t={added:{},removed:{},updated:{}};for(const n of e){for(const[r,i]of Mi(n.added))if(t.removed[r]){const o=t.removed[r];delete t.removed[r],o!==i&&(t.updated[r]=[o,i])}else t.added[r]=i;for(const[r,[i,o]]of Mi(n.updated)){if(t.added[r]){t.added[r]=o,delete t.updated[r],delete t.removed[r];continue}if(t.updated[r]){t.updated[r]=[t.updated[r][0],o],delete t.removed[r];continue}t.updated[r]=n.updated[r],delete t.removed[r]}for(const[r,i]of Mi(n.removed))t.added[r]?delete t.added[r]:t.updated[r]?(t.removed[r]=t.updated[r][0],delete t.updated[r]):t.removed[r]=i}return t}function GL(e){const t=[];let n=e[0],r;for(let i=1,o=e.length;i<o;i++)r=e[i],n.source!==r.source?(t.push(n),n=r):n={source:n.source,changes:Oh([n.changes,r.changes])};return t.push(n),t}class qL{constructor(){v(this,"_history",[]);v(this,"_interceptors",new Set)}intercepting(t){return this._interceptors.add(t),()=>{this._interceptors.delete(t)}}add(t){this._history.push(t);for(const n of this._interceptors)n(t)}flush(){const t=GL(this._history);return this._history=[],t}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function ZL(e){return typeof e=="object"&&e!==null&&"id"in e&&"typeName"in e}function Ae(e){const{currentVersion:t,firstVersion:n,migrators:r={},subTypeKey:i,subTypeMigrations:o}=e;if(typeof t=="number"&&typeof n=="number"){if(t===n)throw Error("Current version is equal to initial version.");if(t<n)throw Error("Current version is lower than initial version.")}return{firstVersion:n??0,currentVersion:t??0,migrators:r,subTypeKey:i,subTypeMigrations:o}}var kc=(e=>(e.IncompatibleSubtype="incompatible-subtype",e.UnknownType="unknown-type",e.TargetVersionTooNew="target-version-too-new",e.TargetVersionTooOld="target-version-too-old",e.MigrationError="migration-error",e.UnrecognizedSubtype="unrecognized-subtype",e))(kc||{});function J_({record:e,migrations:t,fromVersion:n,toVersion:r}){let i=n;if(!ZL(e))throw new Error("[migrateRecord] object is not a record");const{typeName:o,id:s,...a}=e;let l=a;for(;i<r;){const c=i+1,u=t.migrators[c];if(!u)return{type:"error",reason:"target-version-too-new"};l=u.up(l),i=c}for(;i>r;){const c=i-1,u=t.migrators[i];if(!u)return{type:"error",reason:"target-version-too-old"};l=u.down(l),i=c}return{type:"success",value:{...l,id:s,typeName:o}}}function o0({value:e,migrations:t,fromVersion:n,toVersion:r}){let i=n;for(;i<r;){const o=i+1,s=t.migrators[o];if(!s)return{type:"error",reason:"target-version-too-new"};e=s.up(e),i=o}for(;i>r;){const o=i-1,s=t.migrators[i];if(!s)return{type:"error",reason:"target-version-too-old"};e=s.down(e),i=o}return{type:"success",value:e}}class Dw{constructor(t,n){this.types=t,this.options=n}static create(t,n){return new Dw(t,n??{})}get currentStoreVersion(){var t;return((t=this.options.snapshotMigrations)==null?void 0:t.currentVersion)??0}validateRecord(t,n,r,i){try{const o=ws(this.types,n.typeName);if(!o)throw new Error(`Missing definition for record type ${n.typeName}`);return o.validate(n)}catch(o){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:t,record:n,phase:r,recordBefore:i,error:o});throw o}}migratePersistedRecord(t,n,r="up"){var d;const i=ws(this.types,t.typeName),o=n.recordVersions[t.typeName];if(!o||!i)return{type:"error",reason:kc.UnknownType};const s=i.migrations.currentVersion,a=o.version;if(s!==a){const h=J_(r==="up"?{record:t,migrations:i.migrations,fromVersion:a,toVersion:s}:{record:t,migrations:i.migrations,fromVersion:s,toVersion:a});if(h.type==="error")return h;t=h.value}if(!i.migrations.subTypeKey)return{type:"success",value:t};const l=(d=i.migrations.subTypeMigrations)==null?void 0:d[t[i.migrations.subTypeKey]],c="subTypeVersions"in o?o.subTypeVersions[t[i.migrations.subTypeKey]]:void 0;if(l===void 0)return{type:"error",reason:kc.UnrecognizedSubtype};if(c===void 0)return{type:"error",reason:kc.IncompatibleSubtype};const u=J_(r==="up"?{record:t,migrations:l,fromVersion:c,toVersion:l.currentVersion}:{record:t,migrations:l,fromVersion:l.currentVersion,toVersion:c});return u.type==="error"?u:{type:"success",value:u.value}}migrateStoreSnapshot(t){let{store:n}=t;const r=this.options.snapshotMigrations;if(!r)return{type:"success",value:n};const i=r.currentVersion,o=t.schema.storeVersion??0;if(i<o)return{type:"error",reason:kc.TargetVersionTooOld};if(i>o){const a=o0({value:n,migrations:r,fromVersion:o,toVersion:i});if(a.type==="error")return a;n=a.value}const s=[];for(const a of ut(n)){const l=this.migratePersistedRecord(a,t.schema);if(l.type==="error")return l;l.value&&l.value!==a&&s.push(l.value)}if(s.length){n={...n};for(const a of s)n[a.id]=a}return{type:"success",value:n}}createIntegrityChecker(t){var n,r;return((r=(n=this.options).createIntegrityChecker)==null?void 0:r.call(n,t))??void 0}serialize(){var t;return{schemaVersion:1,storeVersion:((t=this.options.snapshotMigrations)==null?void 0:t.currentVersion)??0,recordVersions:Object.fromEntries(ut(this.types).map(n=>[n.typeName,n.migrations.subTypeKey&&n.migrations.subTypeMigrations?{version:n.migrations.currentVersion,subTypeKey:n.migrations.subTypeKey,subTypeVersions:n.migrations.subTypeMigrations?Object.fromEntries(Object.entries(n.migrations.subTypeMigrations).map(([r,i])=>[r,i.currentVersion])):void 0}:{version:n.migrations.currentVersion}]))}}serializeEarliestVersion(){var t;return{schemaVersion:1,storeVersion:((t=this.options.snapshotMigrations)==null?void 0:t.firstVersion)??0,recordVersions:Object.fromEntries(ut(this.types).map(n=>[n.typeName,n.migrations.subTypeKey&&n.migrations.subTypeMigrations?{version:n.migrations.firstVersion,subTypeKey:n.migrations.subTypeKey,subTypeVersions:n.migrations.subTypeMigrations?Object.fromEntries(Object.entries(n.migrations.subTypeMigrations).map(([r,i])=>[r,i.firstVersion])):void 0}:{version:n.migrations.firstVersion}]))}}}const QL=(e,t)=>{if(e.schemaVersion>t.schemaVersion)return 1;if(e.schemaVersion<t.schemaVersion)return-1;if(e.storeVersion>t.storeVersion)return 1;if(e.storeVersion<t.storeVersion)return-1;for(const n of Object.keys(e.recordVersions)){const r=e.recordVersions[n],i=t.recordVersions[n];if(r.version>i.version)return 1;if(r.version<i.version)return-1;if("subTypeVersions"in r&&!("subTypeVersions"in i))return 1;if(!("subTypeVersions"in r)&&"subTypeVersions"in i)return-1;if(!(!("subTypeVersions"in r)||!("subTypeVersions"in i)))for(const o of Object.keys(r.subTypeVersions)){const s=r.subTypeVersions[o],a=i.subTypeVersions[o];if(s>a)return 1;if(s<a)return-1}}return 0};function JL(e){if(!e.length)return null;let t="";for(const n of e)typeof n=="number"?t+=`.${n}`:n.startsWith("(")?t.endsWith(")")?t=`${t.slice(0,-1)}, ${n.slice(1)}`:t+=n:t+=`.${n}`;return t.startsWith(".")?t.slice(1):t}class Be extends Error{constructor(n,r=[]){const i=JL(r),o=n.split(`
`).map((s,a)=>a===0?s:`  ${s}`).join(`
`);super(r?`At ${i}: ${o}`:o);v(this,"name","ValidationError");this.rawMessage=n,this.path=r}}function _a(e,t){try{return t()}catch(n){throw n instanceof Be?new Be(n.rawMessage,[e,...n.path]):new Be(n.toString(),[e])}}function Ca(e){if(e===null)return"null";if(Array.isArray(e))return"an array";const t=typeof e;switch(t){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${t}`;case"object":return`an ${t}`;case"undefined":return"undefined";default:ka(t)}}class pn{constructor(t){this.validationFn=t}validate(t){return this.validationFn(t)}isValid(t){try{return this.validate(t),!0}catch{return!1}}nullable(){return oD(this)}optional(){return t2(this)}refine(t){return new pn(n=>t(this.validate(n)))}check(t,n){return typeof t=="string"?this.refine(r=>(_a(`(check ${t})`,()=>n(r)),r)):this.refine(r=>(t(r),r))}}class eD extends pn{constructor(t){super(n=>{const r=iD.validate(n);for(let i=0;i<r.length;i++)_a(i,()=>t.validate(r[i]));return r}),this.itemValidator=t}nonEmpty(){return this.check(t=>{if(t.length===0)throw new Be("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(t=>{if(t.length<=1)throw new Be("Expected an array with length greater than 1")})}}class Pg extends pn{constructor(t,n=!1){super(r=>{if(typeof r!="object"||r===null)throw new Be(`Expected object, got ${Ca(r)}`);for(const[i,o]of Object.entries(t))_a(i,()=>{o.validate(ws(r,i))});if(!n){for(const i of Object.keys(r))if(!Mh(t,i))throw new Be("Unexpected property",[i])}return r}),this.config=t,this.shouldAllowUnknownProperties=n}allowUnknownProperties(){return new Pg(this.config,!0)}extend(t){return new Pg({...this.config,...t})}}class zw extends pn{constructor(t,n,r){super(i=>{if(typeof i!="object"||i===null)throw new Be(`Expected an object, got ${Ca(i)}`,[]);const o=ws(i,t);if(typeof o!="string")throw new Be(`Expected a string for key "${t}", got ${Ca(o)}`);const s=Mh(n,o)?n[o]:void 0;return s===void 0?this.unknownValueValidation(i,o):_a(`(${t} = ${o})`,()=>s.validate(i))}),this.key=t,this.config=n,this.unknownValueValidation=r}validateUnknownVariants(t){return new zw(this.key,this.config,t)}}class tD extends pn{constructor(t,n){super(r=>{if(typeof r!="object"||r===null)throw new Be(`Expected object, got ${Ca(r)}`);for(const[i,o]of Object.entries(r))_a(i,()=>{t.validate(i),n.validate(o)});return r}),this.keyValidator=t,this.valueValidator=n}}function s0(e){return new pn(t=>{if(typeof t!==e)throw new Be(`Expected ${e}, got ${Ca(t)}`);return t})}const nD=new pn(e=>e),me=s0("string"),fe=s0("number").check(e=>{if(Number.isNaN(e))throw new Be("Expected a number, got NaN");if(!Number.isFinite(e))throw new Be(`Expected a finite number, got ${e}`)}),a0=fe.check(e=>{if(e<0)throw new Be(`Expected a positive number, got ${e}`)}),Sn=fe.check(e=>{if(e<=0)throw new Be(`Expected a non-zero positive number, got ${e}`)}),e2=fe.check(e=>{if(!Number.isInteger(e))throw new Be(`Expected an integer, got ${e}`)}),Lh=e2.check(e=>{if(e<0)throw new Be(`Expected a positive integer, got ${e}`)}),rD=e2.check(e=>{if(e<=0)throw new Be(`Expected a non-zero positive integer, got ${e}`)}),xe=s0("boolean");function kn(e){return new pn(t=>{if(t!==e)throw new Be(`Expected ${e}, got ${JSON.stringify(t)}`);return e})}const iD=new pn(e=>{if(!Array.isArray(e))throw new Be(`Expected an array, got ${Ca(e)}`);return e});function cn(e){return new eD(e)}function ke(e){return new Pg(e)}function l0(e){return e===null||typeof e=="number"||typeof e=="string"||typeof e=="boolean"?!0:Array.isArray(e)?e.every(l0):typeof e=="object"?Object.values(e).every(l0):!1}const Zr=new pn(e=>{if(l0(e))return e;throw new Be(`Expected json serializable value, got ${typeof e}`)});function c0(e,t){return new tD(e,t)}function u0(e,t){return new zw(e,t,(n,r)=>{throw new Be(`Expected one of ${Object.keys(t).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(r)}`,[e])})}function Ti(e,t){return new pn(n=>{const r=n&&typeof n=="object"&&"id"in n&&typeof n.id=="string"?`${e}(id = ${n.id})`:e;return _a(r,()=>t.validate(n))})}function _c(e){return new pn(t=>{if(!e.has(t)){const n=Array.from(e,r=>JSON.stringify(r)).join(" or ");throw new Be(`Expected ${n}, got ${t}`)}return t})}function t2(e){return new pn(t=>{if(t!==void 0)return e.validate(t)})}function oD(e){return new pn(t=>t===null?null:e.validate(t))}function n2(...e){return _c(new Set(e))}function r2(e){try{return new URL(e)}catch{throw new Be(`Expected a valid url, got ${JSON.stringify(e)}`)}}const sD=new Set(["http:","https:","mailto:"]),Fn=me.check(e=>{if(e==="")return;const t=r2(e);if(!sD.has(t.protocol.toLowerCase()))throw new Be(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)}),aD=new Set(["http:","https:","data:"]),Ea=me.check(e=>{if(e==="")return;const t=r2(e);if(!aD.has(t.protocol.toLowerCase()))throw new Be(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)});function Ir(e){return me.refine(t=>{if(!t.startsWith(`${e}:`))throw new Error(`${e} ID must start with "${e}:"`);return t})}const Dh=Ir("asset");function d0(e,t){return ke({id:Dh,typeName:kn("asset"),type:kn(e),props:t,meta:Zr})}const lD=Ti("camera",ke({typeName:kn("camera"),id:Ir("camera"),x:fe,y:fe,z:fe,meta:Zr})),i2={AddMeta:1},cD=Ae({currentVersion:i2.AddMeta,migrators:{[i2.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),Kt=Ai("camera",{validator:lD,migrations:cD,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),Cc=ke({x:fe,y:fe,z:fe.optional()}),Ec=ke({x:fe,y:fe,w:fe,h:fe}),uD=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),o2=_c(uD),dD=ke({type:o2,rotation:fe}),s2=fe.check(e=>{if(e<0||e>1)throw new Be("Opacity must be between 0 and 1")}),hD=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),pD=_c(hD),fD=new Set(["starting","paused","active","stopping"]),a2=ke({id:me,points:cn(Cc),size:a0,color:pD,opacity:fe,state:_c(fD),delay:fe,shrink:fe,taper:xe}),Pc=Ir("page"),gD=Ti("page",ke({typeName:kn("page"),id:Pc,name:me,index:me,meta:Zr})),l2={AddMeta:1},mD=Ae({currentVersion:l2.AddMeta,migrators:{[l2.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),ji=Ai("page",{validator:gD,migrations:mD,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function _n(e){return ji.isId(e)}Ir("instance");function yD(e){const t={};for(const[r,i]of e)t[r]=t2(i);const n=Ti("instance",ke({typeName:kn("instance"),id:Ir("instance"),currentPageId:Pc,followingUserId:me.nullable(),brush:Ec.nullable(),opacityForNextShape:s2,stylesForNextShape:ke(t),cursor:dD,scribbles:cn(a2),isFocusMode:xe,isDebugMode:xe,isToolLocked:xe,exportBackground:xe,screenBounds:Ec,zoomBrush:Ec.nullable(),isPenMode:xe,isGridMode:xe,chatMessage:me,isChatting:xe,highlightedUserIds:cn(me),canMoveCamera:xe,isFocused:xe,devicePixelRatio:fe,isCoarsePointer:xe,isHoveringCanvas:xe.nullable(),openMenus:cn(me),isChangingStyle:xe,isReadonly:xe,meta:Zr}));return Ai("instance",{migrations:vD,validator:n,scope:"session"}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],canMoveCamera:!0,isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{}}))}const it={AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22},vD=Ae({currentVersion:it.AddScribbles,migrators:{[it.AddTransparentExportBgs]:{up:e=>({...e,exportBackground:!0}),down:({exportBackground:e,...t})=>t},[it.RemoveDialog]:{up:({dialog:e,...t})=>t,down:e=>({...e,dialog:null})},[it.AddToolLockMode]:{up:e=>({...e,isToolLocked:!1}),down:({isToolLocked:e,...t})=>t},[it.RemoveExtraPropsForNextShape]:{up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:Object.fromEntries(Object.entries(e).filter(([n])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(n)))}),down:e=>e},[it.AddLabelColor]:{up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:{...e,labelColor:"black"}}),down:e=>{const{labelColor:t,...n}=e.propsForNextShape;return{...e,propsForNextShape:{...n}}}},[it.AddFollowingUserId]:{up:e=>({...e,followingUserId:null}),down:({followingUserId:e,...t})=>t},[it.RemoveAlignJustify]:{up:e=>{let t=e.propsForNextShape.align;return t==="justify"&&(t="start"),{...e,propsForNextShape:{...e.propsForNextShape,align:t}}},down:e=>({...e})},[it.AddZoom]:{up:e=>({...e,zoomBrush:null}),down:({zoomBrush:e,...t})=>t},[it.AddVerticalAlign]:{up:e=>({...e,propsForNextShape:{...e.propsForNextShape,verticalAlign:"middle"}}),down:e=>{const{verticalAlign:t,...n}=e.propsForNextShape;return{...e,propsForNextShape:n}}},[it.AddScribbleDelay]:{up:e=>e.scribble!==null?{...e,scribble:{...e.scribble,delay:0}}:{...e},down:e=>{if(e.scribble!==null){const{delay:t,...n}=e.scribble;return{...e,scribble:n}}return{...e}}},[it.RemoveUserId]:{up:({userId:e,...t})=>t,down:e=>({...e,userId:"user:none"})},[it.AddIsPenModeAndIsGridMode]:{up:e=>({...e,isPenMode:!1,isGridMode:!1}),down:({isPenMode:e,isGridMode:t,...n})=>n},[it.HoistOpacity]:{up:({propsForNextShape:{opacity:e,...t},...n})=>({...n,opacityForNextShape:Number(e??"1"),propsForNextShape:t}),down:({opacityForNextShape:e,...t})=>({...t,propsForNextShape:{...t.propsForNextShape,opacity:e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}})},[it.AddChat]:{up:e=>({...e,chatMessage:"",isChatting:!1}),down:({chatMessage:e,isChatting:t,...n})=>n},[it.AddHighlightedUserIds]:{up:e=>({...e,highlightedUserIds:[]}),down:({highlightedUserIds:e,...t})=>t},[it.ReplacePropsForNextShapeWithStylesForNextShape]:{up:({propsForNextShape:e,...t})=>({...t,stylesForNextShape:{}}),down:({stylesForNextShape:e,...t})=>({...t,propsForNextShape:{color:"black",labelColor:"black",dash:"draw",fill:"none",size:"m",icon:"file",font:"draw",align:"middle",verticalAlign:"middle",geo:"rectangle",arrowheadStart:"none",arrowheadEnd:"arrow",spline:"line"}})},[it.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[it.RemoveCursorColor]:{up:e=>{const{color:t,...n}=e.cursor;return{...e,cursor:n}},down:e=>({...e,cursor:{...e.cursor,color:"black"}})},[it.AddLonelyProperties]:{up:e=>({...e,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1}),down:({canMoveCamera:e,isFocused:t,devicePixelRatio:n,isCoarsePointer:r,openMenus:i,isChangingStyle:o,isReadOnly:s,...a})=>({...a})},[it.ReadOnlyReadonly]:{up:({isReadOnly:e,...t})=>({...t,isReadonly:e}),down:({isReadonly:e,...t})=>({...t,isReadOnly:e})},[it.AddHoveringCanvas]:{up:e=>({...e,isHoveringCanvas:null}),down:({isHoveringCanvas:e,...t})=>({...t})},[it.AddScribbles]:{up:({scribble:e,...t})=>({...t,scribbles:[]}),down:({scribbles:e,...t})=>({...t,scribble:null})}}}),un="instance:instance",bD=me.refine(e=>{if(!e.startsWith("page:")&&!e.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return e}),Mr=Ir("shape");function wD(e,t,n){return ke({id:Mr,typeName:kn("shape"),x:fe,y:fe,rotation:fe,index:me,parentId:bD,type:kn(e),isLocked:xe,opacity:s2,props:t?ke(t):Zr,meta:n?ke(n):Zr})}const xD=Ti("instance_page_state",ke({typeName:kn("instance_page_state"),id:Ir("instance_page_state"),pageId:Pc,selectedShapeIds:cn(Mr),hintingShapeIds:cn(Mr),erasingShapeIds:cn(Mr),hoveredShapeId:Mr.nullable(),editingShapeId:Mr.nullable(),croppingShapeId:Mr.nullable(),focusedGroupId:Mr.nullable(),meta:Zr})),Pa={AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5},SD=Ae({currentVersion:Pa.RenamePropertiesAgain,migrators:{[Pa.AddCroppingId]:{up(e){return{...e,croppingShapeId:null}},down({croppingShapeId:e,...t}){return t}},[Pa.RemoveInstanceIdAndCameraId]:{up({instanceId:e,cameraId:t,...n}){return n},down(e){return{...e,instanceId:un,cameraId:Kt.createId("void")}}},[Pa.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[Pa.RenameProperties]:{up:e=>{const{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=e;return{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}},down:e=>{const{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=e;return{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}}},[Pa.RenamePropertiesAgain]:{up:e=>{const{selectedIds:t,hintingIds:n,erasingIds:r,hoveredId:i,editingId:o,croppingShapeId:s,croppingId:a,focusLayerId:l,...c}=e;return{...c,selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s??a??null,focusedGroupId:l}},down:e=>{const{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=e;return{...l,selectedIds:t,hintingIds:n,erasingIds:r,hoveredId:i,editingId:o,croppingId:s,focusLayerId:a}}}}}),Wt=Ai("instance_page_state",{migrations:SD,validator:xD,scope:"session"}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),kD=Ti("pointer",ke({typeName:kn("pointer"),id:Ir("pointer"),x:fe,y:fe,lastActivityTimestamp:fe,meta:Zr})),c2={AddMeta:1},_D=Ae({currentVersion:c2.AddMeta,migrators:{[c2.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),h0=Ai("pointer",{validator:kD,migrations:_D,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),zh=h0.createId("pointer"),CD=Ti("instance_presence",ke({typeName:kn("instance_presence"),id:Ir("instance_presence"),userId:me,userName:me,lastActivityTimestamp:fe,followingUserId:me.nullable(),cursor:ke({x:fe,y:fe,type:o2,rotation:fe}),color:me,camera:ke({x:fe,y:fe,z:fe}),screenBounds:Ec,selectedShapeIds:cn(Ir("shape")),currentPageId:Ir("page"),brush:Ec.nullable(),scribbles:cn(a2),chatMessage:me,meta:Zr})),Ia={AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5},ED=Ae({currentVersion:Ia.RenameSelectedShapeIds,migrators:{[Ia.AddScribbleDelay]:{up:e=>e.scribble!==null?{...e,scribble:{...e.scribble,delay:0}}:{...e},down:e=>{if(e.scribble!==null){const{delay:t,...n}=e.scribble;return{...e,scribble:n}}return{...e}}},[Ia.RemoveInstanceId]:{up:({instanceId:e,...t})=>t,down:e=>({...e,instanceId:un})},[Ia.AddChatMessage]:{up:e=>({...e,chatMessage:""}),down:({chatMessage:e,...t})=>t},[Ia.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[Ia.RenameSelectedShapeIds]:{up:e=>{const{selectedShapeIds:t,...n}=e;return{selectedShapeIds:t,...n}},down:e=>{const{selectedShapeIds:t,...n}=e;return{selectedShapeIds:t,...n}}}}}),PD=Ai("instance_presence",{migrations:ED,validator:CD,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),ID=Ti("document",ke({typeName:kn("document"),id:kn("document:document"),gridSize:fe,name:me,meta:Zr})),p0={AddName:1,AddMeta:2},MD=Ae({currentVersion:p0.AddMeta,migrators:{[p0.AddName]:{up:e=>({...e,name:""}),down:({name:e,...t})=>t},[p0.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),f0=Ai("document",{migrations:MD,validator:ID,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),g0=f0.createId("document");function AD(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function u2(e){e.typeName==="asset"&&("src"in e&&(e.src="<redacted>"),"src"in e.props&&(e.props.src="<redacted>"))}const TD=({error:e,phase:t,record:n,recordBefore:r})=>{throw t0(e,{tags:{origin:"store.validateRecord",storePhase:t,isExistingValidationIssue:t==="initialize"},extras:{recordBefore:r?u2(Po(r)):void 0,recordAfter:u2(Po(n))}}),e};function jD(){return[ji.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function OD(e){const t=e.query.ids("page"),n=()=>{if(!e.has(g0))return e.put([f0.create({id:g0,name:e.props.defaultName})]),n();if(!e.has(zh))return e.put([h0.create({id:zh})]),n();const r=t.get();if(r.size===0)return e.put(jD()),n();const i=()=>[...r].map(l=>e.get(l)).sort(AD)[0].id,o=e.get(un);if(o){if(!r.has(o.currentPageId))return e.put([{...o,currentPageId:i()}]),n()}else return e.put([e.schema.types.instance.create({id:un,currentPageId:i(),exportBackground:!0})]),n();const s=new Set,a=new Set;for(const l of r){const c=Wt.createId(l);e.has(c)||s.add(c);const u=Kt.createId(l);e.has(u)||a.add(u)}s.size>0&&e.put([...s].map(l=>Wt.create({id:l,pageId:Wt.parseId(l)}))),a.size>0&&e.put([...a].map(l=>Kt.create({id:l})))};return n}const LD=d0("bookmark",ke({title:me,description:me,image:me,src:Ea.nullable()})),d2={MakeUrlsValid:1},DD=Ae({currentVersion:d2.MakeUrlsValid,migrators:{[d2.MakeUrlsValid]:{up:e=>{const t=e.props.src;return t&&!Ea.isValid(t)?{...e,props:{...e.props,src:""}}:e},down:e=>e}}}),zD=d0("image",ke({w:fe,h:fe,name:me,isAnimated:xe,mimeType:me.nullable(),src:Ea.nullable()})),Nh={AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3},ND=Ae({currentVersion:Nh.MakeUrlsValid,migrators:{[Nh.AddIsAnimated]:{up:e=>({...e,props:{...e.props,isAnimated:!1}}),down:e=>{const{isAnimated:t,...n}=e.props;return{...e,props:n}}},[Nh.RenameWidthHeight]:{up:e=>{const{width:t,height:n,...r}=e.props;return{...e,props:{w:t,h:n,...r}}},down:e=>{const{w:t,h:n,...r}=e.props;return{...e,props:{width:t,height:n,...r}}}},[Nh.MakeUrlsValid]:{up:e=>{const t=e.props.src;return t&&!Ea.isValid(t)?{...e,props:{...e.props,src:""}}:e},down:e=>e}}}),RD=d0("video",ke({w:fe,h:fe,name:me,isAnimated:xe,mimeType:me.nullable(),src:Ea.nullable()})),Rh={AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3},FD=Ae({currentVersion:Rh.MakeUrlsValid,migrators:{[Rh.AddIsAnimated]:{up:e=>({...e,props:{...e.props,isAnimated:!1}}),down:e=>{const{isAnimated:t,...n}=e.props;return{...e,props:n}}},[Rh.RenameWidthHeight]:{up:e=>{const{width:t,height:n,...r}=e.props;return{...e,props:{w:t,h:n,...r}}},down:e=>{const{w:t,h:n,...r}=e.props;return{...e,props:{width:t,height:n,...r}}}},[Rh.MakeUrlsValid]:{up:e=>{const t=e.props.src;return t&&!Ea.isValid(t)?{...e,props:{...e.props,src:""}}:e},down:e=>e}}}),$D=Ti("asset",u0("type",{image:zD,video:RD,bookmark:LD})),h2={AddMeta:1},BD=Ae({subTypeKey:"type",subTypeMigrations:{image:ND,video:FD,bookmark:DD},currentVersion:h2.AddMeta,migrators:{[h2.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),xs=Ai("asset",{migrations:BD,validator:$D,scope:"document"}).withDefaultProperties(()=>({meta:{}}));class nn{constructor(t,n,r){this.id=t,this.defaultValue=n,this.type=r}static define(t,n){const{defaultValue:r,type:i=nD}=n;return new nn(t,r,i)}static defineEnum(t,n){const{defaultValue:r,values:i}=n;return new UD(t,r,i)}validate(t){return this.type.validate(t)}}class UD extends nn{constructor(t,n,r){super(t,n,n2(...r)),this.values=r}}const Fh={AddIsLocked:1,HoistOpacity:2,AddMeta:3},m0=Ae({currentVersion:Fh.AddMeta,migrators:{[Fh.AddIsLocked]:{up:e=>({...e,isLocked:!1}),down:e=>{const{isLocked:t,...n}=e;return{...n}}},[Fh.HoistOpacity]:{up:({props:{opacity:e,...t},...n})=>({...n,opacity:Number(e??"1"),props:t}),down:({opacity:e,...t})=>({...t,props:{...t.props,opacity:e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}})},[Fh.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}});function Ss(e){return e?e.typeName==="shape":!1}function ar(e){return e?e.startsWith("shape:"):!1}function Ve(e){return`shape:${e??Th()}`}function p2(e){const t=new Map;for(const[n,r]of Object.entries(e))if(r instanceof nn){if(t.has(r))throw new Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);t.set(r,n)}return t}function VD(e){return Ai("shape",{migrations:Ae({currentVersion:m0.currentVersion,firstVersion:m0.firstVersion,migrators:m0.migrators,subTypeKey:"type",subTypeMigrations:Y_(e,(t,n)=>n.migrations??Ae({}))}),scope:"document",validator:Ti("shape",u0("type",Y_(e,(t,{props:n,meta:r})=>wD(t,n,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}const Ic={RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4},HD=Ae({currentVersion:Ic.RemoveUserDocument,migrators:{[Ic.RemoveCodeAndIconShapeTypes]:{up:e=>Object.fromEntries(Object.entries(e).filter(([t,n])=>n.typeName!=="shape"||n.type!=="icon"&&n.type!=="code")),down:e=>e},[Ic.AddInstancePresenceType]:{up:e=>e,down:e=>Object.fromEntries(Object.entries(e).filter(([t,n])=>n.typeName!=="instance_presence"))},[Ic.RemoveTLUserAndPresenceAndAddPointer]:{up:e=>Object.fromEntries(Object.entries(e).filter(([t,n])=>!n.typeName.match(/^(user|user_presence)$/))),down:e=>Object.fromEntries(Object.entries(e).filter(([t,n])=>n.typeName!=="pointer"))},[Ic.RemoveUserDocument]:{up:e=>Object.fromEntries(Object.entries(e).filter(([t,n])=>!n.typeName.match("user_document"))),down:e=>e}}});function KD({shapes:e}){const t=new Map;for(const i of ut(e))for(const o of p2(i.props??{}).keys()){if(t.has(o.id)&&t.get(o.id)!==o)throw new Error(`Multiple StyleProp instances with the same id: ${o.id}`);t.set(o.id,o)}const n=VD(e),r=yD(t);return Dw.create({asset:xs,camera:Kt,document:f0,instance:r,instance_page_state:Wt,page:ji,shape:n,instance_presence:PD,pointer:h0},{snapshotMigrations:HD,onValidationFailure:TD,createIntegrityChecker:OD})}const f2=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red"],$h={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4263eb",semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#adb5bd",semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4dabf7",semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#40c057",semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#ff8787",semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e599f7",semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#f76707",semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#ffc078",semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}}},darkMode:{id:"dark",text:"#f8f9fa",background:"#212529",solid:"#28292e",black:{solid:"#e1e1e1",semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4156be",semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#3b7b5e",semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#93989f",semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#588fc9",semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#599f57",semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#c67877",semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#b583c9",semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#bf612e",semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#aa3c37",semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#873fa3",semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#cba371",semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}}}};function Cn(e){return e.isDarkMode?$h.darkMode:$h.lightMode}const lr=nn.defineEnum("tldraw:color",{defaultValue:"black",values:f2}),g2=nn.defineEnum("tldraw:labelColor",{defaultValue:"black",values:f2}),ks=nn.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Ma=nn.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern"]}),Qr=nn.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),Mc={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},Jr=nn.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),m2=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],Bh=nn.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:m2}),Uh=nn.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:m2}),y2=u0("type",{binding:ke({type:kn("binding"),boundShapeId:Mr,normalizedAnchor:Cc,isExact:xe,isPrecise:xe}),point:ke({type:kn("point"),x:fe,y:fe})}),WD={labelColor:g2,color:lr,fill:Ma,dash:ks,size:Jr,arrowheadStart:Bh,arrowheadEnd:Uh,font:Qr,start:y2,end:y2,bend:fe,text:me},y0={AddLabelColor:1,AddIsPrecise:2},YD=Ae({currentVersion:y0.AddIsPrecise,migrators:{[y0.AddLabelColor]:{up:e=>({...e,props:{...e.props,labelColor:"black"}}),down:e=>{const{labelColor:t,...n}=e.props;return{...e,props:n}}},[y0.AddIsPrecise]:{up:e=>{const{start:t,end:n}=e.props;return{...e,props:{...e.props,start:t.type==="binding"?{...t,isPrecise:!(t.normalizedAnchor.x===.5&&t.normalizedAnchor.y===.5)}:t,end:n.type==="binding"?{...n,isPrecise:!(n.normalizedAnchor.x===.5&&n.normalizedAnchor.y===.5)}:n}}},down:e=>{const{start:t,end:n}=e.props,r={...t},i={...n};return r.type==="binding"&&(r.isPrecise||(r.normalizedAnchor={x:.5,y:.5}),delete r.isPrecise),i.type==="binding"&&(i.isPrecise||(i.normalizedAnchor={x:.5,y:.5}),delete i.isPrecise),{...e,props:{...e.props,start:r,end:i}}}}}}),XD={w:Sn,h:Sn,assetId:Dh.nullable(),url:Fn},v0={NullAssetId:1,MakeUrlsValid:2},GD=Ae({currentVersion:v0.MakeUrlsValid,migrators:{[v0.NullAssetId]:{up:e=>e.props.assetId===void 0?{...e,props:{...e.props,assetId:null}}:e,down:e=>{if(e.props.assetId===null){const{assetId:t,...n}=e.props;return{...e,props:n}}return e}},[v0.MakeUrlsValid]:{up:e=>e.props.url!==""&&!Fn.isValid(e.props.url)?{...e,props:{...e.props,url:""}}:e,down:e=>e}}}),v2=ke({type:n2("free","straight"),points:cn(Cc)}),qD={color:lr,fill:Ma,dash:ks,size:Jr,segments:cn(v2),isComplete:xe,isClosed:xe,isPen:xe},b2={AddInPen:1},ZD=Ae({currentVersion:b2.AddInPen,migrators:{[b2.AddInPen]:{up:e=>{const{points:t}=e.props.segments[0];if(t.length===0)return{...e,props:{...e.props,isPen:!1}};let n=!(t[0].z===0||t[0].z===.5);return t[1]&&(n=n&&!(t[1].z===0||t[1].z===.5)),{...e,props:{...e.props,isPen:n}}},down:e=>{const{isPen:t,...n}=e.props;return{...e,props:{...n}}}}}}),w2=/(^\/r\/[^/]+\/?$)/,Ne=e=>{try{return new URL(e)}catch{return}},Aa=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{const t=Ne(e);if(t&&t.pathname.match(w2))return e},fromEmbedUrl:e=>{const t=Ne(e);if(t&&t.pathname.match(w2))return e}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{if(e.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!e.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${e}`},fromEmbedUrl:e=>{const t=Ne(e);if(t&&t.pathname.match(/^\/embed\/?$/)){const n=t.searchParams.get("url");if(n)return n}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{if(e.includes("/maps/")){const t=e.match(/@(.*),(.*),(.*)z/);let n;if(t){const[,r,i,o]=t;n=`https://${new URL(e).host.replace("www.","")}/maps/embed/v1/view?key=${{}.NEXT_PUBLIC_GC_API_KEY}&center=${r},${i}&zoom=${o}`}else n="";return n}},fromEmbedUrl:e=>{const t=Ne(e);if(t&&t.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&t.searchParams.has("center")&&t.searchParams.get("zoom")){const n=t.searchParams.get("zoom"),[r,i]=t.searchParams.get("center").split(",");return`https://www.google.com/maps/@${r},${i},${n}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=Ne(e),n=t&&t.pathname.match(/\/v\/([^/]+)\/?/);if(n)return`https://www.val.town/embed/${n[1]}`},fromEmbedUrl:e=>{const t=Ne(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=Ne(e),n=t&&t.pathname.match(/\/s\/([^/]+)\/?/);if(n)return`https://codesandbox.io/embed/${n[1]}`},fromEmbedUrl:e=>{const t=Ne(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,n=e.match(t);if(n){const[r,i,o]=n;return`https://codepen.io/${i}/embed/${o}`}},fromEmbedUrl:e=>{const t=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,n=e.match(t);if(n){const[r,i,o]=n;return`https://codepen.io/${i}/pen/${o}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,canUnmount:!1,toEmbedUrl:e=>{const t=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,n=e.match(t);if(n){const[r,i]=n;return`https://scratch.mit.edu/projects/embed/${i}`}},fromEmbedUrl:e=>{const t=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,n=e.match(t);if(n){const[r,i]=n;return`https://scratch.mit.edu/projects/${i}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,canUnmount:!1,overridePermissions:{"allow-presentation":!0},isAspectRatioLocked:!0,toEmbedUrl:e=>{const t=Ne(e);if(!t)return;const n=t.hostname.replace(/^www./,"");if(n==="youtu.be")return`https://www.youtube.com/embed/${t.pathname.split("/").filter(Boolean)[0]}`;if((n==="youtube.com"||n==="m.youtube.com")&&t.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${t.searchParams.get("v")}`},fromEmbedUrl:e=>{const t=Ne(e);if(t&&t.hostname.replace(/^www./,"")==="youtube.com"){const n=t.pathname.match(/^\/embed\/([^/]+)\/?/);if(n)return`https://www.youtube.com/watch?v=${n[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",toEmbedUrl:e=>{const t=Ne(e),n=t==null?void 0:t.searchParams.get("cid");if(t!=null&&t.pathname.match(/\/calendar\/u\/0/)&&n){t.pathname="/calendar/embed";const r=Array.from(t.searchParams.keys());for(const i of r)t.searchParams.delete(i);return t.searchParams.set("src",n),t.href}},fromEmbedUrl:e=>{const t=Ne(e),n=t==null?void 0:t.searchParams.get("src");if(t!=null&&t.pathname.match(/\/calendar\/embed/)&&n){t.pathname="/calendar/u/0";const r=Array.from(t.searchParams.keys());for(const i of r)t.searchParams.delete(i);return t.searchParams.set("cid",n),t.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=Ne(e);if(t!=null&&t.pathname.match(/^\/presentation/)&&(t!=null&&t.pathname.match(/\/pub\/?$/))){t.pathname=t.pathname.replace(/\/pub$/,"/embed");const n=Array.from(t.searchParams.keys());for(const r of n)t.searchParams.delete(r);return t.href}},fromEmbedUrl:e=>{const t=Ne(e);if(t!=null&&t.pathname.match(/^\/presentation/)&&(t!=null&&t.pathname.match(/\/embed\/?$/))){t.pathname=t.pathname.replace(/\/embed$/,"/pub");const n=Array.from(t.searchParams.keys());for(const r of n)t.searchParams.delete(r);return t.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{const t=Ne(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/))return e.split("/").pop()?e:void 0},fromEmbedUrl:e=>{const t=Ne(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/))return e.split("/").pop()?e:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=Ne(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${e}?embed=true`},fromEmbedUrl:e=>{const t=Ne(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/)&&t.searchParams.has("embed"))return t.searchParams.delete("embed"),t.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=Ne(e);if(t&&t.pathname.match(/^\/map\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{const t=Ne(e);if(t&&t.pathname.match(/^\/embed\/map\//))return t.pathname=t.pathname.replace(/^\/embed/,""),t.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=Ne(e);if(t&&t.pathname.match(/^\/(artist|album)\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{const t=Ne(e);if(t&&t.pathname.match(/^\/embed\/(artist|album)\//))return t.origin+t.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:e=>{const t=Ne(e);if(t&&t.hostname==="vimeo.com"&&t.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+t.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:e=>{const t=Ne(e);if(t&&t.hostname==="player.vimeo.com"){const n=t.pathname.match(/^\/video\/([^/]+)\/?$/);if(n)return"https://vimeo.com/"+n[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:e=>{const t=Ne(e);if(t&&t.hash.match(/#room=/))return e},fromEmbedUrl:e=>{const t=Ne(e);if(t&&t.hash.match(/#room=/))return e}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:e=>{const t=Ne(e);if(t&&t.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${t.origin}/embed${t.pathname}?cell=*`;if(t&&t.pathname.match(/^\/d\/([^/]+)\/?$/)){const n=t.pathname.replace(/^\/d/,"");return`${t.origin}/embed${n}?cell=*`}},fromEmbedUrl:e=>{const t=Ne(e);if(t&&t.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${t.origin}${t.pathname.replace("/embed","")}#cell-*`;if(t&&t.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${t.origin}${t.pathname.replace("/embed","/d")}#cell-*`}}],QD={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},JD={w:Sn,h:Sn,url:me},Ac={GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4},ez=Ae({currentVersion:Ac.RemovePermissionOverrides,migrators:{[Ac.GenOriginalUrlInEmbed]:{up:e=>{const t=e.props.url,n=new URL(t).host.replace("www.","");let r;for(const i of Aa)if(i.hostnames.includes(n))try{r=i.fromEmbedUrl(t)}catch(o){console.warn(o)}return{...e,props:{...e.props,tmpOldUrl:e.props.url,url:r??""}}},down:e=>{let t=e.props.tmpOldUrl;if(!t||t===""){const i=e.props.url,o=new URL(i).host.replace("www.","");for(const s of Aa)if(s.hostnames.includes(o))try{t=s.toEmbedUrl(i)}catch(a){console.warn(a)}}const{tmpOldUrl:n,...r}=e.props;return{...e,props:{...r,url:t??""}}}},[Ac.RemoveDoesResize]:{up:e=>{const{doesResize:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props,doesResize:!0}})},[Ac.RemoveTmpOldUrl]:{up:e=>{const{tmpOldUrl:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props}})},[Ac.RemovePermissionOverrides]:{up:e=>{const{overridePermissions:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props}})}}}),tz={w:Sn,h:Sn,name:me},nz=Ae({}),Tc=nn.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),Vh=nn.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),ei=nn.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box"]}),rz={geo:ei,labelColor:g2,color:lr,fill:Ma,dash:ks,size:Jr,font:Qr,align:Tc,verticalAlign:Vh,url:Fn,w:Sn,h:Sn,growY:a0,text:me},Oi={AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8},iz=Ae({currentVersion:Oi.MakeUrlsValid,migrators:{[Oi.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{const{url:t,...n}=e.props;return{...e,props:n}}},[Oi.AddLabelColor]:{up:e=>({...e,props:{...e.props,labelColor:"black"}}),down:e=>{const{labelColor:t,...n}=e.props;return{...e,props:n}}},[Oi.RemoveJustify]:{up:e=>{let t=e.props.align;return t==="justify"&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})},[Oi.AddCheckBox]:{up:e=>({...e}),down:e=>({...e,props:{...e.props,geo:e.props.geo==="check-box"?"rectangle":e.props.geo}})},[Oi.AddVerticalAlign]:{up:e=>({...e,props:{...e.props,verticalAlign:"middle"}}),down:e=>{const{verticalAlign:t,...n}=e.props;return{...e,props:n}}},[Oi.MigrateLegacyAlign]:{up:e=>{let t;switch(e.props.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy";break}return{...e,props:{...e.props,align:t}}},down:e=>{let t;switch(e.props.align){case"start-legacy":t="start";break;case"end-legacy":t="end";break;case"middle-legacy":t="middle";break;default:t=e.props.align}return{...e,props:{...e.props,align:t}}}},[Oi.AddCloud]:{up:e=>e,down:e=>{if(e.props.geo==="cloud")return{...e,props:{...e.props,geo:"rectangle"}}}},[Oi.MakeUrlsValid]:{up:e=>e.props.url!==""&&!Fn.isValid(e.props.url)?{...e,props:{...e.props,url:""}}:e,down:e=>e}}}),oz={},sz=Ae({}),az={color:lr,size:Jr,segments:cn(v2),isComplete:xe,isPen:xe},lz=Ae({}),cz=ke({topLeft:Cc,bottomRight:Cc}),uz={w:Sn,h:Sn,playing:xe,url:Fn,assetId:Dh.nullable(),crop:cz.nullable()},Hh={AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3},dz=Ae({currentVersion:Hh.MakeUrlsValid,migrators:{[Hh.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{const{url:t,...n}=e.props;return{...e,props:n}}},[Hh.AddCropProp]:{up:e=>({...e,props:{...e.props,crop:null}}),down:e=>{const{crop:t,...n}=e.props;return{...e,props:n}}},[Hh.MakeUrlsValid]:{up:e=>e.props.url!==""&&!Fn.isValid(e.props.url)?{...e,props:{...e.props,url:""}}:e,down:e=>e}}}),hz=new Set(["vertex","virtual","create"]),pz=ke({id:me,type:_c(hz),canBind:xe.optional(),canSnap:xe.optional(),index:me,x:fe,y:fe}),Kh=nn.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),fz={color:lr,dash:ks,size:Jr,spline:Kh,handles:c0(me,pz)},x2={AddSnapHandles:1},gz=Ae({currentVersion:x2.AddSnapHandles,migrators:{[x2.AddSnapHandles]:{up:e=>{const t=Ht(e.props.handles);for(const n in t)t[n].canSnap=!0;return{...e,props:{...e.props,handles:t}}},down:e=>{const t=Ht(e.props.handles);for(const n in t)delete t[n].canSnap;return{...e,props:{...e.props,handles:t}}}}}}),mz={color:lr,size:Jr,font:Qr,align:Tc,verticalAlign:Vh,growY:a0,url:Fn,text:me},Ta={AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5},yz=Ae({currentVersion:Ta.MakeUrlsValid,migrators:{[Ta.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{const{url:t,...n}=e.props;return{...e,props:n}}},[Ta.RemoveJustify]:{up:e=>{let t=e.props.align;return t==="justify"&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})},[Ta.MigrateLegacyAlign]:{up:e=>{let t;switch(e.props.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy";break}return{...e,props:{...e.props,align:t}}},down:e=>{let t;switch(e.props.align){case"start-legacy":t="start";break;case"end-legacy":t="end";break;case"middle-legacy":t="middle";break;default:t=e.props.align}return{...e,props:{...e.props,align:t}}}},[Ta.AddVerticalAlign]:{up:e=>({...e,props:{...e.props,verticalAlign:"middle"}}),down:e=>{const{verticalAlign:t,...n}=e.props;return{...e,props:n}}},[Ta.MakeUrlsValid]:{up:e=>e.props.url!==""&&!Fn.isValid(e.props.url)?{...e,props:{...e.props,url:""}}:e,down:e=>e}}}),vz={color:lr,size:Jr,font:Qr,align:Tc,w:Sn,text:me,scale:Sn,autoSize:xe},S2={RemoveJustify:1},bz=Ae({currentVersion:S2.RemoveJustify,migrators:{[S2.RemoveJustify]:{up:e=>{let t=e.props.align;return t==="justify"&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})}}}),wz={w:Sn,h:Sn,time:fe,playing:xe,url:Fn,assetId:Dh.nullable()},b0={AddUrlProp:1,MakeUrlsValid:2},xz=Ae({currentVersion:b0.MakeUrlsValid,migrators:{[b0.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{const{url:t,...n}=e.props;return{...e,props:n}}},[b0.MakeUrlsValid]:{up:e=>e.props.url!==""&&!Fn.isValid(e.props.url)?{...e,props:{...e.props,url:""}}:e,down:e=>e}}}),jc=[{locale:"ar",label:"\u0639\u0631\u0628\u064A"},{locale:"ca",label:"Catal\xE0"},{locale:"cs",label:"\u010Ce\u0161tina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espa\xF1ol"},{locale:"fa",label:"\u0641\u0627\u0631\u0633\u06CC"},{locale:"fi",label:"Suomi"},{locale:"fr",label:"Fran\xE7ais"},{locale:"gl",label:"Galego"},{locale:"he",label:"\u05E2\u05D1\u05E8\u05D9\u05EA"},{locale:"it",label:"Italiano"},{locale:"ja",label:"\u65E5\u672C\u8A9E"},{locale:"ko-kr",label:"\uD55C\uAD6D\uC5B4"},{locale:"ku",label:"\u06A9\u0648\u0631\u062F\u06CC"},{locale:"hi-in",label:"\u0939\u093F\u0928\u094D\u0926\u0940"},{locale:"hu",label:"Magyar"},{locale:"my",label:"\u1019\u103C\u1014\u103A\u1019\u102C\u1005\u102C"},{locale:"ne",label:"\u0928\u0947\u092A\u093E\u0932\u0940"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugu\xEAs - Brasil"},{locale:"pt-pt",label:"Portugu\xEAs - Europeu"},{locale:"ro",label:"Rom\xE2n\u0103"},{locale:"ru",label:"Russian"},{locale:"sv",label:"Svenska"},{locale:"te",label:"\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41"},{locale:"th",label:"\u0E20\u0E32\u0E29\u0E32\u0E44\u0E17\u0E22"},{locale:"tr",label:"T\xFCrk\xE7e"},{locale:"uk",label:"Ukrainian"},{locale:"vi",label:"Ti\u1EBFng Vi\u1EC7t"},{locale:"zh-cn",label:"Chinese - Simplified"},{locale:"zh-tw",label:"\u7E41\u9AD4\u4E2D\u6587 (\u53F0\u7063)"}];function Sz(){const e=typeof window<"u"?window.navigator.languages??["en"]:["en"];return kz(e)}function kz(e){for(const t of e){const n=_z(t);if(n)return n}return"en"}const k2={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function _z(e){const t=jc.find(i=>i.locale===e.toLowerCase());if(t)return t.locale;const[n,r]=e.split(/[-_]/).map(i=>i.toLowerCase());if(r){const i=jc.find(o=>o.locale===n);if(i)return i.locale}return n in k2?k2[n]:null}var _2={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(e){(function(){var t={}.hasOwnProperty;function n(){for(var o="",s=0;s<arguments.length;s++){var a=arguments[s];a&&(o=i(o,r(a)))}return o}function r(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return n.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var s="";for(var a in o)t.call(o,a)&&o[a]&&(s=i(s,a));return s}function i(o,s){return s?o?o+" "+s:o+s:o}e.exports?(n.default=n,e.exports=n):window.classNames=n})()})(_2);var Cz=_2.exports;const pe=ns(Cz),Ez={},He={preventDefaultLogging:$n("preventDefaultLogging",{defaults:{all:!1}}),pointerCaptureLogging:$n("pointerCaptureLogging",{defaults:{all:!1}}),pointerCaptureTracking:$n("pointerCaptureTracking",{defaults:{all:!1}}),pointerCaptureTrackingObject:$n("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),elementRemovalLogging:$n("elementRemovalLogging",{defaults:{all:!1}}),debugSvg:$n("debugSvg",{defaults:{all:!1}}),throwToBlob:$n("throwToBlob",{defaults:{all:!1}}),logMessages:$n("uiLog",{defaults:{all:[]}}),resetConnectionEveryPing:$n("resetConnectionEveryPing",{defaults:{all:!1}}),debugCursors:$n("debugCursors",{defaults:{all:!1}}),forceSrgb:$n("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:$n("debugGeometry",{defaults:{all:!1}}),hideShapes:$n("hideShapes",{defaults:{all:!1}})};if(typeof window<"u"&&(window.tldrawLog=e=>{He.logMessages.set(He.logMessages.get().concat(e))}),typeof Element<"u"){const e=Element.prototype.removeChild;xc("element removal logging",()=>{He.elementRemovalLogging.get()?Element.prototype.removeChild=function(t){return console.warn("[tldraw] removing child:",t),e.call(this,t)}:Element.prototype.removeChild=e})}function $n(e,{defaults:t,shouldStoreForSession:n=!0}){return Pz({name:e,defaults:t,shouldStoreForSession:n})}function Pz(e){const t=Mz(e),n=e.shouldStoreForSession?Iz(e.name):null,r=ln(`debug:${e.name}`,n??t);return typeof window<"u"&&(e.shouldStoreForSession&&xc(`debug:${e.name}`,()=>{const i=r.get();try{i===t?window.sessionStorage.removeItem(`tldraw_debug:${e.name}`):window.sessionStorage.setItem(`tldraw_debug:${e.name}`,JSON.stringify(i))}catch{}}),Object.defineProperty(window,`tldraw${e.name.replace(/^[a-z]/,i=>i.toUpperCase())}`,{get(){return r.get()},set(i){r.set(i)},configurable:!0})),Object.assign(r,e)}function Iz(e){try{return JSON.parse((window==null?void 0:window.sessionStorage.getItem(`tldraw_debug:${e}`))??"null")}catch{return null}}function w0(e){try{return e()}catch{return null}}function Mz(e){switch(w0(()=>({}).TLDRAW_ENV)??w0(()=>({}).VERCEL_PUBLIC_TLDRAW_ENV)??w0(()=>({}).NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return e.defaults.production??e.defaults.all;case"preview":case"staging":return e.defaults.staging??e.defaults.all;default:return e.defaults.development??e.defaults.all}}function Wh(e){if(e instanceof HTMLElement)return e;if(e.parentElement)return Wh(e.parentElement);throw Error("Could not find a parent element of an HTML type!")}function Ee(e){e.preventDefault(),He.preventDefaultLogging.get()&&console.warn("preventDefault called on event:",e)}function Oc(e,t){if(e.setPointerCapture(t.pointerId),He.pointerCaptureTracking.get()){const n=He.pointerCaptureTrackingObject.get();n.set(e,(n.get(e)??0)+1)}He.pointerCaptureLogging.get()&&console.warn("setPointerCapture called on element:",e,t)}function Lc(e,t){if(e.hasPointerCapture(t.pointerId)){if(e.releasePointerCapture(t.pointerId),He.pointerCaptureTracking.get()){const n=He.pointerCaptureTrackingObject.get();n.get(e)===1?n.delete(e):n.has(e)?n.set(e,n.get(e)-1):console.warn("Release without capture")}He.pointerCaptureLogging.get()&&console.warn("releasePointerCapture called on element:",e,t)}}const St=e=>e.stopPropagation();function En(e){return e.isKilled=!0,{point:{x:e.clientX,y:e.clientY,z:e.pressure},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,pointerId:e.pointerId,button:e.button,isPen:e.pointerType==="pen"}}const x0=J.createContext({});function H(){return J.useContext(x0)}function Az(){const e=H();return x.useMemo(function(){let t,n;function r(p){if(!p.isKilled){if(p.button===2){e.dispatch({type:"pointer",target:"canvas",name:"right_click",...En(p)});return}p.button!==0&&p.button!==1&&p.button!==5||(Oc(p.currentTarget,p),e.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...En(p)}),e.getOpenMenus().length>0&&(e.updateInstanceState({openMenus:[]}),document.body.click(),e.getContainer().focus()))}}function i(p){p.isKilled||p.clientX===t&&p.clientY===n||(t=p.clientX,n=p.clientY,e.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...En(p)}))}function o(p){p.isKilled||p.button!==0&&p.button!==1&&p.button!==2&&p.button!==5||(t=p.clientX,n=p.clientY,Lc(p.currentTarget,p),e.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...En(p)}))}function s(p){if(p.isKilled||e.getInstanceState().isPenMode&&p.pointerType!=="pen")return;const g=p.pointerType==="mouse"||p.pointerType==="pen";e.updateInstanceState({isHoveringCanvas:g?!0:null})}function a(p){if(p.isKilled||e.getInstanceState().isPenMode&&p.pointerType!=="pen")return;const g=p.pointerType==="mouse"||p.pointerType==="pen";e.updateInstanceState({isHoveringCanvas:g?!1:null})}function l(p){p.isKilled=!0,document.body.click(),Ee(p)}function c(p){p.isKilled=!0,p.target.tagName!=="A"&&p.target.tagName!=="TEXTAREA"&&Ee(p)}function u(p){Ee(p)}async function d(p){var f,m;if(Ee(p),!((m=(f=p.dataTransfer)==null?void 0:f.files)!=null&&m.length))return;const g=Array.from(p.dataTransfer.files);await e.putExternalContent({type:"files",files:g,point:e.screenToPage({x:p.clientX,y:p.clientY}),ignoreParent:!1})}function h(p){St(p)}return{onPointerDown:r,onPointerMove:i,onPointerUp:o,onPointerEnter:s,onPointerLeave:a,onDragOver:u,onDrop:d,onTouchStart:l,onTouchEnd:c,onClick:h}},[e])}function Tz(){const e=H();x.useEffect(()=>{if(e.environment.isFirefox&&!e.environment.isAndroid&&!e.environment.isIos){e.updateInstanceState({isCoarsePointer:!1});return}if(window.matchMedia){const t=window.matchMedia("(pointer: coarse)"),n=()=>{e.updateInstanceState({isCoarsePointer:!!t.matches})};if(n(),t)return t.addEventListener("change",n),()=>t.removeEventListener("change",n)}},[e])}const C2=x.createContext(null);function jz({container:e,children:t}){return y.jsx(C2.Provider,{value:e,children:t})}function Yt(){return DL(x.useContext(C2),"useContainer used outside of <Tldraw />")}function Oz(){const e=H(),t=Yt(),n=Y("isFocused",()=>e.getInstanceState().isFocused,[e]);x.useEffect(()=>{if(typeof matchMedia===void 0)return;let r=null;const i=()=>{r==null||r();const o=`(resolution: ${window.devicePixelRatio}dppx)`,s=matchMedia(o),a=l=>{l.type==="change"&&i()};s.addEventListener?s.addEventListener("change",i):s.addListener&&s.addListener(a),r=()=>{s.removeEventListener?s.removeEventListener("change",i):s.removeListener&&s.removeListener(a)},e.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return i(),()=>{r==null||r()}},[e]),x.useEffect(()=>{if(!n)return;const r=a=>{if(a.altKey&&(e.isIn("zoom")||!e.getPath().endsWith(".idle"))&&!Dc()&&Ee(a),a.isKilled)return;switch(a.isKilled=!0,a.key){case"=":case"-":case"0":{if(a.metaKey||a.ctrlKey){Ee(a);return}break}case"Tab":{if(Dc()||e.getIsMenuOpen())return;break}case",":{if(!Dc()&&(Ee(a),!e.inputs.keys.has("Comma"))){const{x:c,y:u,z:d}=e.inputs.currentScreenPoint;e.inputs.keys.add("Comma");const h={type:"pointer",name:"pointer_down",point:{x:c,y:u,z:d},shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(h);return}break}case"Escape":{if((e.getEditingShape()||e.getSelectedShapeIds().length>0)&&a.preventDefault(),e.getOpenMenus().length>0)return;e.inputs.keys.has("Escape")||(e.inputs.keys.add("Escape"),e.cancel(),t.focus());return}default:if(Dc()||e.getIsMenuOpen())return}const l={type:"keyboard",name:a.repeat?"key_repeat":"key_down",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};e.dispatch(l)},i=a=>{var c;if(a.isKilled||(a.isKilled=!0,Dc()||e.getIsMenuOpen()))return;if(a.key===","&&((c=document.activeElement)!=null&&c.ELEMENT_NODE&&Ee(a),e.inputs.keys.has(a.code))){const{x:u,y:d,z:h}=e.inputs.currentScreenPoint;e.inputs.keys.delete(a.code);const p={type:"pointer",name:"pointer_up",point:{x:u,y:d,z:h},shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(p);return}const l={type:"keyboard",name:"key_up",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};e.dispatch(l)};function o(a){var l,c;if(t.contains(a.target)){const u=a.touches[0].pageX,d=a.touches[0].radiusX||0;(u-d<10||u+d>e.getViewportScreenBounds().width-10)&&(((l=a.target)==null?void 0:l.tagName)==="BUTTON"&&((c=a.target)==null||c.click()),Ee(a))}}const s=a=>{t.contains(a.target)&&(a.ctrlKey||a.metaKey)&&Ee(a)};return t.addEventListener("touchstart",o,{passive:!1}),t.addEventListener("wheel",s,{passive:!1}),document.addEventListener("gesturestart",Ee),document.addEventListener("gesturechange",Ee),document.addEventListener("gestureend",Ee),t.addEventListener("keydown",r),t.addEventListener("keyup",i),()=>{t.removeEventListener("touchstart",o),t.removeEventListener("wheel",s),document.removeEventListener("gesturestart",Ee),document.removeEventListener("gesturechange",Ee),document.removeEventListener("gestureend",Ee),t.removeEventListener("keydown",r),t.removeEventListener("keyup",i)}},[e,t,n])}const Lz=["input","select","button","textarea"];function Dc(){const{activeElement:e}=document;return!!(e&&(e.getAttribute("contenteditable")||Lz.indexOf(e.tagName.toLowerCase())>-1))}const Dz={error:null};class E2 extends x.Component{constructor(){super(...arguments);v(this,"state",Dz)}static getDerivedStateFromError(n){return{error:n}}componentDidCatch(n){var r,i;(i=(r=this.props).onError)==null||i.call(r,n)}render(){const{error:n}=this.state;if(n!==null){const{fallback:r}=this.props;return y.jsx(r,{error:n})}return this.props.children}}function zc({children:e,fallback:t,...n}){return t===null?y.jsx(y.Fragment,{children:e}):y.jsx(E2,{fallback:t,...n,children:e})}class zz{constructor(t){this.shape=t}equals(t){var n,r,i,o,s,a;return((n=this.shape)==null?void 0:n.isLocked)===((r=t==null?void 0:t.shape)==null?void 0:r.isLocked)&&((i=this.shape)==null?void 0:i.props)===((o=t==null?void 0:t.shape)==null?void 0:o.props)&&((s=this.shape)==null?void 0:s.meta)===((a=t==null?void 0:t.shape)==null?void 0:a.meta)}}const Nz=({shape:e,util:t})=>_h("Indicator:"+e.type,()=>t.indicator(e)),Rz=({editor:e,id:t})=>{const n=Y("shape",()=>new zz(e.store.get(t)),[e,t]),{ShapeIndicatorErrorFallback:r}=kt();return!n.shape||n.shape.isLocked?null:y.jsx(zc,{fallback:r,onError:i=>e.annotateError(i,{origin:"react.shapeIndicator",willCrashApp:!1}),children:y.jsx(Nz,{shape:n.shape,util:e.getShapeUtil(n.shape)},n.shape.id)})},Fz=({id:e,className:t,color:n,opacity:r})=>{const i=H(),o=Y("transform",()=>{const s=i.getShapePageTransform(e);return s?s.toCssString():""},[i,e]);return y.jsx("svg",{className:pe("tl-overlays__item",t),children:y.jsx("g",{className:"tl-shape-indicator",transform:o,stroke:n??"var(--color-selected)",opacity:r,children:y.jsx(Rz,{editor:i,id:e})})})},Nc=x.memo(Fz);function $z(){return y.jsx("div",{className:"tl-background"})}function ja(e,t,n,r,i,o){x.useLayoutEffect(()=>{const s=e.current;if(!s||t===void 0)return;let a=`translate(${t}px, ${n}px)`;r!==void 0&&(a+=` scale(${r})`),i!==void 0&&(a+=` rotate(${i}rad)`),o&&(a+=` translate(${o.x}px, ${o.y}px)`),s.style.transform=a})}const Xt={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeInOutQuad:e=>e<.5?2*e*e:-1+(4-2*e)*e,easeInCubic:e=>e*e*e,easeOutCubic:e=>--e*e*e+1,easeInOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1- --e*e*e*e,easeInOutQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1+--e*e*e*e*e,easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>e<=0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e>=1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e<=0?0:e>=1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2};class E{constructor(t=0,n=0,r=1){this.x=t,this.y=n,this.z=r}get pressure(){return this.z}set(t=this.x,n=this.y,r=this.z){return this.x=t,this.y=n,this.z=r,this}setTo({x:t=0,y:n=0,z:r=1}){return this.x=t,this.y=n,this.z=r,this}rot(t){if(t===0)return this;const{x:n,y:r}=this,i=Math.sin(t),o=Math.cos(t);return this.x=n*o-r*i,this.y=n*i+r*o,this}rotWith(t,n){if(n===0)return this;const r=this.x-t.x,i=this.y-t.y,o=Math.sin(n),s=Math.cos(n);return this.x=t.x+(r*s-i*o),this.y=t.y+(r*o+i*s),this}clone(){const{x:t,y:n,z:r}=this;return new E(t,n,r)}sub(t){return this.x-=t.x,this.y-=t.y,this}subXY(t,n){return this.x-=t,this.y-=n,this}subScalar(t){return this.x-=t,this.y-=t,this}add(t){return this.x+=t.x,this.y+=t.y,this}addXY(t,n){return this.x+=t,this.y+=n,this}addScalar(t){return this.x+=t,this.y+=t,this}clamp(t,n){return this.x=Math.max(this.x,t),this.y=Math.max(this.y,t),n!==void 0&&(this.x=Math.min(this.x,n),this.y=Math.min(this.y,n)),this}div(t){return this.x/=t,this.y/=t,this}divV(t){return this.x/=t.x,this.y/=t.y,this}mul(t){return this.x*=t,this.y*=t,this}mulV(t){return this.x*=t.x,this.y*=t.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(t,n){const r=E.Tan(t,this);return this.add(r.mul(n))}neg(){return this.x*=-1,this.y*=-1,this}cross(t){return this.x=this.y*t.z-this.z*t.y,this.y=this.z*t.x-this.x*t.z,this}dpr(t){return E.Dpr(this,t)}cpr(t){return E.Cpr(this,t)}len2(){return E.Len2(this)}len(){return E.Len(this)}pry(t){return E.Pry(this,t)}per(){const{x:t,y:n}=this;return this.x=n,this.y=-t,this}uni(){return E.Uni(this)}tan(t){return E.Tan(this,t)}dist(t){return E.Dist(this,t)}distanceToLineSegment(t,n){return E.DistanceToLineSegment(t,n,this)}slope(t){return E.Slope(this,t)}snapToGrid(t){return this.x=Math.round(this.x/t)*t,this.y=Math.round(this.y/t)*t,this}angle(t){return E.Angle(this,t)}toAngle(){return E.ToAngle(this)}lrp(t,n){return this.x=this.x+(t.x-this.x)*n,this.y=this.y+(t.y-this.y)*n,this}equals(t){return E.Equals(this,t)}equalsXY(t,n){return E.EqualsXY(this,t,n)}norm(){const t=this.len();return this.x=t===0?0:this.x/t,this.y=t===0?0:this.y/t,this}toFixed(){return E.ToFixed(this)}toString(){return E.ToString(E.ToFixed(this))}toJson(){return E.ToJson(this)}toArray(){return E.ToArray(this)}static Add(t,n){return new E(t.x+n.x,t.y+n.y)}static AddXY(t,n,r){return new E(t.x+n,t.y+r)}static Sub(t,n){return new E(t.x-n.x,t.y-n.y)}static SubXY(t,n,r){return new E(t.x-n,t.y-r)}static AddScalar(t,n){return new E(t.x+n,t.y+n)}static SubScalar(t,n){return new E(t.x-n,t.y-n)}static Div(t,n){return new E(t.x/n,t.y/n)}static Mul(t,n){return new E(t.x*n,t.y*n)}static DivV(t,n){return new E(t.x/n.x,t.y/n.y)}static MulV(t,n){return new E(t.x*n.x,t.y*n.y)}static Neg(t){return new E(-t.x,-t.y)}static Per(t){return new E(t.y,-t.x)}static Dist2(t,n){return E.Sub(t,n).len2()}static Abs(t){return new E(Math.abs(t.x),Math.abs(t.y))}static Dist(t,n){return Math.hypot(t.y-n.y,t.x-n.x)}static Dpr(t,n){return t.x*n.x+t.y*n.y}static Cross(t,n){return new E(t.y*n.z-t.z*n.y,t.z*n.x-t.x*n.z)}static Cpr(t,n){return t.x*n.y-n.x*t.y}static Len2(t){return t.x*t.x+t.y*t.y}static Len(t){return Math.hypot(t.x,t.y)}static Pry(t,n){return E.Dpr(t,n)/E.Len(n)}static Uni(t){return E.Div(t,E.Len(t))}static Tan(t,n){return E.Uni(E.Sub(t,n))}static Min(t,n){return new E(Math.min(t.x,n.x),Math.min(t.y,n.y))}static Max(t,n){return new E(Math.max(t.x,n.x),Math.max(t.y,n.y))}static From({x:t,y:n,z:r=1}){return new E(t,n,r)}static FromArray(t){return new E(t[0],t[1])}static Rot(t,n=0){const r=Math.sin(n),i=Math.cos(n);return new E(t.x*i-t.y*r,t.x*r+t.y*i)}static RotWith(t,n,r){const i=t.x-n.x,o=t.y-n.y,s=Math.sin(r),a=Math.cos(r);return new E(n.x+(i*a-o*s),n.y+(i*s+o*a))}static NearestPointOnLineThroughPoint(t,n,r){return E.Mul(n,E.Sub(r,t).pry(n)).add(t)}static NearestPointOnLineSegment(t,n,r,i=!0){const o=E.Tan(n,t),s=E.Add(t,E.Mul(o,E.Sub(r,t).pry(o)));if(i){if(s.x<Math.min(t.x,n.x))return E.Cast(t.x<n.x?t:n);if(s.x>Math.max(t.x,n.x))return E.Cast(t.x>n.x?t:n);if(s.y<Math.min(t.y,n.y))return E.Cast(t.y<n.y?t:n);if(s.y>Math.max(t.y,n.y))return E.Cast(t.y>n.y?t:n)}return s}static DistanceToLineThroughPoint(t,n,r){return E.Dist(r,E.NearestPointOnLineThroughPoint(t,n,r))}static DistanceToLineSegment(t,n,r,i=!0){return E.Dist(r,E.NearestPointOnLineSegment(t,n,r,i))}static Snap(t,n=1){return new E(Math.round(t.x/n)*n,Math.round(t.y/n)*n)}static Cast(t){return t instanceof E?t:E.From(t)}static Slope(t,n){return t.x===n.y?NaN:(t.y-n.y)/(t.x-n.x)}static Angle(t,n){return Math.atan2(n.y-t.y,n.x-t.x)}static Lrp(t,n,r){return E.Sub(n,t).mul(r).add(t)}static Med(t,n){return new E((t.x+n.x)/2,(t.y+n.y)/2)}static Equals(t,n){return Math.abs(t.x-n.x)<1e-4&&Math.abs(t.y-n.y)<1e-4}static EqualsXY(t,n,r){return t.x===n&&t.y===r}static Clockwise(t,n,r){return(r.x-t.x)*(n.y-t.y)-(n.x-t.x)*(r.y-t.y)<0}static Rescale(t,n){const r=E.Len(t);return new E(n*t.x/r,n*t.y/r)}static ScaleWithOrigin(t,n,r){return E.Sub(t,r).mul(n).add(r)}static ToFixed(t,n=2){return new E(+t.x.toFixed(n),+t.y.toFixed(n),+t.z.toFixed(n))}static Nudge(t,n,r){return E.Add(t,E.Tan(n,t).mul(r))}static ToString(t){return`${t.x}, ${t.y}`}static ToAngle(t){let n=Math.atan2(t.y,t.x);return n<0&&(n+=Math.PI*2),n}static FromAngle(t,n=1){return new E(Math.cos(t)*n,Math.sin(t)*n)}static ToArray(t){return[t.x,t.y,t.z]}static ToJson(t){const{x:n,y:r,z:i}=t;return{x:n,y:r,z:i}}static Average(t){const n=t.length,r=new E(0,0);for(let i=0;i<n;i++)r.add(t[i]);return r.div(n)}static Clamp(t,n,r){return r===void 0?new E(Math.min(Math.max(t.x,n)),Math.min(Math.max(t.y,n))):new E(Math.min(Math.max(t.x,n),r),Math.min(Math.max(t.y,n),r))}static PointsBetween(t,n,r=6){const i=[];for(let o=0;o<r;o++){const s=Xt.easeInQuad(o/(r-1)),a=E.Lrp(t,n,s);a.z=Math.min(1,.5+Math.abs(.5-Bz(s))*.65),i.push(a)}return i}static SnapToGrid(t,n=8){return new E(Math.round(t.x/n)*n,Math.round(t.y/n)*n)}}const Bz=e=>e<.5?2*e*e:-1+(4-2*e)*e;function Tt(e){return`${O(e.x)},${O(e.y)} `}function Pn(e,t){return`${O((e.x+t.x)/2)},${O((e.y+t.y)/2)} `}const Te=Math.PI,Ke=Te/2,De=Te*2,Uz=Math.sin;function ti(e,t,n){return Math.max(t,typeof n<"u"?Math.min(e,n):e)}function Yh(e,t=1e10){return e?Math.round(e*t)/t:0}function Rc(e,t,n=1e-6){return Math.abs(e-t)<=n}function Fc(e,t){const n=Math.pow(e-t,2)/Math.pow(e+t,2);return Te*(e+t)*(1+3*n/(10+Math.sqrt(4-3*n)))}function Ar(e){return e=e%De,e<0?e=e+De:e===0&&(e=0),e}function Xh(e,t){return e=Ar(e),t=Ar(t),e>t&&(t+=De),t-e}function Vz(e,t){return De-Xh(e,t)}function $c(e,t){const n=(t-e)%De;return 2*n%De-n}function S0(e){return(De+e)%De}function Gh(e,t){const n=De/t;let r=Math.floor((S0(e)+n/2)/n)*n%De;return r<Te&&(r+=De),r>Te&&(r-=De),r}function P2(e,t){return e===t||Rc(e%(Math.PI/2)-t%(Math.PI/2),0)}function Hz(e){return e*Te/180}function Kz(e){return e*180/Te}function I2(e,t,n,r){return new E(e+n*Math.cos(r),t+n*Math.sin(r))}function k0(e,t,n){const r=e/2,i=t/2,o=[];let s=1/0,a=-1/0,l=1/0,c=-1/0;for(let g=0;g<n;g++){const f=De/n,m=-Ke+g*f,w=r+r*Math.cos(m),b=i+i*Math.sin(m);w<s&&(s=w),b<l&&(l=b),w>a&&(a=w),b>c&&(c=b),o.push(new E(w,b))}const u=a-s,d=c-l,h=e-u,p=t-d;if(h!==0||p!==0)for(let g=0;g<o.length;g++){const f=o[g];f.x=(f.x-s)/u*e,f.y=(f.y-l)/d*t}return o}function Bc(e,t,n,r){return e<r&&n<t}function Tr(e,t,n,r){const i=Math.max(e,n),o=Math.min(t,r);return i<=o?[i,o]:null}function M2(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}function ni(e,t){let n=0,r,i;for(let o=0;o<t.length;o++){if(r=t[o],r.x===e.x&&r.y===e.y||(i=t[(o+1)%t.length],E.Dist(e,r)+E.Dist(e,i)===E.Dist(r,i)))return!0;r.y<=e.y?i.y>e.y&&M2(r,i,e)>0&&(n+=1):i.y<=e.y&&M2(r,i,e)<0&&(n-=1)}return n!==0}function O(e){return+e.toFixed(4)}function qh(e){return+e.toFixed(2)}const A2=e=>Math.abs(e)<Number.MAX_SAFE_INTEGER,Zh=({brush:e,color:t,opacity:n,className:r})=>{const i=x.useRef(null);ja(i,e.x,e.y);const o=O(Math.max(1,e.w)),s=O(Math.max(1,e.h));return y.jsx("svg",{className:"tl-overlays__item",ref:i,children:t?y.jsxs("g",{className:"tl-brush",opacity:n,children:[y.jsx("rect",{width:o,height:s,fill:t,opacity:.75}),y.jsx("rect",{width:o,height:s,fill:"none",stroke:t,opacity:.1})]}):y.jsx("rect",{className:`tl-brush tl-brush__default ${r}`,width:o,height:s})})},Wz=({className:e,zoom:t,point:n,color:r,viewport:i,opacity:o=1})=>{const s=x.useRef(null);return ja(s,ti(n.x,i.minX+5/t,i.maxX-5/t),ti(n.y,i.minY+5/t,i.maxY-5/t),1/t,E.Angle(i.center,n)),y.jsxs("svg",{ref:s,className:pe("tl-overlays__item",e),children:[y.jsx("use",{href:"#cursor_hint",color:r,strokeWidth:3,stroke:"var(--color-background)"}),y.jsx("use",{href:"#cursor_hint",color:r,opacity:o})]})},Yz=({className:e,zoom:t,point:n,color:r,name:i,chatMessage:o})=>{const s=x.useRef(null);return ja(s,n==null?void 0:n.x,n==null?void 0:n.y,1/t),n?y.jsxs("div",{ref:s,className:pe("tl-overlays__item",e),children:[y.jsx("svg",{className:"tl-cursor",children:y.jsx("use",{href:"#cursor",color:r})}),o?y.jsxs(y.Fragment,{children:[i&&y.jsx("div",{className:"tl-nametag-title",style:{color:r},children:i}),y.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:r},children:o})]}):i&&y.jsx("div",{className:"tl-nametag",style:{backgroundColor:r},children:i})]}):null},T2=x.memo(Yz),_0={openWindow:(e,t)=>window.open(e,t,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>{var e;return await((e=window.__tldraw__hardReset)==null?void 0:e.call(window))}};function j2(){_0.hardReset()}function Xz(){_0.refreshPage()}const Gz="https://github.com/tldraw/tldraw/issues/new";function qz(){}const O2=({error:e,editor:t})=>{const n=x.useRef(null),[r,i]=x.useState(!1),[o,s]=x.useState(!1),[a,l]=x.useState(!1),c=e instanceof Error?e.message:String(e),u=e instanceof Error?e.stack:null,d=Y("isDarkMode",()=>{try{if(t)return t.user.getIsDarkMode()}catch{}return null},[t]),[h,p]=x.useState(null);x.useLayoutEffect(()=>{var S;d!==null&&p(d);let b=(S=n.current)==null?void 0:S.parentElement,k=!1;for(;b;){if(b.classList.contains("tl-theme__dark")||b.classList.contains("tl-theme__light")){k=!0;break}b=b.parentElement}if(k){p(null);return}p(window.matchMedia("(prefers-color-scheme: dark)").matches)},[d]),x.useEffect(()=>{if(o){const b=setTimeout(()=>{s(!1)},2e3);return()=>clearTimeout(b)}},[o]);const g=()=>{const b=document.createElement("textarea");b.value=u??c,document.body.appendChild(b),b.select(),document.execCommand("copy"),b.remove(),s(!0)},f=()=>{Xz()},m=async()=>{j2()},w=new URL(Gz);return w.searchParams.set("title",c),w.searchParams.set("labels","bug"),w.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${u??c}
\`\`\`

My browser: ${navigator.userAgent}`),y.jsxs("div",{ref:n,className:pe("tl-container tl-error-boundary",h===null?"":h?"tl-theme__dark":"tl-theme__light"),children:[y.jsx("div",{className:"tl-error-boundary__overlay"}),t&&y.jsx(E2,{onError:qz,fallback:()=>null,children:y.jsx(x0.Provider,{value:t,children:y.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:y.jsx(N0,{})})})}),y.jsx("div",{className:pe("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?y.jsxs(y.Fragment,{children:[y.jsx("h2",{children:"Are you sure?"}),y.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),y.jsxs("div",{className:"tl-error-boundary__content__actions",children:[y.jsx("button",{onClick:()=>l(!1),children:"Cancel"}),y.jsx("button",{className:"tl-error-boundary__reset",onClick:m,children:"Reset data"})]})]}):y.jsxs(y.Fragment,{children:[y.jsx("h2",{children:"Something's gone wrong."}),y.jsxs("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",y.jsx("a",{href:w.toString(),children:"create a GitHub issue"})," or"," ",y.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),r&&y.jsxs("div",{className:"tl-error-boundary__content__error",children:[y.jsx("pre",{children:y.jsx("code",{children:u??c})}),y.jsx("button",{onClick:g,children:o?"Copied!":"Copy"})]}),y.jsxs("div",{className:"tl-error-boundary__content__actions",children:[y.jsx("button",{onClick:()=>i(!r),children:r?"Hide details":"Show details"}),y.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[y.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>l(!0),children:"Reset data"}),y.jsx("button",{className:"tl-error-boundary__refresh",onClick:f,children:"Refresh Page"})]})]})]})})]})},Li=2e3,Qh=40,Di=320,Oa=[.1,.25,.5,1,2,4,8],Uc=.1,Io=8,Zz=.5,Qz=.1,Jz=.2,eN=.005,tN=.05,nN=450,rN=200,C0=6,Vc=4,iN=32,Jh={};for(let e=1;e<=Math.ceil(Io);e++)Jh[e+"_dark"]=`hash_pattern_zoom_${e}_dark`,Jh[e+"_light"]=`hash_pattern_zoom_${e}_light`;const oN={duration:0,easing:Xt.easeInOutCubic},ep=.09,L2=[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],sN=6e4,D2=3e3,aN=1200,z2={CAMERA_MOVE:-10},lN=64,cN=620,jr=8,uN=20,La=32,dN=({x:e,y:t,z:n,size:r})=>y.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[y.jsx("defs",{children:L2.map(({min:i,mid:o,step:s},a)=>{const l=s*r*n,c=.5+e*n,u=.5+t*n,d=c>0?c%l:l+c%l,h=u>0?u%l:l+u%l,p=n<o?Ih(n,[i,o],[0,1]):1;return y.jsx("pattern",{id:`grid-${s}`,width:l,height:l,patternUnits:"userSpaceOnUse",children:y.jsx("circle",{className:"tl-grid-dot",cx:d,cy:h,r:1,opacity:p})},`grid-pattern-${a}`)})}),L2.map(({step:i},o)=>y.jsx("rect",{width:"100%",height:"100%",fill:`url(#grid-${i})`},`grid-rect-${o}`))]}),hN=({handle:e,isCoarse:t,className:n,zoom:r})=>{const i=(t?20:12)/r,o=(e.type==="create"&&t?3:4)/r;return y.jsxs("g",{className:pe("tl-handle",{"tl-handle__virtual":e.type==="virtual","tl-handle__create":e.type==="create"},n),children:[y.jsx("circle",{className:"tl-handle__bg",r:i}),y.jsx("circle",{className:"tl-handle__fg",r:o})]})},pN=({children:e})=>y.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:e}),fN=({shapeId:e})=>y.jsx(Nc,{className:"tl-user-indicator__hovered",id:e});function Hc(e,t=!0){const n=e.length;if(n<2)return"";let r=e[0],i=e[1];if(n===2)return`M${Tt(r)}L${Tt(i)}`;let o="";for(let s=2,a=n-1;s<a;s++)r=e[s],i=e[s+1],o+=Pn(r,i);return t?`M${Pn(e[0],e[1])}Q${Tt(e[1])}${Pn(e[1],e[2])}T${o}${Pn(e[n-1],e[0])}${Pn(e[0],e[1])}Z`:`M${Tt(e[0])}Q${Tt(e[1])}${Pn(e[1],e[2])}${e.length>3?"T":""}${o}L${Tt(e[n-1])}`}const N2=({scribble:e,zoom:t,color:n,opacity:r,className:i})=>e.points.length?y.jsx("svg",{className:i&&pe("tl-overlays__item",i),children:y.jsx("path",{className:"tl-scribble",d:Hc(e.points,!1),stroke:n??`var(--color-${e.color})`,fill:"none",strokeWidth:8/t,opacity:r??e.opacity})}):null,R2=({bounds:e,rotation:t})=>{const n=x.useRef(null);return ja(n,e.x,e.y,1,t),x.useLayoutEffect(()=>{const r=n.current;r&&(r.style.width=O(Math.max(1,e.width))+"px",r.style.height=O(Math.max(1,e.height))+"px")},[e.width,e.height]),y.jsx("div",{ref:n,className:"tl-selection__bg",draggable:!1})},gN=({bounds:e,rotation:t})=>{const n=H(),r=x.useRef(null),i=Y("only selected shape",()=>n.getOnlySelectedShape(),[n]),o=i?n.getShapeUtil(i).expandSelectionOutlinePx(i):0;return ja(r,e==null?void 0:e.x,e==null?void 0:e.y,1,t,{x:-o,y:-o}),e=e.clone().expandBy(o).zeroFix(),y.jsx("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:y.jsx("rect",{className:pe("tl-selection__fg__outline"),width:O(e.width),height:O(e.height)})})},mN=()=>y.jsx("div",{className:"tl-shape-error-boundary"}),yN=()=>y.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"});function vN({points:e,zoom:t}){const n=2.5/t,r=e.reduce((h,p)=>Math.min(h,p.x),1/0),i=e.reduce((h,p)=>Math.max(h,p.x),-1/0),o=e.reduce((h,p)=>Math.min(h,p.y),1/0),s=e.reduce((h,p)=>Math.max(h,p.y),-1/0),a=e.some(h=>h.x===r&&h.y===o);let l,c,u,d;return a?(l=r,c=o,u=i,d=s):(l=r,c=s,u=i,d=o),y.jsxs("g",{className:"tl-snap-line",children:[y.jsx("line",{x1:l,y1:c,x2:u,y2:d}),e.map((h,p)=>y.jsx("g",{transform:`translate(${h.x},${h.y})`,children:y.jsx("path",{className:"tl-snap-point",d:`M ${-n},${-n} L ${n},${n} M ${-n},${n} L ${n},${-n}`})},p))]})}function bN({gaps:e,direction:t,zoom:n}){const r=3.5/n;let i=[-1/0,1/0],o=null;const s=t==="horizontal";for(const l of e){if(o=Tr(i[0],i[1],s?l.startEdge[0].y:l.startEdge[0].x,s?l.startEdge[1].y:l.startEdge[1].x),o)i=o;else continue;if(o=Tr(i[0],i[1],s?l.endEdge[0].y:l.endEdge[0].x,s?l.endEdge[1].y:l.endEdge[1].x),o)i=o;else continue}if(i===null)return null;const a=(i[0]+i[1])/2;return y.jsx("g",{className:"tl-snap-line",children:e.map(({startEdge:l,endEdge:c},u)=>y.jsx(x.Fragment,{children:s?y.jsxs(y.Fragment,{children:[y.jsx("line",{x1:l[0].x,y1:a-2*r,x2:l[1].x,y2:a+2*r}),y.jsx("line",{x1:c[0].x,y1:a-2*r,x2:c[1].x,y2:a+2*r}),y.jsx("line",{x1:l[0].x,y1:a,x2:c[0].x,y2:a}),y.jsx("line",{x1:(l[0].x+c[0].x)/2,y1:a-r,x2:(l[0].x+c[0].x)/2,y2:a+r})]}):y.jsxs(y.Fragment,{children:[y.jsx("line",{x1:a-2*r,y1:l[0].y,x2:a+2*r,y2:l[1].y}),y.jsx("line",{x1:a-2*r,y1:c[0].y,x2:a+2*r,y2:c[1].y}),y.jsx("line",{x1:a,y1:l[0].y,x2:a,y2:c[0].y}),y.jsx("line",{x1:a-r,y1:(l[0].y+c[0].y)/2,x2:a+r,y2:(l[0].y+c[0].y)/2})]})},u))})}const wN=({className:e,line:t,zoom:n})=>y.jsx("svg",{className:pe("tl-overlays__item",e),children:t.type==="points"?y.jsx(vN,{...t,zoom:n}):t.type==="gaps"?y.jsx(bN,{...t,zoom:n}):null}),xN=()=>y.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:y.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[y.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"var(--color-text-1)"}),y.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"var(--color-text-1)",children:y.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})}),SN=()=>null,F2=x.createContext({});function kN({overrides:e,children:t}){return y.jsx(F2.Provider,{value:x.useMemo(()=>({Background:$z,SvgDefs:SN,Brush:Zh,ZoomBrush:Zh,ScreenshotBrush:Zh,CollaboratorBrush:Zh,Cursor:T2,CollaboratorCursor:T2,CollaboratorHint:Wz,CollaboratorShapeIndicator:Nc,Grid:dN,Scribble:N2,SnapLine:wN,Handles:pN,Handle:hN,CollaboratorScribble:N2,ErrorFallback:O2,ShapeErrorFallback:mN,ShapeIndicatorErrorFallback:yN,Spinner:xN,SelectionBackground:R2,SelectionForeground:gN,HoveredShapeIndicator:fN,OnTheCanvas:null,InFrontOfTheCanvas:null,...e}),[e]),children:t})}function kt(){return x.useContext(F2)}const _N=["textarea","input"];function CN(e){const t=H();x.useEffect(()=>{const n=e.current;if(!n)return;const r=i=>{var o;if(i instanceof PointerEvent&&i.pointerType==="pen"){i.isKilled=!0;const{target:s}=i;if(_N.includes((o=s.tagName)==null?void 0:o.toLocaleLowerCase())||t.isIn("select.editing_shape"))return;Ee(i)}};return n.addEventListener("touchstart",r),n.addEventListener("touchend",r),()=>{n.removeEventListener("touchstart",r),n.removeEventListener("touchend",r)}},[t,e])}function EN(e,t,n){return Math.max(t,Math.min(e,n))}const jt={toVector(e,t){return e===void 0&&(e=t),Array.isArray(e)?e:[e,e]},add(e,t){return[e[0]+t[0],e[1]+t[1]]},sub(e,t){return[e[0]-t[0],e[1]-t[1]]},addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function $2(e,t,n){return t===0||Math.abs(t)===1/0?Math.pow(e,n*5):e*t*n/(t+n*e)}function B2(e,t,n,r=.15){return r===0?EN(e,t,n):e<t?-$2(t-e,n-t,r)+t:e>n?+$2(e-n,n-t,r)+n:e}function PN(e,[t,n],[r,i]){const[[o,s],[a,l]]=e;return[B2(t,o,s,r),B2(n,a,l,i)]}function IN(e,t){if(typeof e!="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function MN(e){var t=IN(e,"string");return typeof t=="symbol"?t:String(t)}function Gt(e,t,n){return t=MN(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function U2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function ot(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?U2(Object(n),!0).forEach(function(r){Gt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const V2={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function H2(e){return e?e[0].toUpperCase()+e.slice(1):""}const AN=["enter","leave"];function TN(e=!1,t){return e&&!AN.includes(t)}function jN(e,t="",n=!1){const r=V2[e],i=r&&r[t]||t;return"on"+H2(e)+H2(i)+(TN(n,i)?"Capture":"")}const ON=["gotpointercapture","lostpointercapture"];function LN(e){let t=e.substring(2).toLowerCase();const n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));const r=ON.includes(t)?"capturecapture":"capture",i=!!~t.indexOf(r);return i&&(t=t.replace("capture","")),{device:t,capture:i,passive:n}}function DN(e,t=""){const n=V2[e],r=n&&n[t]||t;return e+r}function K2(e){return"touches"in e}function zN(e){return K2(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function NN(e){return Array.from(e.touches).filter(t=>{var n,r;return t.target===e.currentTarget||((n=e.currentTarget)===null||n===void 0||(r=n.contains)===null||r===void 0?void 0:r.call(n,t.target))})}function E0(e,t){try{const n=t.clientX-e.clientX,r=t.clientY-e.clientY,i=(t.clientX+e.clientX)/2,o=(t.clientY+e.clientY)/2,s=Math.hypot(n,r);return{angle:-(Math.atan2(n,r)*180)/Math.PI,distance:s,origin:[i,o]}}catch{}return null}function RN(e){return NN(e).map(t=>t.identifier)}function W2(e,t){const[n,r]=Array.from(e.touches).filter(i=>t.includes(i.identifier));return E0(n,r)}const Y2=40,X2=800;function G2(e){let{deltaX:t,deltaY:n,deltaMode:r}=e;return r===1?(t*=Y2,n*=Y2):r===2&&(t*=X2,n*=X2),[t,n]}function FN(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o}=e;Object.assign(t,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o})}return t}function tp(e,...t){return typeof e=="function"?e(...t):e}function $N(){}function BN(...e){return e.length===0?$N:e.length===1?e[0]:function(){let t;for(const n of e)t=n.apply(this,arguments)||t;return t}}function q2(e,t){return Object.assign({},t,e||{})}const UN=32;class Z2{constructor(t,n,r){this.ctrl=t,this.args=n,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(t){this.ctrl.state[this.key]=t}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:t,shared:n,ingKey:r,args:i}=this;n[r]=t._active=t.active=t._blocked=t._force=!1,t._step=[!1,!1],t.intentional=!1,t._movement=[0,0],t._distance=[0,0],t._direction=[0,0],t._delta=[0,0],t._bounds=[[-1/0,1/0],[-1/0,1/0]],t.args=i,t.axis=void 0,t.memo=void 0,t.elapsedTime=t.timeDelta=0,t.direction=[0,0],t.distance=[0,0],t.overflow=[0,0],t._movementBound=[!1,!1],t.velocity=[0,0],t.movement=[0,0],t.delta=[0,0],t.timeStamp=0}start(t){const n=this.state,r=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=t.target,n.currentTarget=t.currentTarget,n.lastOffset=r.from?tp(r.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=t.timeStamp)}computeValues(t){const n=this.state;n._values=t,n.values=this.config.transform(t)}computeInitial(){const t=this.state;t._initial=t._values,t.initial=t.values}compute(t){const{state:n,config:r,shared:i}=this;n.args=this.args;let o=0;if(t&&(n.event=t,r.preventDefault&&t.cancelable&&n.event.preventDefault(),n.type=t.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,FN(t)),i.down=i.pressed=i.buttons%2===1||i.touches>0,o=t.timeStamp-n.timeStamp,n.timeStamp=t.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const _=n._delta.map(Math.abs);jt.addTo(n._distance,_)}this.axisIntent&&this.axisIntent(t);const[s,a]=n._movement,[l,c]=r.threshold,{_step:u,values:d}=n;if(r.hasCustomTransform?(u[0]===!1&&(u[0]=Math.abs(s)>=l&&d[0]),u[1]===!1&&(u[1]=Math.abs(a)>=c&&d[1])):(u[0]===!1&&(u[0]=Math.abs(s)>=l&&Math.sign(s)*l),u[1]===!1&&(u[1]=Math.abs(a)>=c&&Math.sign(a)*c)),n.intentional=u[0]!==!1||u[1]!==!1,!n.intentional)return;const h=[0,0];if(r.hasCustomTransform){const[_,P]=d;h[0]=u[0]!==!1?_-u[0]:0,h[1]=u[1]!==!1?P-u[1]:0}else h[0]=u[0]!==!1?s-u[0]:0,h[1]=u[1]!==!1?a-u[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(h);const p=n.offset,g=n._active&&!n._blocked||n.active;g&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=i[this.ingKey]=n._active,t&&(n.first&&("bounds"in r&&(n._bounds=tp(r.bounds,n)),this.setup&&this.setup()),n.movement=h,this.computeOffset()));const[f,m]=n.offset,[[w,b],[k,S]]=n._bounds;n.overflow=[f<w?-1:f>b?1:0,m<k?-1:m>S?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const C=n._active?r.rubberband||[0,0]:[0,0];if(n.offset=PN(n._bounds,n.offset,C),n.delta=jt.sub(n.offset,p),this.computeMovement(),g&&(!n.last||o>UN)){n.delta=jt.sub(n.offset,p);const _=n.delta.map(Math.abs);jt.addTo(n.distance,_),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&o>0&&(n.velocity=[_[0]/o,_[1]/o],n.timeDelta=o)}}emit(){const t=this.state,n=this.shared,r=this.config;if(t._active||this.clean(),(t._blocked||!t.intentional)&&!t._force&&!r.triggerAllEvents)return;const i=this.handler(ot(ot(ot({},n),t),{},{[this.aliasKey]:t.values}));i!==void 0&&(t.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function VN([e,t],n){const r=Math.abs(e),i=Math.abs(t);if(r>i&&r>n)return"x";if(i>r&&i>n)return"y"}class HN extends Z2{constructor(...t){super(...t),Gt(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=jt.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=jt.sub(this.state.offset,this.state.lastOffset)}axisIntent(t){const n=this.state,r=this.config;if(!n.axis&&t){const i=typeof r.axisThreshold=="object"?r.axisThreshold[zN(t)]:r.axisThreshold;n.axis=VN(n._movement,i)}n._blocked=(r.lockDirection||!!r.axis)&&!n.axis||!!r.axis&&r.axis!==n.axis}restrictToAxis(t){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":t[1]=0;break;case"y":t[0]=0;break}}}const KN=e=>e,Q2=.15,J2={enabled(e=!0){return e},eventOptions(e,t,n){return ot(ot({},n.shared.eventOptions),e)},preventDefault(e=!1){return e},triggerAllEvents(e=!1){return e},rubberband(e=0){switch(e){case!0:return[Q2,Q2];case!1:return[0,0];default:return jt.toVector(e)}},from(e){if(typeof e=="function")return e;if(e!=null)return jt.toVector(e)},transform(e,t,n){const r=e||n.shared.transform;return this.hasCustomTransform=!!r,r||KN},threshold(e){return jt.toVector(e,0)}},WN=0,Kc=ot(ot({},J2),{},{axis(e,t,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(e=WN){return e},bounds(e={}){if(typeof e=="function")return o=>Kc.bounds(e(o));if("current"in e)return()=>e.current;if(typeof HTMLElement=="function"&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=e;return[[t,n],[r,i]]}}),Wc=typeof window<"u"&&window.document&&window.document.createElement;function eC(){return Wc&&"ontouchstart"in window}function YN(){return eC()||Wc&&window.navigator.maxTouchPoints>1}function XN(){return Wc&&"onpointerdown"in window}function GN(){return Wc&&"exitPointerLock"in window.document}function qN(){try{return"constructor"in GestureEvent}catch{return!1}}const cr={isBrowser:Wc,gesture:qN(),touch:eC(),touchscreen:YN(),pointer:XN(),pointerLock:GN()},ZN=250,QN=180,JN=.5,e6=50,t6=250,n6=10,tC={mouse:0,touch:0,pen:8};ot(ot({},Kc),{},{device(e,t,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&cr.pointerLock,cr.touch&&n?"touch":this.pointerLock?"mouse":cr.pointer&&!i?"pointer":cr.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&e?ZN:void 0,!(!cr.touchscreen||n===!1))return e||(n!==void 0?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&this.device==="pointer"&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:r=3,axis:i=void 0}){const o=jt.toVector(e,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,o},swipe({velocity:e=JN,distance:t=e6,duration:n=t6}={}){return{velocity:this.transform(jt.toVector(e)),distance:this.transform(jt.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return QN;case!1:return 0;default:return e}},axisThreshold(e){return e?ot(ot({},tC),e):tC},keyboardDisplacement(e=n6){return e}});function nC(e){const[t,n]=e.overflow,[r,i]=e._delta,[o,s]=e._direction;(t<0&&r>0&&o<0||t>0&&r<0&&o>0)&&(e._movement[0]=e._movementBound[0]),(n<0&&i>0&&s<0||n>0&&i<0&&s>0)&&(e._movement[1]=e._movementBound[1])}const r6=30,i6=100;class o6 extends Z2{constructor(...t){super(...t),Gt(this,"ingKey","pinching"),Gt(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const t=this.state;t._touchIds=[],t.canceled=!1,t.cancel=this.cancel.bind(this),t.turns=0}computeOffset(){const{type:t,movement:n,lastOffset:r}=this.state;t==="wheel"?this.state.offset=jt.add(n,r):this.state.offset=[(1+n[0])*r[0],n[1]+r[1]]}computeMovement(){const{offset:t,lastOffset:n}=this.state;this.state.movement=[t[0]/n[0],t[1]-n[1]]}axisIntent(){const t=this.state,[n,r]=t._movement;if(!t.axis){const i=Math.abs(n)*r6-Math.abs(r);i<0?t.axis="angle":i>0&&(t.axis="scale")}}restrictToAxis(t){this.config.lockDirection&&(this.state.axis==="scale"?t[1]=0:this.state.axis==="angle"&&(t[0]=0))}cancel(){const t=this.state;t.canceled||setTimeout(()=>{t.canceled=!0,t._active=!1,this.compute(),this.emit()},0)}touchStart(t){this.ctrl.setEventIds(t);const n=this.state,r=this.ctrl.touchIds;if(n._active&&n._touchIds.every(o=>r.has(o))||r.size<2)return;this.start(t),n._touchIds=Array.from(r).slice(0,2);const i=W2(t,n._touchIds);i&&this.pinchStart(t,i)}pointerStart(t){if(t.buttons!=null&&t.buttons%2!==1)return;this.ctrl.setEventIds(t),t.target.setPointerCapture(t.pointerId);const n=this.state,r=n._pointerEvents,i=this.ctrl.pointerIds;if(n._active&&Array.from(r.keys()).every(s=>i.has(s))||(r.size<2&&r.set(t.pointerId,t),n._pointerEvents.size<2))return;this.start(t);const o=E0(...Array.from(r.values()));o&&this.pinchStart(t,o)}pinchStart(t,n){const r=this.state;r.origin=n.origin,this.computeValues([n.distance,n.angle]),this.computeInitial(),this.compute(t),this.emit()}touchMove(t){if(!this.state._active)return;const n=W2(t,this.state._touchIds);n&&this.pinchMove(t,n)}pointerMove(t){const n=this.state._pointerEvents;if(n.has(t.pointerId)&&n.set(t.pointerId,t),!this.state._active)return;const r=E0(...Array.from(n.values()));r&&this.pinchMove(t,r)}pinchMove(t,n){const r=this.state,i=r._values[1],o=n.angle-i;let s=0;Math.abs(o)>270&&(s+=Math.sign(o)),this.computeValues([n.distance,n.angle-360*s]),r.origin=n.origin,r.turns=s,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(t),this.emit()}touchEnd(t){this.ctrl.setEventIds(t),this.state._active&&this.state._touchIds.some(n=>!this.ctrl.touchIds.has(n))&&(this.state._active=!1,this.compute(t),this.emit())}pointerEnd(t){const n=this.state;this.ctrl.setEventIds(t);try{t.target.releasePointerCapture(t.pointerId)}catch{}n._pointerEvents.has(t.pointerId)&&n._pointerEvents.delete(t.pointerId),n._active&&n._pointerEvents.size<2&&(n._active=!1,this.compute(t),this.emit())}gestureStart(t){t.cancelable&&t.preventDefault();const n=this.state;n._active||(this.start(t),this.computeValues([t.scale,t.rotation]),n.origin=[t.clientX,t.clientY],this.compute(t),this.emit())}gestureMove(t){if(t.cancelable&&t.preventDefault(),!this.state._active)return;const n=this.state;this.computeValues([t.scale,t.rotation]),n.origin=[t.clientX,t.clientY];const r=n._movement;n._movement=[t.scale-1,t.rotation],n._delta=jt.sub(n._movement,r),this.compute(t),this.emit()}gestureEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}wheel(t){const n=this.config.modifierKey;n&&(Array.isArray(n)?!n.find(r=>t[r]):!t[n])||(this.state._active?this.wheelChange(t):this.wheelStart(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(t){this.start(t),this.wheelChange(t)}wheelChange(t){"uv"in t||t.cancelable&&t.preventDefault();const n=this.state;n._delta=[-G2(t)[1]/i6*n.offset[0],0],jt.addTo(n._movement,n._delta),nC(n),this.state.origin=[t.clientX,t.clientY],this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){const n=this.config.device;n&&(t(n,"start",this[n+"Start"].bind(this)),t(n,"change",this[n+"Move"].bind(this)),t(n,"end",this[n+"End"].bind(this)),t(n,"cancel",this[n+"End"].bind(this)),t("lostPointerCapture","",this[n+"End"].bind(this))),this.config.pinchOnWheel&&t("wheel","",this.wheel.bind(this),{passive:!1})}}const s6=ot(ot({},J2),{},{device(e,t,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!cr.touch&&cr.gesture)return"gesture";if(cr.touch&&r)return"touch";if(cr.touchscreen){if(cr.pointer)return"pointer";if(cr.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:r={}}){const i=s=>{const a=q2(tp(n,s),{min:-1/0,max:1/0});return[a.min,a.max]},o=s=>{const a=q2(tp(r,s),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof n!="function"&&typeof r!="function"?[i(),o()]:s=>[i(s),o(s)]},threshold(e,t,n){return this.lockDirection=n.axis==="lock",jt.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey(e){return e===void 0?"ctrlKey":e},pinchOnWheel(e=!0){return e}});ot(ot({},Kc),{},{mouseOnly:(e=!0)=>e});class a6 extends HN{constructor(...t){super(...t),Gt(this,"ingKey","wheeling")}wheel(t){this.state._active||this.start(t),this.wheelChange(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(t){const n=this.state;n._delta=G2(t),jt.addTo(n._movement,n._delta),nC(n),this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("wheel","",this.wheel.bind(this))}}const l6=Kc;ot(ot({},Kc),{},{mouseOnly:(e=!0)=>e});const P0=new Map,I0=new Map;function c6(e){P0.set(e.key,e.engine),I0.set(e.key,e.resolver)}const u6={key:"pinch",engine:o6,resolver:s6},d6={key:"wheel",engine:a6,resolver:l6};function h6(e,t){if(e==null)return{};var n={},r=Object.keys(e),i,o;for(o=0;o<r.length;o++)i=r[o],!(t.indexOf(i)>=0)&&(n[i]=e[i]);return n}function p6(e,t){if(e==null)return{};var n=h6(e,t),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)r=o[i],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}const f6={target(e){if(e)return()=>"current"in e?e.current:e},enabled(e=!0){return e},window(e=cr.isBrowser?window:void 0){return e},eventOptions({passive:e=!0,capture:t=!1}={}){return{passive:e,capture:t}},transform(e){return e}},g6=["target","eventOptions","window","enabled","transform"];function np(e={},t){const n={};for(const[r,i]of Object.entries(t))switch(typeof i){case"function":n[r]=i.call(n,e[r],r,e);break;case"object":n[r]=np(e[r],i);break;case"boolean":i&&(n[r]=e[r]);break}return n}function m6(e,t,n={}){const r=e,{target:i,eventOptions:o,window:s,enabled:a,transform:l}=r,c=p6(r,g6);if(n.shared=np({target:i,eventOptions:o,window:s,enabled:a,transform:l},f6),t){const u=I0.get(t);n[t]=np(ot({shared:n.shared},c),u)}else for(const u in c){const d=I0.get(u);d&&(n[u]=np(ot({shared:n.shared},c[u]),d))}return n}class rC{constructor(t,n){Gt(this,"_listeners",new Set),this._ctrl=t,this._gestureKey=n}add(t,n,r,i,o){const s=this._listeners,a=DN(n,r),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},c=ot(ot({},l),o);t.addEventListener(a,i,c);const u=()=>{t.removeEventListener(a,i,c),s.delete(u)};return s.add(u),u}clean(){this._listeners.forEach(t=>t()),this._listeners.clear()}}class y6{constructor(){Gt(this,"_timeouts",new Map)}add(t,n,r=140,...i){this.remove(t),this._timeouts.set(t,window.setTimeout(n,r,...i))}remove(t){const n=this._timeouts.get(t);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(t=>void window.clearTimeout(t)),this._timeouts.clear()}}class v6{constructor(t){Gt(this,"gestures",new Set),Gt(this,"_targetEventStore",new rC(this)),Gt(this,"gestureEventStores",{}),Gt(this,"gestureTimeoutStores",{}),Gt(this,"handlers",{}),Gt(this,"config",{}),Gt(this,"pointerIds",new Set),Gt(this,"touchIds",new Set),Gt(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),b6(this,t)}setEventIds(t){if(K2(t))return this.touchIds=new Set(RN(t)),this.touchIds;if("pointerId"in t)return t.type==="pointerup"||t.type==="pointercancel"?this.pointerIds.delete(t.pointerId):t.type==="pointerdown"&&this.pointerIds.add(t.pointerId),this.pointerIds}applyHandlers(t,n){this.handlers=t,this.nativeHandlers=n}applyConfig(t,n){this.config=m6(t,n,this.config)}clean(){this._targetEventStore.clean();for(const t of this.gestures)this.gestureEventStores[t].clean(),this.gestureTimeoutStores[t].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...t){const n=this.config.shared,r={};let i;if(!(n.target&&(i=n.target(),!i))){if(n.enabled){for(const s of this.gestures){const a=this.config[s],l=iC(r,a.eventOptions,!!i);if(a.enabled){const c=P0.get(s);new c(this,t,s).bind(l)}}const o=iC(r,n.eventOptions,!!i);for(const s in this.nativeHandlers)o(s,"",a=>this.nativeHandlers[s](ot(ot({},this.state.shared),{},{event:a,args:t})),void 0,!0)}for(const o in r)r[o]=BN(...r[o]);if(!i)return r;for(const o in r){const{device:s,capture:a,passive:l}=LN(o);this._targetEventStore.add(i,s,"",r[o],{capture:a,passive:l})}}}}function Da(e,t){e.gestures.add(t),e.gestureEventStores[t]=new rC(e,t),e.gestureTimeoutStores[t]=new y6}function b6(e,t){t.drag&&Da(e,"drag"),t.wheel&&Da(e,"wheel"),t.scroll&&Da(e,"scroll"),t.move&&Da(e,"move"),t.pinch&&Da(e,"pinch"),t.hover&&Da(e,"hover")}const iC=(e,t,n)=>(r,i,o,s={},a=!1)=>{var l,c;const u=(l=s.capture)!==null&&l!==void 0?l:t.capture,d=(c=s.passive)!==null&&c!==void 0?c:t.passive;let h=a?r:jN(r,i,u);n&&d&&(h+="Passive"),e[h]=e[h]||[],e[h].push(o)},w6=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function x6(e){const t={},n={},r=new Set;for(let i in e)w6.test(i)?(r.add(RegExp.lastMatch),n[i]=e[i]):t[i]=e[i];return[n,t,r]}function za(e,t,n,r,i,o){if(!e.has(n)||!P0.has(r))return;const s=n+"Start",a=n+"End",l=c=>{let u;return c.first&&s in t&&t[s](c),n in t&&(u=t[n](c)),c.last&&a in t&&t[a](c),u};i[r]=l,o[r]=o[r]||{}}function S6(e,t){const[n,r,i]=x6(e),o={};return za(i,n,"onDrag","drag",o,t),za(i,n,"onWheel","wheel",o,t),za(i,n,"onScroll","scroll",o,t),za(i,n,"onPinch","pinch",o,t),za(i,n,"onMove","move",o,t),za(i,n,"onHover","hover",o,t),{handlers:o,config:t,nativeHandlers:r}}function k6(e,t={},n,r){const i=J.useMemo(()=>new v6(e),[]);if(i.applyHandlers(e,r),i.applyConfig(t,n),J.useEffect(i.effect.bind(i)),J.useEffect(()=>i.clean.bind(i),[]),t.target===void 0)return i.bind.bind(i)}function _6(e){return e.forEach(c6),function(t,n){const{handlers:r,nativeHandlers:i,config:o}=S6(t,n||{});return k6(r,o,void 0,i)}}const oC=10,C6=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function sC(e){let{deltaY:t,deltaX:n}=e,r=0;if(e.ctrlKey||e.altKey||e.metaKey){const i=Math.sign(e.deltaY),o=Math.abs(e.deltaY);let s=t;o>oC&&(s=oC*i),r=s/100}else e.shiftKey&&!C6&&(n=t,t=0);return{x:-n,y:-t,z:-r}}const E6=_6([d6,u6]);let Na;const P6=e=>Na===void 0?(Na=e,!1):e-Na>120&&e-Na<160?(Na=e,!0):(Na=e,!1);function I6(e){const t=H(),n=x.useMemo(()=>{let r="not sure";const i=({event:p})=>{var b;if(!t.getInstanceState().isFocused||(r="not sure",P6(Date.now())))return;const g=t.getEditingShapeId();if(g){const k=t.getShape(g);if(k&&t.getShapeUtil(k).canScroll(k)&&((b=t.getShapePageBounds(g))!=null&&b.containsPoint(t.inputs.currentPagePoint)))return}Ee(p);const f=sC(p);if(f.x===0&&f.y===0)return;const m=t.getContainer().getBoundingClientRect(),w={type:"wheel",name:"wheel",delta:f,point:new E(p.clientX,p.clientY).sub({x:m.left,y:m.top}),shiftKey:p.shiftKey,altKey:p.altKey,ctrlKey:p.metaKey||p.ctrlKey};t.dispatch(w)};let o=1,s=1,a=1,l=0;const c=new E,u=new E,d=p=>{const g=e.current;r="not sure";const{event:f,origin:m,da:w}=p;f instanceof WheelEvent||(f.target===g||g!=null&&g.contains(f.target))&&(u.x=m[0],u.y=m[1],c.x=m[0],c.y=m[1],o=w[0],s=t.getZoomLevel(),t.dispatch({type:"pinch",name:"pinch_start",point:{x:m[0],y:m[1],z:t.getZoomLevel()},delta:{x:0,y:0},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey}))},h=p=>{if(p&&(r="zooming"),r==="zooming")return;const g=Math.abs(l-o),f=E.Dist(c,u);switch(r){case"not sure":{g>24?r="zooming":f>16&&(r="panning");break}case"panning":{g>64&&(r="zooming");break}}};return{onWheel:i,onPinchStart:d,onPinchEnd:p=>{const g=e.current,{event:f,origin:m,offset:w}=p;if(f instanceof WheelEvent||!(f.target===g||g!=null&&g.contains(f.target)))return;const b=w[0];r="not sure",requestAnimationFrame(()=>{t.dispatch({type:"pinch",name:"pinch_end",point:{x:m[0],y:m[1],z:b},delta:{x:m[0],y:m[1]},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey})})},onPinch:p=>{const g=e.current,{event:f,origin:m,offset:w,da:b}=p;if(f instanceof WheelEvent||!(f.target===g||g!=null&&g.contains(f.target)))return;const k=p.type==="gesturechange"||p.type==="gestureend";l=b[0];const S=m[0]-u.x,C=m[1]-u.y;switch(u.x=m[0],u.y=m[1],h(k),r){case"zooming":{a=w[0],t.dispatch({type:"pinch",name:"pinch",point:{x:m[0],y:m[1],z:a},delta:{x:S,y:C},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey});break}case"panning":{t.dispatch({type:"pinch",name:"pinch",point:{x:m[0],y:m[1],z:s},delta:{x:S,y:C},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey});break}}}}},[t,e]);E6(n,{target:e,eventOptions:{passive:!1},pinch:{from:()=>[t.getZoomLevel(),0],scaleBounds:()=>({from:t.getZoomLevel(),max:8,min:.05})}})}function M0(e,t,n){const r=e.getShape(t),i=e.getShapeHandles(r);return{shape:r,handle:i.find(o=>o.id===n)}}function M6(e,t){const n=H();return x.useMemo(()=>{const r=s=>{if(s.isKilled)return;const a=Wh(s.currentTarget);Oc(a,s);const{shape:l,handle:c}=M0(n,e,t);c&&n.dispatch({type:"pointer",target:"handle",handle:c,shape:l,name:"pointer_down",...En(s)})};let i,o;return{onPointerDown:r,onPointerMove:s=>{if(s.isKilled||s.clientX===i&&s.clientY===o)return;i=s.clientX,o=s.clientY;const{shape:a,handle:l}=M0(n,e,t);l&&n.dispatch({type:"pointer",target:"handle",handle:l,shape:a,name:"pointer_move",...En(s)})},onPointerUp:s=>{if(s.isKilled)return;const a=Wh(s.currentTarget);Lc(a,s);const{shape:l,handle:c}=M0(n,e,t);c&&n.dispatch({type:"pointer",target:"handle",handle:c,shape:l,name:"pointer_up",...En(s)})}}},[n,e,t])}var aC="Expected a function",lC=0/0,A6="[object Symbol]",T6=/^\s+|\s+$/g,j6=/^[-+]0x[0-9a-f]+$/i,O6=/^0b[01]+$/i,L6=/^0o[0-7]+$/i,D6=parseInt,z6=typeof Oe=="object"&&Oe&&Oe.Object===Object&&Oe,N6=typeof self=="object"&&self&&self.Object===Object&&self,R6=z6||N6||Function("return this")(),F6=Object.prototype,$6=F6.toString,B6=Math.max,U6=Math.min,A0=function(){return R6.Date.now()};function V6(e,t,n){var r,i,o,s,a,l,c=0,u=!1,d=!1,h=!0;if(typeof e!="function")throw new TypeError(aC);t=cC(t)||0,rp(n)&&(u=!!n.leading,d="maxWait"in n,o=d?B6(cC(n.maxWait)||0,t):o,h="trailing"in n?!!n.trailing:h);function p(_){var P=r,I=i;return r=i=void 0,c=_,s=e.apply(I,P),s}function g(_){return c=_,a=setTimeout(w,t),u?p(_):s}function f(_){var P=_-l,I=_-c,M=t-P;return d?U6(M,o-I):M}function m(_){var P=_-l,I=_-c;return l===void 0||P>=t||P<0||d&&I>=o}function w(){var _=A0();if(m(_))return b(_);a=setTimeout(w,f(_))}function b(_){return a=void 0,h&&r?p(_):(r=i=void 0,s)}function k(){a!==void 0&&clearTimeout(a),c=0,r=l=i=a=void 0}function S(){return a===void 0?s:b(A0())}function C(){var _=A0(),P=m(_);if(r=arguments,i=this,l=_,P){if(a===void 0)return g(l);if(d)return a=setTimeout(w,t),p(l)}return a===void 0&&(a=setTimeout(w,t)),s}return C.cancel=k,C.flush=S,C}function H6(e,t,n){var r=!0,i=!0;if(typeof e!="function")throw new TypeError(aC);return rp(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),V6(e,t,{leading:r,maxWait:t,trailing:i})}function rp(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function K6(e){return!!e&&typeof e=="object"}function W6(e){return typeof e=="symbol"||K6(e)&&$6.call(e)==A6}function cC(e){if(typeof e=="number")return e;if(W6(e))return lC;if(rp(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=rp(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(T6,"");var n=O6.test(e);return n||L6.test(e)?D6(e.slice(2),n?2:8):j6.test(e)?lC:+e}var Y6=H6;const X6=ns(Y6);function G6(){const e=H();x.useLayoutEffect(()=>{const t=X6(()=>{e.updateViewportScreenBounds()},200,{trailing:!0});e.updateViewportScreenBounds();const n=setInterval(t,1e3);return window.addEventListener("resize",t),window.addEventListener("scroll",t),()=>{clearInterval(n),window.removeEventListener("resize",t),window.removeEventListener("scroll",t)}},[e])}const Je=class Je{constructor(t=0,n=0,r=0,i=0){v(this,"x",0);v(this,"y",0);v(this,"w",0);v(this,"h",0);this.x=t,this.y=n,this.w=r,this.h=i}get point(){return new E(this.x,this.y)}set point(t){this.x=t.x,this.y=t.y}get minX(){return this.x}set minX(t){this.x=t}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(t){this.y=t}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(t){this.w=t}get height(){return this.h}set height(t){this.h=t}get aspectRatio(){return this.width/this.height}get center(){return new E(this.midX,this.midY)}set center(t){this.minX=t.x-this.width/2,this.minY=t.y-this.height/2}get corners(){return[new E(this.minX,this.minY),new E(this.maxX,this.minY),new E(this.maxX,this.maxY),new E(this.minX,this.maxY)]}get snapPoints(){return[new E(this.minX,this.minY),new E(this.maxX,this.minY),new E(this.maxX,this.maxY),new E(this.minX,this.maxY),this.center]}get sides(){const{corners:t}=this;return[[t[0],t[1]],[t[1],t[2]],[t[2],t[3]],[t[3],t[0]]]}get size(){return new E(this.w,this.h)}toFixed(){return this.x=Yh(this.x),this.y=Yh(this.y),this.w=Yh(this.w),this.h=Yh(this.h),this}setTo(t){return this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this}set(t=0,n=0,r=0,i=0){return this.x=t,this.y=n,this.w=r,this.h=i,this}expand(t){const n=Math.min(this.minX,t.minX),r=Math.min(this.minY,t.minY),i=Math.max(this.maxX,t.maxX),o=Math.max(this.maxY,t.maxY);return this.x=n,this.y=r,this.w=i-n,this.h=o-r,this}expandBy(t){return this.x-=t,this.y-=t,this.w+=t*2,this.h+=t*2,this}scale(t){return this.x/=t,this.y/=t,this.w/=t,this.h/=t,this}clone(){const{x:t,y:n,w:r,h:i}=this;return new Je(t,n,r,i)}translate(t){return this.x+=t.x,this.y+=t.y,this}snapToGrid(t){const n=Math.round(this.minX/t)*t,r=Math.round(this.minY/t)*t,i=Math.round(this.maxX/t)*t,o=Math.round(this.maxY/t)*t;this.minX=n,this.minY=r,this.width=Math.max(1,i-n),this.height=Math.max(1,o-r)}collides(t){return Je.Collides(this,t)}contains(t){return Je.Contains(this,t)}includes(t){return Je.Includes(this,t)}containsPoint(t,n=0){return Je.ContainsPoint(this,t,n)}getHandlePoint(t){switch(t){case"top_left":return new E(this.minX,this.minY);case"top_right":return new E(this.maxX,this.minY);case"bottom_left":return new E(this.minX,this.maxY);case"bottom_right":return new E(this.maxX,this.maxY);case"top":return new E(this.midX,this.minY);case"right":return new E(this.maxX,this.midY);case"bottom":return new E(this.midX,this.maxY);case"left":return new E(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(t,n,r){const{minX:i,minY:o,maxX:s,maxY:a}=this;let{minX:l,minY:c,maxX:u,maxY:d}=this;switch(t){case"left":case"top_left":case"bottom_left":{l+=n;break}case"right":case"top_right":case"bottom_right":{u+=n;break}}switch(t){case"top":case"top_left":case"top_right":{c+=r;break}case"bottom":case"bottom_left":case"bottom_right":{d+=r;break}}const h=(u-l)/(s-i),p=(d-c)/(a-o),g=h<0,f=p<0;if(g){const m=u;u=l,l=m}if(f){const m=d;d=c,c=m}this.minX=l,this.minY=c,this.width=Math.abs(u-l),this.height=Math.abs(d-c)}union(t){const n=Math.min(this.minX,t.x),r=Math.min(this.minY,t.y),i=Math.max(this.maxX,t.w+t.x),o=Math.max(this.maxY,t.h+t.y);return this.x=n,this.y=r,this.width=i-n,this.height=o-r,this}static From(t){return new Je(t.x,t.y,t.w,t.h)}static FromPoints(t){if(t.length===0)return new Je;let n=1/0,r=1/0,i=-1/0,o=-1/0,s;for(let a=0,l=t.length;a<l;a++)s=t[a],n=Math.min(s.x,n),r=Math.min(s.y,r),i=Math.max(s.x,i),o=Math.max(s.y,o);return new Je(n,r,i-n,o-r)}static Expand(t,n){const r=Math.min(n.minX,t.minX),i=Math.min(n.minY,t.minY),o=Math.max(n.maxX,t.maxX),s=Math.max(n.maxY,t.maxY);return new Je(r,i,o-r,s-i)}static ExpandBy(t,n){return new Je(t.minX-n,t.minY-n,t.width+n*2,t.height+n*2)}static Resize(t,n,r,i,o=!1){const{minX:s,minY:a,maxX:l,maxY:c}=t;let{minX:u,minY:d,maxX:h,maxY:p}=t;switch(n){case"left":case"top_left":case"bottom_left":{u+=r;break}case"right":case"top_right":case"bottom_right":{h+=r;break}}switch(n){case"top":case"top_left":case"top_right":{d+=i;break}case"bottom":case"bottom_left":case"bottom_right":{p+=i;break}}const g=(h-u)/(l-s),f=(p-d)/(c-a),m=g<0,w=f<0;if(o){const k=(l-s)/(c-a),S=Math.abs(h-u),C=Math.abs(p-d),_=S*(f<0?1:-1)*(1/k),P=C*(g<0?1:-1)*k,I=k<S/C;switch(n){case"top_left":{I?d=p+_:u=h+P;break}case"top_right":{I?d=p+_:h=u-P;break}case"bottom_right":{I?p=d-_:h=u-P;break}case"bottom_left":{I?p=d-_:u=h+P;break}case"bottom":case"top":{const M=(u+h)/2,A=C*k;u=M-A/2,h=M+A/2;break}case"left":case"right":{const M=(d+p)/2,A=S/k;d=M-A/2,p=M+A/2;break}}}if(m){const k=h;h=u,u=k}if(w){const k=p;p=d,d=k}const b=new Je(u,d,Math.abs(h-u),Math.abs(p-d));return{box:b,scaleX:+(b.width/t.width*(g>0?1:-1)).toFixed(5),scaleY:+(b.height/t.height*(f>0?1:-1)).toFixed(5)}}equals(t){return Je.Equals(this,t)}static Equals(t,n){return n.x===t.x&&n.y===t.y&&n.w===t.w&&n.h===t.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(t){return new Je(t.x,t.y,Math.max(1,t.w),Math.max(1,t.h))}};v(Je,"Collides",(t,n)=>!(t.maxX<n.minX||t.minX>n.maxX||t.maxY<n.minY||t.minY>n.maxY)),v(Je,"Contains",(t,n)=>t.minX<n.minX&&t.minY<n.minY&&t.maxY>n.maxY&&t.maxX>n.maxX),v(Je,"Includes",(t,n)=>Je.Collides(t,n)||Je.Contains(t,n)),v(Je,"ContainsPoint",(t,n,r=0)=>!(n.x<t.minX-r||n.y<t.minY-r||n.x>t.maxX+r||n.y>t.maxY+r)),v(Je,"Common",t=>{let n=1/0,r=1/0,i=-1/0,o=-1/0;for(let s=0;s<t.length;s++){const a=t[s];n=Math.min(n,a.minX),r=Math.min(r,a.minY),i=Math.max(i,a.maxX),o=Math.max(o,a.maxY)}return new Je(n,r,i-n,o-r)}),v(Je,"Sides",(t,n=0)=>{const{corners:r}=t;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]});let se=Je;function q6(e){switch(e){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return e}}function Z6(e){switch(e){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return e}}function Q6(e){return e==="top_left"||e==="top_right"||e==="bottom_right"||e==="bottom_left"}const je=class je{constructor(t,n,r,i,o,s){v(this,"a",1);v(this,"b",0);v(this,"c",0);v(this,"d",1);v(this,"e",0);v(this,"f",0);this.a=t,this.b=n,this.c=r,this.d=i,this.e=o,this.f=s}equals(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(t){const n=t,{a:r,b:i,c:o,d:s,e:a,f:l}=this;return this.a=r*n.a+o*n.b,this.c=r*n.c+o*n.d,this.e=r*n.e+o*n.f+a,this.b=i*n.a+s*n.b,this.d=i*n.c+s*n.d,this.f=i*n.e+s*n.f+l,this}rotate(t,n,r){return t===0?this:n===void 0?this.multiply(je.Rotate(t)):this.translate(n,r).multiply(je.Rotate(t)).translate(-n,-r)}translate(t,n){return this.multiply(je.Translate(t,n))}scale(t,n){return this.multiply(je.Scale(t,n))}invert(){const{a:t,b:n,c:r,d:i,e:o,f:s}=this,a=t*i-n*r;return this.a=i/a,this.b=n/-a,this.c=r/-a,this.d=t/a,this.e=(i*o-r*s)/-a,this.f=(n*o-t*s)/a,this}applyToPoint(t){return je.applyToPoint(this,t)}applyToPoints(t){return je.applyToPoints(this,t)}rotation(){return je.Rotation(this)}point(){return je.Point(this)}decomposed(){return je.Decompose(this)}toCssString(){return je.toCssString(this)}setTo(t){return Object.assign(this,t),this}decompose(){return je.Decompose(this)}clone(){return new je(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new je(1,0,0,1,0,0)}static Translate(t,n){return new je(1,0,0,1,t,n)}static Rotate(t,n,r){if(t===0)return je.Identity();const i=Math.cos(t),o=Math.sin(t),s=new je(i,o,-o,i,0,0);return n===void 0?s:je.Compose(je.Translate(n,r),s,je.Translate(-n,-r))}static Multiply(t,n){return{a:t.a*n.a+t.c*n.b,c:t.a*n.c+t.c*n.d,e:t.a*n.e+t.c*n.f+t.e,b:t.b*n.a+t.d*n.b,d:t.b*n.c+t.d*n.d,f:t.b*n.e+t.d*n.f+t.f}}static Inverse(t){const n=t.a*t.d-t.b*t.c;return{a:t.d/n,b:t.b/-n,c:t.c/-n,d:t.a/n,e:(t.d*t.e-t.c*t.f)/-n,f:(t.b*t.e-t.a*t.f)/n}}static Absolute(t){const n=t.a*t.d-t.b*t.c;return{a:t.d/n,b:t.b/-n,c:t.c/-n,d:t.a/n,e:(t.d*t.e-t.c*t.f)/n,f:(t.b*t.e-t.a*t.f)/-n}}static Compose(...t){const n=je.Identity();for(let r=0,i=t.length;r<i;r++)n.multiply(t[r]);return n}static Point(t){return new E(t.e,t.f)}static Rotation(t){let n;if(t.a!==0||t.c!==0){const r=Math.hypot(t.a,t.c);n=Math.acos(t.a/r)*(t.c>0?-1:1)}else if(t.b!==0||t.d!==0){const r=Math.hypot(t.b,t.d);n=Ke+Math.acos(t.b/r)*(t.d>0?-1:1)}else n=0;return S0(n)}static Decompose(t){let n,r,i;if(t.a!==0||t.c!==0){const o=Math.hypot(t.a,t.c);n=o,r=(t.a*t.d-t.b*t.c)/o,i=Math.acos(t.a/o)*(t.c>0?-1:1)}else if(t.b!==0||t.d!==0){const o=Math.hypot(t.b,t.d);n=(t.a*t.d-t.b*t.c)/o,r=o,i=Ke+Math.acos(t.b/o)*(t.d>0?-1:1)}else n=0,r=0,i=0;return{x:t.e,y:t.f,scaleX:n,scaleY:r,rotation:S0(i)}}static Smooth(t,n=1e10){return t.a=Math.round(t.a*n)/n,t.b=Math.round(t.b*n)/n,t.c=Math.round(t.c*n)/n,t.d=Math.round(t.d*n)/n,t.e=Math.round(t.e*n)/n,t.f=Math.round(t.f*n)/n,t}static toCssString(t){return`matrix(${O(t.a)}, ${O(t.b)}, ${O(t.c)}, ${O(t.d)}, ${O(t.e)}, ${O(t.f)})`}static applyToPoint(t,n){return new E(t.a*n.x+t.c*n.y+t.e,t.b*n.x+t.d*n.y+t.f,n.z)}static applyToXY(t,n,r){return[t.a*n+t.c*r+t.e,t.b*n+t.d*r+t.f]}static applyToPoints(t,n){return n.map(r=>new E(t.a*r.x+t.c*r.y+t.e,t.b*r.x+t.d*r.y+t.f,r.z))}static applyToBounds(t,n){return new se(t.e+n.minX,t.f+n.minY,n.width,n.height)}static From(t){return new je(t.a,t.b,t.c,t.d,t.e,t.f)}static Cast(t){return t instanceof je?t:je.From(t)}};v(je,"Scale",(t,n,r,i)=>{const o=new je(t,0,0,n,0,0);return r===void 0?o:je.Compose(je.Translate(r,i),o,je.Translate(-r,-i))});let te=je;function J6(e=!0){const[t,n]=x.useState(0),r=H();x.useEffect(()=>{if(!e)return;const i=()=>n(o=>o+1);return r.on("tick",i),()=>{r.off("tick",i)}},[r,e])}const e8=Pe(function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:n=!0}){const r=H();J6(n);const i=r.getZoomLevel(),o=r.getRenderingShapes(),{inputs:{currentPagePoint:s}}=r;return y.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(a=>{const l=r.getShape(a.id);if(l.type==="group")return null;const c=r.getShapeGeometry(l),u=r.getShapePageTransform(l),d=r.getPointInShapeSpace(l,s),h=c.nearestPoint(d),p=c.distanceToPoint(d,!0),g=Math.abs(p)*i,f=p<0,{vertices:m}=c;return y.jsxs("g",{transform:u.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&y.jsx("path",{stroke:"red",strokeWidth:"2",fill:"none",opacity:"1",d:c.toSimpleSvgPath()}),t&&m.map((w,b)=>y.jsx("circle",{cx:w.x,cy:w.y,r:"2",fill:`hsl(${Ih(b,[0,m.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:"1"},`v${b}`)),n&&g<150&&y.jsx("line",{x1:h.x,y1:h.y,x2:d.x,y2:d.y,opacity:1-g/150,stroke:f?"goldenrod":"dodgerblue",strokeWidth:"2"})]},a.id+"_outline")})})});var t8=200,T0="__lodash_hash_undefined__",n8=1/0,r8="[object Function]",i8="[object GeneratorFunction]",o8=/[\\^$.*+?()[\]{}|]/g,s8=/^\[object .+?Constructor\]$/,a8=typeof Oe=="object"&&Oe&&Oe.Object===Object&&Oe,l8=typeof self=="object"&&self&&self.Object===Object&&self,j0=a8||l8||Function("return this")();function c8(e,t){var n=e?e.length:0;return!!n&&h8(e,t,0)>-1}function u8(e,t,n){for(var r=-1,i=e?e.length:0;++r<i;)if(n(t,e[r]))return!0;return!1}function d8(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}function h8(e,t,n){if(t!==t)return d8(e,p8,n);for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function p8(e){return e!==e}function f8(e,t){return e.has(t)}function g8(e,t){return e==null?void 0:e[t]}function m8(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function uC(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var y8=Array.prototype,v8=Function.prototype,dC=Object.prototype,O0=j0["__core-js_shared__"],hC=function(){var e=/[^.]+$/.exec(O0&&O0.keys&&O0.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),pC=v8.toString,L0=dC.hasOwnProperty,b8=dC.toString,w8=RegExp("^"+pC.call(L0).replace(o8,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),x8=y8.splice,S8=z0(j0,"Map"),D0=z0(j0,"Set"),Yc=z0(Object,"create");function _s(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function k8(){this.__data__=Yc?Yc(null):{}}function _8(e){return this.has(e)&&delete this.__data__[e]}function C8(e){var t=this.__data__;if(Yc){var n=t[e];return n===T0?void 0:n}return L0.call(t,e)?t[e]:void 0}function E8(e){var t=this.__data__;return Yc?t[e]!==void 0:L0.call(t,e)}function P8(e,t){var n=this.__data__;return n[e]=Yc&&t===void 0?T0:t,this}_s.prototype.clear=k8,_s.prototype.delete=_8,_s.prototype.get=C8,_s.prototype.has=E8,_s.prototype.set=P8;function Ra(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function I8(){this.__data__=[]}function M8(e){var t=this.__data__,n=op(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():x8.call(t,n,1),!0}function A8(e){var t=this.__data__,n=op(t,e);return n<0?void 0:t[n][1]}function T8(e){return op(this.__data__,e)>-1}function j8(e,t){var n=this.__data__,r=op(n,e);return r<0?n.push([e,t]):n[r][1]=t,this}Ra.prototype.clear=I8,Ra.prototype.delete=M8,Ra.prototype.get=A8,Ra.prototype.has=T8,Ra.prototype.set=j8;function Fa(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function O8(){this.__data__={hash:new _s,map:new(S8||Ra),string:new _s}}function L8(e){return sp(this,e).delete(e)}function D8(e){return sp(this,e).get(e)}function z8(e){return sp(this,e).has(e)}function N8(e,t){return sp(this,e).set(e,t),this}Fa.prototype.clear=O8,Fa.prototype.delete=L8,Fa.prototype.get=D8,Fa.prototype.has=z8,Fa.prototype.set=N8;function ip(e){var t=-1,n=e?e.length:0;for(this.__data__=new Fa;++t<n;)this.add(e[t])}function R8(e){return this.__data__.set(e,T0),this}function F8(e){return this.__data__.has(e)}ip.prototype.add=ip.prototype.push=R8,ip.prototype.has=F8;function op(e,t){for(var n=e.length;n--;)if(Y8(e[n][0],t))return n;return-1}function $8(e){if(!fC(e)||H8(e))return!1;var t=X8(e)||m8(e)?w8:s8;return t.test(K8(e))}function B8(e,t,n){var r=-1,i=c8,o=e.length,s=!0,a=[],l=a;if(n)s=!1,i=u8;else if(o>=t8){var c=t?null:U8(e);if(c)return uC(c);s=!1,i=f8,l=new ip}else l=t?[]:a;e:for(;++r<o;){var u=e[r],d=t?t(u):u;if(u=n||u!==0?u:0,s&&d===d){for(var h=l.length;h--;)if(l[h]===d)continue e;t&&l.push(d),a.push(u)}else i(l,d,n)||(l!==a&&l.push(d),a.push(u))}return a}var U8=D0&&1/uC(new D0([,-0]))[1]==n8?function(e){return new D0(e)}:G8;function sp(e,t){var n=e.__data__;return V8(t)?n[typeof t=="string"?"string":"hash"]:n.map}function z0(e,t){var n=g8(e,t);return $8(n)?n:void 0}function V8(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function H8(e){return!!hC&&hC in e}function K8(e){if(e!=null){try{return pC.call(e)}catch{}try{return e+""}catch{}}return""}function W8(e){return e&&e.length?B8(e):[]}function Y8(e,t){return e===t||e!==e&&t!==t}function X8(e){var t=fC(e)?b8.call(e):"";return t==r8||t==i8}function fC(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function G8(){}var q8=W8;const Z8=ns(q8);function gC(e){return Z8(e)}function Q8(){const e=H(),t=x.useMemo(()=>e.store.query.records("instance_presence",()=>({userId:{neq:e.user.getId()}})),[e]),n=R_("userIds",()=>gC(t.get().map(r=>r.userId)).sort(),{isEqual:(r,i)=>{var o;return r.join(",")===((o=i.join)==null?void 0:o.call(i,","))}},[t]);return Y(n)}function mC(e){const t=H(),n=x.useMemo(()=>t.store.query.records("instance_presence",()=>({userId:{eq:e}})),[t,e]);return Y(`latestPresence:${e}`,()=>n.get().slice().sort((r,i)=>i.lastActivityTimestamp-r.lastActivityTimestamp)[0],[])??null}const J8=Pe(function(){const e=Q8();return y.jsx(y.Fragment,{children:e.map(t=>y.jsx(eR,{collaboratorId:t},t))})}),eR=Pe(function({collaboratorId:e}){const t=H(),n=mC(e),r=nR(n);if(!(n&&n.currentPageId===t.getCurrentPageId()))return null;switch(r){case"inactive":{const{followingUserId:i,highlightedUserIds:o}=t.getInstanceState();if(!(i===n.userId||o.includes(n.userId)))return null;break}case"idle":{const{highlightedUserIds:i}=t.getInstanceState();if(n.followingUserId===t.user.getId()&&!(n.chatMessage||i.includes(n.userId)))return null;break}}return y.jsx(tR,{latestPresence:n})}),tR=Pe(function({latestPresence:e}){const t=H(),{CollaboratorBrush:n,CollaboratorScribble:r,CollaboratorCursor:i,CollaboratorHint:o,CollaboratorShapeIndicator:s}=kt(),a=t.getZoomLevel(),l=t.getViewportPageBounds(),{userId:c,chatMessage:u,brush:d,scribbles:h,selectedShapeIds:p,userName:g,cursor:f,color:m}=e,w=!(f.x<l.minX-12/a||f.y<l.minY-16/a||f.x>l.maxX-12/a||f.y>l.maxY-16/a);return y.jsxs(y.Fragment,{children:[d&&n?y.jsx(n,{className:"tl-collaborator__brush",brush:d,color:m,opacity:.1},c+"_brush"):null,w&&i?y.jsx(i,{className:"tl-collaborator__cursor",point:f,color:m,zoom:a,name:g!=="New User"?g:null,chatMessage:u},c+"_cursor"):o?y.jsx(o,{className:"tl-collaborator__cursor-hint",point:f,color:m,zoom:a,viewport:l},c+"_cursor_hint"):null,r&&h.length?y.jsx(y.Fragment,{children:h.map(b=>y.jsx(r,{className:"tl-collaborator__scribble",scribble:b,color:m,zoom:a,opacity:b.color==="laser"?.5:.1},c+"_scribble_"+b.id))}):null,s&&p.map(b=>y.jsx(s,{className:"tl-collaborator__shape-indicator",id:b,color:m,opacity:.5},c+"_"+b))]})});function yC(e){return e>sN?"inactive":e>D2?"idle":"active"}function nR(e){const t=x.useRef((e==null?void 0:e.lastActivityTimestamp)??-1),[n,r]=x.useState(()=>yC(Date.now()-t.current));return x.useEffect(()=>{const i=setInterval(()=>{r(yC(Date.now()-t.current))},aN);return()=>clearInterval(i)},[]),e&&(t.current=e.lastActivityTimestamp),n}function vC(e,t){return t===0?e:vC(t,e%t)}function bC(e){const t=e.toString().split(".")[1];if(!t)return 1;const n=Math.pow(10,t.length),r=parseInt(t,10);return n/vC(r,n)}function rR(){const e=H(),t=Yt();x.useEffect(()=>xc("useDPRMultiple",()=>{const n=e.getInstanceState().devicePixelRatio;t.style.setProperty("--tl-dpr-multiple",bC(n).toString())}),[e,t])}const wC=Pe(function({id:e,shape:t,util:n,index:r,backgroundIndex:i,opacity:o,isCulled:s}){const a=H(),{ShapeErrorFallback:l}=kt(),c=x.useRef(null),u=x.useRef(null),d=x.useCallback((p,g)=>{var f,m;(f=c.current)==null||f.style.setProperty(p,g),(m=u.current)==null||m.style.setProperty(p,g)},[]);vs("set shape container transform position",()=>{if(!a.getShape(e))return;const p=a.getShapePageTransform(e),g=te.toCssString(p);d("transform",g)},[a,d]),vs("set shape container clip path",()=>{if(!a.getShape(e))return null;const p=a.getShapeClipPath(e);d("clip-path",p??"none")},[a,d]),vs("set shape height and width",()=>{const p=a.getShape(e);if(!p)return null;const g=a.getShapeGeometry(p).bounds,f=Math.floor(a.getInstanceState().devicePixelRatio*100)/100,m=bC(f),w=g.w%m,b=w===0?g.w:g.w+(m-w),k=g.h%m,S=k===0?g.h:g.h+(m-k);d("width",Math.max(b,m)+"px"),d("height",Math.max(S,m)+"px")},[a]),x.useLayoutEffect(()=>{var p,g;d("opacity",o+""),(p=c.current)==null||p.style.setProperty("z-index",r+""),(g=u.current)==null||g.style.setProperty("z-index",i+"")},[o,r,i,d]);const h=x.useCallback(p=>{a.annotateError(p,{origin:"react.shape",willCrashApp:!1})},[a]);return t?y.jsxs(y.Fragment,{children:[n.backgroundComponent&&y.jsx("div",{ref:u,className:"tl-shape tl-shape-background","data-shape-type":t.type,draggable:!1,children:!s&&y.jsx(zc,{fallback:l,onError:h,children:y.jsx(oR,{shape:t,util:n})})}),y.jsx("div",{ref:c,className:"tl-shape","data-shape-type":t.type,draggable:!1,children:s?y.jsx(sR,{shape:t}):y.jsx(zc,{fallback:l,onError:h,children:y.jsx(iR,{shape:t,util:n})})})]}):null}),iR=x.memo(function({shape:e,util:t}){return _h("InnerShape:"+e.type,()=>t.component(e))},(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta&&e.util===t.util),oR=x.memo(function({shape:e,util:t}){return _h("InnerShape:"+e.type,()=>{var n;return(n=t.backgroundComponent)==null?void 0:n.call(t,e)})},(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta),sR=x.memo(function({shape:e}){const t=H().getShapeGeometry(e).bounds;return y.jsx("div",{className:"tl-shape__culled",style:{transform:`translate(${O(t.minX)}px, ${O(t.minY)}px)`,width:Math.max(1,O(t.width)),height:Math.max(1,O(t.height))}})},()=>!0);function N0({className:e}){const t=H(),{Background:n,SvgDefs:r}=kt(),i=J.useRef(null),o=J.useRef(null),s=J.useRef(null);G6(),Oz(),Tz(),I6(i),CN(i),vs("position layers",()=>{const h=o.current;if(!h)return;const p=s.current;if(!p)return;const{x:g,y:f,z:m}=t.getCamera(),w=m>=1?Ih(m,[1,8],[.125,.5],!0):Ih(m,[.1,1],[-2,.125],!0),b=`scale(${O(m)}) translate(${O(g+w)}px,${O(f+w)}px)`;h.style.setProperty("transform",b),p.style.setProperty("transform",b)},[t]);const a=Az(),l=Y("shapeSvgDefs",()=>{const h=new Map;for(const p of ut(t.shapeUtils)){if(!p)return;const g=p.getCanvasSvgDefs();for(const{key:f,component:m}of g)h.has(f)||h.set(f,y.jsx(m,{},f))}return[...h.values()]},[t]),c=Y("debug_shapes",()=>He.hideShapes.get(),[He]),u=Y("debug_svg",()=>He.debugSvg.get(),[He]),d=Y("debug_geometry",()=>He.debugGeometry.get(),[He]);return y.jsxs("div",{ref:i,draggable:!1,className:pe("tl-canvas",e),"data-testid":"canvas",...a,children:[n&&y.jsx(n,{}),y.jsx(aR,{}),y.jsx(_R,{}),y.jsx("svg",{className:"tl-svg-context",children:y.jsxs("defs",{children:[l,xC&&y.jsx(xC,{}),y.jsx(wR,{}),y.jsx(xR,{}),y.jsx(SR,{}),r&&y.jsx(r,{})]})}),y.jsxs("div",{ref:o,className:"tl-html-layer tl-shapes",draggable:!1,children:[y.jsx(PR,{}),y.jsx(ER,{}),c?null:u?y.jsx(gR,{}):y.jsx(mR,{})]}),y.jsxs("div",{className:"tl-fixed-layer tl-overlays",children:[y.jsxs("div",{ref:s,className:"tl-html-layer",children:[d?y.jsx(e8,{}):null,y.jsx(pR,{}),y.jsx(cR,{}),y.jsx(lR,{}),y.jsx(uR,{}),y.jsx(yR,{}),y.jsx(vR,{}),y.jsx(bR,{}),y.jsx(dR,{}),y.jsx(CR,{}),y.jsx(J8,{})]}),y.jsx(IR,{})]})]})}function aR(){const e=H(),t=Y("gridSize",()=>e.getDocumentSettings().gridSize,[e]),{x:n,y:r,z:i}=Y("camera",()=>e.getCamera(),[e]),o=Y("isGridMode",()=>e.getInstanceState().isGridMode,[e]),{Grid:s}=kt();return s&&o?y.jsx(s,{x:n,y:r,z:i,size:t}):null}function lR(){const e=H(),t=Y("scribbles",()=>e.getInstanceState().scribbles,[e]),n=Y("zoomLevel",()=>e.getZoomLevel(),[e]),{Scribble:r}=kt();return r&&t.length?y.jsx(y.Fragment,{children:t.map(i=>y.jsx(r,{className:"tl-user-scribble",scribble:i,zoom:n},i.id))}):null}function cR(){const e=H(),t=Y("brush",()=>e.getInstanceState().brush,[e]),{Brush:n}=kt();return n&&t?y.jsx(n,{className:"tl-user-brush",brush:t}):null}function uR(){const e=H(),t=Y("zoomBrush",()=>e.getInstanceState().zoomBrush,[e]),{ZoomBrush:n}=kt();return n&&t?y.jsx(n,{className:"tl-user-brush tl-zoom-brush",brush:t}):null}function dR(){const e=H(),t=Y("snapLines",()=>e.snaps.getLines(),[e]),n=Y("zoomLevel",()=>e.getZoomLevel(),[e]),{SnapLine:r}=kt();return r&&t.length>0?y.jsx(y.Fragment,{children:t.map(i=>y.jsx(r,{className:"tl-user-snapline",line:i,zoom:n},i.id))}):null}const hR=48;function pR(){const e=H(),{Handles:t}=kt(),n=Y("zoomLevel",()=>e.getZoomLevel(),[e]),r=Y("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),i=Y("onlySelectedShape",()=>e.getOnlySelectedShape(),[e]),o=Y("isChangingStyle",()=>e.getInstanceState().isChangingStyle,[e]),s=Y("isChangingStyle",()=>e.getInstanceState().isReadonly,[e]),a=Y("handles",()=>{const u=e.getOnlySelectedShape();if(u)return e.getShapeHandles(u)},[e]),l=Y("transform",()=>{const u=e.getOnlySelectedShape();if(u)return e.getShapePageTransform(u)},[e]);if(!t||!i||o||s||!a||!l)return null;const c=[];for(let u=0,d=a[u];u<a.length;u++,d=a[u]){if(d.type!=="vertex"){const h=a[u-1],p=a[u+1];if(h&&p&&Math.hypot(h.y-p.y,h.x-p.x)<hR/n)continue}c.push(d)}return c.sort(u=>u.type==="vertex"?1:-1),y.jsx(t,{children:y.jsx("g",{transform:te.toCssString(l),children:c.map(u=>y.jsx(fR,{shapeId:i.id,handle:u,zoom:n,isCoarse:r},u.id))})})}function fR({shapeId:e,handle:t,zoom:n,isCoarse:r}){const i=M6(e,t.id),{Handle:o}=kt();return o?y.jsx("g",{"aria-label":"handle",transform:`translate(${t.x}, ${t.y})`,...i,children:y.jsx(o,{shapeId:e,handle:t,zoom:n,isCoarse:r})}):null}function gR(){const e=H(),t=Y("rendering shapes",()=>e.getRenderingShapes(),[e]);return y.jsx(y.Fragment,{children:t.map(n=>y.jsxs(J.Fragment,{children:[y.jsx(wC,{...n}),y.jsx(kR,{id:n.id})]},n.id+"_fragment"))})}function mR(){const e=H(),t=Y("rendering shapes",()=>e.getRenderingShapes(),[e]);return y.jsx(y.Fragment,{children:t.map(n=>y.jsx(wC,{...n},n.id+"_shape"))})}function yR(){const e=H(),t=Y("selectedShapeIds",()=>e.getCurrentPageState().selectedShapeIds,[e]);return Y("should display selected ids",()=>e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle,[e])?y.jsx(y.Fragment,{children:t.map(n=>y.jsx(Nc,{className:"tl-user-indicator__selected",id:n},n+"_indicator"))}):null}const vR=function(){const e=H(),{HoveredShapeIndicator:t}=kt(),n=Y("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),r=Y("hovering canvas",()=>e.getInstanceState().isHoveringCanvas,[e]),i=Y("hovered id",()=>e.getCurrentPageState().hoveredShapeId,[e]);return n||!r||!i||!t?null:y.jsx(t,{shapeId:i})},bR=Pe(function(){const e=H(),t=Eh(e.getHintingShapeIds());return t.length?y.jsx(y.Fragment,{children:t.map(n=>y.jsx(Nc,{className:"tl-user-indicator__hint",id:n},n+"_hinting"))}):null});function xC(){return y.jsxs("g",{id:"cursor",children:[y.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[y.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),y.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),y.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[y.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),y.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),y.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[y.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),y.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function wR(){return y.jsx("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function xR(){return y.jsx("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:y.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function SR(){return y.jsxs("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[y.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),y.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const kR=Pe(function({id:e}){const t=H(),n=t.getShape(e),[r,i]=J.useState(""),o=(n==null?void 0:n.parentId)===t.getCurrentPageId();return J.useEffect(()=>{if(!o)return;let s=null;const a=xc("shape to svg",async()=>{const l=Math.random();s=l;const c=t.getShapePageBounds(e),u=await t.getSvg([e],{padding:0});u&&c&&s===l&&(u.style.setProperty("overflow","visible"),u.setAttribute("preserveAspectRatio","xMidYMin slice"),u.style.setProperty("transform",`translate(${c.x}px, ${c.y+c.h+12}px)`),u.style.setProperty("border","1px solid black"),i(u==null?void 0:u.outerHTML))});return()=>{s=null,a()}},[t,e,o]),o?y.jsx("div",{style:{paddingTop:12,position:"absolute"},children:y.jsx("div",{style:{display:"flex"},dangerouslySetInnerHTML:{__html:r}})}):null});function _R(){const e=Y("debugging ui log",()=>He.logMessages.get(),[He]);return e.length?y.jsx("div",{className:"debug__ui-logger",children:e.map((t,n)=>{const r=typeof t=="string"?t:JSON.stringify(t);return y.jsx("div",{className:"debug__ui-logger__line",children:r},n)})}):null}function CR(){const e=H(),t=Y("selection rotation",()=>e.getSelectionRotation(),[e]),n=Y("selection bounds",()=>e.getSelectionRotatedPageBounds(),[e]),{SelectionForeground:r}=kt();return!n||!r?null:y.jsx(r,{bounds:n,rotation:t})}function ER(){const e=H(),t=Y("selection rotation",()=>e.getSelectionRotation(),[e]),n=Y("selection bounds",()=>e.getSelectionRotatedPageBounds(),[e]),{SelectionBackground:r}=kt();return!n||!r?null:y.jsx(r,{bounds:n,rotation:t})}function PR(){const{OnTheCanvas:e}=kt();return e?y.jsx(e,{}):null}function IR(){const{InFrontOfTheCanvas:e}=kt();return e?y.jsx(e,{}):null}const MR=()=>y.jsx(hE,{children:"Connecting..."});function Re(){return Th()}const SC="TLDRAW_USER_DATA_v3",kC=ke({id:me,name:me.nullable().optional(),locale:me.nullable().optional(),color:me.nullable().optional(),isDarkMode:xe.nullable().optional(),animationSpeed:fe.nullable().optional(),edgeScrollSpeed:fe.nullable().optional(),isSnapMode:xe.nullable().optional()}),Xc={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4},ap=Ae({currentVersion:Xc.AddEdgeScrollSpeed,migrators:{[Xc.AddAnimationSpeed]:{up:e=>({...e,animationSpeed:1}),down:({animationSpeed:e,...t})=>t},[Xc.AddIsSnapMode]:{up:e=>({...e,isSnapMode:!1}),down:({isSnapMode:e,...t})=>t},[Xc.MakeFieldsNullable]:{up:e=>e,down:e=>({id:e.id,name:e.name??ur.name,locale:e.locale??ur.locale,color:e.color??ur.color,isDarkMode:e.isDarkMode??ur.isDarkMode,animationSpeed:e.animationSpeed??ur.animationSpeed,isSnapMode:e.isSnapMode??ur.isSnapMode})},[Xc.AddEdgeScrollSpeed]:{up:e=>({...e,edgeScrollSpeed:1}),down:({edgeScrollSpeed:e,...t})=>t}}}),_C=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function AR(){return _C[Math.floor(Math.random()*_C.length)]}function TR(){var e,t;return typeof window>"u"?!1:((t=(e=window.matchMedia)==null?void 0:e.call(window,"(prefers-color-scheme: dark)"))==null?void 0:t.matches)??!1}function jR(){var e,t;return typeof window>"u"?!1:((t=(e=window.matchMedia)==null?void 0:e.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:t.matches)??!1}const ur=Object.freeze({name:"New User",locale:Sz(),color:AR(),isDarkMode:!1,edgeScrollSpeed:1,animationSpeed:jR()?0:1,isSnapMode:!1});function R0(){return{id:Re()}}function CC(e){if(e===null||typeof e!="object"||!("version"in e)||!("user"in e)||typeof e.version!="number")return R0();const t=o0({value:e.user,fromVersion:e.version,toVersion:ap.currentVersion??0,migrations:ap});if(t.type==="error")return R0();try{kC.validate(t.value)}catch{return R0()}return t.value}function OR(){var t;const e=typeof window>"u"?null:JSON.parse(((t=window==null?void 0:window.localStorage)==null?void 0:t.getItem(SC))||"null")??null;return CC(e)}const Gc=ln("globalUserData",OR());function LR(){typeof window<"u"&&window.localStorage&&window.localStorage.setItem(SC,JSON.stringify({version:ap.currentVersion,user:Gc.get()}))}function DR(e){kC.validate(e),Gc.set(e),LR(),NR()}const zR=typeof process<"u"&&!1,$a=typeof BroadcastChannel<"u"&&!zR?new BroadcastChannel("tldraw-user-sync"):null;$a==null||$a.addEventListener("message",e=>{const t=e.data;(t==null?void 0:t.type)===PC&&(t==null?void 0:t.origin)!==EC&&Gc.set(CC(t.data))});const EC=Re(),PC="tldraw-user-preferences-change";function NR(){$a==null||$a.postMessage({type:PC,origin:EC,data:{user:Gc.get(),version:ap.currentVersion}})}function RR(){return Gc.get()}function IC(e={}){return{derivePresenceState:e.derivePresenceState??(()=>q("presence",()=>null)),userPreferences:e.userPreferences??q("userPreferences",()=>RR()),setUserPreferences:e.setUserPreferences??DR}}var MC={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function i(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function o(l,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var p=new i(u,d||l,h),g=n?n+c:c;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],p]:l._events[g].push(p):(l._events[g]=p,l._eventsCount++),l}function s(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],c,u;if(this._eventsCount===0)return l;for(u in c=this._events)t.call(c,u)&&l.push(n?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},a.prototype.listeners=function(l){var c=n?n+l:l,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,h=u.length,p=new Array(h);d<h;d++)p[d]=u[d].fn;return p},a.prototype.listenerCount=function(l){var c=n?n+l:l,u=this._events[c];return u?u.fn?1:u.length:0},a.prototype.emit=function(l,c,u,d,h,p){var g=n?n+l:l;if(!this._events[g])return!1;var f=this._events[g],m=arguments.length,w,b;if(f.fn){switch(f.once&&this.removeListener(l,f.fn,void 0,!0),m){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,c),!0;case 3:return f.fn.call(f.context,c,u),!0;case 4:return f.fn.call(f.context,c,u,d),!0;case 5:return f.fn.call(f.context,c,u,d,h),!0;case 6:return f.fn.call(f.context,c,u,d,h,p),!0}for(b=1,w=new Array(m-1);b<m;b++)w[b-1]=arguments[b];f.fn.apply(f.context,w)}else{var k=f.length,S;for(b=0;b<k;b++)switch(f[b].once&&this.removeListener(l,f[b].fn,void 0,!0),m){case 1:f[b].fn.call(f[b].context);break;case 2:f[b].fn.call(f[b].context,c);break;case 3:f[b].fn.call(f[b].context,c,u);break;case 4:f[b].fn.call(f[b].context,c,u,d);break;default:if(!w)for(S=1,w=new Array(m-1);S<m;S++)w[S-1]=arguments[S];f[b].fn.apply(f[b].context,w)}}return!0},a.prototype.on=function(l,c,u){return o(this,l,c,u,!1)},a.prototype.once=function(l,c,u){return o(this,l,c,u,!0)},a.prototype.removeListener=function(l,c,u,d){var h=n?n+l:l;if(!this._events[h])return this;if(!c)return s(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!d||p.once)&&(!u||p.context===u)&&s(this,h);else{for(var g=0,f=[],m=p.length;g<m;g++)(p[g].fn!==c||d&&!p[g].once||u&&p[g].context!==u)&&f.push(p[g]);f.length?this._events[h]=f.length===1?f[0]:f:s(this,h)}return this},a.prototype.removeAllListeners=function(l){var c;return l?(c=n?n+l:l,this._events[c]&&s(this,c)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a})(MC);var FR=MC.exports;function Bn({children:e,className:t="",...n}){return y.jsx("svg",{...n,className:`tl-svg-container ${t}`,children:e})}class Cs{constructor(t){v(this,"isFilled",!1);v(this,"isClosed",!0);v(this,"isLabel",!1);v(this,"isSnappable",!0);v(this,"_vertices");v(this,"_bounds");v(this,"_snapPoints");v(this,"_area");this.isFilled=t.isFilled,this.isClosed=t.isClosed,this.isSnappable=t.isSnappable??!1,this.isLabel=t.isLabel??!1}hitTestPoint(t,n=0,r=!1){return this.distanceToPoint(t,r)<=n}distanceToPoint(t,n=!1){const r=t.dist(this.nearestPoint(t));return this.isClosed&&(this.isFilled||n)&&ni(t,this.vertices)?-r:r}distanceToLineSegment(t,n){const r=this.nearestPointOnLineSegment(t,n),i=E.DistanceToLineSegment(t,n,r);return this.isClosed&&this.isFilled&&ni(r,this.vertices)?-i:i}hitTestLineSegment(t,n,r=0){return this.distanceToLineSegment(t,n)<=r}nearestPointOnLineSegment(t,n){let r=1/0,i;for(let o=0;o<this.vertices.length;o++){const s=this.vertices[o],a=E.DistanceToLineSegment(t,n,s);a<r&&(r=a,i=s)}if(!i)throw Error("nearest point not found");return i}isPointInBounds(t,n=0){const{bounds:r}=this;return!(t.x<r.minX-n||t.y<r.minY-n||t.x>r.maxX+n||t.y>r.maxY+n)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return se.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get snapPoints(){return this._snapPoints||(this._snapPoints=this.bounds.snapPoints),this._snapPoints}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:t}=this;let n=0;for(let r=0,i=t.length;r<i;r++){const o=t[r],s=t[(r+1)%i];n+=o.x*s.y-s.x*o.y}return n/2}toSimpleSvgPath(){let t="";const{vertices:n}=this,r=n.length;if(r===0)return t;t+=`M${n[0].x},${n[0].y}`;for(let i=1;i<r;i++)t+=`L${n[i].x},${n[i].y}`;return this.isClosed&&(t+="Z"),t}}class Mo extends Cs{constructor(n){super({...n,isClosed:!0,isFilled:!1});v(this,"children");const{children:r}=n;if(r.length===0)throw Error("Group2d must have at least one child");this.children=r}getVertices(){return this.children.filter(n=>!n.isLabel).flatMap(n=>n.vertices)}nearestPoint(n){let r=1/0,i;const{children:o}=this;if(o.length===0)throw Error("no children");for(const s of o){const a=s.nearestPoint(n),l=a.dist(n);l<r&&(r=l,i=a)}if(!i)throw Error("nearest point not found");return i}distanceToPoint(n,r=!1){return Math.min(...this.children.map((i,o)=>i.distanceToPoint(n,r||o>0)))}hitTestPoint(n,r,i){return!!this.children.filter(o=>!o.isLabel).find(o=>o.hitTestPoint(n,r,i))}hitTestLineSegment(n,r,i){return!!this.children.filter(o=>!o.isLabel).find(o=>o.hitTestLineSegment(n,r,i))}getArea(){return this.children[0].area}toSimpleSvgPath(){let n="";for(const i of this.children)n+=i.toSimpleSvgPath();const r=se.FromPoints(this.vertices).corners;for(let i=0,o=r.length;i<o;i++){const s=r[i],a=r[(i-1+o)%o],l=s.dist(a),c=r[(i+1)%o],u=s.dist(c),d=s.clone().lrp(a,4/l),h=s,p=s.clone().lrp(c,4/u);n+=`M${d.x},${d.y} L${h.x},${h.y} L${p.x},${p.y} `}return n}}function F0(e,t,n,r){const i=e.x-n.x,o=e.y-n.y,s=r.x-n.x,a=r.y-n.y,l=t.x-e.x,c=t.y-e.y,u=s*o-a*i,d=l*o-c*i,h=a*l-s*c;if(u===0||d===0||h===0)return null;if(h!==0){const p=u/h,g=d/h;if(0<=p&&p<=1&&0<=g&&g<=1)return E.AddXY(e,p*l,p*c)}return null}function lp(e,t,n,r){const i=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y),o=2*((t.x-e.x)*(e.x-n.x)+(t.y-e.y)*(e.y-n.y)),s=n.x*n.x+n.y*n.y+e.x*e.x+e.y*e.y-2*(n.x*e.x+n.y*e.y)-r*r,a=o*o-4*i*s;if(a<0||a===0)return null;const l=Math.sqrt(a),c=(-o+l)/(2*i),u=(-o-l)/(2*i);if((c<0||c>1)&&(u<0||u>1))return null;const d=[];return 0<=c&&c<=1&&d.push(E.Lrp(e,t,c)),0<=u&&u<=1&&d.push(E.Lrp(e,t,u)),d.length===0?null:d}function AC(e,t,n){const r=[];let i;for(let o=0,s=n.length-1;o<s;o++)i=F0(e,t,n[o],n[o+1]),i&&r.push(i);return r.length===0?null:r}function $R(e,t,n){const r=[];let i;for(let o=1,s=n.length;o<s+1;o++)i=F0(e,t,n[o-1],n[o%n.length]),i&&r.push(i);return r.length===0?null:r}function BR(e,t,n,r){let i=n.x-e.x,o=n.y-e.y;const s=Math.sqrt(i*i+o*o),a=(s*s-r*r+t*t)/(2*s),l=Math.sqrt(t*t-a*a);return i/=s,o/=s,[new E(e.x+i*a-o*l,e.y+o*a+i*l),new E(e.x+i*a+o*l,e.y+o*a-i*l)]}function TC(e,t,n){const r=[];let i,o,s;for(let a=0,l=n.length;a<l;a++)i=n[a],o=n[(a+1)%n.length],s=lp(i,o,e,t),s&&r.push(...s);return r.length===0?null:r}function jC(e,t,n){const r=[];let i,o,s;for(let a=1,l=n.length;a<l;a++)i=n[a-1],o=n[a],s=lp(i,o,e,t),s&&r.push(...s);return r.length===0?null:r}function cp(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function OC(e,t,n,r){return cp(e,n,r)!==cp(t,n,r)&&cp(e,t,n)!==cp(e,t,r)}function $0(e,t){const n=new Map;let r,i,o,s;for(let a=0,l=e.length;a<l;a++)if(r=e[a],ni(r,t)){const c=B0(r);n.has(c)||n.set(c,r)}for(let a=0,l=t.length;a<l;a++)if(r=t[a],ni(r,e)){const c=B0(r);n.has(c)||n.set(c,r)}for(let a=0,l=e.length;a<l;a++){r=e[a],i=e[(a+1)%e.length];for(let c=0,u=t.length;c<u;c++){o=t[c],s=t[(c+1)%t.length];const d=F0(r,i,o,s);if(d!==null){const h=B0(d);n.has(h)||n.set(h,d)}}}return n.size===0?null:UR([...n.values()])}function B0(e){return`${e.x},${e.y}`}function UR(e){const t=E.Average(e);return e.sort((n,r)=>E.Angle(t,n)-E.Angle(t,r))}function VR(e,t){let n,r,i,o;for(let s=0,a=e.length;s<a;s++){n=e[s],r=e[(s+1)%a];for(let l=0,c=t.length;l<c;l++)if(i=t[l],o=t[(l+1)%c],OC(n,r,i,o))return!0}return!1}class up extends Cs{constructor(n){super({...n,isClosed:!1,isFilled:!1});v(this,"start");v(this,"end");v(this,"d");v(this,"u");v(this,"ul");v(this,"_length");const{start:r,end:i}=n;this.start=r,this.end=i,this.d=r.clone().sub(i),this.u=this.d.clone().uni(),this.ul=this.u.len()}get length(){return this._length?this._length:this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(n){const{start:r,end:i,u:o,ul:s}=this;if(s===0)return r;const a=E.Sub(n,r).dpr(o)/s,l=r.x+o.x*a;if(l<Math.min(r.x,i.x))return r.x<i.x?r:i;if(l>Math.max(r.x,i.x))return r.x>i.x?r:i;const c=r.y+o.y*a;return c<Math.min(r.y,i.y)?r.y<i.y?r:i:c>Math.max(r.y,i.y)?r.y>i.y?r:i:new E(l,c)}hitTestLineSegment(n,r,i){return OC(n,r,this.start,this.end)}}class Es extends Cs{constructor(n){super({isClosed:!1,isFilled:!1,...n});v(this,"points");v(this,"_segments");v(this,"_length");const{points:r}=n;this.points=r}get segments(){if(!this._segments){this._segments=[];const{vertices:n}=this;for(let r=0,i=n.length-1;r<i;r++){const o=n[r],s=n[r+1];this._segments.push(new up({start:o,end:s}))}this.isClosed&&this._segments.push(new up({start:n[n.length-1],end:n[0]}))}return this._segments}get length(){return this._length||(this._length=this.segments.reduce((n,r)=>n+r.length,0)),this._length}getVertices(){return this.points}nearestPoint(n){const{segments:r}=this;let i=this.points[0],o=1/0,s,a;for(let l=0;l<r.length;l++)s=r[l].nearestPoint(n),a=s.dist(n),a<o&&(i=s,o=a);return i}hitTestLineSegment(n,r,i){return this.segments.some(o=>o.hitTestLineSegment(n,r,i))}}class _t extends Es{constructor(t){super({...t}),this.isClosed=!0}}class Ao extends _t{constructor(n){const{x:r=0,y:i=0,width:o,height:s}=n;super({...n,points:[new E(r,i),new E(r+o,i),new E(r+o,i+s),new E(r,i+s)]});v(this,"x");v(this,"y");v(this,"w");v(this,"h");this.x=r,this.y=i,this.w=o,this.h=s}getBounds(){return new se(this.x,this.y,this.w,this.h)}}class Or{constructor(t){v(this,"canSnap",()=>!0);v(this,"canScroll",()=>!1);v(this,"canUnmount",()=>!0);v(this,"canBind",(t,n)=>!0);v(this,"canEdit",()=>!1);v(this,"canResize",()=>!0);v(this,"canEditInReadOnly",()=>!1);v(this,"canCrop",()=>!1);v(this,"hideResizeHandles",()=>!1);v(this,"hideRotateHandle",()=>!1);v(this,"hideSelectionBoundsBg",()=>!1);v(this,"hideSelectionBoundsFg",()=>!1);v(this,"isAspectRatioLocked",()=>!1);v(this,"onBeforeCreate");v(this,"onBeforeUpdate");v(this,"onDragShapesOver");v(this,"onDragShapesOut");v(this,"onDropShapesOver");v(this,"onResizeStart");v(this,"onResize");v(this,"onResizeEnd");v(this,"onTranslateStart");v(this,"onTranslate");v(this,"onTranslateEnd");v(this,"onRotateStart");v(this,"onRotate");v(this,"onRotateEnd");v(this,"onHandleChange");v(this,"onBindingChange");v(this,"onChildrenChange");v(this,"onDoubleClickHandle");v(this,"onDoubleClickEdge");v(this,"onDoubleClick");v(this,"onClick");v(this,"onEditEnd");this.editor=t}providesBackgroundForChildren(t){return!1}getOutlineSegments(t){return[this.editor.getShapeGeometry(t).vertices]}canReceiveNewChildrenOfType(t,n){return!1}canDropShapes(t,n){return!1}expandSelectionOutlinePx(t){return 0}getCanvasSvgDefs(){return[]}}v(Or,"props"),v(Or,"migrations"),v(Or,"type");function HR(e,t,n={}){const{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=n;let c=0,u=0,d=1,h=0,p=0;switch(l){case"dashed":{d=1,c=Math.min(t*a,e/4);break}case"dotted":{d=100,c=t/d;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(o==="outset"?(e+=c/2,p+=c/2):o==="skip"&&(e-=c,p-=c),s==="outset"?e+=c/2:s==="skip"&&(e-=c)),u=Math.floor(e/c/(2*d)),u-=u%i,u<3&&l==="dashed"?e/t<5?(c=e,u=1,h=0):(c=e*.333,h=e*.333):(u=Math.max(u,3),c=e/u/(2*d),r?(p=c/2,h=(e-u*c)/u):h=(e-u*c)/Math.max(1,u-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}function LC({bounds:e,className:t}){const n=H(),r=Y("zoom level",()=>n.getZoomLevel(),[n]);return y.jsx("g",{className:t,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:e.sides.map((i,o)=>{const{strokeDasharray:s,strokeDashoffset:a}=HR(i[0].dist(i[1]),1/r,{style:"dashed",lengthRatio:4});return y.jsx("line",{x1:i[0].x,y1:i[0].y,x2:i[1].x,y2:i[1].y,strokeDasharray:s,strokeDashoffset:a},o)})})}class dp extends Or{constructor(){super(...arguments);v(this,"hideSelectionBoundsFg",()=>!0);v(this,"canBind",()=>!1);v(this,"onChildrenChange",n=>{const r=this.editor.getSortedChildIdsForParent(n.id);if(r.length===0){this.editor.getCurrentPageState().focusedGroupId===n.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([n.id]);return}else if(r.length===1){this.editor.getCurrentPageState().focusedGroupId===n.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(r,n.parentId),this.editor.deleteShapes([n.id]);return}})}getDefaultProps(){return{}}getGeometry(n){const r=this.editor.getSortedChildIdsForParent(n.id);return r.length===0?new Ao({width:1,height:1,isFilled:!1}):new Mo({children:r.map(i=>{const o=this.editor.getShape(i),s=this.editor.getShapeGeometry(i),a=this.editor.getShapeLocalTransform(o).applyToPoints(s.vertices);return s.isClosed?new _t({points:a,isFilled:!0}):new Es({points:a})})})}component(n){const r=this.editor.getErasingShapeIds().includes(n.id),{hintingShapeIds:i}=this.editor.getCurrentPageState(),o=i.length>0&&i.some(l=>l!==n.id&&this.editor.isShapeOfType(this.editor.getShape(l),"group")),s=this.editor.getCurrentPageState().focusedGroupId!==n.id;if(!r&&(s||o))return null;const a=this.editor.getShapeGeometry(n).bounds;return y.jsx(Bn,{id:n.id,children:y.jsx(LC,{className:"tl-group",bounds:a})})}indicator(n){const r=this.editor.getShapeGeometry(n).bounds;return y.jsx(LC,{className:"",bounds:r})}}v(dp,"type","group"),v(dp,"props",oz),v(dp,"migrations",sz);const DC=[dp],KR=new Set(DC.map(e=>e.type));function zC(e){const t=[...DC],n=new Set;for(const r of e){if(KR.has(r.type))throw new Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(n.has(r.type))throw new Error(`Shape type "${r.type}" is defined more than once`);t.push(r),n.add(r.type)}return t}function NC(e,t){if(!t)return!1;switch(e.type){case"mixed":return t.type==="mixed";case"shared":return t.type==="shared"&&e.value===t.value;default:throw ka(e)}}class WR{constructor(t){v(this,"map");this.map=new Map(t)}get(t){return this.map.get(t)}getAsKnownValue(t){const n=this.get(t);if(n&&n.type!=="mixed")return n.value}get size(){return this.map.size}equals(t){if(this.size!==t.size)return!1;const n=new Set;for(const[r,i]of this){if(!NC(i,t.get(r)))return!1;n.add(r)}for(const[r,i]of t)if(!n.has(r)&&!NC(i,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class U0 extends WR{set(t,n){this.map.set(t,n)}applyValue(t,n){const r=this.get(t);if(!r){this.set(t,{type:"shared",value:n});return}switch(r.type){case"mixed":return;case"shared":r.value!==n&&this.set(t,{type:"mixed"});return;default:ka(r,"type")}}}class V0{constructor(){v(this,"items",new WeakMap)}get(t,n){return this.items.has(t)||this.items.set(t,n(t)),this.items.get(t)}access(t){return this.items.get(t)}set(t,n){this.items.set(t,n)}has(t){return this.items.has(t)}invalidate(t){this.items.delete(t)}bust(){this.items=new WeakMap}}function YR(e,t,n){return fetch(e).then(function(r){return r.arrayBuffer()}).then(function(r){return new File([r],t,{type:n})})}function XR(e,t){var i;let n=e;const r=new Set(t);for(;r.has(n);)n=(i=/^.*(\d+)$/.exec(n))!=null&&i[1]?n.replace(/(\d+)(?=\D?)$/,o=>(+o+1).toString()):`${n} 1`;return n}const Un="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",GR="a0",RC="A00000000000000000000000000";function FC(e){if(e>="a"&&e<="z")return e.charCodeAt(0)-"a".charCodeAt(0)+2;if(e>="A"&&e<="Z")return"Z".charCodeAt(0)-e.charCodeAt(0)+2;throw new Error("Invalid index key head: "+e)}function $C(e){if(e.length!==FC(e.charAt(0)))throw new Error("invalid integer part of index key: "+e)}function BC(e){if(e===void 0)throw Error("n is undefined")}function UC(e){$C(e);const[t,...n]=e.split("");let r=!0;for(let i=n.length-1;r&&i>=0;i--){const o=Un.indexOf(n[i])+1;o===Un.length?n[i]="0":(n[i]=Un.charAt(o),r=!1)}if(r){if(t==="Z")return"a0";if(t==="z")return;const i=String.fromCharCode(t.charCodeAt(0)+1);return i>"a"?n.push("0"):n.pop(),i+n.join("")}else return t+n.join("")}function qR(e){$C(e);const[t,...n]=e.split("");let r=!0;for(let i=n.length-1;r&&i>=0;i--){const o=Un.indexOf(n[i])-1;o===-1?n[i]=Un.slice(-1):(n[i]=Un.charAt(o),r=!1)}if(r){if(t==="a")return"Z"+Un.slice(-1);if(t==="A")return;const i=String.fromCharCode(t.charCodeAt(0)-1);return i<"Z"?n.push(Un.slice(-1)):n.pop(),i+n.join("")}else return t+n.join("")}function Ba(e,t){if(t!==void 0&&e>=t)throw new Error(e+" >= "+t);if(e.slice(-1)==="0"||t&&t.slice(-1)==="0")throw new Error("trailing zero");if(t){let i=0;for(;(e.charAt(i)||"0")===t.charAt(i);)i++;if(i>0)return t.slice(0,i)+Ba(e.slice(i),t.slice(i))}const n=e?Un.indexOf(e.charAt(0)):0,r=t!==void 0?Un.indexOf(t.charAt(0)):Un.length;if(r-n>1){const i=Math.round(.5*(n+r));return Un.charAt(i)}else return t&&t.length>1?t.slice(0,1):Un.charAt(n)+Ba(e.slice(1),void 0)}function qc(e){const t=FC(e.charAt(0));if(t>e.length)throw new Error("invalid index: "+e);return e.slice(0,t)}function VC(e){if(e===RC)throw new Error("invalid index: "+e);const t=qc(e);if(e.slice(t.length).slice(-1)==="0")throw new Error("invalid index: "+e)}function Ua(e,t){if(e!==void 0&&VC(e),t!==void 0&&VC(t),e!==void 0&&t!==void 0&&e>=t)throw new Error(e+" >= "+t);if(e===void 0&&t===void 0)return GR;if(e===void 0){if(t===void 0)throw Error("b is undefined");const a=qc(t),l=t.slice(a.length);if(a===RC)return a+Ba("",l);if(a<t)return a;const c=qR(a);return BC(c),c}if(t===void 0){const a=qc(e),l=e.slice(a.length),c=UC(a);return c===void 0?a+Ba(l,void 0):c}const n=qc(e),r=e.slice(n.length),i=qc(t),o=t.slice(i.length);if(n===i)return n+Ba(r,o);const s=UC(n);return BC(s),s<t?s:n+Ba(r,void 0)}function To(e,t,n){if(n===0)return[];if(n===1)return[Ua(e,t)];if(t===void 0){let o=Ua(e,t);const s=[o];for(let a=0;a<n-1;a++)o=Ua(o,t),s.push(o);return s}if(e===void 0){let o=Ua(e,t);const s=[o];for(let a=0;a<n-1;a++)o=Ua(e,o),s.push(o);return s.reverse(),s}const r=Math.floor(n/2),i=Ua(e,t);return[...To(e,i,r),i,...To(i,t,n-r-1)]}function Va(e,t,n){return To(e,t,n)}function H0(e,t){return To(e,void 0,t)}function Zc(e,t){return To(e,t,1)[0]}function zi(e){return To(e,void 0,1)[0]}function ZR(e){return To(void 0,e,1)[0]}function HC(e,t="a1"){return[t,...To(t,void 0,e)]}function qt(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function hp(e,t,n){if(n.length===0)return[];const r=new Map;for(const o of he(n.map(s=>e.getShape(s)))){const{parentId:s}=o;r.has(s)||r.set(s,{children:he(e.getSortedChildIdsForParent(s).map(a=>e.getShape(a))),moving:new Set}),r.get(s).moving.add(o)}const i=[];switch(t){case"toBack":{r.forEach(({moving:o,children:s})=>QR(o,s,i));break}case"toFront":{r.forEach(({moving:o,children:s})=>JR(o,s,i));break}case"forward":{r.forEach(({moving:o,children:s})=>e9(o,s,i));break}case"backward":{r.forEach(({moving:o,children:s})=>t9(o,s,i));break}}return i}function QR(e,t,n){const r=t.length;if(e.size===r)return;let i,o;for(let s=0;s<r;s++){const a=t[s];if(e.has(a))i=a.index,e.delete(a);else{o=a.index;break}}if(e.size!==0){const s=Va(i,o,e.size);n.push(...Array.from(e.values()).sort(qt).map((a,l)=>({...a,index:s[l]})))}}function JR(e,t,n){const r=t.length;if(e.size===r)return;let i,o;for(let s=r-1;s>-1;s--){const a=t[s];if(e.has(a))o=a.index,e.delete(a);else{i=a.index;break}}if(e.size!==0){const s=Va(i,o,e.size);n.push(...Array.from(e.values()).sort(qt).map((a,l)=>({...a,index:s[l]})))}}function e9(e,t,n){var o;const r=t.length;if(e.size===r)return;let i={name:"skipping"};for(let s=0;s<r;s++){const a=e.has(t[s]);switch(i.name){case"skipping":{if(!a)continue;i={name:"selecting",selectIndex:s};break}case"selecting":{if(a)continue;const{selectIndex:l}=i;Va(t[s].index,(o=t[s+1])==null?void 0:o.index,s-l).forEach((c,u)=>n.push({...t[l+u],index:c})),i={name:"skipping"};break}}}}function t9(e,t,n){var o;const r=t.length;if(e.size===r)return;let i={name:"skipping"};for(let s=r-1;s>-1;s--){const a=e.has(t[s]);switch(i.name){case"skipping":{if(!a)continue;i={name:"selecting",selectIndex:s};break}case"selecting":{if(a)continue;Va((o=t[s-1])==null?void 0:o.index,t[s].index,i.selectIndex-s).forEach((l,c)=>{n.push({...t[s+c+1],index:l})}),i={name:"skipping"};break}}}}function KC({editor:e}){const t=e.getSelectedShapes(),n=e.getSelectionRotation(),r=e.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:i}}=e;if(!r)return null;const o=r.center.clone().rotWith(r.point,n);return{selectionPageCenter:o,initialCursorAngle:o.angle(i),initialSelectionRotation:n,shapeSnapshots:t.map(s=>({shape:Po(s),initialPagePoint:e.getShapePageTransform(s.id).point()}))}}function pp({delta:e,editor:t,snapshot:n,stage:r}){const{selectionPageCenter:i,shapeSnapshots:o}=n;t.updateShapes(o.map(({shape:a,initialPagePoint:l})=>{const c=ar(a.parentId)?t.getShapePageTransform(a.parentId):te.Identity(),u=E.RotWith(l,i,e),d=te.applyToPoint(te.Inverse(c),u),h=Ar(a.rotation+e);return{id:a.id,type:a.type,x:d.x,y:d.y,rotation:h}}));const s=[];o.forEach(({shape:a})=>{var d,h,p;const l=t.getShape(a.id);if(!l)return;const c=t.getShapeUtil(a);if(r==="start"||r==="one-off"){const g=(d=c.onRotateStart)==null?void 0:d.call(c,a);g&&s.push(g)}const u=(h=c.onRotate)==null?void 0:h.call(c,a,l);if(u&&s.push(u),r==="end"||r==="one-off"){const g=(p=c.onRotateEnd)==null?void 0:p.call(c,a,l);g&&s.push(g)}}),s.length>0&&t.updateShapes(s)}const n9=e=>{const{store:t}=e,n=t.query.filterHistory("shape"),r=t.query.records("shape",()=>({type:{eq:"arrow"}}));function i(){const o=r.get(),s={};for(const a of o){const{start:l,end:c}=a.props;if(l.type==="binding"){const u=s[l.boundShapeId];u?u.push({arrowId:a.id,handleId:"start"}):s[l.boundShapeId]=[{arrowId:a.id,handleId:"start"}]}if(c.type==="binding"){const u=s[c.boundShapeId];u?u.push({arrowId:a.id,handleId:"end"}):s[c.boundShapeId]=[{arrowId:a.id,handleId:"end"}]}}return s}return q("arrowBindingsIndex",(o,s)=>{if(Sa(o))return i();const a=o,l=n.getDiffSince(s);if(l===Nn)return i();let c;function u(p){c||(c={...a}),c[p]?c[p]===a[p]&&(c[p]=[...c[p]]):c[p]=[]}function d(p,g,f){u(p),c[p]=c[p].filter(m=>m.arrowId!==g||m.handleId!==f),c[p].length===0&&delete c[p]}function h(p,g,f){u(p),c[p].push({arrowId:g,handleId:f})}for(const p of l){for(const g of Object.values(p.added))if(e.isShapeOfType(g,"arrow")){const{start:f,end:m}=g.props;f.type==="binding"&&h(f.boundShapeId,g.id,"start"),m.type==="binding"&&h(m.boundShapeId,g.id,"end")}for(const[g,f]of Object.values(p.updated))if(!(!e.isShapeOfType(g,"arrow")||!e.isShapeOfType(f,"arrow")))for(const m of["start","end"]){const w=g.props[m],b=f.props[m];w.type==="binding"&&b.type==="point"?d(w.boundShapeId,g.id,m):w.type==="point"&&b.type==="binding"?h(b.boundShapeId,f.id,m):w.type==="binding"&&b.type==="binding"&&w.boundShapeId!==b.boundShapeId&&(d(w.boundShapeId,g.id,m),h(b.boundShapeId,f.id,m))}for(const g of Object.values(p.removed))if(e.isShapeOfType(g,"arrow")){const{start:f,end:m}=g.props;f.type==="binding"&&d(f.boundShapeId,g.id,"start"),m.type==="binding"&&d(m.boundShapeId,g.id,"end")}}return c??a})},r9=e=>{const t=e.query.ids("shape");function n(){const r={},i=t.get(),o=Array(i.size);return i.forEach(s=>o.push(e.get(s))),o.sort(qt),o.forEach(s=>{r[s.parentId]||(r[s.parentId]=[]),r[s.parentId].push(s.id)}),r}return q("parentsToChildrenWithIndexes",(r,i)=>{if(Sa(r))return n();const o=e.history.getDiffSince(i);if(o===Nn)return n();if(o.length===0)return r;let s=null;const a=u=>{s||(s={...r}),s[u]?s[u]===r[u]&&(s[u]=[...s[u]]):s[u]=[]},l=new Set;let c;for(let u=0,d=o.length;u<d;u++){c=o[u];for(const h of Object.values(c.added))Ss(h)&&(a(h.parentId),s[h.parentId].push(h.id),l.add(s[h.parentId]));for(const[h,p]of Object.values(c.updated))if(Ss(p)&&Ss(h)){if(h.parentId!==p.parentId)a(h.parentId),a(p.parentId),s[h.parentId].splice(s[h.parentId].indexOf(p.id),1),s[p.parentId].push(p.id),l.add(s[p.parentId]);else if(h.index!==p.index){a(p.parentId);const g=s[p.parentId].indexOf(p.id);s[p.parentId][g]=p.id,l.add(s[p.parentId])}}for(const h of Object.values(c.removed))Ss(h)&&(a(h.parentId),s[h.parentId].splice(s[h.parentId].indexOf(h.id),1))}for(const u of l){const d=he(u.map(h=>e.get(h)));d.sort(qt),u.splice(0,u.length,...d.map(h=>h.id))}return s??r})},K0=(e,t,n)=>{for(;!_n(n.parentId);){const r=e.get(n.parentId);if(!r)return!1;n=r}return n.parentId===t},i9=(e,t)=>{const n=e.query.ids("shape");let r=null;function i(){const o=t();return r=o,new Set([...n.get()].filter(s=>K0(e,o,e.get(s))))}return q("_shapeIdsInCurrentPage",(o,s)=>{if(Sa(o))return i();const a=t();if(a!==r)return i();const l=e.history.getDiffSince(s);if(l===Nn)return i();const c=new Ch(o);for(const d of l){for(const h of Object.values(d.added))Ss(h)&&K0(e,a,h)&&c.add(h.id);for(const[h,p]of Object.values(d.updated))Ss(p)&&(K0(e,a,p)?c.add(p.id):c.remove(p.id));for(const h of Object.keys(d.removed))ar(h)&&c.remove(h)}const u=c.get();return u?Sc(u.value,u.diff):o})},o9=40;class s9{constructor(t){v(this,"_clickId","");v(this,"_clickTimeout");v(this,"_clickScreenPoint");v(this,"_previousScreenPoint");v(this,"_getClickTimeout",(t,n=Re())=>{this._clickId=n,clearTimeout(this._clickTimeout),this._clickTimeout=setTimeout(()=>{if(this._clickState===t&&this._clickId===n){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},t==="idle"||t==="pendingDouble"?nN:rN)});v(this,"_clickState","idle");v(this,"lastPointerInfo",{});v(this,"transformPointerDownEvent",t=>{if(!this._clickState)return t;switch(this._clickScreenPoint=E.From(t.point),this._previousScreenPoint&&this._previousScreenPoint.dist(this._clickScreenPoint)>o9&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=t,this._clickState){case"idle":return this._clickState="pendingDouble",this._clickTimeout=this._getClickTimeout(this._clickState),t;case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...t,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...t,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...t,type:"click",name:"quadruple_click",phase:"down"};case"pendingOverflow":return this._clickState="overflow",this._clickTimeout=this._getClickTimeout(this._clickState),t;default:return this._clickTimeout=this._getClickTimeout(this._clickState),t}});v(this,"transformPointerUpEvent",t=>{if(!this._clickState)return t;switch(this._clickScreenPoint=E.From(t.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"};default:return t}});v(this,"cancelDoubleClickTimeout",()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"});v(this,"handleMove",()=>{this._clickState!=="idle"&&this._clickScreenPoint&&this._clickScreenPoint.dist(this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?C0:Vc)&&this.cancelDoubleClickTimeout()});this.editor=t}get clickState(){return this._clickState}}class a9{constructor(t){v(this,"isSafari");v(this,"isIos");v(this,"isChromeForIos");v(this,"isFirefox");v(this,"isAndroid");this.editor=t,typeof window<"u"&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}}function Ps(e){if(e){let t=WC;for(;e.length;)t=t.push(e.pop());return t}return WC}class l9{constructor(){v(this,"length",0);v(this,"head",null);v(this,"tail",this)}push(t){return new Nw(t,this)}toArray(){return Ii}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const WC=new l9;class Nw{constructor(t,n){v(this,"length");this.head=t,this.tail=n,this.length=n.length+1}push(t){return new Nw(t,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let t=this;return{next(){if(t.length){const n=t.head;return t=t.tail,{value:n,done:!1}}else return{value:void 0,done:!0}}}}}class c9{constructor(t,n){v(this,"_undos",ln("HistoryManager.undos",Ps()));v(this,"_redos",ln("HistoryManager.redos",Ps()));v(this,"_batchDepth",0);v(this,"onBatchComplete",()=>{});v(this,"_commands",{});v(this,"createCommand",(t,n,r)=>{if(this._commands[t])throw new Error(`Duplicate command: ${t}`);this._commands[t]=r;const i=(...o)=>{if(!this._batchDepth)return this.batch(()=>i(...o)),this.ctx;const s=n(...o);if(!s)return this.ctx;const{data:a,ephemeral:l,squashing:c,preservesRedoStack:u}=s;if(this.ignoringUpdates((d,h)=>(r.do(a),{undos:d,redos:h})),!l){const d=this._undos.get().head;c&&d&&d.type==="command"&&d.name===t&&d.preservesRedoStack===u?this._undos.update(h=>h.tail.push({...d,id:Re(),data:r.squash(d.data,a)})):this._undos.update(h=>h.push({type:"command",name:t,data:a,id:Re(),preservesRedoStack:u})),s.preservesRedoStack||this._redos.set(Ps()),this.ctx.emit("change-history",{reason:"push"})}return this.ctx};return i});v(this,"batch",t=>{try{this._batchDepth++,this._batchDepth===1?Pr(()=>{var r,i;const n=(r=this._undos.get().head)==null?void 0:r.id;t(),n!==((i=this._undos.get().head)==null?void 0:i.id)&&this.onBatchComplete()}):t()}catch(n){throw this.annotateError(n),n}finally{this._batchDepth--}return this});v(this,"ignoringUpdates",t=>{let n=this._undos.get(),r=this._redos.get();this._undos.set(Ps()),this._redos.set(Ps());try{({undos:n,redos:r}=Pr(()=>t(n,r)))}finally{this._undos.set(n),this._redos.set(r)}});v(this,"_undo",({pushToRedoStack:t,toMark:n=void 0})=>(this.ignoringUpdates((r,i)=>{var o;if(r.length===0)return{undos:r,redos:i};for(;((o=r.head)==null?void 0:o.type)==="STOP";){const s=r.head;if(r=r.tail,t&&(i=i.push(s)),s.id===n)return this.ctx.emit("change-history",t?{reason:"undo"}:{reason:"bail",markId:n}),{undos:r,redos:i}}if(r.length===0)return this.ctx.emit("change-history",t?{reason:"undo"}:{reason:"bail",markId:n}),{undos:r,redos:i};for(;r.head;){const s=r.head;if(r=r.tail,t&&(i=i.push(s)),s.type==="STOP"){if(s.onUndo&&(!n||s.id===n))return this.ctx.emit("change-history",t?{reason:"undo"}:{reason:"bail",markId:n}),{undos:r,redos:i}}else this._commands[s.name].undo(s.data)}return this.ctx.emit("change-history",t?{reason:"undo"}:{reason:"bail",markId:n}),{undos:r,redos:i}}),this));v(this,"undo",()=>(this._undo({pushToRedoStack:!0}),this));v(this,"redo",()=>(this.ignoringUpdates((t,n)=>{var r;if(n.length===0)return{undos:t,redos:n};for(;((r=n.head)==null?void 0:r.type)==="STOP";)t=t.push(n.head),n=n.tail;if(n.length===0)return this.ctx.emit("change-history",{reason:"redo"}),{undos:t,redos:n};for(;n.head;){const i=n.head;if(t=t.push(n.head),n=n.tail,i.type==="STOP"){if(i.onRedo)break}else{const o=this._commands[i.name];o.redo?o.redo(i.data):o.do(i.data)}}return this.ctx.emit("change-history",{reason:"redo"}),{undos:t,redos:n}}),this));v(this,"bail",()=>(this._undo({pushToRedoStack:!1}),this));v(this,"bailToMark",t=>(this._undo({pushToRedoStack:!1,toMark:t}),this));v(this,"mark",(t=Re(),n=!0,r=!0)=>{const i=this._undos.get().head;return i&&i.type==="STOP"&&i.id===t&&i.onUndo===n&&i.onRedo===r?i.id:(this._undos.update(o=>o.push({type:"STOP",id:t,onUndo:n,onRedo:r})),this.ctx.emit("mark-history",{id:t}),t)});this.ctx=t,this.annotateError=n}getNumUndos(){return this._undos.get().length}getNumRedos(){return this._redos.get().length}clear(){this._undos.set(Ps()),this._redos.set(Ps())}}class u9{constructor(t){v(this,"scribbleItems",new Map);v(this,"state","paused");v(this,"addScribble",(t,n=Re())=>{const r={id:n,scribble:{id:n,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...t,state:"starting"},timeoutMs:0,delayRemaining:t.delay??0,prev:null,next:null};return this.scribbleItems.set(n,r),this.state==="paused"&&this.resume(),r});v(this,"stop",t=>{const n=this.scribbleItems.get(t);if(!n)throw Error(`Scribble with id ${t} not found`);return n.delayRemaining=Math.min(n.delayRemaining,200),n.scribble.state="stopping",n});v(this,"addPoint",(t,n,r)=>{const i=this.scribbleItems.get(t);if(!i)throw Error(`Scribble with id ${t} not found`);const{prev:o}=i,s={x:n,y:r,z:.5};return(!o||E.Dist(o,s)>=1)&&(i.next=s),i});v(this,"tick",t=>{this.editor.batch(()=>{this.scribbleItems.forEach(n=>{if(n.scribble.state==="starting"){const{next:l,prev:c}=n;l&&l!==c&&(n.prev=l,n.scribble.points.push(l)),n.scribble.points.length>8&&(n.scribble.state="active");return}n.delayRemaining>0&&(n.delayRemaining=Math.max(0,n.delayRemaining-t)),n.timeoutMs+=t,n.timeoutMs>=16&&(n.timeoutMs=0);const{delayRemaining:r,timeoutMs:i,prev:o,next:s,scribble:a}=n;switch(a.state){case"active":{s&&s!==o?(n.prev=s,a.points.push(s),r===0&&a.points.length>8&&a.points.shift()):i===0&&(a.points.length>1?a.points.shift():n.delayRemaining=a.delay);break}case"stopping":{if(n.delayRemaining===0&&i===0){if(a.points.length===1){this.scribbleItems.delete(n.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:n})=>({...n,points:[...n.points]})).slice(-5)}),this.scribbleItems.size===0&&this.pause()})});this.editor=t}resume(){this.state="running",this.editor.addListener("tick",this.tick)}pause(){this.editor.removeListener("tick",this.tick),this.state="paused"}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear(),this.pause()}}class d9{constructor(t){v(this,"_beforeCreateHandlers",{});v(this,"_afterCreateHandlers",{});v(this,"_beforeChangeHandlers",{});v(this,"_afterChangeHandlers",{});v(this,"_beforeDeleteHandlers",{});v(this,"_afterDeleteHandlers",{});v(this,"_batchCompleteHandlers",[]);this.editor=t,t.store.onBeforeCreate=(r,i)=>{const o=this._beforeCreateHandlers[r.typeName];if(o){let s=r;for(const a of o)s=a(s,i);return s}return r},t.store.onAfterCreate=(r,i)=>{const o=this._afterCreateHandlers[r.typeName];if(o)for(const s of o)s(r,i)},t.store.onBeforeChange=(r,i,o)=>{const s=this._beforeChangeHandlers[i.typeName];if(s){let a=i;for(const l of s)a=l(r,a,o);return a}return i};let n=0;t.store.onAfterChange=(r,i,o)=>{if(n++,n>1e3)console.error("[CleanupManager.onAfterChange] Maximum update depth exceeded, bailing out.");else{const s=this._afterChangeHandlers[i.typeName];if(s)for(const a of s)a(r,i,o)}n--},t.store.onBeforeDelete=(r,i)=>{const o=this._beforeDeleteHandlers[r.typeName];if(o){for(const s of o)if(s(r,i)===!1)return!1}},t.store.onAfterDelete=(r,i)=>{const o=this._afterDeleteHandlers[r.typeName];if(o)for(const s of o)s(r,i)},t.history.onBatchComplete=()=>{this._batchCompleteHandlers.forEach(r=>r())}}registerBeforeCreateHandler(t,n){return this._beforeCreateHandlers[t]||(this._beforeCreateHandlers[t]=[]),this._beforeCreateHandlers[t].push(n),()=>Is(this._beforeCreateHandlers[t],n)}registerAfterCreateHandler(t,n){return this._afterCreateHandlers[t]||(this._afterCreateHandlers[t]=[]),this._afterCreateHandlers[t].push(n),()=>Is(this._afterCreateHandlers[t],n)}registerBeforeChangeHandler(t,n){return this._beforeChangeHandlers[t]||(this._beforeChangeHandlers[t]=[]),this._beforeChangeHandlers[t].push(n),()=>Is(this._beforeChangeHandlers[t],n)}registerAfterChangeHandler(t,n){return this._afterChangeHandlers[t]||(this._afterChangeHandlers[t]=[]),this._afterChangeHandlers[t].push(n),()=>Is(this._afterChangeHandlers[t],n)}registerBeforeDeleteHandler(t,n){return this._beforeDeleteHandlers[t]||(this._beforeDeleteHandlers[t]=[]),this._beforeDeleteHandlers[t].push(n),()=>Is(this._beforeDeleteHandlers[t],n)}registerAfterDeleteHandler(t,n){return this._afterDeleteHandlers[t]||(this._afterDeleteHandlers[t]=[]),this._afterDeleteHandlers[t].push(n),()=>Is(this._afterDeleteHandlers[t],n)}registerBatchCompleteHandler(t){return this._batchCompleteHandlers.push(t),()=>Is(this._batchCompleteHandlers,t)}}function Is(e,t){const n=e.indexOf(t);n>=0&&e.splice(n,1)}var h9=Object.defineProperty,p9=Object.getOwnPropertyDescriptor,Ms=(e,t,n,r)=>{for(var i=r>1?void 0:r?p9(t,n):t,o=e.length-1,s;o>=0;o--)(s=e[o])&&(i=(r?s(t,n,i):s(i))||i);return r&&i&&h9(t,n,i),i};const de=e=>Math.round(e*10**8)/10**8;function Ni(e,t,n,r,i){const o=e.filter(a=>(r==="forward"?a.startNode.id===t:a.endNode.id===t)&&de(a.length)===de(n)&&Tr(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));if(o.length===0)return[];const s=new Set;return o.forEach(a=>{const l=r==="forward"?a.endNode.id:a.startNode.id;if(!s.has(l)){s.add(l);const c=Ni(e,l,n,r,Tr(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));o.push(...c)}}),o}function f9(e){e.sort((t,n)=>n.gaps.length-t.gaps.length);for(let t=e.length-1;t>0;t--){const n=e[t];for(let r=t-1;r>=0;r--){const i=e[r];if(i.direction===n.direction&&n.gaps.every(o=>i.gaps.some(s=>de(o.startEdge[0].x)===de(s.startEdge[0].x)&&de(o.startEdge[0].y)===de(s.startEdge[0].y)&&de(o.startEdge[1].x)===de(s.startEdge[1].x)&&de(o.startEdge[1].y)===de(s.startEdge[1].y))&&i.gaps.some(s=>de(o.endEdge[0].x)===de(s.endEdge[0].x)&&de(o.endEdge[0].y)===de(s.endEdge[0].y)&&de(o.endEdge[1].x)===de(s.endEdge[1].x)&&de(o.endEdge[1].y)===de(s.endEdge[1].y)))){e.splice(t,1);break}}}}class jo{constructor(t){v(this,"_snapLines",ln("snapLines",void 0));this.editor=t}getLines(){return this._snapLines.get()??Ii}clear(){this.getLines().length&&this._snapLines.set(void 0)}setLines(t){this._snapLines.set(t)}getSnapPointsCache(){const{editor:t}=this;return t.store.createComputedCache("snapPoints",n=>{const r=t.getShapePageTransform(n.id);return r?this.editor.getShapeGeometry(n).snapPoints.map((i,o)=>{const{x:s,y:a}=te.applyToPoint(r,i);return{x:s,y:a,id:`${n.id}:${o}`}}):void 0})}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:t}=this,n=t.getRenderingBounds(),r=t.getSelectedShapeIds(),i=[],o=s=>{const a=t.getSortedChildIdsForParent(s);for(const l of a){if(r.includes(l))continue;const c=t.getShape(l);if(!c||!t.getShapeUtil(c).canSnap(c))continue;const u=t.getShapePageBounds(l);if(u&&n.includes(u)){if(t.isShapeOfType(c,"group")){o(l);continue}i.push({id:l,pageBounds:u,isClosed:t.getShapeGeometry(c).isClosed})}}};return o(this.getCurrentCommonAncestor()??t.getCurrentPageId()),i}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}getSnappablePoints(){const t=this.getSnapPointsCache(),n=this.getSnappableShapes(),r=[];return n.forEach(i=>{const o=t.get(i.id);o&&r.push(...o)}),r}getVisibleGaps(){const t=[],n=[];let r,i;const o=this.getSnappableShapes().sort((a,l)=>a.pageBounds.minX-l.pageBounds.minX);for(let a=0;a<o.length;a++){r=o[a];for(let l=a+1;l<o.length;l++)i=o[l],r.pageBounds.maxX<i.pageBounds.minX&&Bc(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)&&t.push({startNode:r,endNode:i,startEdge:[new E(r.pageBounds.maxX,r.pageBounds.minY),new E(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new E(i.pageBounds.minX,i.pageBounds.minY),new E(i.pageBounds.minX,i.pageBounds.maxY)],length:i.pageBounds.minX-r.pageBounds.maxX,breadthIntersection:Tr(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)})}const s=o.sort((a,l)=>a.pageBounds.minY-l.pageBounds.minY);for(let a=0;a<s.length;a++){r=s[a];for(let l=a+1;l<s.length;l++)i=s[l],r.pageBounds.maxY<i.pageBounds.minY&&Bc(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)&&n.push({startNode:r,endNode:i,startEdge:[new E(r.pageBounds.minX,r.pageBounds.maxY),new E(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new E(i.pageBounds.minX,i.pageBounds.minY),new E(i.pageBounds.maxX,i.pageBounds.minY)],length:i.pageBounds.minY-r.pageBounds.maxY,breadthIntersection:Tr(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)})}return{horizontal:t,vertical:n}}snapTranslate({lockedAxis:t,initialSelectionPageBounds:n,initialSelectionSnapPoints:r,dragDelta:i}){var m,w;const o=this.getSnapThreshold(),s=this.getSnappablePoints(),a=n.clone().translate(i),l=r.map(({x:b,y:k},S)=>({id:"selection:"+S,x:b+i.x,y:k+i.y})),c=s,u=[],d=[],h=new E(o,o);this.collectPointSnaps({minOffset:h,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:h});const p=new E(t==="x"?0:((m=u[0])==null?void 0:m.nudge)??0,t==="y"?0:((w=d[0])==null?void 0:w.nudge)??0);h.x=0,h.y=0,u.length=0,d.length=0,l.forEach(b=>{b.x+=p.x,b.y+=p.y}),a.translate(p),this.collectPointSnaps({minOffset:h,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:h});const g=this.getPointSnapLines({nearestSnapsX:u,nearestSnapsY:d}),f=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d});return this._snapLines.set([...f,...g]),{nudge:p}}getOutlinesInPageSpace(){return this.getSnappableShapes().map(({id:t,isClosed:n})=>{const r=Ht(this.editor.getShapeGeometry(t).vertices);n&&r.push(r[0]);const i=this.editor.getShapePageTransform(t);if(!i)throw Error("No page transform");return te.applyToPoints(i,r)})}getSnappingHandleDelta({handlePoint:t,additionalSegments:n}){const r=this.getSnapThreshold(),i=this.getOutlinesInPageSpace();let o=r,s=null,a,l,c,u;const d=[...i,...n];for(const h of d)for(let p=0;p<h.length-1;p++)a=h[p],l=h[p+1],c=E.NearestPointOnLineSegment(a,l,t),u=E.Dist(t,c),!isNaN(u)&&u<o&&(o=u,s=c);return s?(this._snapLines.set([{id:Re(),type:"points",points:[s]}]),E.Sub(s,t)):null}snapResize({initialSelectionPageBounds:t,dragDelta:n,handle:r,isAspectRatioLocked:i,isResizingFromCenter:o}){var P,I;const s=this.getSnapThreshold(),{box:a,scaleX:l,scaleY:c}=se.Resize(t,r,o?n.x*2:n.x,o?n.y*2:n.y,i);let u=r;l<0&&(u=Z6(u)),c<0&&(u=q6(u)),o&&(a.center=t.center);const d=u==="top"||u==="bottom",h=u==="left"||u==="right",p=YC(u,a),g=this.getSnappablePoints(),f=[],m=[],w=new E(s,s);this.collectPointSnaps({minOffset:w,nearestSnapsX:f,nearestSnapsY:m,otherNodeSnapPoints:g,selectionSnapPoints:p});const b=new E(d?0:((P=f[0])==null?void 0:P.nudge)??0,h?0:((I=m[0])==null?void 0:I.nudge)??0);if(i&&Q6(u)&&b.len()!==0){const M=f.length&&m.length?Math.abs(b.x)<Math.abs(b.y)?"x":"y":f.length?"x":"y",A=t.aspectRatio;M==="x"?(m.length=0,b.y=b.x/A,(u==="bottom_left"||u==="top_right")&&(b.y=-b.y)):(f.length=0,b.x=b.y*A,(u==="bottom_left"||u==="top_right")&&(b.x=-b.x))}const k=E.Add(n,b),{box:S}=se.Resize(t,r,o?k.x*2:k.x,o?k.y*2:k.y,i);o&&(S.center=t.center);const C=YC("any",S);f.length=0,m.length=0,w.x=0,w.y=0,this.collectPointSnaps({minOffset:w,nearestSnapsX:f,nearestSnapsY:m,otherNodeSnapPoints:g,selectionSnapPoints:C});const _=this.getPointSnapLines({nearestSnapsX:f,nearestSnapsY:m});return this._snapLines.set([..._]),{nudge:b}}collectPointSnaps({selectionSnapPoints:t,otherNodeSnapPoints:n,minOffset:r,nearestSnapsX:i,nearestSnapsY:o}){for(const s of t)for(const a of n){const l=E.Sub(s,a),c=Math.abs(l.x),u=Math.abs(l.y);de(c)<=de(r.x)&&(de(c)<de(r.x)&&(i.length=0),i.push({type:"points",points:{thisPoint:s,otherPoint:a},nudge:a.x-s.x}),r.x=c),de(u)<=de(r.y)&&(de(u)<de(r.y)&&(o.length=0),o.push({type:"points",points:{thisPoint:s,otherPoint:a},nudge:a.y-s.y}),r.y=u)}}collectGapSnaps({selectionPageBounds:t,minOffset:n,nearestSnapsX:r,nearestSnapsY:i}){const{horizontal:o,vertical:s}=this.getVisibleGaps();for(const a of o){if(!Bc(a.breadthIntersection[0],a.breadthIntersection[1],t.minY,t.maxY))continue;const l=a.startEdge[0].x+a.length/2-t.center.x;if(a.length>t.width&&de(Math.abs(l))<=de(n.x)){de(Math.abs(l))<de(n.x)&&(r.length=0),n.x=Math.abs(l);const f={type:"gap_center",gap:a,nudge:l},m=r.find(({type:b})=>b==="gap_center"),w=m&&Tr(a.breadthIntersection[0],a.breadthIntersection[1],m.gap.breadthIntersection[0],m.gap.breadthIntersection[1]);m&&m.gap.length>a.length&&w?r[r.indexOf(m)]=f:(!m||!w)&&r.push(f)}const c=a.startNode.pageBounds.minX-a.length,u=t.maxX,d=c-u;de(Math.abs(d))<=de(n.x)&&(de(Math.abs(d))<de(n.x)&&(r.length=0),n.x=Math.abs(d),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:d}));const h=a.endNode.pageBounds.maxX+a.length,p=t.minX,g=h-p;de(Math.abs(g))<=de(n.x)&&(de(Math.abs(g))<de(n.x)&&(r.length=0),n.x=Math.abs(g),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:g}))}for(const a of s){if(!Bc(a.breadthIntersection[0],a.breadthIntersection[1],t.minX,t.maxX))continue;const l=a.startEdge[0].y+a.length/2-t.center.y;if(a.length>t.height&&de(Math.abs(l))<=de(n.y)){de(Math.abs(l))<de(n.y)&&(i.length=0),n.y=Math.abs(l);const f={type:"gap_center",gap:a,nudge:l},m=i.find(({type:b})=>b==="gap_center"),w=m&&Bc(m.gap.breadthIntersection[0],m.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);m&&m.gap.length>a.length&&w?i[i.indexOf(m)]=f:(!m||!w)&&i.push(f);continue}const c=a.startNode.pageBounds.minY-a.length,u=t.maxY,d=c-u;de(Math.abs(d))<=de(n.y)&&(de(Math.abs(d))<de(n.y)&&(i.length=0),n.y=Math.abs(d),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:d}));const h=a.endNode.pageBounds.maxY+a.length,p=t.minY,g=h-p;de(Math.abs(g))<=de(n.y)&&(de(Math.abs(g))<de(n.y)&&(i.length=0),n.y=Math.abs(g),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:g}))}}getPointSnapLines({nearestSnapsX:t,nearestSnapsY:n}){const r={},i={};if(t.length>0){for(const o of t)if(o.type==="points"){const s=de(o.points.otherPoint.x);r[s]||(r[s]=[]),r[s].push(o.points)}}if(n.length>0){for(const o of n)if(o.type==="points"){const s=de(o.points.otherPoint.y);i[s]||(i[s]=[]),i[s].push(o.points)}}return Object.values(r).concat(Object.values(i)).map(o=>({id:Re(),type:"points",points:Eh(o.map(s=>E.From(s.otherPoint)).concat(o.map(s=>E.From(s.thisPoint))),(s,a)=>s.equals(a))}))}getGapSnapLines({selectionPageBounds:t,nearestSnapsX:n,nearestSnapsY:r}){const{vertical:i,horizontal:o}=this.getVisibleGaps(),s={top:t.sides[0],right:t.sides[1],bottom:[t.corners[3],t.corners[2]],left:[t.corners[0],t.corners[3]]},a=[];if(n.length>0)for(const l of n){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:u,startNode:d,endNode:h,length:p,endEdge:g}}=l;switch(l.type){case"gap_center":{const f=(p-t.width)/2,m=Tr(c[0],c[1],t.minY,t.maxY);a.push({type:"gaps",direction:"horizontal",id:Re(),gaps:[...Ni(o,d.id,f,"backward",m),{startEdge:u,endEdge:s.left},{startEdge:s.right,endEdge:g},...Ni(o,h.id,f,"forward",m)]});break}case"gap_duplicate":{const f=Tr(c[0],c[1],t.minY,t.maxY);a.push({type:"gaps",direction:"horizontal",id:Re(),gaps:l.protrusionDirection==="left"?[{startEdge:s.right,endEdge:u.map(m=>m.clone().addXY(-d.pageBounds.width,0))},{startEdge:u,endEdge:g},...Ni(o,h.id,p,"forward",f)]:[...Ni(o,d.id,p,"backward",f),{startEdge:u,endEdge:g},{startEdge:g.map(m=>m.clone().addXY(l.gap.endNode.pageBounds.width,0)),endEdge:s.left}]});break}}}if(r.length>0)for(const l of r){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:u,startNode:d,endNode:h,length:p,endEdge:g}}=l;switch(l.type){case"gap_center":{const f=(p-t.height)/2,m=Tr(c[0],c[1],t.minX,t.maxX);a.push({type:"gaps",direction:"vertical",id:Re(),gaps:[...Ni(i,d.id,f,"backward",m),{startEdge:u,endEdge:s.top},{startEdge:s.bottom,endEdge:g},...Ni(i,l.gap.endNode.id,f,"forward",m)]});break}case"gap_duplicate":{const f=Tr(c[0],c[1],t.minX,t.maxX);a.push({type:"gaps",direction:"vertical",id:Re(),gaps:l.protrusionDirection==="top"?[{startEdge:s.bottom,endEdge:u.map(m=>m.clone().addXY(0,-d.pageBounds.height))},{startEdge:u,endEdge:g},...Ni(i,h.id,p,"forward",f)]:[...Ni(i,d.id,p,"backward",f),{startEdge:u,endEdge:g},{startEdge:g.map(m=>m.clone().addXY(0,h.pageBounds.height)),endEdge:s.top}]})}break}}return f9(a),a}}Ms([q],jo.prototype,"getSnapPointsCache",1),Ms([q],jo.prototype,"getSnapThreshold",1),Ms([q],jo.prototype,"getSnappableShapes",1),Ms([q],jo.prototype,"getCurrentCommonAncestor",1),Ms([q],jo.prototype,"getSnappablePoints",1),Ms([q],jo.prototype,"getVisibleGaps",1),Ms([q],jo.prototype,"getOutlinesInPageSpace",1);function YC(e,t){const{minX:n,maxX:r,minY:i,maxY:o}=t,s=[];switch(e){case"top":case"left":case"top_left":case"any":s.push({id:"top_left",handle:"top_left",x:n,y:i})}switch(e){case"top":case"right":case"top_right":case"any":s.push({id:"top_right",handle:"top_right",x:r,y:i})}switch(e){case"bottom":case"right":case"bottom_right":case"any":s.push({id:"bottom_right",handle:"bottom_right",x:r,y:o})}switch(e){case"bottom":case"left":case"bottom_left":case"any":s.push({id:"bottom_left",handle:"bottom_left",x:n,y:o})}return s}const g9=/\r?\n|\r/g;function XC(e){return e.replace(g9,`
`).split(`
`).map(t=>t||" ").join(`
`)}const m9={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},y9=/\s/;class v9{constructor(t){v(this,"measureText",(t,n)=>{const r=this.getTextElement();r.setAttribute("dir","ltr"),r.style.setProperty("font-family",n.fontFamily),r.style.setProperty("font-style",n.fontStyle),r.style.setProperty("font-weight",n.fontWeight),r.style.setProperty("font-size",n.fontSize+"px"),r.style.setProperty("line-height",n.lineHeight*n.fontSize+"px"),r.style.setProperty("max-width",n.maxWidth===null?null:n.maxWidth+"px"),r.style.setProperty("min-width",n.minWidth??null),r.style.setProperty("padding",n.padding),r.textContent=XC(t);const i=r.getBoundingClientRect();return{x:0,y:0,w:i.width,h:i.height}});this.editor=t}getTextElement(){var n;(n=document.querySelector(".tl-text-measure"))==null||n.remove();const t=document.createElement("div");return this.editor.getContainer().appendChild(t),t.id=`__textMeasure_${Re()}`,t.classList.add("tl-text"),t.classList.add("tl-text-measure"),t.tabIndex=-1,t}measureElementTextNodeSpans(t,{shouldTruncateToFirstLine:n=!1}={}){const r=[],i=t.getBoundingClientRect(),o=-i.left,s=-i.top,a=new Range,l=t.childNodes[0];let c=0,u=null,d=null,h=0,p=!1;for(const g of t.childNodes)if(g.nodeType===Node.TEXT_NODE)for(const f of g.textContent??""){a.setStart(l,c),a.setEnd(l,c+f.length);const m=a.getClientRects(),w=m[m.length-1],b=w.top+s,k=w.left+o,S=w.right+o,C=y9.test(f);if(C!==d||b!==h||!u){if(u){if(n&&b!==h){p=!0;break}r.push(u)}u={box:{x:k,y:b,w:w.width,h:w.height},text:f}}else u.box.w=S-u.box.x,u.text+=f;d=C,h=b,c+=f.length}return u&&r.push(u),{spans:r,didTruncate:p}}measureTextSpans(t,n){if(t==="")return[];const r=n.overflow==="truncate-ellipsis"||n.overflow==="truncate-clip",i=this.getTextElement(),o=Math.ceil(n.width-n.padding*2);i.style.setProperty("width",`${o}px`),i.style.setProperty("height","min-content"),i.style.setProperty("dir","ltr"),i.style.setProperty("font-size",`${n.fontSize}px`),i.style.setProperty("font-family",n.fontFamily),i.style.setProperty("font-weight",n.fontWeight),i.style.setProperty("line-height",`${n.lineHeight*n.fontSize}px`),i.style.setProperty("text-align",m9[n.textAlign]),r&&(i.style.setProperty("overflow-wrap","anywhere"),i.style.setProperty("word-break","break-all")),t=XC(t),i.textContent=t;const{spans:s,didTruncate:a}=this.measureElementTextNodeSpans(i,{shouldTruncateToFirstLine:r});if(n.overflow==="truncate-ellipsis"&&a){i.textContent="\u2026";const l=Math.ceil(this.measureElementTextNodeSpans(i).spans[0].box.w);i.style.setProperty("width",`${o-l}px`),i.textContent=t;const c=this.measureElementTextNodeSpans(i,{shouldTruncateToFirstLine:!0}).spans,u=c[c.length-1];return c.push({text:"\u2026",box:{x:Math.min(u.box.x+u.box.w,n.width-n.padding-l),y:u.box.y,w:l,h:u.box.h}}),c}return i.remove(),s}}class b9{constructor(t){v(this,"raf");v(this,"isPaused",!0);v(this,"last",0);v(this,"t",0);v(this,"start",()=>{this.isPaused=!1,cancelAnimationFrame(this.raf),this.raf=requestAnimationFrame(this.tick),this.last=Date.now()});v(this,"tick",()=>{if(this.isPaused)return;const t=Date.now(),n=t-this.last;if(this.last=t,this.t+=n,this.editor.emit("frame",n),this.t<16){this.raf=requestAnimationFrame(this.tick);return}this.t-=16,this.updatePointerVelocity(n),this.editor.emit("tick",n),this.raf=requestAnimationFrame(this.tick)});v(this,"dispose",()=>{this.isPaused=!0,cancelAnimationFrame(this.raf)});v(this,"prevPoint",new E);v(this,"updatePointerVelocity",t=>{const{prevPoint:n,editor:{inputs:{currentScreenPoint:r,pointerVelocity:i}}}=this;if(t===0)return;const o=E.Sub(r,n);this.prevPoint=r.clone();const s=o.len(),a=s?o.div(s):new E(0,0),l=i.clone().lrp(a.mul(s/t),.5);Math.abs(l.x)<.01&&(l.x=0),Math.abs(l.y)<.01&&(l.y=0),i.equals(l)||(this.editor.inputs.pointerVelocity=l)});this.editor=t,this.editor.disposables.add(this.dispose),this.start()}}var w9=Object.defineProperty,x9=Object.getOwnPropertyDescriptor,Ri=(e,t,n,r)=>{for(var i=r>1?void 0:r?x9(t,n):t,o=e.length-1,s;o>=0;o--)(s=e[o])&&(i=(r?s(t,n,i):s(i))||i);return r&&i&&w9(t,n,i),i};class ri{constructor(t,n){v(this,"updateUserPreferences",t=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...t})});this.user=t,this.inferDarkMode=n}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),isDarkMode:this.getIsDarkMode(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode()}}getIsDarkMode(){return this.user.userPreferences.get().isDarkMode??(this.inferDarkMode?TR():!1)}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??ur.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??ur.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??ur.name}getLocale(){return this.user.userPreferences.get().locale??ur.locale}getColor(){return this.user.userPreferences.get().color??ur.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??ur.isSnapMode}}Ri([q],ri.prototype,"getUserPreferences",1),Ri([q],ri.prototype,"getIsDarkMode",1),Ri([q],ri.prototype,"getEdgeScrollSpeed",1),Ri([q],ri.prototype,"getAnimationSpeed",1),Ri([q],ri.prototype,"getId",1),Ri([q],ri.prototype,"getName",1),Ri([q],ri.prototype,"getLocale",1),Ri([q],ri.prototype,"getColor",1),Ri([q],ri.prototype,"getIsSnapMode",1);function Qc(e){return Math.abs(e.props.bend)<8}function fp(e,t){if(t.type==="point")return;const n=e.getShape(t.boundShapeId),r=e.getShapePageTransform(n),i=e.getShapeGeometry(n),o=i instanceof Mo?i.children[0].vertices:i.vertices;return{shape:n,transform:r,isClosed:i.isClosed,isExact:t.isExact,didIntersect:!1,outline:o}}function GC(e,t,n,r){if(n.type==="point")return E.From(n);const i=e.getShape(n.boundShapeId);if(i){const{point:o,size:s}=e.getShapeGeometry(i).bounds,a=E.Add(o,E.MulV(n.isPrecise||r?n.normalizedAnchor:{x:.5,y:.5},s)),l=te.applyToPoint(e.getShapePageTransform(i),a);return te.applyToPoint(te.Inverse(t),l)}else return new E(0,0)}function Lr(e,t){const n=e.getShapePageTransform(t);let r,i;t.props.start.type==="binding"&&t.props.end.type==="binding"&&(r=t.props.start.boundShapeId,i=t.props.end.boundShapeId);const o=W0(e,r,i),s=GC(e,n,t.props.start,o==="double-bound"||o==="start-contains-end"),a=GC(e,n,t.props.end,o==="double-bound"||o==="end-contains-start");return{start:s,end:a}}const Ha=10,gp=10,S9=10,Oo={s:2,m:3.5,l:5,xl:10};function W0(e,t,n){if(!t||!n)return"safe";if(t===n)return"double-bound";const r=e.getShapePageBounds(t),i=e.getShapePageBounds(n);if(r&&i){if(r.contains(i))return"start-contains-end";if(i.contains(r))return"end-contains-start"}return"safe"}function Jc(e,t){const{start:n,end:r,arrowheadStart:i,arrowheadEnd:o}=t.props,s=Lr(e,t),a=s.start.clone(),l=s.end.clone(),c=E.Med(a,l);if(E.Equals(a,l))return{isStraight:!0,start:{handle:a,point:a,arrowhead:t.props.arrowheadStart},end:{handle:l,point:l,arrowhead:t.props.arrowheadEnd},middle:c,isValid:!1,length:0};const u=E.Sub(l,a).uni(),d=fp(e,n),h=fp(e,r),p=e.getShapePageTransform(t);qC(l,s.start,p,h),qC(a,s.end,p,d);let g=0,f=0,m=0,w=0,b=Ha;const k=d&&h&&d.shape===h.shape,S=d&&h?W0(e,d.shape.id,h.shape.id):"safe";S==="safe"&&d&&h&&!k&&!d.isExact&&!h.isExact&&(h.didIntersect&&!d.didIntersect?d.isClosed&&a.setTo(l.clone().add(u.clone().mul(Ha))):h.didIntersect||h.isClosed&&l.setTo(a.clone().sub(u.clone().mul(Ha))));const C=E.Sub(l,a).uni(),_=!E.Equals(C,u);k||(S!=="start-contains-end"&&d&&i!=="none"&&!d.isExact&&(m=Oo[t.props.size]/2+("size"in d.shape.props?Oo[d.shape.props.size]/2:0),g=gp+m,b+=m),S!=="end-contains-start"&&h&&o!=="none"&&!h.isExact&&(w=Oo[t.props.size]/2+("size"in h.shape.props?Oo[h.shape.props.size]/2:0),f=gp+w,b+=w));const P=a.clone().add(C.clone().mul(g*(_?-1:1))),I=l.clone().sub(C.clone().mul(f*(_?-1:1)));E.Dist(P,I)<b&&(g!==0&&f!==0?(g*=-1.5,f*=-1.5):g!==0?g*=-1:f!==0&&(f*=-1)),a.add(C.clone().mul(g*(_?-1:1))),l.sub(C.clone().mul(f*(_?-1:1))),_?(d&&h&&l.setTo(E.Add(a,C.clone().mul(-Ha))),c.setTo(E.Med(s.start,s.end))):c.setTo(E.Med(a,l));const M=E.Dist(a,l);return{isStraight:!0,start:{handle:s.start,point:a,arrowhead:t.props.arrowheadStart},end:{handle:s.end,point:l,arrowhead:t.props.arrowheadEnd},middle:c,isValid:M>0,length:M}}function qC(e,t,n,r){if(r===void 0||r.isExact)return;const i=te.applyToPoint(n,t),o=te.applyToPoint(n,e),s=te.applyToPoint(te.Inverse(r.transform),i),a=te.applyToPoint(te.Inverse(r.transform),o),l=r.isClosed,c=(l?$R:AC)(s,a,r.outline);let u;if(c!==null&&(u=c.sort((p,g)=>E.Dist(p,s)-E.Dist(g,s))[0]??(l?void 0:a)),u===void 0)return;const d=te.applyToPoint(r.transform,u),h=te.applyToPoint(te.Inverse(n),d);e.setTo(h),r.didIntersect=!0}function Y0(e,t,n=0){const{arrowheadEnd:r,arrowheadStart:i}=t.props,o=t.props.bend+n;if(Math.abs(o)>Math.abs(t.props.bend*S9))return Jc(e,t);const s=Lr(e,t),a=E.Med(s.start,s.end),l=E.Sub(s.end,s.start).uni(),c=E.Add(a,l.per().mul(-o)),u=fp(e,t.props.start),d=fp(e,t.props.end),h=s.start.clone(),p=s.end.clone(),g=c.clone();if(E.Equals(h,p))return{isStraight:!0,start:{handle:h,point:h,arrowhead:t.props.arrowheadStart},end:{handle:p,point:p,arrowhead:t.props.arrowheadEnd},middle:g,isValid:!1,length:0};const f=t.props.bend<0,m=f?Xh:Vz,w=ZC(h,p,g),b=E.Angle(w.center,h),k=E.Angle(w.center,p),S=m(b,k);if(w.length===0||w.size===0||!A2(w.length)||!A2(w.size))return Jc(e,t);const C=h.clone(),_=p.clone(),P=g.clone(),I=e.getShapePageTransform(t);let M=0,A=0,L=Ha;if(u&&!u.isExact){const D=te.applyToPoint(I,C),B=te.applyToPoint(I,w.center),X=te.applyToPoint(I,_),ie=te.Inverse(u.transform),ue=te.applyToPoint(ie,D),ge=te.applyToPoint(ie,B),ce=te.applyToPoint(ie,X),{isClosed:be}=u,ft=be?TC:jC;let Ie,Ce=ft(ge,w.radius,u.outline);if(Ce){const Me=ge.angle(ue),vr=ge.angle(ce),gn=m(Me,vr);Ce=Ce.filter(gt=>m(Me,ge.angle(gt))<=gn);const Mn=gn*.25;Ce.sort(be?(gt,at)=>Math.abs(m(Me,ge.angle(gt))-Mn)<Math.abs(m(Me,ge.angle(at))-Mn)?-1:1:(gt,at)=>m(Me,ge.angle(gt))<m(Me,ge.angle(at))?-1:1),Ie=Ce[0]??(be?void 0:ue)}else Ie=be?void 0:ue;if(Ie&&(C.setTo(e.getPointInShapeSpace(t,te.applyToPoint(u.transform,Ie))),u.didIntersect=!0,i!=="none")){const Me=Oo[t.props.size]/2+("size"in u.shape.props?Oo[u.shape.props.size]/2:0);M=gp+Me,L+=Me}}if(d&&!d.isExact){const D=te.applyToPoint(I,C),B=te.applyToPoint(I,_),X=te.applyToPoint(I,w.center),ie=te.Inverse(d.transform),ue=te.applyToPoint(ie,D),ge=te.applyToPoint(ie,X),ce=te.applyToPoint(ie,B),be=d.isClosed,ft=be?TC:jC;let Ie,Ce=ft(ge,w.radius,d.outline);if(Ce){const Me=ge.angle(ue),vr=ge.angle(ce),gn=m(Me,vr),Mn=gn*.75;Ce=Ce.filter(gt=>m(Me,ge.angle(gt))<=gn),Ce.sort(be?(gt,at)=>Math.abs(m(Me,ge.angle(gt))-Mn)<Math.abs(m(Me,ge.angle(at))-Mn)?-1:1:(gt,at)=>m(Me,ge.angle(gt))<m(Me,ge.angle(at))?-1:1),Ce[0]?Ie=Ce[0]:Ie=be?void 0:ce}else Ie=be?void 0:ce;if(Ie&&(_.setTo(e.getPointInShapeSpace(t,te.applyToPoint(d.transform,Ie))),d.didIntersect=!0,r!=="none")){const Me=Oo[t.props.size]/2+("size"in d.shape.props?Oo[d.shape.props.size]/2:0);A=gp+Me,L+=Me}}let z=E.Angle(w.center,C),$=E.Angle(w.center,_),j=m(z,$),F=j*w.radius;const R=C.clone(),W=_.clone();if(M!==0){const D=M/F*(f?1:-1),B=E.FromAngle(z+j*D);R.setTo(w.center).add(B.mul(w.radius))}if(A!==0){const D=A/F*(f?-1:1),B=E.FromAngle($+j*D);W.setTo(w.center).add(B.mul(w.radius))}if(E.Dist(R,W)<L&&(M!==0&&A!==0?(M*=-1.5,A*=-1.5):M!==0?M*=-2:A!==0&&(A*=-2)),M!==0){const D=M/F*(f?1:-1),B=E.FromAngle(z+j*D);C.setTo(w.center).add(B.mul(w.radius))}if(A!==0){const D=A/F*(f?-1:1),B=E.FromAngle($+j*D);_.setTo(w.center).add(B.mul(w.radius))}if(u&&d&&!u.isExact&&!d.isExact){z=E.Angle(w.center,C),$=E.Angle(w.center,_),j=m(z,$),F=j*w.radius;const D=W0(e,u.shape.id,d.shape.id);if(D==="double-bound"&&F<30)C.setTo(h),_.setTo(p),P.setTo(g);else if(D==="safe"&&(u&&!u.didIntersect&&C.setTo(h),d&&!d.didIntersect||m(b,z)>m(b,$))){const B=Math.min(.9,Ha/F)*(f?1:-1),X=E.FromAngle(z+j*B);_.setTo(w.center).add(X.mul(w.radius))}}k9(w.center,w.radius,C,_,P,S,f),C.equals(_)&&(C.setTo(P.clone().addXY(1,1)),_.setTo(P.clone().subXY(1,1))),h.setTo(C),p.setTo(_),g.setTo(P);const V=ZC(h,p,g);return{isStraight:!1,start:{point:h,handle:s.start,arrowhead:t.props.arrowheadStart},end:{point:p,handle:s.end,arrowhead:t.props.arrowheadEnd},middle:g,handleArc:w,bodyArc:V,isValid:V.length!==0&&isFinite(V.center.x)&&isFinite(V.center.y)}}function ZC(e,t,n){const r=-2*(e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y),i={x:((e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y))/r,y:((e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x))/r},o=E.Dist(i,e),s=+E.Clockwise(e,n,t),a=Math.hypot(e.y-t.y,e.x-t.x),l=Math.hypot(t.y-n.y,t.x-n.x),c=Math.hypot(n.y-e.y,n.x-e.x),u=Math.acos((l*l+c*c-a*a)/(2*l*c))*2,d=+(Te>u),h=(De-u)*(s?1:-1),p=h*o;return{center:i,radius:o,size:h,length:p,largeArcFlag:d,sweepFlag:s}}function k9(e,t,n,r,i,o,s){const a=E.Angle(e,n),l=E.Angle(e,r);let c=Xh(a,l);s||(c=De-c);const u=.5*(s?1:-1),d=E.FromAngle(a+c*u);if(i.setTo(e).add(d.mul(t)),c>o){i.rotWith(e,Te);const h=r.clone();r.setTo(n),n.setTo(h)}}const _9={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick"};class ne{constructor(t,n){v(this,"id");v(this,"type");v(this,"shapeType");v(this,"initial");v(this,"children");v(this,"parent");v(this,"_path");v(this,"_current");v(this,"_isActive");v(this,"transition",(t,n={})=>{var o;const r=t.split(".");let i=this;for(let s=0;s<r.length;s++){const a=r[s],l=i.getCurrent(),c=(o=i.children)==null?void 0:o[a];if(!c)throw Error(`${i.id} - no child state exists with the id ${a}.`);if((l==null?void 0:l.id)!==c.id&&(l==null||l.exit(n,a),i._current.set(c),c.enter(n,(l==null?void 0:l.id)||"initial"),!c.getIsActive()))break;i=c}return this});v(this,"handleEvent",t=>{var i;const n=_9[t.name],r=this.getCurrent();(i=this[n])==null||i.call(this,t),this.getCurrent()===r&&this.getIsActive()&&(r==null||r.handleEvent(t))});v(this,"enter",(t,n)=>{var r;if(this._isActive.set(!0),(r=this.onEnter)==null||r.call(this,t,n),this.onTick&&this.editor.on("tick",this.onTick),this.children&&this.initial&&this.getIsActive()){const i=this.children[this.initial];this._current.set(i),i.enter(t,n)}});v(this,"exit",(t,n)=>{var r,i;this._isActive.set(!1),this.onTick&&this.editor.off("tick",this.onTick),(r=this.onExit)==null||r.call(this,t,n),this.getIsActive()||((i=this.getCurrent())==null||i.exit(t,n))});v(this,"_currentToolIdMask",ln("curent tool id mask",void 0));v(this,"onWheel");v(this,"onPointerDown");v(this,"onPointerMove");v(this,"onPointerUp");v(this,"onDoubleClick");v(this,"onTripleClick");v(this,"onQuadrupleClick");v(this,"onRightClick");v(this,"onMiddleClick");v(this,"onKeyDown");v(this,"onKeyUp");v(this,"onKeyRepeat");v(this,"onCancel");v(this,"onComplete");v(this,"onInterrupt");v(this,"onEnter");v(this,"onExit");v(this,"onTick");this.editor=t;const{id:r,children:i,initial:o}=this.constructor;this.id=r,this._isActive=ln("toolIsActive"+this.id,!1),this._current=ln("toolState"+this.id,void 0),this._path=q("toolPath"+this.id,()=>{const s=this.getCurrent();return this.id+(s?`.${s.getPath()}`:"")}),this.parent=n??{},this.parent?i&&o?(this.type="branch",this.initial=o,this.children=Object.fromEntries(i().map(s=>[s.id,new s(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",i&&o&&(this.initial=o,this.children=Object.fromEntries(i().map(s=>[s.id,new s(this.editor,this)])),this._current.set(this.children[this.initial])))}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(t){this._currentToolIdMask.set(t)}}v(ne,"id"),v(ne,"initial"),v(ne,"children");class mp extends ne{constructor(){super(...arguments);v(this,"onKeyDown",n=>{var r;switch(n.code){case"KeyZ":{if(!(n.shiftKey||n.ctrlKey)){const i=this.getCurrent();i&&((r=i.getCurrent())==null?void 0:r.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...n,onInteractionEnd:i.id})}break}}})}}v(mp,"id","root"),v(mp,"initial",""),v(mp,"children",()=>[]);var C9=Object.defineProperty,E9=Object.getOwnPropertyDescriptor,le=(e,t,n,r)=>{for(var i=r>1?void 0:r?E9(t,n):t,o=e.length-1,s;o>=0;o--)(s=e[o])&&(i=(r?s(t,n,i):s(i))||i);return r&&i&&C9(t,n,i),i};class ae extends FR.EventEmitter{constructor({store:n,user:r,shapeUtils:i,tools:o,getContainer:s,initialState:a,inferDarkMode:l}){super();v(this,"store");v(this,"root");v(this,"disposables",new Set);v(this,"_tickManager",new b9(this));v(this,"snaps");v(this,"user");v(this,"textMeasure");v(this,"environment");v(this,"scribbles");v(this,"getContainer");v(this,"sideEffects");v(this,"shapeUtils");v(this,"styleProps");v(this,"history",new c9(this,n=>{this.annotateError(n,{origin:"history.batch",willCrashApp:!0}),this.crash(n)}));v(this,"_crashingError",null);v(this,"_updateInstanceState",this.history.createCommand("updateInstanceState",(n,r)=>{const i=this.store.get(this.getInstanceState().id),o={...i,...n};return{data:{prev:i,next:o},ephemeral:!1,squashing:!1,...r}},{do:({next:n})=>{this.store.put([n])},undo:({prev:n})=>{this.store.put([n])},squash({prev:n},{next:r}){return{prev:n,next:r}}}));v(this,"_isChangingStyleTimeout",-1);v(this,"setCursor",n=>(this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...n}},{ephemeral:!0}),this));v(this,"_setInstancePageState",this.history.createCommand("setInstancePageState",(n,r)=>({data:{prev:this.store.get(n.id??this.getCurrentPageState().id),partial:n},...r}),{do:({prev:n,partial:r})=>{this.store.update(n.id,i=>({...i,...r}))},undo:({prev:n})=>{this.store.update(n.id,()=>n)}}));v(this,"_setSelectedShapes",this.history.createCommand("setSelectedShapes",(n,r)=>{const{selectedShapeIds:i}=this.getCurrentPageState(),o=new Set(i);return n.length===o.size&&n.every(s=>o.has(s))?null:{data:{selectedShapeIds:n,prevSelectedShapeIds:i},preservesRedoStack:!0,...r}},{do:({selectedShapeIds:n})=>{this.store.put([{...this.getCurrentPageState(),selectedShapeIds:n}])},undo:({prevSelectedShapeIds:n})=>{this.store.put([{...this.getCurrentPageState(),selectedShapeIds:n}])},squash({prevSelectedShapeIds:n},{selectedShapeIds:r}){return{selectedShapeIds:r,prevSelectedShapeIds:n}}}));v(this,"_setFocusedGroupId",this.history.createCommand("setFocusedGroupId",n=>{const r=this.getCurrentPageState().focusedGroupId;if(r!==n)return{data:{prev:r,next:n},preservesRedoStack:!0,squashing:!0}},{do:({next:n})=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:n}))},undo:({prev:n})=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:n}))},squash({prev:n},{next:r}){return{prev:n,next:r}}}));v(this,"_viewportAnimation",null);v(this,"_willSetInitialBounds",!0);v(this,"_cameraState",ln("camera state","idle"));v(this,"_cameraStateTimeoutRemaining",0);v(this,"_lastUpdateRenderingBoundsTimestamp",Date.now());v(this,"_decayCameraStateTimeout",n=>{this._cameraStateTimeoutRemaining-=n,this._cameraStateTimeoutRemaining<=0&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"),this.updateRenderingBounds())});v(this,"_tickCameraState",()=>{this._cameraStateTimeoutRemaining=lN;const n=Date.now();this._cameraState.__unsafe__getWithoutCapture()==="idle"?(this._lastUpdateRenderingBoundsTimestamp=n,this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout)):n-this._lastUpdateRenderingBoundsTimestamp>cN&&this.updateRenderingBounds()});v(this,"_renderingBounds",ln("rendering viewport",new se));v(this,"_renderingBoundsExpanded",ln("rendering viewport expanded",new se));v(this,"renderingBoundsMargin",100);v(this,"_currentPageShapeIds");v(this,"_setCurrentPageId",this.history.createCommand("setCurrentPage",(n,r)=>{if(!this.store.has(n)){console.error("Tried to set the current page id to a page that doesn't exist.");return}return this.stopFollowingUser(),{data:{toId:n,fromId:this.getCurrentPageId()},squashing:!0,preservesRedoStack:!0,...r}},{do:({toId:n})=>{if(this.store.has(n)){if(!this.getPageStates().find(r=>r.pageId===n)){const r=Kt.create({id:Kt.createId(n)});this.store.put([r,Wt.create({id:Wt.createId(n),pageId:n})])}this.store.put([{...this.getInstanceState(),currentPageId:n}]),this.updateRenderingBounds()}},undo:({fromId:n})=>{this.store.has(n)&&(this.store.put([{...this.getInstanceState(),currentPageId:n}]),this.updateRenderingBounds())},squash:({fromId:n},{toId:r})=>({toId:r,fromId:n})}));v(this,"_updatePage",this.history.createCommand("updatePage",(n,r)=>{if(this.getInstanceState().isReadonly)return null;const i=this.getPage(n.id);return i?{data:{prev:i,partial:n},...r}:null},{do:({partial:n})=>{this.store.update(n.id,r=>({...r,...n}))},undo:({prev:n,partial:r})=>{this.store.update(r.id,()=>n)},squash(n,r){return{prev:{...n.prev,...r.prev},partial:r.partial}}}));v(this,"_createPage",this.history.createCommand("createPage",n=>{if(this.getInstanceState().isReadonly||this.getPages().length>=Qh)return null;const r=this.getPages(),i=XR(n.name??"Page 1",r.map(c=>c.name));let o=n.index;(!o||r.some(c=>c.index===o))&&(o=zi(r[r.length-1].index));const s=ji.create({meta:{},...n,name:i,index:o}),a=Kt.create({id:Kt.createId(s.id)}),l=Wt.create({id:Wt.createId(s.id),pageId:s.id});return{data:{newPage:s,newTabPageState:l,newCamera:a}}},{do:({newPage:n,newTabPageState:r,newCamera:i})=>{this.store.put([n,i,r])},undo:({newPage:n,newTabPageState:r,newCamera:i})=>{this.getPages().length!==1&&this.store.remove([r.id,n.id,i.id])}}));v(this,"_deletePage",this.history.createCommand("delete_page",n=>{if(this.getInstanceState().isReadonly)return null;const r=this.getPages();if(r.length===1)return null;const i=this.getPage(n),o=this.getPageStates().filter(s=>s.pageId===n);if(!i)return null;if(n===this.getCurrentPageId()){const s=r.findIndex(l=>l.id===n),a=r[s-1]??r[s+1];this.setCurrentPage(a.id)}return{data:{id:n,deletedPage:i,deletedPageStates:o}}},{do:({deletedPage:n,deletedPageStates:r})=>{const i=this.getPages();if(i.length!==1){if(n.id===this.getCurrentPageId()){const o=i.findIndex(a=>a.id===n.id),s=i[o-1]??i[o+1];this.setCurrentPage(s.id)}this.store.remove(r.map(o=>o.id)),this.store.remove([n.id]),this.updateRenderingBounds()}},undo:({deletedPage:n,deletedPageStates:r})=>{this.store.put([n]),this.store.put(r),this.updateRenderingBounds()}}));v(this,"_createAssets",this.history.createCommand("createAssets",n=>this.getInstanceState().isReadonly||n.length<=0?null:{data:{assets:n}},{do:({assets:n})=>{this.store.put(n)},undo:({assets:n})=>{this.store.remove(n.map(r=>r.id))}}));v(this,"_updateAssets",this.history.createCommand("updateAssets",n=>this.getInstanceState().isReadonly||n.length<=0?void 0:{data:{snapshots:{},assets:n}},{do:({assets:n,snapshots:r})=>{this.store.put(n.map(i=>{const o=this.store.get(i.id);return r[i.id]=o,{...o,...i}}))},undo:({snapshots:n})=>{this.store.put(Object.values(n))}}));v(this,"_deleteAssets",this.history.createCommand("deleteAssets",n=>{if(this.getInstanceState().isReadonly||n.length<=0)return;const r=he(n.map(i=>this.store.get(i)));return{data:{ids:n,prev:r}}},{do:({ids:n})=>{this.store.remove(n)},undo:({prev:n})=>{this.store.put(n)}}));v(this,"_parentIdsToChildIds");v(this,"_childIdsCache",new V0);v(this,"_createShapes",this.history.createCommand("createShapes",n=>{if(this.getInstanceState().isReadonly||n.length<=0)return null;const r=this.getCurrentPageShapeIds();if(n.length+r.size>Li){yp(this);return}return n.length===0?null:{data:{currentPageId:this.getCurrentPageId(),partials:n.map(i=>i.id?i:{...i,id:Ve()})}}},{do:({partials:n})=>{var a,l;const r=this.getFocusedGroupId(),i=this.getCurrentPageShapesSorted();n=n.map(c=>{if(!c.parentId||!(this.store.has(c.parentId)||n.some(u=>u.id===c.parentId))){let u=this.getFocusedGroupId();for(let h=i.length-1;h>=0;h--){const p=i[h];if(this.getShapeUtil(p).canReceiveNewChildrenOfType(p,c.type)&&this.isPointInShape(p,{x:c.x??0,y:c.y??0},{margin:0,hitInside:!0})){u=p.id;break}}const d=c.parentId;if(u===c.id&&(u=r),u!==d&&(c={...c},c.parentId=u,ar(u))){const h=this.getPointInShapeSpace(this.getShape(u),{x:c.x??0,y:c.y??0});c.x=h.x,c.y=h.y,c.rotation=-this.getShapePageTransform(u).rotation()+(c.rotation??0)}}return c});const o=new Map,s=[];for(const c of n){const u=this.getShapeUtil(c);let d=c.index;if(!d){const f=c.parentId??r;o.has(f)||o.set(f,this.getHighestIndexForParent(f)),d=o.get(f),o.set(f,zi(d))}const h=u.getDefaultProps();for(const[f,m]of this.styleProps[c.type])h[m]=this.getStyleForNextShape(f);let p=this.store.schema.types.shape.create({...c,index:d,opacity:c.opacity??this.getInstanceState().opacityForNextShape,parentId:c.parentId??r,props:"props"in c?{...h,...c.props}:h});if(p.index===void 0)throw Error("no index!");const g=(l=(a=this.getShapeUtil(p)).onBeforeCreate)==null?void 0:l.call(a,p);g&&(p=g),s.push(p)}s.forEach(c=>{c.meta={...this.getInitialMetaForShape(c),...c.meta}}),this.store.put(s)},undo:({partials:n})=>{this.store.remove(n.map(r=>r.id))}}));v(this,"animatingShapes",new Map);v(this,"_updateShapes",this.history.createCommand("updateShapes",(n,r)=>{if(this.getInstanceState().isReadonly)return null;const i=he(n),o=Object.fromEntries(he(i.map(({id:l})=>this.getShape(l))).map(l=>[l.id,l]));if(i.length<=0)return null;const s=he(i.map(l=>{const c=o[l.id];if(!c)return null;let u=null;for(const[d,h]of Object.entries(l))if(h!==void 0)switch(d){case"id":case"type":continue;default:if(h!==c[d])if(u||(u={...c}),d==="props"){const p={...c.props};for(const[g,f]of Object.entries(h))f!==void 0&&(p[g]=f);u.props=p}else if(d==="meta"){const p={...c.meta};for(const[g,f]of Object.entries(h))f!==void 0&&(p[g]=f);u.meta=p}else u[d]=h}return u??c})),a=Object.fromEntries(s.map(l=>[l.id,l]));return{data:{snapshots:o,updates:a},...r}},{do:({updates:n})=>{var i,o;const r=Object.values(n);for(let s=0;s<r.length;s++){const a=r[s],l=this.store.get(a.id);if(!l)continue;const c=(o=(i=this.getShapeUtil(a)).onBeforeUpdate)==null?void 0:o.call(i,l,a);c&&(r[s]=c)}this.store.put(r)},undo:({snapshots:n})=>{this.store.put(Object.values(n))},squash(n,r){return{snapshots:{...r.snapshots,...n.snapshots},updates:{...n.updates,...r.updates}}}}));v(this,"_deleteShapes",this.history.createCommand("delete_shapes",n=>{if(this.getInstanceState().isReadonly||n.length===0)return null;const r=[...this.getCurrentPageState().selectedShapeIds],i=new Set(n);for(const c of n)this.visitDescendants(c,u=>{i.add(u)});const o=[...i],s=this._getArrowBindingsIndex().get(),a=he(o.flatMap(c=>{const u=this.getShape(c),d=s[c];return d&&d.length>0?d.map(({arrowId:h})=>this.getShape(h)).concat(u):u})),l=r.filter(c=>!i.has(c));return{data:{deletedIds:o,snapshots:a,prevSelectedShapeIds:r,postSelectedShapeIds:l}}},{do:({deletedIds:n,postSelectedShapeIds:r})=>{this.store.remove(n),this.store.update(this.getCurrentPageState().id,i=>({...i,selectedShapeIds:r}))},undo:({snapshots:n,prevSelectedShapeIds:r})=>{this.store.put(n),this.store.update(this.getCurrentPageState().id,i=>({...i,selectedShapeIds:r}))}}));v(this,"_selectionSharedStyles",q("_selectionSharedStyles",()=>{const n=this.getSelectedShapes(),r=new U0;for(const i of n)this._extractSharedStyles(i,r);return r}));v(this,"externalAssetContentHandlers",{file:null,url:null});v(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null});v(this,"inputs",{originPagePoint:new E,originScreenPoint:new E,previousPagePoint:new E,previousScreenPoint:new E,currentPagePoint:new E,currentScreenPoint:new E,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new E});v(this,"_clickManager",new s9(this));v(this,"_prevCursor","default");v(this,"_shiftKeyTimeout",-1);v(this,"_setShiftKeyTimeout",()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})});v(this,"_altKeyTimeout",-1);v(this,"_setAltKeyTimeout",()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})});v(this,"_ctrlKeyTimeout",-1);v(this,"_setCtrlKeyTimeout",()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})});v(this,"_restoreToolId","select");v(this,"_pinchStart",1);v(this,"_didPinch",!1);v(this,"_selectedShapeIdsAtPointerDown",[]);v(this,"capturedPointerId",null);v(this,"dispatch",n=>{if(this.getCrashingError())return this;const{inputs:r}=this,{type:i}=n;return this.batch(()=>{if(n.type==="misc"){(n.name==="cancel"||n.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}))),this.root.handleEvent(n);return}n.shiftKey?(clearInterval(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,r.shiftKey=!0):!n.shiftKey&&r.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=setTimeout(this._setShiftKeyTimeout,150)),n.altKey?(clearInterval(this._altKeyTimeout),this._altKeyTimeout=-1,r.altKey=!0):!n.altKey&&r.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=setTimeout(this._setAltKeyTimeout,150)),n.ctrlKey?(clearInterval(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,r.ctrlKey=!0):!n.ctrlKey&&r.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=setTimeout(this._setCtrlKeyTimeout,150));const{originPagePoint:o,originScreenPoint:s,currentPagePoint:a,currentScreenPoint:l}=r;switch(r.isPointing||(r.isDragging=!1),i){case"pinch":{if(!this.getInstanceState().canMoveCamera)return;switch(this._updateInputsFromEvent(n),n.name){case"pinch_start":{if(r.isPinching)return;r.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds()),this._didPinch=!0,r.isPinching=!0,this.interrupt());return}case"pinch":{if(!r.isPinching)return;const{point:{x:c,y:u,z:d=1},delta:{x:h,y:p}}=n,{x:g,y:f,z:m}=this.getCamera(),w=Math.min(Io,Math.max(Uc,d));this.setCamera({x:g+h/m-c/m+c/w,y:f+p/m-u/m+u/w,z:w});return}case"pinch_end":{if(!r.isPinching)return this;r.isPinching=!1;const{_selectedShapeIdsAtPointerDown:c}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown,{squashing:!0}),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,requestAnimationFrame(()=>{this._didPinch||this.setSelectedShapes(c,{squashing:!0})}));return}}}case"wheel":{if(!this.getInstanceState().canMoveCamera)return;if(this._updateInputsFromEvent(n),!this.getIsMenuOpen()){if(r.ctrlKey){const{x:c,y:u}=this.inputs.currentScreenPoint,{x:d,y:h,z:p}=this.getCamera(),g=Math.min(Io,Math.max(Uc,p+(n.delta.z??0)*p));this.setCamera({x:d+(c/g-c)-(c/p-c),y:h+(u/g-u)-(u/p-u),z:g});return}this.pan(n.delta),!r.isDragging&&r.isPointing&&o.dist(a)>(this.getInstanceState().isCoarsePointer?C0:Vc)/this.getZoomLevel()&&(r.isDragging=!0)}break}case"pointer":{if(r.isPinching)return;this._updateInputsFromEvent(n);const{isPen:c}=n;switch(n.name){case"pointer_down":{if(this.clearOpenMenus(),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),n.button===0&&(this.capturedPointerId=n.pointerId),r.buttons.add(n.button),r.isPointing=!0,r.isDragging=!1,this.getInstanceState().isPenMode){if(!c)return}else c&&this.updateInstanceState({isPenMode:!0});if(n.button===5?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):n.button===1&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0),this.inputs.isPanning)return this.stopCameraAnimation(),this.updateInstanceState({cursor:{type:"grabbing",rotation:0}}),this;s.setTo(l),o.setTo(a);break}case"pointer_move":{if(!c&&this.getInstanceState().isPenMode)return;if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:u,previousScreenPoint:d}=this.inputs;this.pan(E.Sub(u,d));return}!r.isDragging&&r.isPointing&&o.dist(a)>(this.getInstanceState().isCoarsePointer?C0:Vc)/this.getZoomLevel()&&(r.isDragging=!0);break}case"pointer_up":{if(r.buttons.delete(n.button),r.isPointing=!1,r.isDragging=!1,this.getIsMenuOpen()||!c&&this.getInstanceState().isPenMode)return;this.capturedPointerId===n.pointerId&&(this.capturedPointerId=null,n.button=0),r.isPanning?n.button===1?this.inputs.keys.has(" ")?(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:ep}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):(r.isPanning=!1,this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:ep}),this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}})):n.button===0&&(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:ep}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):n.button===5&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(n.key==="ShiftRight"&&(n.key="ShiftLeft"),n.key==="AltRight"&&(n.key="AltLeft"),n.code==="ControlRight"&&(n.code="ControlLeft"),n.name){case"key_down":{r.keys.add(n.code),!n.ctrlKey&&n.code==="Space"&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,this.updateInstanceState({cursor:{type:this.inputs.isPointing?"grabbing":"grab",rotation:0}}));break}case"key_up":{r.keys.delete(n.code),n.code==="Space"&&!this.inputs.buttons.has(1)&&(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}));break}}break}}if(n.type==="pointer"&&(n.button===1?n.name="middle_click":n.button===2&&(n.name="right_click"),n.isPen===this.getInstanceState().isPenMode))switch(n.name){case"pointer_down":{const c=this._clickManager.transformPointerDownEvent(n);if(n.name!==c.name){this.root.handleEvent(n),this.emit("event",n),this.root.handleEvent(c),this.emit("event",c);return}break}case"pointer_up":{const c=this._clickManager.transformPointerUpEvent(n);if(n.name!==c.name){this.root.handleEvent(n),this.emit("event",n),this.root.handleEvent(c),this.emit("event",c);return}break}case"pointer_move":{this._clickManager.handleMove();break}}this.root.handleEvent(n),this.emit("event",n)}),this});this.store=n,this.snaps=new jo(this),this.user=new ri(r??IC(),l??!1),this.getContainer=s??(()=>document.body),this.textMeasure=new v9(this);class c extends mp{}v(c,"initial",a??""),this.root=new c(this),this.root.children={};const u=zC(i),d=new Set(Object.keys(n.schema.types.shape.migrations.subTypeMigrations));for(const S of u){if(!d.has(S.type))throw Error(`Editor and store have different shapes: "${S.type}" was passed into the editor but not the schema`);d.delete(S.type)}if(d.size>0)throw Error(`Editor and store have different shapes: "${[...d][0]}" is present in the store schema but not provided to the editor`);const h={},p={},g=new Map;for(const S of u){const C=new S(this);h[S.type]=C;const _=p2(S.props??{});p[S.type]=_;for(const P of _.keys())if(!g.has(P.id))g.set(P.id,P);else if(g.get(P.id)!==P)throw Error(`Multiple style props with id "${P.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=h,this.styleProps=p;for(const S of[...o]){if(Mh(this.root.children,S.id))throw Error(`Can't override tool with id "${S.id}"`);this.root.children[S.id]=new S(this,this.root)}this.environment=new a9(this),this.scribbles=new u9(this);const f=new Set,m=S=>{var V;const C=this.getShape(S);if(!C)return;const{start:_,end:P}=C.props,I=_.type==="binding"?this.getShape(_.boundShapeId):void 0,M=P.type==="binding"?this.getShape(P.boundShapeId):void 0,A=this.getAncestorPageId(C);if(!A)return;let L;if(I&&M)L=this.findCommonAncestor([I,M])??A;else if(I||M){const D=(V=I||M)==null?void 0:V.parentId;D&&D===C.parentId?L=C.parentId:L=A}else return;L&&L!==C.parentId&&this.reparentShapes([S],L);const z=this.getShape(S);if(!z)throw Error("no reparented arrow");const $=this.getShapeNearestSibling(z,I),j=this.getShapeNearestSibling(z,M);let F;if($&&j)F=$.index>j.index?$:j;else if($&&!j)F=$;else if(j&&!$)F=j;else return;let R;const W=this.getSortedChildIdsForParent(F.parentId).map(D=>this.getShape(D)).filter(D=>D.index>F.index);if(W.length){const D=W.find(B=>B.type!=="arrow");if(z.index>F.index&&(!D||z.index<D.index))return;R=Zc(F.index,W[0].index)}else R=zi(F.index);R!==z.index&&this.updateShapes([{id:S,type:"arrow",index:R}])},w=(S,C)=>{const{x:_,y:P}=Lr(this,S)[C];this.store.put([{...S,props:{...S.props,[C]:{type:"point",x:_,y:P}}}])},b=S=>{for(const C of["start","end"]){const _=S.props[C];if(_.type!=="binding")continue;const P=this.getShape(_.boundShapeId),I=this.getAncestorPageId(S)===this.getAncestorPageId(P);(!P||!I)&&w(S,C)}m(S.id)},k=(S,C)=>{let _=null;const P=S.selectedShapeIds.filter(A=>!C.has(A));P.length!==S.selectedShapeIds.length&&(_||(_={...S}),_.selectedShapeIds=P);const I=S.erasingShapeIds.filter(A=>!C.has(A));I.length!==S.erasingShapeIds.length&&(_||(_={...S}),_.erasingShapeIds=I),S.hoveredShapeId&&C.has(S.hoveredShapeId)&&(_||(_={...S}),_.hoveredShapeId=null),S.editingShapeId&&C.has(S.editingShapeId)&&(_||(_={...S}),_.editingShapeId=null);const M=S.hintingShapeIds.filter(A=>!C.has(A));return M.length!==S.hintingShapeIds.length&&(_||(_={...S}),_.hintingShapeIds=M),S.focusedGroupId&&C.has(S.focusedGroupId)&&(_||(_={...S}),_.focusedGroupId=null),_};if(this.sideEffects=new d9(this),this.sideEffects.registerBatchCompleteHandler(()=>{var S,C;for(const _ of f){f.delete(_);const P=this.getShape(_);if(!P)continue;const I=(C=(S=this.getShapeUtil(P)).onChildrenChange)==null?void 0:C.call(S,P);I!=null&&I.length&&this.updateShapes(I,{squashing:!0})}this.emit("update")}),this.sideEffects.registerBeforeDeleteHandler("shape",S=>{S.parentId&&ar(S.parentId)&&f.add(S.parentId);const C=this._getArrowBindingsIndex().get()[S.id];if(C!=null&&C.length)for(const{arrowId:I,handleId:M}of C){const A=this.getShape(I);A&&w(A,M)}const _=new Set([S.id]),P=he(this.getPageStates().map(I=>k(I,_)));P.length&&this.store.put(P)}),this.sideEffects.registerBeforeDeleteHandler("page",S=>{var I;if(this.getInstanceState().currentPageId!==S.id)return;const C=(I=this.getPages().find(M=>M.id!==S.id))==null?void 0:I.id;if(!C)return;this.store.put([{...this.getInstanceState(),currentPageId:C}]);const _=Kt.createId(S.id),P=Wt.createId(S.id);this.store.remove([_,P])}),this.sideEffects.registerAfterChangeHandler("shape",(S,C)=>{if(this.isShapeOfType(C,"arrow")&&b(C),S.parentId!==C.parentId){const _=P=>{const I=this._getArrowBindingsIndex().get()[P];if(I!=null&&I.length)for(const M of I)m(M.arrowId)};_(C.id),this.visitDescendants(C.id,_)}if(S.parentId!==C.parentId&&_n(C.parentId)){const _=new Set([S.id]);this.visitDescendants(S.id,P=>{_.add(P)});for(const P of this.getPageStates()){if(P.pageId===C.parentId)continue;const I=k(P,_);I&&this.store.put([I])}}S.parentId&&ar(S.parentId)&&f.add(S.parentId),C.parentId!==S.parentId&&ar(C.parentId)&&f.add(C.parentId)}),this.sideEffects.registerAfterChangeHandler("instance_page_state",(S,C)=>{if((S==null?void 0:S.selectedShapeIds)!==(C==null?void 0:C.selectedShapeIds)){const _=C.selectedShapeIds.filter(I=>{var A,L;let M=(A=this.getShape(I))==null?void 0:A.parentId;for(;ar(M);){if(C.selectedShapeIds.includes(M))return!1;M=(L=this.getShape(M))==null?void 0:L.parentId}return!0});let P=null;if(_.length>0){const I=this.findCommonAncestor(he(_.map(M=>this.getShape(M))),M=>this.isShapeOfType(M,"group"));I&&(P=I)}else C!=null&&C.focusedGroupId&&(P=C.focusedGroupId);(_.length!==C.selectedShapeIds.length||P!==C.focusedGroupId)&&this.store.put([{...C,selectedShapeIds:_,focusedGroupId:P??null}])}}),this.sideEffects.registerAfterCreateHandler("shape",S=>{this.isShapeOfType(S,"arrow")&&b(S)}),this.sideEffects.registerAfterCreateHandler("page",S=>{const C=Kt.createId(S.id),_=Wt.createId(S.id);this.store.has(C)||this.store.put([Kt.create({id:C})]),this.store.has(_)||this.store.put([Wt.create({id:_,pageId:S.id})])}),this._currentPageShapeIds=i9(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=r9(this.store),this.disposables.add(this.store.listen(S=>{this.emit("change",S)})),this.store.ensureStoreIsUsable(),this._setInstancePageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]},{ephemeral:!0}),a&&this.root.children[a]===void 0)throw Error(`No state found for initialState "${a}".`);this.root.enter(void 0,"initial"),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.updateRenderingBounds(),requestAnimationFrame(()=>{this._tickManager.start()})}dispose(){this.disposables.forEach(n=>n()),this.disposables.clear()}getShapeUtil(n){const r=typeof n=="string"?n:n.type,i=ws(this.shapeUtils,r);return bs(i,`No shape util found for type "${r}"`),i}undo(){return this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this.history.redo(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(n,r,i){return this.history.mark(n,r,i),this}bail(){return this.history.bail(),this}bailToMark(n){return this.history.bailToMark(n),this}batch(n){return this.history.batch(n),this}_getArrowBindingsIndex(){return n9(this)}getArrowsBoundTo(n){return this._getArrowBindingsIndex().get()[n]||Ii}getArrowInfoCache(){return this.store.createComputedCache("arrow infoCache",n=>Qc(n)?Jc(this,n):Y0(this,n))}getArrowInfo(n){const r=typeof n=="string"?n:n.id;return this.getArrowInfoCache().get(r)}annotateError(n,{origin:r,willCrashApp:i,tags:o,extras:s}){const a=this.createErrorAnnotations(r,i);return t0(n,{tags:{...a.tags,...o},extras:{...a.extras,...s}}),i&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(n,r){try{const i=this.getEditingShapeId();return{tags:{origin:n,willCrashApp:r},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:i?this.getShape(i):void 0,inputs:this.inputs}}}catch{return{tags:{origin:n,willCrashApp:r},extras:{}}}}getCrashingError(){return this._crashingError}crash(n){return this._crashingError=n,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:n}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(n){const r=n.split(".").reverse();let i=this.root;for(;r.length>0;){const o=r.pop();if(!o)return!0;const s=i.getCurrent();if((s==null?void 0:s.id)===o){if(r.length===0)return!0;i=s;continue}else return!1}return!1}isInAny(...n){return n.some(r=>this.isIn(r))}setCurrentTool(n,r={}){return this.root.transition(n,r),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const n=this.getCurrentTool();return n?n.getCurrentToolIdMask()??n.id:""}getStateDescendant(n){var o;const r=n.split(".").reverse();let i=this.root;for(;r.length>0;){const s=r.pop();if(!s)return i;const a=(o=i.children)==null?void 0:o[s];if(!a)return;i=a}return i}getDocumentSettings(){return this.store.get(g0)}updateDocumentSettings(n){return this.store.put([{...this.getDocumentSettings(),...n}]),this}getInstanceState(){return this.store.get(un)}updateInstanceState(n,r){return this._updateInstanceState(n,{ephemeral:!0,squashing:!0,...r}),n.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),n.isChangingStyle===!0&&(this._isChangingStyleTimeout=setTimeout(()=>{this.updateInstanceState({isChangingStyle:!1})},2e3))),this}getOpenMenus(){return this.getInstanceState().openMenus}addOpenMenu(n){const r=new Set(this.getOpenMenus());return r.has(n)||(r.add(n),this.updateInstanceState({openMenus:[...r]})),this}deleteOpenMenu(n){const r=new Set(this.getOpenMenus());return r.has(n)&&(r.delete(n),this.updateInstanceState({openMenus:[...r]})),this}clearOpenMenus(){return this.getOpenMenus().length&&this.updateInstanceState({openMenus:[]}),this}getIsMenuOpen(){return this.getOpenMenus().length>0}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return Wt.createId(this.getCurrentPageId())}updateCurrentPageState(n,r){return this._setInstancePageState(n,r),this}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:n}=this.getCurrentPageState();return he(n.map(r=>this.store.get(r)))}setSelectedShapes(n,r){const i=n.map(o=>typeof o=="string"?o:o.id);return this._setSelectedShapes(i,r),this}isAncestorSelected(n){const r=typeof n=="string"?n:(n==null?void 0:n.id)??null,i=this.getShape(r);if(!i)return!1;const o=this.getSelectedShapeIds();return!!this.findShapeAncestor(i,s=>o.includes(s.id))}select(...n){const r=typeof n[0]=="string"?n:n.map(i=>i.id);return this.setSelectedShapes(r),this}deselect(...n){const r=typeof n[0]=="string"?n:n.map(o=>o.id),i=this.getSelectedShapeIds();return i.length>0&&r.length>0&&this.setSelectedShapes(i.filter(o=>!r.includes(o))),this}selectAll(){const n=this.getSortedChildIdsForParent(this.getCurrentPageId());return n.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(n)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShape(){const n=this.getSelectedShapes();return n.length===1?n[0]:null}getSelectionPageBounds(){const n=this.getCurrentPageState().selectedShapeIds;return n.length===0?null:se.Common(he(n.map(r=>this.getShapePageBounds(r))))}getSelectionRotation(){const n=this.getSelectedShapeIds();if(n.length===0)return 0;if(n.length===1)return this.getShapePageTransform(this.getSelectedShapeIds()[0]).rotation();const r=n.map(i=>this.getShapePageTransform(i).rotation());return r.every(i=>Math.abs(i-r[0])<Math.PI/180)?this.getShapePageTransform(n[0]).rotation():0}getSelectionRotatedPageBounds(){const n=this.getSelectedShapeIds();if(n.length===0)return;const r=this.getSelectionRotation();if(r===0)return this.getSelectionPageBounds();if(n.length===1){const o=this.getShapeGeometry(n[0]).bounds.clone(),s=this.getShapePageTransform(n[0]);return o.point=s.applyToPoint(o.point),o}const i=se.FromPoints(this.getSelectedShapeIds().flatMap(o=>{const s=this.getShapePageTransform(o);return s?s.applyToPoints(this.getShapeGeometry(o).vertices):[]}).map(o=>E.Rot(o,-r)));return i.point=i.point.rot(r),i}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const n=this.getFocusedGroupId();return n?this.getShape(n):void 0}setFocusedGroup(n){const r=typeof n=="string"?n:(n==null?void 0:n.id)??null;if(r!==null){const i=this.getShape(r);if(!i)throw Error(`Editor.setFocusedGroup: Shape with id ${r} does not exist`);if(!this.isShapeOfType(i,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${i.type}`)}return r===this.getFocusedGroupId()?this:(this._setFocusedGroupId(r),this)}popFocusedGroupId(){const n=this.getFocusedGroup();if(n){const r=this.findShapeAncestor(n,i=>this.isShapeOfType(i,"group"));this.setFocusedGroup((r==null?void 0:r.id)??null),this.select(n.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const n=this.getEditingShapeId();return n?this.getShape(n):void 0}setEditingShape(n){const r=typeof n=="string"?n:(n==null?void 0:n.id)??null;if(r!==this.getEditingShapeId()){if(r){const i=this.getShape(r);if(i&&this.getShapeUtil(i).canEdit(i))return this._setInstancePageState({editingShapeId:r}),this}this._setInstancePageState({editingShapeId:null})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const n=this.getHoveredShapeId();return n?this.getShape(n):void 0}setHoveredShape(n){const r=typeof n=="string"?n:(n==null?void 0:n.id)??null;return r===this.getHoveredShapeId()?this:(this.updateCurrentPageState({hoveredShapeId:r},{ephemeral:!0}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const n=this.getHintingShapeIds();return he(n.map(r=>this.getShape(r)))}setHintingShapes(n){const r=typeof n[0]=="string"?n:n.map(i=>i.id);return this.updateCurrentPageState({hintingShapeIds:Eh(r)},{ephemeral:!0}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const n=this.getErasingShapeIds();return he(n.map(r=>this.getShape(r)))}setErasingShapes(n){const r=typeof n[0]=="string"?n:n.map(o=>o.id);r.sort();const i=this.getErasingShapeIds();if(r.length===i.length){for(let o=0;o<r.length;o++)if(r[o]!==i[o]){this._setInstancePageState({erasingShapeIds:r},{ephemeral:!0});break}}else this._setInstancePageState({erasingShapeIds:r},{ephemeral:!0});return this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(n){const r=typeof n=="string"?n:(n==null?void 0:n.id)??null;if(r!==this.getCroppingShapeId())if(!r)this.updateCurrentPageState({croppingShapeId:null});else{const i=this.getShape(r),o=this.getShapeUtil(i);i&&o.canCrop(i)&&this.updateCurrentPageState({croppingShapeId:r})}return this}getCameraId(){return Kt.createId(this.getCurrentPageId())}getCamera(){return this.store.get(this.getCameraId())}getZoomLevel(){return this.getCamera().z}_setCamera(n){const r=this.getCamera();return r.x===n.x&&r.y===n.y&&r.z===n.z?this:(this.batch(()=>{this.store.put([{...r,...n}]);const{currentScreenPoint:i}=this.inputs;this.dispatch({type:"pointer",target:"canvas",name:"pointer_move",point:i,pointerId:z2.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.getInstanceState().isPenMode??!1}),this._tickCameraState()}),this)}setCamera(n,r){const i=Number.isFinite(n.x)?n.x:0,o=Number.isFinite(n.y)?n.y:0,s=Number.isFinite(n.z)?n.z:this.getZoomLevel();if(this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),r){const{width:a,height:l}=this.getViewportScreenBounds();return this._animateToViewport(new se(-i,-o,a/s,l/s),r)}else this._setCamera({x:i,y:o,z:s});return this}centerOnPoint(n,r){if(!this.getInstanceState().canMoveCamera)return this;const{width:i,height:o}=this.getViewportPageBounds();return this.setCamera({x:-(n.x-i/2),y:-(n.y-o/2),z:this.getCamera().z},r),this}zoomToContent(){const n=this.getSelectionPageBounds()??this.getCurrentPageBounds();return n&&this.zoomToBounds(n,Math.min(1,this.getZoomLevel()),{duration:220}),this}zoomToFit(n){if(!this.getInstanceState().canMoveCamera)return this;const r=[...this.getCurrentPageShapeIds()];if(r.length<=0)return this;const i=se.Common(he(r.map(o=>this.getShapePageBounds(o))));return this.zoomToBounds(i,void 0,n),this}resetZoom(n=this.getViewportScreenCenter(),r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera(),{x:a,y:l}=n;return this.setCamera({x:i+(a/1-a)-(a/s-a),y:o+(l/1-l)-(l/s-l),z:1},r),this}zoomIn(n=this.getViewportScreenCenter(),r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera();let a=Io;for(let u=1;u<Oa.length;u++){const d=Oa[u-1],h=Oa[u];if(!(h-s<=(h-d)/2)){a=h;break}}const{x:l,y:c}=n;return this.setCamera({x:i+(l/a-l)-(l/s-l),y:o+(c/a-c)-(c/s-c),z:a},r),this}zoomOut(n=this.getViewportScreenCenter(),r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera();let a=Uc;for(let u=Oa.length-1;u>0;u--){const d=Oa[u-1],h=Oa[u];if(!(h-s>=(h-d)/2)){a=d;break}}const{x:l,y:c}=n;return this.setCamera({x:i+(l/a-l)-(l/s-l),y:o+(c/a-c)-(c/s-c),z:a},r),this}zoomToSelection(n){if(!this.getInstanceState().canMoveCamera)return this;const r=this.getSelectionPageBounds();return r?(this.zoomToBounds(r,Math.max(1,this.getZoomLevel()),n),this):this}panZoomIntoView(n,r){if(!this.getInstanceState().canMoveCamera)return this;if(n.length<=0)return this;const i=se.Common(he(n.map(s=>this.getShapePageBounds(s)))),o=this.getViewportPageBounds();if(o.h<i.h||o.w<i.w)return this.zoomToBounds(i,this.getCamera().z,r),this;{const s=this.getViewportPageBounds().clone().expandBy(-32/this.getZoomLevel());let a=0,l=0;s.maxY<i.maxY?l=s.maxY-i.maxY:s.minY>i.minY&&(l=s.minY-i.minY),s.maxX<i.maxX?a=s.maxX-i.maxX:s.minX>i.minX&&(a=s.minX-i.minX);const c=this.getCamera();this.setCamera({x:c.x+a,y:c.y+l,z:c.z},r)}return this}zoomToBounds(n,r,i){if(!this.getInstanceState().canMoveCamera)return this;const o=this.getViewportScreenBounds(),s=Math.min(256,o.width*.28);let a=ti(Math.min((o.width-s)/n.width,(o.height-s)/n.height),Uc,Io);return r!==void 0&&(a=Math.min(r,a)),this.setCamera({x:-n.minX+(o.width-n.width*a)/2/a,y:-n.minY+(o.height-n.height*a)/2/a,z:a},i),this}pan(n,r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera();return this.setCamera({x:i+n.x/s,y:o+n.y/s,z:s},r),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(n){if(!this._viewportAnimation)return;const r=()=>{this.removeListener("tick",this._animateViewport),this.removeListener("stop-camera-animation",r),this._viewportAnimation=null};this.once("stop-camera-animation",r),this._viewportAnimation.elapsed+=n;const{elapsed:i,easing:o,duration:s,start:a,end:l}=this._viewportAnimation;if(i>s){this._setCamera({x:-l.x,y:-l.y,z:this.getViewportScreenBounds().width/l.width}),r();return}const c=s-i,u=o(1-c/s),d=a.minX+(l.minX-a.minX)*u,h=a.minY+(l.minY-a.minY)*u,p=a.maxX+(l.maxX-a.maxX)*u;this._setCamera({x:-d,y:-h,z:this.getViewportScreenBounds().width/(p-d)})}_animateToViewport(n,r={}){const{duration:i=0,easing:o=Xt.easeInOutCubic}=r,s=this.user.getAnimationSpeed(),a=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),i===0||s===0?this._setCamera({x:-n.x,y:-n.y,z:this.getViewportScreenBounds().width/n.width}):(this._viewportAnimation={elapsed:0,duration:i/s,easing:o,start:a.clone(),end:n.clone()},this.addListener("tick",this._animateViewport),this)}slideCamera(n={}){if(!this.getInstanceState().canMoveCamera)return this;if(this.stopCameraAnimation(),this.user.getAnimationSpeed()===0)return this;const{speed:r,friction:i,direction:o,speedThreshold:s=.01}=n;let a=Math.min(r,1);const l=()=>{this.removeListener("tick",c),this.removeListener("stop-camera-animation",l)};this.once("stop-camera-animation",l);const c=u=>{const{x:d,y:h,z:p}=this.getCamera(),g=E.Mul(o,a*u/p);a*=1-i,a<s?l():this._setCamera({x:d+g.x,y:h+g.y,z:p})};return this.addListener("tick",c),this}animateToUser(n){const r=[...this.store.query.records("instance_presence",()=>({userId:{eq:n}})).get()].sort((i,o)=>i.lastActivityTimestamp-o.lastActivityTimestamp).pop();return r?(this.batch(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const i=r.currentPageId===this.getCurrentPageId();i||this.setCurrentPage(r.currentPageId);const o=i?{duration:500}:void 0;this.centerOnPoint(r.cursor,o);const{highlightedUserIds:s}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...s,n]}),setTimeout(()=>{const a=[...this.getInstanceState().highlightedUserIds],l=a.indexOf(n);l<0||(a.splice(l,1),this.updateInstanceState({highlightedUserIds:a}))},D2)}),this):this}animateToShape(n,r=oN){if(!this.getInstanceState().canMoveCamera)return this;const i=this.getViewportScreenBounds().clone().expandBy(-32),o=i.width/i.height,s=this.getShapePageBounds(n);if(!s)return this;const a=s.width/s.height,l=s.clone(),c=s.width/i.width;return l.width+=(i.minX+i.maxX)*c,l.height+=(i.minY+i.maxY)*c,l.x-=i.minX*c,l.y-=i.minY*c,a>o?(l.height=s.width/o,l.y-=(l.height-s.height)/2):(l.width=s.height*o,l.x-=(l.width-s.width)/2),this._animateToViewport(l,r)}updateViewportScreenBounds(n=!1){const r=this.getContainer();if(!r)return this;const i=r.getBoundingClientRect(),o=new se(i.left||i.x,i.top||i.y,Math.max(i.width,1),Math.max(i.height,1)),s=o.equals(this.getViewportScreenBounds()),{_willSetInitialBounds:a}=this;if(s)this._willSetInitialBounds=!1;else if(a)this._willSetInitialBounds=!1,this.updateInstanceState({screenBounds:o.toJson()},{squashing:!0,ephemeral:!0});else if(n&&!this.getInstanceState().followingUserId){const l=this.getViewportPageCenter();this.updateInstanceState({screenBounds:o.toJson()},{squashing:!0,ephemeral:!0}),this.centerOnPoint(l)}else this.updateInstanceState({screenBounds:o.toJson()},{squashing:!0,ephemeral:!0});return this._tickCameraState(),this.updateRenderingBounds(),this}getViewportScreenBounds(){const{x:n,y:r,w:i,h:o}=this.getInstanceState().screenBounds;return new se(n,r,i,o)}getViewportScreenCenter(){return this.getViewportScreenBounds().center}getViewportPageBounds(){const{w:n,h:r}=this.getViewportScreenBounds(),{x:i,y:o,z:s}=this.getCamera();return new se(-i,-o,n/s,r/s)}getViewportPageCenter(){return this.getViewportPageBounds().center}screenToPage(n){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(un),{x:i,y:o,z:s=1}=this.getCamera();return{x:(n.x-r.x)/s-i,y:(n.y-r.y)/s-o,z:n.z??.5}}pageToScreen(n){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(un),{x:i,y:o,z:s=1}=this.getCamera();return{x:(n.x+i)*s+r.x,y:(n.y+o)*s+r.y,z:n.z??.5}}startFollowingUser(n){const r=this.store.query.records("instance_presence",()=>({userId:{eq:n}})),i=this.user.getId();if(i||console.warn("You should set the userId for the current instance before following a user"),r.get().some(l=>l.followingUserId===i))return this;Pr(()=>{this.stopFollowingUser(),this.updateInstanceState({followingUserId:n},{ephemeral:!0})});const o=()=>{this.removeListener("frame",a),this.removeListener("stop-following",o)};let s=!1;const a=()=>{const l=[...r.get()].sort(($,j)=>$.lastActivityTimestamp-j.lastActivityTimestamp).pop();if(!l){this.stopFollowingUser();return}const c=l.currentPageId===this.getCurrentPageId(),u=c?Zz:1;if(!c){this.stopFollowingUser(),this.setCurrentPage(l.currentPageId),this.startFollowingUser(n);return}const{center:d,width:h,height:p}=this.getViewportPageBounds(),g=se.From(l.screenBounds),f=g.width/l.camera.z,m=g.height/l.camera.z,w=new E(f/2-l.camera.x,m/2-l.camera.y),b=l.followingUserId===i,k=h+(f-h)*u,S=p+(m-p)*u,C=b?p/S:Math.min(h/k,p/S),_=ti(this.getCamera().z*C,Uc,Io),P=this.getViewportScreenBounds().w/_,I=this.getViewportScreenBounds().h/_,M=w.sub(d),A=E.Add(d,E.Mul(M,u)),L=E.Sub(A,d).len(),z=Math.abs(_-this.getCamera().z);if(L<Qz&&z<eN){s=!0;return}s&&L<Jz&&z<tN||(s=!1,this.stopCameraAnimation(),this._setCamera({x:-(A.x-P/2),y:-(A.y-I/2),z:_}))};return this.once("stop-following",o),this.addListener("frame",a),this}stopFollowingUser(){return this.updateInstanceState({followingUserId:null},{ephemeral:!0}),this.emit("stop-following"),this}getCameraState(){return this._cameraState.get()}getUnorderedRenderingShapes(n){const r=[];let i=Li*2,o=Li;const s=this.getEditingShapeId(),a=this.getSelectedShapeIds(),l=this.getErasingShapeIds(),c=this.getRenderingBoundsExpanded(),u=Number.isFinite(this.renderingBoundsMargin),d=(h,p,g)=>{const f=this.getShape(h);if(!f)return;p*=f.opacity;let m=!1,w=!1;const b=this.getShapeUtil(f),k=this.getShapeMaskedPageBounds(h);n&&(w=!g&&l.includes(h),w&&(p*=.32),m=u&&b.canUnmount(f)&&s!==h&&(k===void 0||!c.includes(k)&&!a.includes(h))),r.push({id:h,shape:f,util:b,index:i,backgroundIndex:o,opacity:p,isCulled:m,maskedPageBounds:k}),i+=1,o+=1;const S=this.getSortedChildIdsForParent(h);if(!S.length)return;let C=null;b.providesBackgroundForChildren(f)&&(C=o,o=i,i+=Li);for(const _ of S)d(_,p,g||w);C!==null&&(o=C)};for(const h of this.getSortedChildIdsForParent(this.getCurrentPageId()))d(h,1,!1);return r}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(UL)}getRenderingBounds(){return this._renderingBounds.get()}getRenderingBoundsExpanded(){return this._renderingBoundsExpanded.get()}updateRenderingBounds(){const n=this.getViewportPageBounds();return n.equals(this._renderingBounds.__unsafe__getWithoutCapture())?this:(this._renderingBounds.set(n.clone()),Number.isFinite(this.renderingBoundsMargin)?this._renderingBoundsExpanded.set(n.clone().expandBy(this.renderingBoundsMargin/this.getZoomLevel())):this._renderingBoundsExpanded.set(n),this)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(qt)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(n){return this.store.get(typeof n=="string"?n:n.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getPageShapeIds(n){const r=typeof n=="string"?n:n.id,i=this.store.query.exec("shape",{parentId:{eq:r}});return this.getShapeAndDescendantIds(i.map(o=>o.id))}setCurrentPage(n,r){const i=typeof n=="string"?n:n.id;return this._setCurrentPageId(i,r),this}updatePage(n,r){return this._updatePage(n,r),this}createPage(n){return this._createPage(n),this}deletePage(n){const r=typeof n=="string"?n:n.id;return this._deletePage(r),this}duplicatePage(n,r=ji.createId()){if(this.getPages().length>=Qh)return this;const i=typeof n=="string"?n:n.id,o=this.getPage(i);if(!o)return this;const s={...this.getCamera()},a=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(o.id));return this.batch(()=>{var u;const l=this.getPages(),c=Zc(o.index,(u=l[l.indexOf(o)+1])==null?void 0:u.index);if(this.createPage({name:o.name+" Copy",id:r,index:c}),this.setCurrentPage(r),this.setCamera(s),a)return this.putContentOntoCurrentPage(a)}),this}renamePage(n,r,i){const o=typeof n=="string"?n:n.id;return this.getInstanceState().isReadonly?this:(this.updatePage({id:o,name:r},i),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(n){return this._createAssets(n),this}updateAssets(n){return this._updateAssets(n),this}deleteAssets(n){const r=typeof n[0]=="string"?n:n.map(i=>i.id);return this._deleteAssets(r),this}getAsset(n){return this.store.get(typeof n=="string"?n:n.id)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",n=>this.getShapeUtil(n).getGeometry(n),(n,r)=>n.props===r.props)}getShapeGeometry(n){return this._getShapeGeometryCache().get(typeof n=="string"?n:n.id)}_getShapeOutlineSegmentsCache(){return this.store.createComputedCache("outline-segments",n=>this.getShapeUtil(n).getOutlineSegments(n))}getShapeOutlineSegments(n){return this._getShapeOutlineSegmentsCache().get(typeof n=="string"?n:n.id)??Ii}_getShapeHandlesCache(){return this.store.createComputedCache("handles",n=>{var r,i;return(i=(r=this.getShapeUtil(n)).getHandles)==null?void 0:i.call(r,n)})}getShapeHandles(n){return this._getShapeHandlesCache().get(typeof n=="string"?n:n.id)}getShapeLocalTransform(n){const r=typeof n=="string"?n:n.id,i=this.getShape(r);if(!i)throw Error("Editor.getTransform: shape not found");return te.Identity().translate(i.x,i.y).rotate(i.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",n=>{if(_n(n.parentId))return this.getShapeLocalTransform(n);const r=this._getShapePageTransformCache().get(n.parentId)??te.Identity();return te.Compose(r,this.getShapeLocalTransform(n))})}getShapeParentTransform(n){const r=typeof n=="string"?n:n.id,i=this.getShape(r);return!i||_n(i.parentId)?te.Identity():this._getShapePageTransformCache().get(i.parentId)??te.Identity()}getShapePageTransform(n){const r=typeof n=="string"?n:this.getShape(n).id;return this._getShapePageTransformCache().get(r)??te.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",n=>{const r=this._getShapePageTransformCache().get(n.id);return r?se.FromPoints(te.applyToPoints(r,this.getShapeGeometry(n).vertices)):new se})}getShapePageBounds(n){return this._getShapePageBoundsCache().get(typeof n=="string"?n:n.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",n=>{const r=this._getShapeMaskCache().get(n.id);if(!r)return;if(r.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const i=this._getShapePageTransformCache().get(n.id);return i?`polygon(${te.applyToPoints(te.Inverse(i),r).map(o=>`${o.x}px ${o.y}px`).join(",")})`:void 0})}getShapeClipPath(n){return this._getShapeClipPathCache().get(typeof n=="string"?n:n.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",n=>{if(_n(n.parentId))return;const r=this.getShapeAncestors(n.id).filter(i=>this.isShapeOfType(i,"frame"));return r.length===0?void 0:r.map(i=>this._getShapePageTransformCache().get(i.id).applyToPoints(this.getShapeGeometry(i).vertices)).reduce((i,o)=>{if(!(o&&i))return;const s=$0(i,o);return s?s.map(E.Cast):[]})})}getShapeMask(n){return this._getShapeMaskCache().get(typeof n=="string"?n:n.id)}getShapeMaskedPageBounds(n){typeof n!="string"&&(n=n.id);const r=this._getShapePageBoundsCache().get(n);if(!r)return;const i=this._getShapeMaskCache().get(n);if(i){if(i.length===0)return;const{corners:o}=r;if(o.every((a,l)=>a&&E.Equals(a,i[l])))return r.clone();const s=$0(i,o);return s?se.FromPoints(s):void 0}return r}getShapeAncestors(n,r=[]){const i=typeof n=="string"?n:n.id,o=this.getShape(i);if(!o)return r;const s=o.parentId;if(_n(s))return r.reverse(),r;const a=this.store.get(s);return a?(r.push(a),this.getShapeAncestors(a,r)):r}findShapeAncestor(n,r){const i=typeof n=="string"?n:n.id,o=this.getShape(i);if(!o)return;const s=o.parentId;if(_n(s))return;const a=this.getShape(s);if(a)return r(a)?a:this.findShapeAncestor(a,r)}hasAncestor(n,r){const i=typeof n=="string"?n:n==null?void 0:n.id,o=i&&this.getShape(i);return o?o.parentId===r?!0:this.hasAncestor(this.getShapeParent(o),r):!1}findCommonAncestor(n,r){var c;if(n.length===0)return;const i=typeof n[0]=="string"?n:n.map(u=>u.id),o=he(i.map(u=>this.getShape(u)));if(o.length===1){const u=o[0].parentId;return _n(u)?void 0:r?(c=this.findShapeAncestor(o[0],r))==null?void 0:c.id:u}const[s,...a]=o;let l=this.getShapeParent(s);for(;l;){if(r&&!r(l)){l=this.getShapeParent(l);continue}if(a.every(u=>this.hasAncestor(u,l.id)))return l.id;l=this.getShapeParent(l)}}isShapeOrAncestorLocked(n){const r=typeof n=="string"?this.getShape(n):n;return r===void 0?!1:r.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(r))}getCurrentPageBounds(){let n;return this.getCurrentPageShapeIds().forEach(r=>{const i=this.getShapeMaskedPageBounds(r);i&&(n?n=n.expand(i):n=i.clone())}),n}getSelectedShapeAtPoint(n){const r=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(i=>i.type!=="group"&&r.includes(i.id)).reverse().find(i=>this.isPointInShape(i,n,{hitInside:!0,margin:0}))}getShapeAtPoint(n,r={}){const i=this.getZoomLevel(),o=this.getViewportPageBounds(),{filter:s,margin:a=0,hitLabels:l=!1,hitInside:c=!1,hitFrameInside:u=!1}=r;let d=1/0,h=null,p=1/0,g=null;const f=(r.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(m=>{if(this.isShapeOfType(m,"group"))return!1;const w=this.getShapeMask(m);return w&&!ni(n,w)?!1:s?s(m):!0});for(let m=f.length-1;m>=0;m--){const w=f[m],b=this.getShapeGeometry(w),k=b instanceof Mo,S=this.getPointInShapeSpace(w,n);if((this.isShapeOfType(w,"arrow")||this.isShapeOfType(w,"geo")&&w.props.fill==="none")&&w.props.text.trim()){for(const _ of b.children)if(_.isLabel&&_.isPointInBounds(S))return w}if(this.isShapeOfType(w,"frame")){const _=b.distanceToPoint(S,c);if(Math.abs(_)<=a)return g||w;if(b.hitTestPoint(S,0,!0))return g||h||(u?w:void 0);continue}let C;if(k){let _=1/0;for(const P of b.children){if(P.isLabel&&!l)continue;const I=P.distanceToPoint(S,c);I<_&&(_=I)}C=_}else a===0&&(b.bounds.w<1||b.bounds.h<1)||b.bounds.containsPoint(S,a)?C=b.distanceToPoint(S,c):C=1/0;if(b.isClosed){if(C<=a){if(b.isFilled||k&&b.children[0].isFilled)return g||w;if(this.getShapePageBounds(w).contains(o))continue;if(Math.abs(C)<a)Math.abs(C)<p&&(p=Math.abs(C),g=w);else if(!g){const{area:_}=b;_<d&&(d=_,h=w)}}}else if(C<jr/i)return w}return g||h||void 0}getShapesAtPoint(n,r={}){return this.getCurrentPageShapes().filter(i=>this.isPointInShape(i,n,r))}isPointInShape(n,r,i={}){const{hitInside:o=!1,margin:s=0}=i,a=typeof n=="string"?n:n.id,l=this.getShapeMask(a);return l&&!ni(r,l)?!1:this.getShapeGeometry(a).hitTestPoint(this.getPointInShapeSpace(n,r),s,o)}getPointInShapeSpace(n,r){const i=typeof n=="string"?n:n.id;return this._getShapePageTransformCache().get(i).clone().invert().applyToPoint(r)}getPointInParentSpace(n,r){const i=typeof n=="string"?n:n.id,o=this.getShape(i);if(!o)return new E(0,0);if(_n(o.parentId))return E.From(r);const s=this.getShapePageTransform(o.parentId);return s?s.clone().invert().applyToPoint(r):E.From(r)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),n=>this.store.get(n))}getCurrentPageShapesSorted(){const n=new Set(this.getCurrentPageShapes().sort(qt)),r=[];function i(o){r.push(o),n.delete(o),n.forEach(s=>{s.parentId===o.id&&i(s)})}return n.forEach(o=>{const s=this.getShape(o.parentId);Ss(s)||i(o)}),r}getCurrentPageRenderingShapesSorted(){return this.getRenderingShapes().filter(({isCulled:n})=>!n).sort((n,r)=>n.index-r.index).map(({shape:n})=>n)}isShapeOfType(n,r){return(typeof n=="string"?this.getShape(n):n).type===r}getShape(n){const r=typeof n=="string"?n:n.id;if(ar(r))return this.store.get(r)}getShapeParent(n){const r=typeof n=="string"?n:n==null?void 0:n.id;if(!r)return;const i=this.getShape(r);if(!(i===void 0||!ar(i.parentId)))return this.store.get(i.parentId)}getShapeNearestSibling(n,r){return r?r.parentId===n.parentId?r:this.findShapeAncestor(r,i=>i.parentId===n.parentId):void 0}isShapeInPage(n,r=this.getCurrentPageId()){const i=typeof n=="string"?n:n.id,o=this.getShape(i);if(!o)return!1;let s=!1;if(o.parentId===r)s=!0;else{let a=this.getShape(o.parentId);e:for(;a;){if(a.parentId===r){s=!0;break e}a=this.getShape(a.parentId)}}return s}getAncestorPageId(n){const r=typeof n=="string"?n:n==null?void 0:n.id,i=r&&this.getShape(r);if(i)return _n(i.parentId)?i.parentId:this.getAncestorPageId(this.getShape(i.parentId))}reparentShapes(n,r,i){const o=typeof n[0]=="string"?n:n.map(g=>g.id);if(o.length===0)return this;const s=[],a=_n(r)?te.Identity():this.getShapePageTransform(r),l=a.rotation();let c=[];const u=he(this.getSortedChildIdsForParent(r).map(g=>this.getShape(g)));if(i){const g=u.find(f=>f.index===i);if(g){const f=u[u.indexOf(g)+1];f?c=Va(i,f.index,o.length):c=H0(i,o.length)}else{const f=u.sort(qt).find(m=>m.index>i);f?c=Va(i,f.index,o.length):c=H0(i,o.length)}}else{const g=u.length&&u[u.length-1];c=g?H0(g.index,o.length):HC(o.length)}const d=a.clone().invert(),h=he(o.map(g=>this.getShape(g))),p=h.filter(g=>g.isLocked);p.length&&this.updateShapes(p.map(({id:g,type:f})=>({id:g,type:f,isLocked:!1})));for(let g=0;g<h.length;g++){const f=h[g],m=this.getShapePageTransform(f);if(!m)continue;const w=m.point();if(!w)continue;const b=d.applyToPoint(w),k=m.rotation()-l;s.push({id:f.id,type:f.type,parentId:r,x:b.x,y:b.y,rotation:k,index:c[g],isLocked:f.isLocked})}return this.updateShapes(s),this}getHighestIndexForParent(n){const r=typeof n=="string"?n:n.id,i=this._parentIdsToChildIds.get()[r];if(!i||i.length===0)return"a1";const o=this.getShape(i[i.length-1]);return zi(o.index)}getSortedChildIdsForParent(n){const r=typeof n=="string"?n:n.id,i=this._parentIdsToChildIds.get()[r];return i?this._childIdsCache.get(i,()=>i):Ii}visitDescendants(n,r){const i=typeof n=="string"?n:n.id,o=this.getSortedChildIdsForParent(i);for(const s of o)r(s)!==!1&&this.visitDescendants(s,r);return this}getShapeAndDescendantIds(n){const r=new Set,i=[...n];for(;i.length>0;){const o=i.pop();if(!o)break;if(!r.has(o)){r.add(o);for(const s of this.getSortedChildIdsForParent(o))i.push(s)}}return r}getDroppingOverShape(n,r=[]){const i=this.getCurrentPageShapesSorted();for(let o=i.length-1;o>=0;o--){const s=i[o];if(!this.getShapeUtil(s).canDropShapes(s,r)||r.find(l=>l.id===s.id||this.hasAncestor(s,l.id)))continue;const a=this.getShapeMaskedPageBounds(s.id);if(a&&a.containsPoint(n)&&this.getShapeGeometry(s).hitTestPoint(this.getPointInShapeSpace(s,n),0,!0))return s}}getOutermostSelectableShape(n,r){const i=typeof n=="string"?n:n.id,o=this.getShape(i);let s=o,a=o;const l=this.getFocusedGroup();for(;a;){if(this.isShapeOfType(a,"group")&&(l==null?void 0:l.id)!==a.id&&!this.hasAncestor(l,a.id)&&((r==null?void 0:r(a))??!0))s=a;else if((l==null?void 0:l.id)===a.id)break;a=this.getShapeParent(a)}return s}rotateShapesBy(n,r){if((typeof n[0]=="string"?n:n.map(o=>o.id)).length<=0)return this;const i=KC({editor:this});return i?(pp({delta:r,snapshot:i,editor:this,stage:"one-off"}),this):this}nudgeShapes(n,r,i){var a,l;const o=typeof n[0]=="string"?n:n.map(c=>c.id);if(o.length<=0)return this;const s=[];for(const c of o){const u=this.getShape(c);if(!u)throw Error(`Could not find a shape with the id ${c}.`);const d=E.Cast(r),h=this.getShapeParentTransform(u);h&&d.rot(-h.rotation());const p=(l=(a=this.getShapeUtil(u)).onTranslateStart)==null?void 0:l.call(a,u);s.push(p?{...p,x:u.x+d.x,y:u.y+d.y}:{id:c,x:u.x+d.x,y:u.y+d.y,type:u.type})}return this.updateShapes(s,{squashing:!0,...i}),this}duplicateShapes(n,r){const i=typeof n[0]=="string"?n:n.map(u=>u.id);if(i.length<=0)return this;const o=new Set(i),s=[],a=[...i];for(;a.length>0;){const u=a.pop();if(!u)break;s.push(u),this.getSortedChildIdsForParent(u).forEach(d=>a.push(d))}s.reverse();const l=new Map(s.map(u=>[u,Ve()])),c=he(s.map(u=>{const d=this.getShape(u);if(!d)return null;const h=l.get(u);let p=0,g=0;if(r&&o.has(u)){const _=this.getShapeParentTransform(d),P=new E(r.x,r.y).rot(-_.rotation());p=P.x,g=P.y}const f=d.parentId??this.getCurrentPageId(),m=this.getSortedChildIdsForParent(f),w=m.indexOf(d.id),b=m[w+1],k=b?this.getShape(b):null,S=k?Zc(d.index,k.index):zi(d.index);let C=Ht(d);if(this.isShapeOfType(d,"arrow")&&this.isShapeOfType(C,"arrow")){const _=this.getArrowInfo(d);let P,I;if(d.props.start.type==="binding"&&(P=l.get(d.props.start.boundShapeId),!P))if(_!=null&&_.isValid){const{x:A,y:L}=_.start.point;C.props.start={type:"point",x:A,y:L}}else{const{start:A}=Lr(this,d);C.props.start={type:"point",x:A.x,y:A.y}}if(d.props.end.type==="binding"&&(I=l.get(d.props.end.boundShapeId),!I))if(_!=null&&_.isValid){const{x:A,y:L}=_.end.point;C.props.end={type:"point",x:A,y:L}}else{const{end:A}=Lr(this,d);C.props.start={type:"point",x:A.x,y:A.y}}const M=Qc(C)?Jc(this,C):Y0(this,C);if(_!=null&&_.isValid&&(M!=null&&M.isValid)&&!Qc(d)){const A=E.Med(_.start.handle,_.end.handle),L=E.Dist(_.middle,A),z=E.Dist(M.middle,A);C.props.bend<0?C.props.bend+=z-L:C.props.bend-=z-L}C.props.start.type==="binding"&&P&&(C.props.start.boundShapeId=P),C.props.end.type==="binding"&&I&&(C.props.end.boundShapeId=I)}return C={...C,id:h,x:d.x+p,y:d.y+g,index:S},C}));return c.forEach(u=>{ar(u.parentId)&&l.has(u.parentId)&&(u.parentId=l.get(u.parentId))}),this.history.batch(()=>{const u=c.length+this.getCurrentPageShapeIds().size>Li;u&&yp(this);const d=u?c.slice(0,Li-this.getCurrentPageShapeIds().size):c,h=d.map(p=>p.id);if(this.createShapes(d),this.setSelectedShapes(h),r!==void 0){const p=this.getSelectionPageBounds(),g=this.getViewportPageBounds();p&&!g.contains(p)&&this.centerOnPoint(p.center,{duration:Di})}}),this}moveShapesToPage(n,r){const i=typeof n[0]=="string"?n:n.map(l=>l.id);if(i.length===0)return this;if(this.getInstanceState().isReadonly)return this;const o=this.getCurrentPageId();if(r===o)return this;if(!this.store.has(r))return this;const s=this.getContentFromCurrentPage(i);if(!s)return this;if(this.getPageShapeIds(r).size+s.shapes.length>Li)return yp(this,r),this;const a=this.getCamera().z;return this.history.batch(()=>{this.deleteShapes(i),this.setCurrentPage(r),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(s,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:a}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(n){const r=typeof n[0]=="string"?n:n.map(a=>a.id);if(this.getInstanceState().isReadonly||r.length===0)return this;let i=!0,o=!0;const s=[];for(const a of r){const l=this.getShape(a);l&&(s.push(l),l.isLocked?o=!1:i=!1)}return this.batch(()=>{o?(this.updateShapes(s.map(a=>({id:a.id,type:a.type,isLocked:!0}))),this.setSelectedShapes([])):i?this.updateShapes(s.map(a=>({id:a.id,type:a.type,isLocked:!1}))):this.updateShapes(s.map(a=>({id:a.id,type:a.type,isLocked:!0})))}),this}sendToBack(n){const r=typeof n[0]=="string"?n:n.map(o=>o.id),i=hp(this,"toBack",r);return i&&this.updateShapes(i),this}sendBackward(n){const r=typeof n[0]=="string"?n:n.map(o=>o.id),i=hp(this,"backward",r);return i&&this.updateShapes(i),this}bringForward(n){const r=typeof n[0]=="string"?n:n.map(o=>o.id),i=hp(this,"forward",r);return i&&this.updateShapes(i),this}bringToFront(n){const r=typeof n[0]=="string"?n:n.map(o=>o.id),i=hp(this,"toFront",r);return i&&this.updateShapes(i),this}flipShapes(n,r){const i=typeof n[0]=="string"?n:n.map(a=>a.id);if(this.getInstanceState().isReadonly)return this;let o=he(i.map(a=>this.getShape(a)));if(!o.length)return this;o=he(o.map(a=>this.isShapeOfType(a,"group")?this.getSortedChildIdsForParent(a.id).map(l=>this.getShape(l)):a).flat());const s=se.Common(he(o.map(a=>this.getShapePageBounds(a)))).center;return this.batch(()=>{for(const a of o){const l=this.getShapeGeometry(a).bounds,c=this.getShapePageTransform(a.id);c&&this.resizeShape(a.id,{x:r==="horizontal"?-1:1,y:r==="vertical"?-1:1},{initialBounds:l,initialPageTransform:c,initialShape:a,mode:"scale_shape",scaleOrigin:s,scaleAxisRotation:0})}}),this}stackShapes(n,r,i){const o=typeof n[0]=="string"?n:n.map(m=>m.id);if(this.getInstanceState().isReadonly)return this;const s=he(o.map(m=>this.getShape(m)).filter(m=>!(!m||this.isShapeOfType(m,"arrow")&&(m.props.start.type==="binding"||m.props.end.type==="binding")))),a=s.length;if(i===0&&a<3||a<2)return this;const l=Object.fromEntries(s.map(m=>[m.id,this.getShapePageBounds(m)]));let c,u,d,h;r==="horizontal"?(c="x",u="minX",d="maxX",h="width"):(c="y",u="minY",d="maxY",h="height");let p;if(i===0){const m=[];s.sort((b,k)=>l[b.id][u]-l[k.id][u]);for(let b=0;b<a-1;b++){const k=s[b],S=s[b+1],C=l[k.id],_=l[S.id][u]-C[d],P=m.find(I=>I.gap===_);P?P.count++:m.push({gap:_,count:1})}let w=0;m.forEach(b=>{b.count>w&&(w=b.count,p=b.gap)}),w===1&&(p=Math.max(0,m.reduce((b,k)=>b+k.gap*k.count,0)/(a-1)))}else p=i;const g=[];let f=l[s[0].id][d];return s.forEach((m,w)=>{var _,P;if(w===0)return;const b={x:0,y:0};b[c]=f+p-l[m.id][c];const k=this.getShapeParent(m),S=k?E.Rot(b,-this.getShapePageTransform(k).decompose().rotation):b,C=(P=(_=this.getShapeUtil(m)).onTranslateStart)==null?void 0:P.call(_,m);g.push(C?{...C,[c]:m[c]+S[c]}:{id:m.id,type:m.type,[c]:m[c]+S[c]}),f+=l[m.id][h]+p}),this.updateShapes(g),this}packShapes(n,r){var P,I;const i=typeof n[0]=="string"?n:n.map(M=>M.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const o=he(i.map(M=>this.getShape(M)).filter(M=>!(!M||this.isShapeOfType(M,"arrow")&&(M.props.start.type==="binding"||M.props.end.type==="binding")))),s={},a={};let l,c,u=0;for(let M=0;M<o.length;M++)l=o[M],c=this.getShapePageBounds(l),s[l.id]=c,a[l.id]=c.clone(),u+=c.width*c.height;const d=se.Common(he(Object.values(s))),h=d.width;o.sort((M,A)=>s[A.id].height-s[M.id].height);const p=Math.max(Math.ceil(Math.sqrt(u/.95)),h),g=[new se(d.x,d.y,p,1/0)];let f=0,m=0,w,b;for(let M=0;M<o.length;M++){l=o[M],c=a[l.id];for(let A=g.length-1;A>=0;A--)if(w=g[A],!(c.width>w.width||c.height>w.height)){c.x=w.x,c.y=w.y,m=Math.max(m,c.maxY),f=Math.max(f,c.maxX),c.width===w.width&&c.height===w.height?(b=g.pop(),A<g.length&&(g[A]=b)):c.height===w.height?(w.x+=c.width+r,w.width-=c.width+r):c.width===w.width?(w.y+=c.height+r,w.height-=c.height+r):(g.push(new se(w.x+(c.width+r),w.y,w.width-(c.width+r),c.height)),w.y+=c.height+r,w.height-=c.height+r);break}}const k=se.Common(Object.values(a)),S=E.Sub(d.center,k.center);let C;const _=[];for(let M=0;M<o.length;M++){l=o[M],c=s[l.id],C=a[l.id];const A=E.Sub(C.point,c.point).add(S),L=this.getShapeParentTransform(l);L&&A.rot(-L.rotation());const z={id:l.id,type:l.type,x:l.x+A.x,y:l.y+A.y},$=(I=(P=this.getShapeUtil(l)).onTranslateStart)==null?void 0:I.call(P,{...l,...z});$?_.push({...z,...$}):_.push(z)}return _.length&&this.updateShapes(_),this}alignShapes(n,r){const i=typeof n[0]=="string"?n:n.map(c=>c.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const o=he(i.map(c=>this.getShape(c))),s=Object.fromEntries(o.map(c=>[c.id,this.getShapePageBounds(c)])),a=se.Common(he(Object.values(s))),l=[];return o.forEach(c=>{var f,m;const u=s[c.id];if(!u)return;const d={x:0,y:0};switch(r){case"top":{d.y=a.minY-u.minY;break}case"center-vertical":{d.y=a.midY-u.minY-u.height/2;break}case"bottom":{d.y=a.maxY-u.minY-u.height;break}case"left":{d.x=a.minX-u.minX;break}case"center-horizontal":{d.x=a.midX-u.minX-u.width/2;break}case"right":{d.x=a.maxX-u.minX-u.width;break}}const h=this.getShapeParent(c),p=h?E.Rot(d,-this.getShapePageTransform(h).decompose().rotation):d,g=(m=(f=this.getShapeUtil(c)).onTranslateStart)==null?void 0:m.call(f,c);l.push(g?{...g,x:c.x+p.x,y:c.y+p.y}:{id:c.id,type:c.type,x:c.x+p.x,y:c.y+p.y})}),this.updateShapes(l),this}distributeShapes(n,r){const i=typeof n[0]=="string"?n:n.map(k=>k.id);if(this.getInstanceState().isReadonly)return this;if(i.length<3)return this;const o=i.length,s=he(i.map(k=>this.getShape(k))),a=Object.fromEntries(s.map(k=>[k.id,this.getShapePageBounds(k)]));let l,c,u,d,h;r==="horizontal"?(l="x",c="minX",u="maxX",d="midX",h="width"):(l="y",c="minY",u="maxY",d="midY",h="height");const p=[],g=s.sort((k,S)=>a[k.id][c]-a[S.id][c])[0],f=s.sort((k,S)=>a[S.id][u]-a[k.id][u])[0],m=a[g.id][d],w=(a[f.id][d]-m)/(o-1),b=m+w;return s.filter(k=>k!==g&&k!==f).sort((k,S)=>a[k.id][d]-a[S.id][d]).forEach((k,S)=>{var M,A;const C={x:0,y:0};C[l]=b+w*S-a[k.id][h]/2-a[k.id][l];const _=this.getShapeParent(k),P=_?E.Rot(C,-this.getShapePageTransform(_).rotation()):C,I=(A=(M=this.getShapeUtil(k)).onTranslateStart)==null?void 0:A.call(M,k);p.push(I?{...I,[l]:k[l]+P[l]}:{id:k.id,type:k.type,[l]:k[l]+P[l]})}),this.updateShapes(p),this}stretchShapes(n,r){const i=typeof n[0]=="string"?n:n.map(c=>c.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const o=he(i.map(c=>this.getShape(c))),s=Object.fromEntries(i.map(c=>[c,this.getShapeGeometry(c).bounds])),a=Object.fromEntries(i.map(c=>[c,this.getShapePageBounds(c)])),l=se.Common(he(Object.values(a)));switch(r){case"vertical":{this.batch(()=>{for(const c of o){if(this.getShapePageTransform(c).rotation()%De)continue;const u=s[c.id],d=a[c.id],h=new E(0,l.minY-d.minY),p=this.getShapeParentTransform(c);p&&h.rot(-p.rotation());const{x:g,y:f}=E.Add(h,c);this.updateShapes([{id:c.id,type:c.type,x:g,y:f}],{squashing:!0});const m=new E(1,l.height/d.height);this.resizeShape(c.id,m,{initialBounds:u,scaleOrigin:new E(d.center.x,l.minY),scaleAxisRotation:0})}});break}case"horizontal":{this.batch(()=>{for(const c of o){const u=s[c.id],d=a[c.id];if(this.getShapePageTransform(c).rotation()%De)continue;const h=new E(l.minX-d.minX,0),p=this.getShapeParentTransform(c);p&&h.rot(-p.rotation());const{x:g,y:f}=E.Add(h,c);this.updateShapes([{id:c.id,type:c.type,x:g,y:f}],{squashing:!0});const m=new E(l.width/d.width,1);this.resizeShape(c.id,m,{initialBounds:u,scaleOrigin:new E(l.minX,d.center.y),scaleAxisRotation:0})}});break}}return this}resizeShape(n,r,i={}){var p;const o=typeof n=="string"?n:n.id;if(this.getInstanceState().isReadonly)return this;Number.isFinite(r.x)||(r=new E(1,r.y)),Number.isFinite(r.y)||(r=new E(r.x,1));const s=i.initialShape??this.getShape(o);if(!s)return this;const a=i.scaleOrigin??((p=this.getShapePageBounds(o))==null?void 0:p.center);if(!a)return this;const l=i.initialPageTransform?te.Cast(i.initialPageTransform):this.getShapePageTransform(o);if(!l)return this;const c=l.rotation();if(c==null)return this;const u=i.scaleAxisRotation??c,d=i.initialBounds??this.getShapeGeometry(o).bounds;if(!d)return this;if(!P2(c,u))return this._resizeUnalignedShape(o,r,{...i,initialBounds:d,scaleOrigin:a,scaleAxisRotation:u,initialPageTransform:l,initialShape:s});const h=this.getShapeUtil(s);if(h.isAspectRatioLocked(s)&&(Math.abs(r.x)>Math.abs(r.y)?r=new E(r.x,Math.sign(r.y)*Math.abs(r.x)):r=new E(Math.sign(r.x)*Math.abs(r.y),r.y)),h.onResize&&h.canResize(s)){const g=this._scalePagePoint(te.applyToPoint(l,new E(0,0)),a,r,u),f=this.getPointInParentSpace(s.id,g),m=new E(r.x,r.y),w=Rc((c-u)%Math.PI,0);m.x=w?r.x:r.y,m.y=w?r.y:r.x;const b=te.applyToPoint(l,new E),{x:k,y:S}=this.getPointInParentSpace(s.id,b);this.updateShapes([{id:o,type:s.type,x:f.x,y:f.y,...h.onResize({...s,x:k,y:S},{newPoint:f,handle:i.dragHandle??"bottom_right",mode:i.mode??"scale_shape",scaleX:m.x,scaleY:m.y,initialBounds:d,initialShape:s})}],{squashing:!0})}else{const g=te.applyToPoint(l,d.center),f=this._scalePagePoint(g,a,r,u),m=this.getPointInParentSpace(s.id,g),w=this.getPointInParentSpace(s.id,f),b=E.Sub(w,m);this.updateShapes([{id:o,type:s.type,x:s.x+b.x,y:s.y+b.y}],{squashing:!0})}return this}_scalePagePoint(n,r,i,o){const s=E.RotWith(n,r,-o).sub(r),a=E.MulV(s,i);return E.Add(a,r).rotWith(r,o)}_resizeUnalignedShape(n,r,i){const{type:o}=i.initialShape,s=new E(r.x,r.y);if(Math.abs(r.x)>Math.abs(r.y)?s.x=Math.sign(r.x)*Math.abs(r.y):s.y=Math.sign(r.y)*Math.abs(r.x),this.resizeShape(n,s,{initialShape:i.initialShape,initialBounds:i.initialBounds}),Math.sign(r.x)*Math.sign(r.y)<0){let{rotation:w}=te.Decompose(i.initialPageTransform);w-=2*w,this.updateShapes([{id:n,type:o,rotation:w}],{squashing:!0})}const a=te.applyToPoint(i.initialPageTransform,i.initialBounds.center),l=this._scalePagePoint(a,i.scaleOrigin,r,i.scaleAxisRotation),c=this.getShapePageBounds(n),u=this.getShapePageTransform(n),d=c.center,h=u.point();if(!d||!h)return this;const p=E.Sub(l,d),g=E.Add(h,p),{x:f,y:m}=this.getPointInParentSpace(n,g);return this.updateShapes([{id:n,type:o,x:f,y:m}],{squashing:!0}),this}getInitialMetaForShape(n){return{}}createShape(n){return this._createShapes([n]),this}createShapes(n){if(!Array.isArray(n))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");return this._createShapes(n),this}animateShape(n,r){return this.animateShapes([n],r)}animateShapes(n,r={}){const{duration:i=500,easing:o=Xt.linear}=r,s=Re();let a=i,l;const c=[];n.forEach(h=>{if(!h)return;const p={partial:h,values:[]},g=this.getShape(h.id);if(g){for(const f of["x","y","rotation"])h[f]!==void 0&&g[f]!==h[f]&&p.values.push({prop:f,from:g[f],to:h[f]});c.push(p),this.animatingShapes.set(g.id,s)}});let u;const d=h=>{if(a-=h,a<0){const{animatingShapes:g}=this,f=n.filter(m=>m&&g.get(m.id)===s);f.length&&this.updateShapes(f,{squashing:!1}),this.removeListener("tick",d);return}l=o(1-a/i);const{animatingShapes:p}=this;try{const g=[];for(let f=0;f<c.length;f++)u=c[f],p.get(u.partial.id)===s&&g.push({id:u.partial.id,type:u.partial.type,...u.values.reduce((m,{prop:w,from:b,to:k})=>(m[w]=b+(k-b)*l,m),{})});this._updateShapes(g,{squashing:!0})}catch{}};return this.addListener("tick",d),this}groupShapes(n,r=Ve()){var p;if(!Array.isArray(n))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getInstanceState().isReadonly)return this;const i=typeof n[0]=="string"?n:n.map(g=>g.id);if(i.length<=1)return this;const o=he(this._getUnlockedShapeIds(i).map(g=>this.getShape(g))),s=o.sort(qt).map(g=>g.id),a=se.Common(he(o.map(g=>this.getShapePageBounds(g)))),{x:l,y:c}=a.point,u=this.findCommonAncestor(o)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const d=o.filter(g=>g.parentId===u).sort(qt),h=(p=d[d.length-1])==null?void 0:p.index;return this.batch(()=>{this.createShapes([{id:r,type:"group",parentId:u,index:h,x:l,y:c,opacity:1,props:{}}]),this.reparentShapes(s,r),this.select(r)}),this}ungroupShapes(n){const r=typeof n[0]=="string"?n:n.map(a=>a.id);if(this.getInstanceState().isReadonly)return this;if(r.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const i=new Set,o=he(r.map(a=>this.getShape(a))),s=[];return o.forEach(a=>{this.isShapeOfType(a,"group")?s.push(a):i.add(a.id)}),s.length===0?this:(this.batch(()=>{let a;for(let l=0,c=s.length;l<c;l++){a=s[l];const u=this.getSortedChildIdsForParent(a.id);for(let d=0,h=u.length;d<h;d++)i.add(u[d]);this.reparentShapes(u,a.parentId,a.index)}this.deleteShapes(s.map(l=>l.id)),this.select(...i)}),this)}updateShape(n,r){return this.updateShapes([n],r),this}updateShapes(n,r){let i=he(n);return this.animatingShapes.size>0&&i.forEach(o=>this.animatingShapes.delete(o.id)),i=i.filter(o=>{const s=this.getShape(o.id);return!(!s||this.isShapeOrAncestorLocked(s)&&!Object.hasOwn(o,"isLocked"))}),this._updateShapes(i,r),this}_getUnlockedShapeIds(n){return n.filter(r=>{var i;return!((i=this.getShape(r))!=null&&i.isLocked)})}deleteShapes(n){if(!Array.isArray(n))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");return this._deleteShapes(this._getUnlockedShapeIds(typeof n[0]=="string"?n:n.map(r=>r.id))),this}deleteShape(n){return this.deleteShapes([typeof n=="string"?n:n.id]),this}_extractSharedStyles(n,r){if(this.isShapeOfType(n,"group")){const i=this._parentIdsToChildIds.get()[n.id];if(!i)return;for(let o=0,s=i.length;o<s;o++)this._extractSharedStyles(this.getShape(i[o]),r)}else for(const[i,o]of this.styleProps[n.type])r.applyValue(i,ws(n.props,o))}getStyleForNextShape(n){const r=this.getInstanceState().stylesForNextShape[n.id];return r===void 0?n.defaultValue:r}getShapeStyleIfExists(n,r){const i=this.styleProps[n.type].get(r);if(i!==void 0)return ws(n.props,i)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._selectionSharedStyles.get();const n=this.root.getCurrent(),r=new U0;if(!n)return r;if(n.shapeType)for(const i of this.styleProps[n.shapeType].keys())r.applyValue(i,this.getStyleForNextShape(i));return r}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const n=[],r=o=>{const s=this.getShape(o);if(s)if(this.isShapeOfType(s,"group"))for(const a of this.getSortedChildIdsForParent(s.id))r(a);else n.push(s)};for(const o of this.getSelectedShapeIds())r(o);let i=null;for(const o of n)if(i===null)i=o.opacity;else if(i!==o.opacity)return{type:"mixed"};if(i!==null)return{type:"shared",value:i}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(n,r){return this.updateInstanceState({opacityForNextShape:n},r),this}setOpacityForSelectedShapes(n,r){const i=this.getSelectedShapes();if(i.length>0){const o=[],s=a=>{if(this.isShapeOfType(a,"group")){const l=this.getSortedChildIdsForParent(a);for(const c of l)s(this.getShape(c))}else o.push(a)};for(const a of i)s(a);this.updateShapes(o.map(a=>({id:a.id,type:a.type,opacity:n})),r)}return this}setStyleForNextShapes(n,r,i){const o=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...o,[n.id]:r}},i),this}setStyleForSelectedShapes(n,r,i){const o=this.getSelectedShapes();if(o.length>0){const s=[],a=l=>{if(this.isShapeOfType(l,"group")){const c=this.getSortedChildIdsForParent(l.id);for(const u of c)a(this.getShape(u))}else{const c=this.getShapeUtil(l),u=this.styleProps[l.type].get(n);if(u){const d={id:l.id,type:l.type,props:{[u]:r}};s.push({util:c,originalShape:l,updatePartial:d})}}};for(const l of o)a(l);this.updateShapes(s.map(({updatePartial:l})=>l),i)}return this}registerExternalAssetHandler(n,r){return this.externalAssetContentHandlers[n]=r,this}async getAssetForExternalContent(n){var r,i;return await((i=(r=this.externalAssetContentHandlers)[n.type])==null?void 0:i.call(r,n))}registerExternalContentHandler(n,r){return this.externalContentHandlers[n]=r,this}async putExternalContent(n){var r,i;return(i=(r=this.externalContentHandlers)[n.type])==null?void 0:i.call(r,n)}getContentFromCurrentPage(n){const r=typeof n[0]=="string"?n:n.map(l=>l.id);if(!r||r.length===0)return;const i={};let o=Eh(r.map(l=>this.getShape(l)).sort(qt).flatMap(l=>{const c=[l];return this.visitDescendants(l.id,u=>{c.push(this.getShape(u))}),c}));o=o.map(l=>{if(i[l.id]=this.getShapePageTransform(l.id),l=Po(l),this.isShapeOfType(l,"arrow")){const c=l.props.start.type==="binding"?l.props.start.boundShapeId:void 0,u=l.props.end.type==="binding"?l.props.end.boundShapeId:void 0,d=this.getArrowInfo(l);if(l.props.start.type==="binding"&&!o.some(p=>p.id===c))if(d!=null&&d.isValid){const{x:p,y:g}=d.start.point;l.props.start={type:"point",x:p,y:g}}else{const{start:p}=Lr(this,l);l.props.start={type:"point",x:p.x,y:p.y}}if(l.props.end.type==="binding"&&!o.some(p=>p.id===u))if(d!=null&&d.isValid){const{x:p,y:g}=d.end.point;l.props.end={type:"point",x:p,y:g}}else{const{end:p}=Lr(this,l);l.props.end={type:"point",x:p.x,y:p.y}}const h=Qc(l)?Jc(this,l):Y0(this,l);if(d!=null&&d.isValid&&(h!=null&&h.isValid)&&!Qc(l)){const p=E.Med(d.start.handle,d.end.handle),g=E.Dist(d.middle,p),f=E.Dist(h.middle,p);l.props.bend<0?l.props.bend+=f-g:l.props.bend-=f-g}return l}return l});const s=[];o.forEach(l=>{if(o.find(c=>c.id===l.parentId)===void 0){const c=this.getShapePageTransform(l.id),u=c.point(),d=c.rotation();l.x=u.x,l.y=u.y,l.rotation=d,l.parentId=this.getCurrentPageId(),s.push(l.id)}});const a=new Set;return o.forEach(l=>{"assetId"in l.props&&l.props.assetId!==null&&a.add(l.props.assetId)}),{shapes:o,rootShapeIds:s,schema:this.store.schema.serialize(),assets:he(Array.from(a).map(l=>this.getAsset(l)))}}putContentOntoCurrentPage(n,r={}){if(this.getInstanceState().isReadonly)return this;if(!n.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:i=!1,preserveIds:o=!1,preservePosition:s=!1}=r;let{point:a=void 0}=r;const l=this.getCurrentPageId(),{assets:c,shapes:u,rootShapeIds:d}=n,h=new Map(u.map(C=>[C.id,Ve()]));let p=this.getCurrentPageId(),g=1/0,f=[];for(const C of this.getSelectedShapes()){if(g===0)break;const _=this.isShapeOfType(C,"frame"),P=this.getShapeAncestors(C);_&&P.push(C);const I=_?P.length+1:P.length;if(I<g)g=I,f=P,p=_?C.id:C.parentId;else if(I===g){if(f.length!==P.length)throw Error(`Ancestors: ${f.length} !== ${P.length}`);if(f.length===0){p=l;break}else{p=l;for(let M=0;M<f.length&&P[M]===f[M];M++)p=P[M].id}}}let m=!1;if(!_n(p)){const C=this.getShape(p);if(C){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(C)))p=l;else if(d.length===1){const _=u.find(P=>P.id===d[0]);this.isShapeOfType(C,"frame")&&this.isShapeOfType(_,"frame")&&_.props.w===(C==null?void 0:C.props.w)&&_.props.h===(C==null?void 0:C.props.h)&&(m=!0)}}else p=l}m||(m=h.has(p)),m&&(p=this.getShape(p).parentId);let w=this.getHighestIndexForParent(p);const b=[],k=u.map(C=>{let _;if(o)_=Ht(C),h.set(C.id,C.id);else{const P=h.get(C.id);_=Ht({...C,id:P})}if(d.includes(C.id)&&(_.parentId=l,b.push(_)),h.has(_.parentId)?_.parentId=h.get(C.parentId):(d.push(_.id),_.index=w,w=zi(w)),this.isShapeOfType(_,"arrow")){if(_.props.start.type==="binding"){const P=h.get(_.props.start.boundShapeId);_.props.start=P?{..._.props.start,boundShapeId:P}:{type:"point",x:0,y:0}}if(_.props.end.type==="binding"){const P=h.get(_.props.end.boundShapeId);_.props.end=P?{..._.props.end,boundShapeId:P}:{type:"point",x:0,y:0}}}return _});if(k.length+this.getCurrentPageShapeIds().size>Li)return yp(this),this;let S=[];if(c){for(let _=0;_<c.length;_++){const P=c[_],I=this.store.schema.migratePersistedRecord(P,n.schema);if(I.type==="success")c[_]=I.value;else throw Error(`Could not put content:
could not migrate content for asset:
${P.id}
${P.type}
reason:${I.reason}`)}const C=[];S=c.filter(_=>!this.store.has(_.id)).map(_=>{var P;return(_.type==="image"||_.type==="video")&&(_.props.src&&((P=_.props.src)!=null&&P.startsWith("data:image"))?(C.push(Po(_)),_.props.src=null):C.push(Po(_))),_}),Promise.allSettled(C.map(async _=>{const P=await YR(_.props.src,_.props.name,_.props.mimeType??"image/png"),I=await this.getAssetForExternalContent({type:"file",file:P});return I?[_,I]:null})).then(_=>{this.updateAssets(he(_.map(P=>P.status==="fulfilled"&&P.value?{...P.value[1],id:P.value[0].id}:void 0)))})}for(let C=0;C<k.length;C++){const _=k[C],P=this.store.schema.migratePersistedRecord(_,n.schema);if(P.type==="success")k[C]=P.value;else throw Error(`Could not put content:
could not migrate content for shape:
${_.id}, ${_.type}
reason:${P.reason}`)}return this.batch(()=>{S.length>0&&this.createAssets(S),this.createShapes(k),i&&this.select(...b.map(M=>M.id)),p!==l&&this.reparentShapes(b.map(M=>M.id),p);const C=k.map(M=>this.getShape(M.id)),_=se.Common(C.map(M=>this.getShapePageBounds(M)));if(a===void 0)if(_n(p)){const M=this.getViewportPageBounds();s||M.includes(se.From(_))?a=_.center:a=M.center}else{const M=this.getShape(p);a=te.applyToPoint(this.getShapePageTransform(M),this.getShapeGeometry(M).bounds.center)}if(b.length===1){const M=b[0];if(this.isShapeOfType(M,"frame"))for(;this.getShapesAtPoint(a).some(A=>this.isShapeOfType(A,"frame")&&A.props.w===M.props.w&&A.props.h===M.props.h);)a.x+=_.w+16}const P=se.Common(he(b.map(({id:M})=>this.getShapePageBounds(M)))).center,I=E.Sub(a,P);this.updateShapes(b.map(({id:M})=>{const A=this.getShape(M),L=this.getShapeParentTransform(M).decompose().rotation,z=E.Rot(I,-L);return{id:A.id,type:A.type,x:A.x+z.x,y:A.y+z.y}}))}),this}async getSvg(n,r={}){var C,_;const i=typeof n[0]=="string"?n:n.map(P=>P.id);if(i.length===0)return;if(!window.document)throw Error("No document");const{scale:o=1,background:s=!1,padding:a=iN,preserveAspectRatio:l=!1}=r,c=Cn({isDarkMode:this.user.getIsDarkMode()}),u=this.getShapeAndDescendantIds(i),d=this.getUnorderedRenderingShapes(!1).filter(({id:P})=>u.has(P));let h=null;if(r.bounds)h=r.bounds;else for(const{maskedPageBounds:P}of d)P&&(h?h.union(P):h=P.clone());if(!h)return;const p=i.length===1&&this.isShapeOfType(this.getShape(i[0]),"frame")?i[0]:null;p||h.expandBy(a);const g=h.width*o,f=h.height*o,m=window.document.createElementNS("http://www.w3.org/2000/svg","svg");l&&m.setAttribute("preserveAspectRatio",l),m.setAttribute("direction","ltr"),m.setAttribute("width",g+""),m.setAttribute("height",f+""),m.setAttribute("viewBox",`${h.minX} ${h.minY} ${h.width} ${h.height}`),m.setAttribute("stroke-linecap","round"),m.setAttribute("stroke-linejoin","round"),s?p?m.style.setProperty("background",c.solid):m.style.setProperty("background-color",c.background):m.style.setProperty("background-color","transparent");try{(_=(C=document.body).focus)==null||_.call(C)}catch{}const w=window.document.createElementNS("http://www.w3.org/2000/svg","defs");m.append(w);const b=new Map,k={addExportDef:P=>{if(b.has(P.key))return;const I=(async()=>{const M=await P.getElement();if(!M)return;const A=document.createComment(`def: ${P.key}`);w.appendChild(A);for(const L of Array.isArray(M)?M:[M])w.appendChild(L)})();b.set(P.key,I)}},S=(await Promise.all(d.map(async({id:P,opacity:I,index:M,backgroundIndex:A})=>{var V,D;if(P===p)return[];const L=this.getShape(P);if(this.isShapeOfType(L,"group"))return[];const z=this.getShapeUtil(L);let $=await((V=z.toSvg)==null?void 0:V.call(z,L,k)),j=await((D=z.toBackgroundSvg)==null?void 0:D.call(z,L,k));if($){const B=document.createElementNS("http://www.w3.org/2000/svg","g");B.appendChild($),$=B}if(j){const B=document.createElementNS("http://www.w3.org/2000/svg","g");B.appendChild(j),j=B}if(!$&&!j){const B=this.getShapePageBounds(L),X=window.document.createElementNS("http://www.w3.org/2000/svg","rect");X.setAttribute("width",B.width+""),X.setAttribute("height",B.height+""),X.setAttribute("fill",c.solid),X.setAttribute("stroke",c.grey.pattern),X.setAttribute("stroke-width","1"),$=X}let F=this.getShapePageTransform(L).toCssString();"scale"in L.props&&L.props.scale!==1&&(F=`${F} scale(${L.props.scale}, ${L.props.scale})`),$==null||$.setAttribute("transform",F),j==null||j.setAttribute("transform",F),$==null||$.setAttribute("opacity",I+""),j==null||j.setAttribute("opacity",I+"");const R=this.getShapeMask(L.id);if(R){const B=document.createElementNS("http://www.w3.org/2000/svg","clipPath");w.appendChild(B);const X=Re();B.id=X;const ie=document.createElementNS("http://www.w3.org/2000/svg","path");if(ie.setAttribute("d",`M${R.map(({x:ue,y:ge})=>`${ue},${ge}`).join("L")}Z`),B.appendChild(ie),$){const ue=document.createElementNS("http://www.w3.org/2000/svg","g");ue.setAttribute("clip-path",`url(#${X})`),ue.appendChild($),$=ue}if(j){const ue=document.createElementNS("http://www.w3.org/2000/svg","g");ue.setAttribute("clip-path",`url(#${X})`),ue.appendChild(j),j=ue}}const W=[];return $&&W.push({zIndex:M,element:$}),j&&W.push({zIndex:A,element:j}),W}))).flat();await Promise.all(b.values());for(const{element:P}of S.sort((I,M)=>I.zIndex-M.zIndex))m.appendChild(P);return m}_updateInputsFromEvent(n){var g;const{previousScreenPoint:r,previousPagePoint:i,currentScreenPoint:o,currentPagePoint:s}=this.inputs,{screenBounds:a}=this.store.unsafeGetWithoutCapture(un),{x:l,y:c,z:u}=n.point,{x:d,y:h,z:p}=this.getCamera();r.setTo(o),i.setTo(s),o.set(l,c),s.set((l-a.x)/p-d,(c-a.y)/p-h,u??.5),this.inputs.isPen=n.type==="pointer"&&n.isPen,n.name==="pointer_down"&&this.inputs.pointerVelocity.set(0,0),this.store.put([{id:zh,typeName:"pointer",x:s.x,y:s.y,lastActivityTimestamp:n.type==="pointer"&&n.pointerId===z2.CAMERA_MOVE?((g=this.store.get(zh))==null?void 0:g.lastActivityTimestamp)??Date.now():Date.now(),meta:{}}])}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}}le([q],ae.prototype,"getCanUndo",1),le([q],ae.prototype,"getCanRedo",1),le([q],ae.prototype,"_getArrowBindingsIndex",1),le([q],ae.prototype,"getArrowInfoCache",1),le([q],ae.prototype,"getPath",1),le([q],ae.prototype,"getCurrentTool",1),le([q],ae.prototype,"getCurrentToolId",1),le([q],ae.prototype,"getDocumentSettings",1),le([q],ae.prototype,"getInstanceState",1),le([q],ae.prototype,"getOpenMenus",1),le([q],ae.prototype,"getIsMenuOpen",1),le([q],ae.prototype,"getPageStates",1),le([q],ae.prototype,"_getPageStatesQuery",1),le([q],ae.prototype,"getCurrentPageState",1),le([q],ae.prototype,"_getCurrentPageStateId",1),le([q],ae.prototype,"getSelectedShapeIds",1),le([q],ae.prototype,"getSelectedShapes",1),le([q],ae.prototype,"getOnlySelectedShape",1),le([q],ae.prototype,"getSelectionPageBounds",1),le([q],ae.prototype,"getSelectionRotation",1),le([q],ae.prototype,"getSelectionRotatedPageBounds",1),le([q],ae.prototype,"getFocusedGroupId",1),le([q],ae.prototype,"getFocusedGroup",1),le([q],ae.prototype,"getEditingShapeId",1),le([q],ae.prototype,"getEditingShape",1),le([q],ae.prototype,"getHoveredShapeId",1),le([q],ae.prototype,"getHoveredShape",1),le([q],ae.prototype,"getHintingShapeIds",1),le([q],ae.prototype,"getHintingShape",1),le([q],ae.prototype,"getErasingShapeIds",1),le([q],ae.prototype,"getErasingShapes",1),le([q],ae.prototype,"getCameraId",1),le([q],ae.prototype,"getCamera",1),le([q],ae.prototype,"getZoomLevel",1),le([q],ae.prototype,"getViewportScreenBounds",1),le([q],ae.prototype,"getViewportScreenCenter",1),le([q],ae.prototype,"getViewportPageBounds",1),le([q],ae.prototype,"getViewportPageCenter",1),le([q],ae.prototype,"getRenderingShapes",1),le([q],ae.prototype,"_getAllPagesQuery",1),le([q],ae.prototype,"getPages",1),le([q],ae.prototype,"_getAllAssetsQuery",1),le([q],ae.prototype,"_getShapeGeometryCache",1),le([q],ae.prototype,"_getShapeOutlineSegmentsCache",1),le([q],ae.prototype,"_getShapeHandlesCache",1),le([q],ae.prototype,"_getShapePageTransformCache",1),le([q],ae.prototype,"_getShapePageBoundsCache",1),le([q],ae.prototype,"_getShapeClipPathCache",1),le([q],ae.prototype,"_getShapeMaskCache",1),le([q],ae.prototype,"getCurrentPageBounds",1),le([q],ae.prototype,"getCurrentPageShapes",1),le([q],ae.prototype,"getCurrentPageShapesSorted",1),le([q],ae.prototype,"getCurrentPageRenderingShapesSorted",1),le([q({isEqual:(e,t)=>e.equals(t)})],ae.prototype,"getSharedStyles",1),le([q],ae.prototype,"getSharedOpacity",1);function yp(e,t=e.getCurrentPageId()){const n=e.getPage(t).name;e.emit("max-shapes",{name:n,pageId:t,count:Li})}function vp(){const e=H();return Y("isDarkMode",()=>e.user.getIsDarkMode(),[e])}const P9='<path d="m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z" fill="white"/><path d="m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z" fill="white"/><path d="m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z" fill="black"/><path d="m13 10.814v11.188l2.969-2.866.428-.139h4.768z" fill="black"/>',I9='<path d="m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z" fill="white"/><g stroke="black" stroke-linecap="round" stroke-width=".75"><path d="m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z" stroke-linejoin="round"/><path d="m21.5664 21.7344v-3.459"/><path d="m19.5508 21.7461-.016-3.473"/><path d="m17.5547 18.3047.021 3.426"/></g>',M9='<path d="m25 16h-6.01v-6h-2.98v6h-6.01v3h6.01v6h2.98v-6h6.01z" fill="white"/><path d="m23.9902 17.0103h-6v-6.01h-.98v6.01h-6v.98h6v6.01h.98v-6.01h6z" fill="%23231f1f"/>',A9='<path d="m19 14h1v1h-1zm1 6h-1v-1h1zm-5-5h-1v-1h1zm0 5h-1v-1h1zm2-10.987-7.985 7.988 5.222 5.221 2.763 2.763 7.984-7.985z" fill="white"/><g fill="black"><path d="m23.5664 16.9971-2.557-2.809v1.829h-4.009-4.001v-1.829l-2.571 2.809 2.572 2.808-.001-1.808h4.001 4.009l-.001 1.808z"/><path d="m17.9873 17h.013v-4.001l1.807.001-2.807-2.571-2.809 2.57h1.809v4.001h.008v4.002l-1.828-.001 2.807 2.577 2.805-2.576h-1.805z"/></g>',QC="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",JC="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",bp='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>',T9='<path fill="white" d="M7.94 0a5.25 5.25 0 0 0-3.47 1.17A5.27 5.27 0 0 0 1 0H0v3h1c1.41 0 1.85.7 2 1v3.94H2v3h1v3c-.13.3-.57 1-2 1H0v3h1a5.27 5.27 0 0 0 3.47-1.17c.98.8 2.21 1.21 3.47 1.17h1v-3h-1c-1.41 0-1.85-.7-2-1v-3H7v-3H6V4c.13-.3.57-1 2-1h1V0H7.94z"/><path fill="black" d="M7.94 2V1a4 4 0 0 0-3.47 1.64A4 4 0 0 0 1 1v1c1.3-.17 2.56.6 3 1.84v5.1H3v1h1v4.16c-.45 1.24-1.7 2-3 1.84v1a4.05 4.05 0 0 0 3.47-1.63 4.05 4.05 0 0 0 3.47 1.63v-1A2.82 2.82 0 0 1 5 14.1V9.93h1v-1H5V3.85A2.81 2.81 0 0 1 7.94 2z"/>',j9="<path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042' fill='white'/><g stroke='black' stroke-width='.75'><path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042z' stroke-linejoin='round'/><path d='m20.5664 19.7344v-3.459' stroke-linecap='round'/><path d='m18.5508 19.7461-.016-3.473' stroke-linecap='round'/><path d='m16.5547 16.3047.021 3.426' stroke-linecap='round'/></g>",O9='<path d="m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121" fill="white"/><g stroke="black" stroke-linecap="round" stroke-width=".75"><path d="m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121" stroke-linejoin="round"/><path d="m20.5664 21.7344v-3.459"/><path d="m18.5508 21.7461-.016-3.473"/><path d="m16.5547 18.3047.021 3.426"/></g>',L9='<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 14h-2v-2h-2v2h-2v1.98h2v2.02h2v-2.02h2z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>',D9='<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 16h-5.98v-1.98h5.98z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>';function Ot(e,t,n,r,i,o=16,s=16){const a=(-n-t)*(Te/180),l=Math.sin(a),c=Math.cos(a),u=1*c-1*l,d=1*l+1*c;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${u}' dy='${d}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${t+n} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+e.replaceAll('"',"'")+`</g></svg>") ${o} ${s}, pointer`}const z9={none:()=>"none",default:(e,t,n)=>Ot(P9,e,0,t,n,12,8),pointer:(e,t,n)=>Ot(I9,e,0,t,n,14,10),cross:(e,t,n)=>Ot(M9,e,0,t,n),move:(e,t,n)=>Ot(A9,e,0,t,n),grab:(e,t,n)=>Ot(O9,e,0,t,n),grabbing:(e,t,n)=>Ot(j9,e,0,t,n),text:(e,t,n)=>Ot(T9,e,0,t,n,4,10),"ew-resize":(e,t,n)=>Ot(JC,e,0,t,n),"ns-resize":(e,t,n)=>Ot(JC,e,90,t,n),"nesw-resize":(e,t,n)=>Ot(QC,e,0,t,n),"nwse-resize":(e,t,n)=>Ot(QC,e,90,t,n),"nwse-rotate":(e,t,n)=>Ot(bp,e,0,t,n),"nesw-rotate":(e,t,n)=>Ot(bp,e,90,t,n),"senw-rotate":(e,t,n)=>Ot(bp,e,180,t,n),"swne-rotate":(e,t,n)=>Ot(bp,e,270,t,n),"zoom-in":(e,t,n)=>Ot(L9,e,0,t,n),"zoom-out":(e,t,n)=>Ot(D9,e,0,t,n)};function Vn(e,t=0,n="black"){return z9[e](Kz(t),!1,n)}const N9=["default","pointer","cross","move","grab","grabbing","text"];function R9(){const e=H(),t=Yt(),n=vp();vs("useCursor",()=>{const{type:r,rotation:i}=e.getInstanceState().cursor;if(N9.includes(r)){t.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}t.style.setProperty("--tl-cursor",Vn(r,i,n?"white":"black"))},[e,t,n])}function F9(){const e=H(),t=Yt(),n=vp(),r=Y(He.forceSrgb);J.useEffect(()=>{n?(t.setAttribute("data-color-mode","dark"),t.classList.remove("tl-theme__light"),t.classList.add("tl-theme__dark")):(t.setAttribute("data-color-mode","light"),t.classList.remove("tl-theme__dark"),t.classList.add("tl-theme__light")),r?t.classList.add("tl-theme__force-sRGB"):t.classList.remove("tl-theme__force-sRGB")},[e,t,r,n])}function $9(e){const t=x.useRef();return x.useLayoutEffect(()=>{t.current=e}),x.useDebugValue(e),x.useCallback((...n)=>{const r=t.current;return bs(r,"fn does not exist"),r(...n)},[])}function B9(e){const t=H(),n=Yt();x.useLayoutEffect(()=>{e?(t.getInstanceState().isFocused||t.updateInstanceState({isFocused:!0}),t.getContainer().focus()):t.getInstanceState().isFocused&&t.updateInstanceState({isFocused:!1})},[t,n,e])}function U9(){const[e,t]=x.useState(0);x.useEffect(()=>t(n=>n+1),[])}const Ka="TLDRAW_TAB_ID_v2",Lt=globalThis.window;function V9(){return Lt?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(Lt.navigator.platform)||Lt.navigator.userAgent.includes("Mac")&&"ontouchend"in document:!1}const wp=(Lt==null?void 0:Lt[Ka])??(Lt==null?void 0:Lt.sessionStorage[Ka])??"TLDRAW_INSTANCE_STATE_V1_"+Re();Lt&&(Lt[Ka]=wp,V9()?Lt.sessionStorage[Ka]=wp:delete Lt.sessionStorage[Ka]),Lt==null||Lt.addEventListener("beforeunload",()=>{Lt.sessionStorage[Ka]=wp});const H9={Initial:0},eu=H9.Initial,eE=ke({version:fe,currentPageId:Pc,isFocusMode:xe,exportBackground:xe,isDebugMode:xe,isToolLocked:xe,isGridMode:xe,pageStates:cn(ke({pageId:Pc,camera:ke({x:fe,y:fe,z:fe}),selectedShapeIds:cn(Mr),focusedGroupId:Mr.nullable()}))}),K9=Ae({currentVersion:eu});function W9(e){if(!e||typeof e!="object")return console.warn("Invalid instance state"),null;if(!("version"in e)||typeof e.version!="number")return console.warn("No version in instance state"),null;const t=o0({value:e,fromVersion:e.version,toVersion:eu,migrations:K9});if(t.type==="error")return console.warn(t.reason),null;const n={...t.value,version:eu};try{eE.validate(n)}catch(r){return console.warn(r),null}return n}function Y9(e){const t=e.query.ids("page");return q("sessionStateSnapshot",()=>{const n=e.get(un);if(!n)return null;const r=[...t.get()];return{version:eu,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:r.map(i=>{const o=e.get(Wt.createId(i)),s=e.get(Kt.createId(i));return{pageId:i,camera:{x:(s==null?void 0:s.x)??0,y:(s==null?void 0:s.y)??0,z:(s==null?void 0:s.z)??1},selectedShapeIds:(o==null?void 0:o.selectedShapeIds)??[],focusedGroupId:(o==null?void 0:o.focusedGroupId)??null}})}})}function X9(e,t){const n=W9(t);if(!n)return;const r=e.allRecords().filter(s=>s.typeName==="instance_page_state"||s.typeName==="camera"),i={added:{},updated:{},removed:{...W_(r.map(s=>[s.id,s]))}};e.has(un)&&(i.removed[un]=e.get(un));const o={removed:{},updated:{},added:{[un]:e.schema.types.instance.create({id:un,currentPageId:n.currentPageId,isDebugMode:n.isDebugMode,isFocusMode:n.isFocusMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,exportBackground:n.exportBackground})}};for(const s of n.pageStates){const a=Kt.createId(s.pageId),l=Wt.createId(s.pageId);o.added[a]=Kt.create({id:Kt.createId(s.pageId),x:s.camera.x,y:s.camera.y,z:s.camera.z}),o.added[l]=Wt.create({id:Wt.createId(s.pageId),pageId:s.pageId,selectedShapeIds:s.selectedShapeIds,focusedGroupId:s.focusedGroupId})}Pr(()=>{e.applyDiff(Oh([i,o])),e.ensureStoreIsUsable()})}function G9(e){var i;const t=[];for(const o of Object.values(e))(i=o.typeName)!=null&&i.match(/^(instance.*|pointer|camera)$/)&&t.push(o);const n=t.filter(o=>o.typeName==="instance"&&o.id!==un)[0];if(!n)return null;const r={version:eu,currentPageId:n.currentPageId,exportBackground:!!n.exportBackground,isFocusMode:!!n.isFocusMode,isDebugMode:!!n.isDebugMode,isToolLocked:!!n.isToolLocked,isGridMode:!1,pageStates:t.filter(o=>o.typeName==="instance_page_state"&&o.instanceId===n.id).map(o=>{const s=e[o.cameraId]??{x:0,y:0,z:1};return{pageId:o.pageId,camera:{x:s.x,y:s.y,z:s.z},selectedShapeIds:o.selectedShapeIds,focusedGroupId:o.focusedGroupId}})};try{return eE.validate(r),r}catch{return null}}function q9(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
\u2022 If your hard disk is full, try clearing up some space and then reload the page.`)}function Z9(){window.alert(`Oops! We could not access your browser's storage\u2014and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const Q9=(e,t)=>t.some(n=>e instanceof n);let tE,nE;function J9(){return tE||(tE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function eF(){return nE||(nE=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const rE=new WeakMap,X0=new WeakMap,iE=new WeakMap,G0=new WeakMap,q0=new WeakMap;function tF(e){const t=new Promise((n,r)=>{const i=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{n(Fi(e.result)),i()},s=()=>{r(e.error),i()};e.addEventListener("success",o),e.addEventListener("error",s)});return t.then(n=>{n instanceof IDBCursor&&rE.set(n,e)}).catch(()=>{}),q0.set(t,e),t}function nF(e){if(X0.has(e))return;const t=new Promise((n,r)=>{const i=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{n(),i()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)});X0.set(e,t)}let Z0={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return X0.get(e);if(t==="objectStoreNames")return e.objectStoreNames||iE.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Fi(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function rF(e){Z0=e(Z0)}function iF(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const r=e.call(Q0(this),t,...n);return iE.set(r,t.sort?t.sort():[t]),Fi(r)}:eF().includes(e)?function(...t){return e.apply(Q0(this),t),Fi(rE.get(this))}:function(...t){return Fi(e.apply(Q0(this),t))}}function oF(e){return typeof e=="function"?iF(e):(e instanceof IDBTransaction&&nF(e),Q9(e,J9())?new Proxy(e,Z0):e)}function Fi(e){if(e instanceof IDBRequest)return tF(e);if(G0.has(e))return G0.get(e);const t=oF(e);return t!==e&&(G0.set(e,t),q0.set(t,e)),t}const Q0=e=>q0.get(e);function sF(e,t,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const s=indexedDB.open(e,t),a=Fi(s);return r&&s.addEventListener("upgradeneeded",l=>{r(Fi(s.result),l.oldVersion,l.newVersion,Fi(s.transaction),l)}),n&&s.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener("close",()=>o()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function aF(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",r=>t(r.oldVersion,r)),Fi(n).then(()=>{})}const lF=["get","getKey","getAll","getAllKeys","count"],cF=["put","add","delete","clear"],J0=new Map;function oE(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(J0.get(t))return J0.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=cF.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||lF.includes(n)))return;const o=async function(s,...a){const l=this.transaction(s,i?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),i&&l.done]))[0]};return J0.set(t,o),o}rF(e=>({...e,get:(t,n,r)=>oE(t,n)||e.get(t,n,r),has:(t,n)=>!!oE(t,n)||e.has(t,n)}));const xp="TLDRAW_DOCUMENT_v2",sE="TLDRAW_DB_NAME_INDEX_v2",ze={Records:"records",Schema:"schema",SessionState:"session_state"};async function Sp(e,t){fF(e);const n=await sF(e,3,{upgrade(r){r.objectStoreNames.contains(ze.Records)||r.createObjectStore(ze.Records),r.objectStoreNames.contains(ze.Schema)||r.createObjectStore(ze.Schema),r.objectStoreNames.contains(ze.SessionState)||r.createObjectStore(ze.SessionState)}});try{return await t(n)}finally{n.close()}}async function uF({persistenceKey:e,sessionId:t,didCancel:n}){const r=xp+e;if(ev().includes(r))return await pF({persistenceKey:e,didCancel:n}),await Sp(r,async i=>{var d,h;if(n!=null&&n())return;const o=i.transaction([ze.Records,ze.Schema,ze.SessionState],"readonly"),s=o.objectStore(ze.Records),a=o.objectStore(ze.Schema),l=o.objectStore(ze.SessionState);let c=t?(d=await l.get(t))==null?void 0:d.snapshot:null;c||(c=(h=(await l.getAll()).sort((p,g)=>p.updatedAt-g.updatedAt).pop())==null?void 0:h.snapshot);const u={records:await s.getAll(),schema:await a.get(ze.Schema),sessionStateSnapshot:c};if(n!=null&&n()){o.abort();return}return await o.done,u})}async function dF({persistenceKey:e,schema:t,changes:n,sessionId:r,sessionStateSnapshot:i,didCancel:o}){const s=xp+e;await Sp(s,async a=>{const l=a.transaction([ze.Records,ze.Schema,ze.SessionState],"readwrite"),c=l.objectStore(ze.Records),u=l.objectStore(ze.Schema),d=l.objectStore(ze.SessionState);for(const[h,p]of Object.entries(n.added))await c.put(p,h);for(const[h,p]of Object.values(n.updated))await c.put(p,p.id);for(const h of Object.keys(n.removed))await c.delete(h);if(u.put(t.serialize(),ze.Schema),i&&r?d.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o==null?void 0:o())return l.abort();await l.done})}async function hF({persistenceKey:e,schema:t,snapshot:n,sessionId:r,sessionStateSnapshot:i,didCancel:o}){const s=xp+e;await Sp(s,async a=>{const l=a.transaction([ze.Records,ze.Schema,ze.SessionState],"readwrite"),c=l.objectStore(ze.Records),u=l.objectStore(ze.Schema),d=l.objectStore(ze.SessionState);await c.clear();for(const[h,p]of Object.entries(n))await c.put(p,h);if(u.put(t.serialize(),ze.Schema),i&&r?d.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o==null?void 0:o())return l.abort();await l.done})}async function pF({persistenceKey:e,didCancel:t}){await Sp(xp+e,async n=>{const r=n.transaction([ze.SessionState],"readwrite"),i=r.objectStore(ze.SessionState),o=(await i.getAll()).sort((a,l)=>a.updatedAt-l.updatedAt);if(o.length<10){await r.done;return}const s=o.slice(0,o.length-10);for(const{id:a}of s)await i.delete(a);if(t!=null&&t())return r.abort();await r.done})}function ev(){const e=JSON.parse((window==null?void 0:window.localStorage.getItem(sE))||"[]")??[];return Array.isArray(e)?e:[]}function fF(e){const t=new Set(ev());t.add(e),window==null||window.localStorage.setItem(sE,JSON.stringify([...t]))}const gF=350,mF=1e4,aE=Symbol("UPDATE_INSTANCE_STATE"),yF=e=>e;class vF{constructor(t){v(this,"onmessage")}postMessage(t){}close(){}}const bF=typeof BroadcastChannel>"u"?vF:BroadcastChannel;class wF{constructor(t,{persistenceKey:n,sessionId:r=wp,onLoad:i,onLoadError:o},s=new bF(`tldraw-tab-sync-${n}`)){v(this,"disposables",new Set);v(this,"diffQueue",[]);v(this,"didDispose",!1);v(this,"shouldDoFullDBWrite",!0);v(this,"isReloading",!1);v(this,"persistenceKey");v(this,"sessionId");v(this,"serializedSchema");v(this,"isDebugging",!1);v(this,"documentTypes");v(this,"$sessionStateSnapshot");v(this,"initTime",Date.now());v(this,"isPersisting",!1);v(this,"didLastWriteError",!1);v(this,"scheduledPersistTimeout",null);this.store=t,this.channel=s,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=n,this.sessionId=r,this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=Y9(this.store),this.disposables.add(t.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(yF({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(t.listen(()=>{this.diffQueue.push(aE),this.schedulePersist()},{scope:"session"})),this.connect(i,o),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}debug(...t){this.isDebugging&&console.debug(...t)}async connect(t,n){this.debug("connecting");let r;try{r=await uF({persistenceKey:this.persistenceKey,sessionId:this.sessionId,didCancel:()=>this.didDispose})}catch(i){n(i),Z9(),typeof window<"u"&&window.location.reload();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){const i=Object.fromEntries(r.records.map(a=>[a.id,a])),o=r.sessionStateSnapshot??G9(i),s=this.store.schema.migrateStoreSnapshot({store:i,schema:r.schema??this.store.schema.serializeEarliestVersion()});if(s.type==="error"){console.error("failed to migrate store",s),n(new Error(`Failed to migrate store: ${s.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(s.value).filter(a=>this.documentTypes.has(a.typeName)),"initialize")}),o&&X9(this.store,o)}this.channel.onmessage=({data:i})=>{var a,l;this.debug("got message",i);const o=i,s=QL(this.serializedSchema,o.schema??this.store.schema.serializeEarliestVersion());if(s===-1){if(Date.now()-this.initTime<5e3){n(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(l=(a=window==null?void 0:window.location)==null?void 0:a.reload)==null||l.call(a);return}else if(s===1){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}o.type==="diff"&&(this.debug("applying diff"),Pr(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(o.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),t(this)}catch(i){if(this.debug("error loading data from store",i),this.didDispose)return;n(i);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(t=>t())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?mF:gF))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){bs(!this.isPersisting,"persist already in progress"),this.isPersisting=!0,this.debug("doPersist start");const t=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await hF({persistenceKey:this.persistenceKey,schema:this.store.schema,snapshot:this.store.serialize(),didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const n=Oh(t.filter(r=>r!==aE));await dF({persistenceKey:this.persistenceKey,changes:n,schema:this.store.schema,didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(n){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",n),q9(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function xF({initialData:e,defaultName:t="",...n}){const r="schema"in n&&n.schema?n.schema:KD({shapes:SF(zC("shapeUtils"in n&&n.shapeUtils?n.shapeUtils:[]))});return new Q_({schema:r,initialData:e,props:{defaultName:t}})}function SF(e){return Object.fromEntries(e.map(t=>[t.type,{props:t.props,migrations:t.migrations}]))}function lE(e){const t=xF(e);return e.snapshot&&t.loadSnapshot(e.snapshot),{store:t,opts:e}}function kF(e){const[t,n]=x.useState(()=>lE(e));if(!X_(t.opts,e)){const r=lE(e);return n(r),r.store}return t.store}function _F({persistenceKey:e,sessionId:t,...n}){const[r,i]=x.useState(null),o=kF(n);return x.useEffect(()=>{const s=Re();if(!e){i({id:s,storeWithStatus:{status:"not-synced",store:o}});return}i({id:s,storeWithStatus:{status:"loading"}});const a=c=>{i(u=>(u==null?void 0:u.id)===s?{id:s,storeWithStatus:c}:u)},l=new wF(o,{sessionId:t,persistenceKey:e,onLoad(){a({store:o,status:"synced-local"})},onLoadError(c){a({status:"error",error:c})}});return()=>{i(c=>(c==null?void 0:c.id)===s?null:c),l.close()}},[e,o,t]),(r==null?void 0:r.storeWithStatus)??{status:"loading"}}let cE=!1;if(typeof window<"u"){const e=window.navigator.userAgent,t=!!e.match(/iPad/i)||!!e.match(/iPhone/i),n=!!e.match(/WebKit/i);cE=t&&n&&!e.match(/CriOS/i)}function CF(){const e=H();x.useEffect(()=>{if(!cE)return;function t(n){(n.target instanceof HTMLInputElement&&n.target.type==="text"||n.target instanceof HTMLTextAreaElement)&&e.complete()}return document.addEventListener("focusout",t),()=>document.removeEventListener("focusout",t)},[e])}function EF(){const e=H(),t=Yt();x.useEffect(()=>{const n=o=>t.style.setProperty("--tl-zoom",o.toString()),r=$_(n,100),i=new xa("useZoomCss",()=>{e.getCurrentPageShapeIds().size<300?n(e.getZoomLevel()):r(e.getZoomLevel())});return i.attach(),i.execute(),()=>{i.detach()}},[e,t])}const PF=[],IF=[],MF=x.memo(function({store:e,components:t,className:n,user:r,...i}){const[o,s]=J.useState(null),a=x.useMemo(()=>r??IC(),[r]),l=(t==null?void 0:t.ErrorFallback)===void 0?O2:t==null?void 0:t.ErrorFallback,c={...i,shapeUtils:i.shapeUtils??PF,tools:i.tools??IF,components:t};return y.jsx("div",{ref:s,draggable:!1,className:pe("tl-container tl-theme__light",n),onPointerDown:St,tabIndex:-1,children:y.jsx(zc,{fallback:l,onError:u=>t0(u,{tags:{origin:"react.tldraw-before-app"}}),children:o&&y.jsx(jz,{container:o,children:y.jsx(kN,{overrides:t,children:e?e instanceof Q_?y.jsx(dE,{...c,store:e,user:a}):y.jsx(uE,{...c,store:e,user:a}):y.jsx(AF,{...c,store:e,user:a})})})})})});function AF(e){const{defaultName:t,snapshot:n,initialData:r,shapeUtils:i,persistenceKey:o,sessionId:s,user:a}=e,l=_F({shapeUtils:i,initialData:r,persistenceKey:o,sessionId:s,defaultName:t,snapshot:n});return y.jsx(uE,{...e,store:l,user:a})}const uE=x.memo(function({store:e,user:t,...n}){var i;const r=Yt();switch(x.useLayoutEffect(()=>{t.userPreferences.get().isDarkMode&&(r.classList.remove("tl-theme__light"),r.classList.add("tl-theme__dark"))},[r,t]),e.status){case"error":throw e.error;case"loading":{const o=((i=n.components)==null?void 0:i.LoadingScreen)??MR;return y.jsx(o,{})}}return y.jsx(dE,{...n,store:e.store,user:t})});function dE({onMount:e,children:t,store:n,tools:r,shapeUtils:i,user:o,initialState:s,autoFocus:a=!0,inferDarkMode:l}){const{ErrorFallback:c}=kt(),u=Yt(),[d,h]=x.useState(null);x.useLayoutEffect(()=>{const g=new ae({store:n,shapeUtils:i,tools:r,getContainer:()=>u,user:o,initialState:s,inferDarkMode:l});return window.app=g,window.editor=g,h(g),()=>{g.dispose()}},[u,i,r,n,o,s,l]);const p=x.useSyncExternalStore(x.useCallback(g=>d?(d.on("crash",g),()=>d.off("crash",g)):()=>{},[d]),()=>(d==null?void 0:d.getCrashingError())??null);return d?y.jsx(zc,{fallback:c,onError:g=>d.annotateError(g,{origin:"react.tldraw",willCrashApp:!0}),children:p?y.jsx(jF,{crashingError:p}):y.jsx(x0.Provider,{value:d,children:y.jsx(TF,{autoFocus:a,onMount:e,children:t})})}):null}function TF({children:e,onMount:t,autoFocus:n}){return EF(),R9(),F9(),CF(),U9(),B9(n),LF(t),rR(),H().updateViewportScreenBounds(),e??y.jsx(N0,{})}function jF({crashingError:e}){throw e}function hE({children:e}){const{Spinner:t}=kt();return y.jsxs("div",{className:"tl-loading",children:[t?y.jsx(t,{}):null,e]})}function OF({children:e}){return y.jsx("div",{className:"tl-loading",children:e})}function LF(e){const t=H(),n=$9(r=>{const i=e==null?void 0:e(r);return r.emit("mount"),window.tldrawReady=!0,i});J.useLayoutEffect(()=>{if(t)return n==null?void 0:n(t)},[t,n])}function As({children:e,className:t="",...n}){return y.jsx("div",{...n,className:`tl-html-container ${t}`,children:e})}Pe(function({x:e=0,y:t=0,rotation:n=0,...r}){const i=H(),o=x.useRef(null),s=i.getCamera();return x.useLayoutEffect(()=>{const{x:a,y:l,z:c}=i.getCamera(),u=o.current;u&&a!==void 0&&(u.style.transform=`translate(${a}px, ${l}px) scale(${c}) rotate(${n}rad) translate(${e}px, ${t}px)`)},[s,i,e,t,n]),y.jsx("div",{ref:o,...r,className:pe("tl-positioned",r.className)})});function pE(e,t,n={}){const{newPoint:r,handle:i,scaleX:o,scaleY:s}=t,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:u=1/0}=n;let d=e.props.w*o,h=e.props.h*s;const p=new E(0,0);if(d>0){if(d<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=d-a;break}case"top":case"bottom":{p.x=(d-a)/2;break}default:p.x=0}d=a}}else if(p.x=d,d=-d,d<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=-d;break}default:p.x=-a}d=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=h-c;break}case"right":case"left":{p.y=(h-c)/2;break}default:p.y=0}h=c}}else if(p.y=h,h=-h,h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=-h;break}default:p.y=-c}h=c}const{x:g,y:f}=p.rot(e.rotation).add(r);return{x:g,y:f,props:{w:Math.min(l,d),h:Math.min(u,h)}}}class Wa extends Or{constructor(){super(...arguments);v(this,"onResize",(n,r)=>pE(n,r))}getGeometry(n){return new Ao({width:n.props.w,height:n.props.h,isFilled:!0})}}let DF=(fw=class extends ne{constructor(){super(...arguments);v(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(fw,"id","idle"),fw),zF=(gw=class extends ne{constructor(){super(...arguments);v(this,"markId","");v(this,"wasFocusedOnEnter",!1);v(this,"onEnter",()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen()});v(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){const{originPagePoint:n}=this.editor.inputs,r=this.parent.shapeType,i=Ve();this.markId=`creating:${i}`,this.editor.mark(this.markId),this.editor.createShapes([{id:i,type:r,x:n.x,y:n.y,props:{w:1,h:1}}]).select(i),this.editor.setCurrentTool("select.resizing",{...t,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:this.parent.onCreate})}});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()});v(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:t}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);const n=this.parent.shapeType,r=Ve();this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:n,x:t.x,y:t.y}]);const i=this.editor.getShape(r),{w:o,h:s}=this.editor.getShapeUtil(i).getDefaultProps(),a=new E(o/2,s/2),l=this.editor.getShapeParentTransform(i);l&&a.rot(-l.rotation()),this.editor.updateShapes([{id:r,type:n,x:i.x-a.x,y:i.y-a.y}]),this.editor.setSelectedShapes([r]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},v(gw,"id","pointing"),gw);class kp extends ne{constructor(){super(...arguments);v(this,"onCreate")}}v(kp,"id","box"),v(kp,"initial","idle"),v(kp,"children",()=>[DF,zF]);function fE(e,t){const n=x.useRef(e);return t(e,n.current)?n.current:(n.current=e,e)}function gE(e){return fE(e,LL)}function NF(e){return fE(e,X_)}function mE(e){const t=H();return Y("isCropping",()=>t.getCroppingShapeId()===e,[t,e])}function _p(e){const t=H();return Y("isEditing",()=>t.getEditingShapeId()===e,[t,e])}function ii(e){const t=H();return x.useMemo(function(){const n=s=>{if(s.isKilled)return;if(s.button===2){t.dispatch({type:"pointer",target:"selection",handle:e,name:"right_click",...En(s)});return}if(s.button!==0)return;const a=Wh(s.currentTarget);function l(){a.removeEventListener("pointerup",l),Lc(a,s)}Oc(a,s),a.addEventListener("pointerup",l),t.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:e,...En(s)}),St(s)};let r,i;function o(s){s.isKilled||s.button===0&&(s.clientX===r&&s.clientY===i||(r=s.clientX,i=s.clientY,t.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:e,...En(s)})))}return{onPointerDown:n,onPointerMove:o,onPointerUp:s=>{s.isKilled||s.button===0&&t.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:e,...En(s)})}}},[t,e])}const RF=20,FF=8;function tv(e,t=RF){return Math.max(FF,Math.ceil(e/t))}class $F extends Cs{constructor(n){super({...n,isFilled:!1,isClosed:!1});v(this,"_center");v(this,"radius");v(this,"start");v(this,"end");v(this,"measure");v(this,"length");v(this,"angleStart");v(this,"angleEnd");const{center:r,radius:i,sweepFlag:o,largeArcFlag:s,start:a,end:l}=n;if(a.equals(l))throw Error("Arc must have different start and end points.");this.angleStart=E.Angle(r,a),this.angleEnd=E.Angle(r,l),this.measure=BF(this.angleStart,this.angleEnd,o,s),this.length=this.measure*i,this.start=a,this.end=l,this._center=r,this.radius=i}nearestPoint(n){const{_center:r,measure:i,radius:o,angleEnd:s,angleStart:a,start:l,end:c}=this,u=yE(i,a,s,r.angle(n));if(u<=0)return l;if(u>=1)return c;const d=r.clone().add(n.clone().sub(r).uni().mul(o));let h=1/0,p;for(const g of[l,c,d])n.dist(g)<h&&(p=g,h=n.dist(g));if(!p)throw Error("nearest point not found");return p}hitTestLineSegment(n,r,i){const{_center:o,radius:s,measure:a,angleStart:l,angleEnd:c}=this,u=lp(n,r,o,s);return u===null?!1:u.some(d=>{const h=yE(a,l,c,o.angle(d));return h>=0&&h<=1})}getVertices(){const{_center:n,measure:r,length:i,radius:o,angleStart:s}=this,a=[];for(let l=0,c=tv(Math.abs(i));l<c+1;l++){const u=l/c*r,d=s+u;a.push(n.clone().add(new E(Math.cos(d),Math.sin(d)).mul(o)))}return a}}function yE(e,t,n,r){let i;if(Math.abs(e)>Te){i=$c(t,r);const o=$c(r,n);return Math.abs(i)<Math.abs(o)?i/e:(e-o)/e}else return i=$c(t,r),i/e}function BF(e,t,n,r){const i=2*((t-e)%De)%De-(t-e)%De;return r?(De-Math.abs(i))*(n?1:-1):i}class vE extends Cs{constructor(n){super({isClosed:!0,...n});v(this,"_center");v(this,"radius");v(this,"x");v(this,"y");this.config=n;const{x:r=0,y:i=0,radius:o}=n;this.x=r,this.y=i,this._center=new E(o+r,o+i),this.radius=o}getBounds(){return new se(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:n,radius:r}=this,i=De*r,o=[];for(let s=0,a=tv(i);s<a;s++){const l=s/a*De;o.push(n.clone().add(E.FromAngle(l).mul(r)))}return o}nearestPoint(n){const{_center:r,radius:i}=this;return r.equals(n)?E.AddXY(r,i,0):r.clone().add(n.clone().sub(r).uni().mul(i))}hitTestLineSegment(n,r,i){const{_center:o,radius:s}=this;return lp(n,r,o,s)!==null}}class UF extends Es{constructor(n){const{start:r,cp1:i,cp2:o,end:s}=n;super({...n,points:[r,s]});v(this,"a");v(this,"b");v(this,"c");v(this,"d");this.a=r,this.b=i,this.c=o,this.d=s}getVertices(){const n=[],{a:r,b:i,c:o,d:s}=this;for(let a=0,l=10;a<=l;a++){const c=a/l;n.push(new E((1-c)*(1-c)*(1-c)*r.x+3*((1-c)*(1-c))*c*i.x+3*(1-c)*(c*c)*o.x+c*c*c*s.x,(1-c)*(1-c)*(1-c)*r.y+3*((1-c)*(1-c))*c*i.y+3*(1-c)*(c*c)*o.y+c*c*c*s.y))}return n}midPoint(){return VF(this,.5)}nearestPoint(n){let r,i=1/0;for(const o of this.segments){const s=o.nearestPoint(n),a=s.dist(n);a<i&&(r=s,i=a)}if(!r)throw Error("nearest point not found");return r}}function VF(e,t){const{a:n,b:r,c:i,d:o}=e;return new E((1-t)*(1-t)*(1-t)*n.x+3*((1-t)*(1-t))*t*r.x+3*(1-t)*(t*t)*i.x+t*t*t*o.x,(1-t)*(1-t)*(1-t)*n.y+3*((1-t)*(1-t))*t*r.y+3*(1-t)*(t*t)*i.y+t*t*t*o.y)}class Cp extends Cs{constructor(n){super({...n,isClosed:!1,isFilled:!1});v(this,"points");v(this,"_segments");v(this,"_length");const{points:r}=n;this.points=r}get segments(){if(!this._segments){this._segments=[];const{points:n}=this,r=n.length,i=r-2,o=1.25;for(let s=0;s<r-1;s++){const a=s===0?n[0]:n[s-1],l=n[s],c=n[s+1],u=s===i?c:n[s+2],d=l,h=s===0?a:new E(l.x+(c.x-a.x)/6*o,l.y+(c.y-a.y)/6*o),p=s===i?c:new E(c.x-(u.x-l.x)/6*o,c.y-(u.y-l.y)/6*o),g=c;this._segments.push(new UF({start:d,cp1:h,cp2:p,end:g}))}}return this._segments}get length(){return this._length||(this._length=this.segments.reduce((n,r)=>n+r.length,0)),this._length}getVertices(){const n=this.segments.reduce((r,i)=>r.concat(i.vertices),[]);return n.push(this.points[this.points.length-1]),n}nearestPoint(n){let r,i=1/0;for(const o of this.segments){const s=o.nearestPoint(n),a=s.dist(n);a<i&&(r=s,i=a)}if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(n,r,i){return this.segments.some(o=>o.hitTestLineSegment(n,r,i))}}class bE extends Cs{constructor(n){super({...n,isClosed:!0});v(this,"w");v(this,"h");v(this,"_edges");this.config=n;const{width:r,height:i}=n;this.w=r,this.h=i}get edges(){if(!this._edges){const{vertices:n}=this;this._edges=[];for(let r=0,i=n.length;r<i;r++){const o=n[r],s=n[(r+1)%i];this._edges.push(new up({start:o,end:s}))}}return this._edges}getVertices(){const n=Math.max(1,this.w),r=Math.max(1,this.h),i=n/2,o=r/2,s=Math.pow(i-o,2)/Math.pow(i+o,2),a=Te*(i+o)*(1+3*s/(10+Math.sqrt(4-3*s))),l=tv(a),c=De/l,u=Math.cos(c),d=Math.sin(c);let h=0,p=1,g=0,f=1;const m=Array(l);for(let w=0;w<l;w++)m[w]=new E(i+i*p,o+o*h),g=d*p+u*h,f=u*p-d*h,h=g,p=f;return m}nearestPoint(n){let r,i=1/0;for(const o of this.edges){const s=o.nearestPoint(n),a=s.dist(n);a<i&&(r=s,i=a)}if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(n,r,i){return this.edges.some(o=>o.hitTestLineSegment(n,r,i))}getBounds(){return new se(0,0,this.w,this.h)}}class HF extends bE{constructor(t){super({...t}),this.config=t}getVertices(){const t=Math.max(1,this.w),n=Math.max(1,this.h),r=t/2,i=n/2,o=10,s=Array(o*2-2);if(n>t)for(let a=0;a<o-1;a++){const l=-Te+Te*a/(o-2),c=Te*a/(o-2);s[a]=new E(r+r*Math.cos(l),r+r*Math.sin(l)),s[a+(o-1)]=new E(r+r*Math.cos(c),n-r+r*Math.sin(c))}else for(let a=0;a<o-1;a++){const l=-Ke+Te*a/(o-2),c=Ke+Te*-a/(o-2);s[a]=new E(t-i+i*Math.cos(l),n-i+i*Math.sin(l)),s[a+(o-1)]=new E(i-i*Math.cos(c),n-i+i*Math.sin(c))}return s}}function wE(e,t){return e<0?1:e>t?-1:e<La?(La-e)/La:e>t-La?-(La-t+e)/La:0}function nv(e){if(!e.inputs.isDragging||e.inputs.isPanning)return;const{inputs:{currentScreenPoint:{x:t,y:n}}}=e,r=e.getZoomLevel(),i=e.getViewportScreenBounds(),o=i.w<1e3?.612:1,s=i.h<1e3?.612:1,a=wE(t-i.x,i.w),l=wE(n-i.y,i.h);if(a===0&&l===0)return;const c=e.user.getEdgeScrollSpeed()*uN,u=c*a*o/r,d=c*l*s/r,h=e.getCamera();e.setCamera({x:h.x+u,y:h.y+d})}async function KF({shouldReload:e=!0}={}){sessionStorage.clear(),await Promise.all(ev().map(t=>aF(t))),localStorage.clear(),e&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=KF);function WF(e,t="_blank"){_0.openWindow(e,t)}var tu=function(e){return e&&e.Math===Math&&e},In=tu(typeof globalThis=="object"&&globalThis)||tu(typeof window=="object"&&window)||tu(typeof self=="object"&&self)||tu(typeof Oe=="object"&&Oe)||tu(typeof Oe=="object"&&Oe)||function(){return this}()||Function("return this")(),rv={},dn=function(e){try{return!!e()}catch{return!0}},YF=dn,Lo=!YF(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),XF=dn,Ep=!XF(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),GF=Ep,Pp=Function.prototype.call,$i=GF?Pp.bind(Pp):function(){return Pp.apply(Pp,arguments)},xE={},SE={}.propertyIsEnumerable,kE=Object.getOwnPropertyDescriptor,qF=kE&&!SE.call({1:2},1);xE.f=qF?function(e){var t=kE(this,e);return!!t&&t.enumerable}:SE;var _E=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}},CE=Ep,EE=Function.prototype,iv=EE.call,ZF=CE&&EE.bind.bind(iv,iv),Ct=CE?ZF:function(e){return function(){return iv.apply(e,arguments)}},PE=Ct,QF=PE({}.toString),JF=PE("".slice),Ya=function(e){return JF(QF(e),8,-1)},e$=Ct,t$=dn,n$=Ya,ov=Object,r$=e$("".split),i$=t$(function(){return!ov("z").propertyIsEnumerable(0)})?function(e){return n$(e)==="String"?r$(e,""):ov(e)}:ov,Ip=function(e){return e==null},o$=Ip,s$=TypeError,Xa=function(e){if(o$(e))throw new s$("Can't call method on "+e);return e},a$=i$,l$=Xa,Mp=function(e){return a$(l$(e))},sv=typeof document=="object"&&document.all,hn=typeof sv>"u"&&sv!==void 0?function(e){return typeof e=="function"||e===sv}:function(e){return typeof e=="function"},c$=hn,Ts=function(e){return typeof e=="object"?e!==null:c$(e)},av=In,u$=hn,d$=function(e){return u$(e)?e:void 0},Ap=function(e,t){return arguments.length<2?d$(av[e]):av[e]&&av[e][t]},h$=Ct,IE=h$({}.isPrototypeOf),p$=typeof navigator<"u"&&String(navigator.userAgent)||"",ME=In,lv=p$,AE=ME.process,TE=ME.Deno,jE=AE&&AE.versions||TE&&TE.version,OE=jE&&jE.v8,Dr,Tp;OE&&(Dr=OE.split("."),Tp=Dr[0]>0&&Dr[0]<4?1:+(Dr[0]+Dr[1])),!Tp&&lv&&(Dr=lv.match(/Edge\/(\d+)/),(!Dr||Dr[1]>=74)&&(Dr=lv.match(/Chrome\/(\d+)/),Dr&&(Tp=+Dr[1])));var f$=Tp,LE=f$,g$=dn,m$=In,y$=m$.String,DE=!!Object.getOwnPropertySymbols&&!g$(function(){var e=Symbol("symbol detection");return!y$(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&LE&&LE<41}),v$=DE,zE=v$&&!Symbol.sham&&typeof Symbol.iterator=="symbol",b$=Ap,w$=hn,x$=IE,S$=zE,k$=Object,NE=S$?function(e){return typeof e=="symbol"}:function(e){var t=b$("Symbol");return w$(t)&&x$(t.prototype,k$(e))},_$=String,C$=function(e){try{return _$(e)}catch{return"Object"}},E$=hn,P$=C$,I$=TypeError,cv=function(e){if(E$(e))return e;throw new I$(P$(e)+" is not a function")},M$=cv,A$=Ip,uv=function(e,t){var n=e[t];return A$(n)?void 0:M$(n)},dv=$i,hv=hn,pv=Ts,T$=TypeError,j$=function(e,t){var n,r;if(t==="string"&&hv(n=e.toString)&&!pv(r=dv(n,e))||hv(n=e.valueOf)&&!pv(r=dv(n,e))||t!=="string"&&hv(n=e.toString)&&!pv(r=dv(n,e)))return r;throw new T$("Can't convert object to primitive value")},RE={exports:{}},FE=In,O$=Object.defineProperty,fv=function(e,t){try{O$(FE,e,{value:t,configurable:!0,writable:!0})}catch{FE[e]=t}return t},L$=In,D$=fv,$E="__core-js_shared__",z$=L$[$E]||D$($E,{}),gv=z$,BE=gv;(RE.exports=function(e,t){return BE[e]||(BE[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.35.1",mode:"global",copyright:"\xA9 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.35.1/LICENSE",source:"https://github.com/zloirock/core-js"});var mv=RE.exports,N$=Xa,R$=Object,nu=function(e){return R$(N$(e))},F$=Ct,$$=nu,B$=F$({}.hasOwnProperty),Do=Object.hasOwn||function(e,t){return B$($$(e),t)},U$=Ct,V$=0,H$=Math.random(),K$=U$(1 .toString),UE=function(e){return"Symbol("+(e===void 0?"":e)+")_"+K$(++V$+H$,36)},W$=In,Y$=mv,VE=Do,X$=UE,G$=DE,q$=zE,Ga=W$.Symbol,yv=Y$("wks"),Z$=q$?Ga.for||Ga:Ga&&Ga.withoutSetter||X$,Bi=function(e){return VE(yv,e)||(yv[e]=G$&&VE(Ga,e)?Ga[e]:Z$("Symbol."+e)),yv[e]},Q$=$i,HE=Ts,KE=NE,J$=uv,e7=j$,t7=Bi,n7=TypeError,r7=t7("toPrimitive"),i7=function(e,t){if(!HE(e)||KE(e))return e;var n=J$(e,r7),r;if(n){if(t===void 0&&(t="default"),r=Q$(n,e,t),!HE(r)||KE(r))return r;throw new n7("Can't convert object to primitive value")}return t===void 0&&(t="number"),e7(e,t)},o7=i7,s7=NE,WE=function(e){var t=o7(e,"string");return s7(t)?t:t+""},a7=In,YE=Ts,vv=a7.document,l7=YE(vv)&&YE(vv.createElement),XE=function(e){return l7?vv.createElement(e):{}},c7=Lo,u7=dn,d7=XE,GE=!c7&&!u7(function(){return Object.defineProperty(d7("div"),"a",{get:function(){return 7}}).a!==7}),h7=Lo,p7=$i,f7=xE,g7=_E,m7=Mp,y7=WE,v7=Do,b7=GE,qE=Object.getOwnPropertyDescriptor;rv.f=h7?qE:function(e,t){if(e=m7(e),t=y7(t),b7)try{return qE(e,t)}catch{}if(v7(e,t))return g7(!p7(f7.f,e,t),e[t])};var qa={},w7=Lo,x7=dn,ZE=w7&&x7(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),S7=Ts,k7=String,_7=TypeError,js=function(e){if(S7(e))return e;throw new _7(k7(e)+" is not an object")},C7=Lo,E7=GE,P7=ZE,jp=js,QE=WE,I7=TypeError,bv=Object.defineProperty,M7=Object.getOwnPropertyDescriptor,wv="enumerable",xv="configurable",Sv="writable";qa.f=C7?P7?function(e,t,n){if(jp(e),t=QE(t),jp(n),typeof e=="function"&&t==="prototype"&&"value"in n&&Sv in n&&!n[Sv]){var r=M7(e,t);r&&r[Sv]&&(e[t]=n.value,n={configurable:xv in n?n[xv]:r[xv],enumerable:wv in n?n[wv]:r[wv],writable:!1})}return bv(e,t,n)}:bv:function(e,t,n){if(jp(e),t=QE(t),jp(n),E7)try{return bv(e,t,n)}catch{}if("get"in n||"set"in n)throw new I7("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var A7=Lo,T7=qa,j7=_E,kv=A7?function(e,t,n){return T7.f(e,t,j7(1,n))}:function(e,t,n){return e[t]=n,e},JE={exports:{}},_v=Lo,O7=Do,eP=Function.prototype,L7=_v&&Object.getOwnPropertyDescriptor,Cv=O7(eP,"name"),D7=Cv&&(function(){}).name==="something",z7=Cv&&(!_v||_v&&L7(eP,"name").configurable),N7={EXISTS:Cv,PROPER:D7,CONFIGURABLE:z7},R7=Ct,F7=hn,Ev=gv,$7=R7(Function.toString);F7(Ev.inspectSource)||(Ev.inspectSource=function(e){return $7(e)});var tP=Ev.inspectSource,B7=In,U7=hn,nP=B7.WeakMap,V7=U7(nP)&&/native code/.test(String(nP)),H7=mv,K7=UE,rP=H7("keys"),iP=function(e){return rP[e]||(rP[e]=K7(e))},Pv={},W7=V7,oP=In,Y7=Ts,X7=kv,Iv=Do,Mv=gv,G7=iP,q7=Pv,sP="Object already initialized",Av=oP.TypeError,Z7=oP.WeakMap,Op,ru,Lp,Q7=function(e){return Lp(e)?ru(e):Op(e,{})},J7=function(e){return function(t){var n;if(!Y7(t)||(n=ru(t)).type!==e)throw new Av("Incompatible receiver, "+e+" required");return n}};if(W7||Mv.state){var oi=Mv.state||(Mv.state=new Z7);oi.get=oi.get,oi.has=oi.has,oi.set=oi.set,Op=function(e,t){if(oi.has(e))throw new Av(sP);return t.facade=e,oi.set(e,t),t},ru=function(e){return oi.get(e)||{}},Lp=function(e){return oi.has(e)}}else{var Za=G7("state");q7[Za]=!0,Op=function(e,t){if(Iv(e,Za))throw new Av(sP);return t.facade=e,X7(e,Za,t),t},ru=function(e){return Iv(e,Za)?e[Za]:{}},Lp=function(e){return Iv(e,Za)}}var aP={set:Op,get:ru,has:Lp,enforce:Q7,getterFor:J7},Tv=Ct,eB=dn,tB=hn,Dp=Do,jv=Lo,nB=N7.CONFIGURABLE,rB=tP,lP=aP,iB=lP.enforce,oB=lP.get,cP=String,zp=Object.defineProperty,sB=Tv("".slice),aB=Tv("".replace),lB=Tv([].join),cB=jv&&!eB(function(){return zp(function(){},"length",{value:8}).length!==8}),uB=String(String).split("String"),dB=JE.exports=function(e,t,n){sB(cP(t),0,7)==="Symbol("&&(t="["+aB(cP(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!Dp(e,"name")||nB&&e.name!==t)&&(jv?zp(e,"name",{value:t,configurable:!0}):e.name=t),cB&&n&&Dp(n,"arity")&&e.length!==n.arity&&zp(e,"length",{value:n.arity});try{n&&Dp(n,"constructor")&&n.constructor?jv&&zp(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch{}var r=iB(e);return Dp(r,"source")||(r.source=lB(uB,typeof t=="string"?t:"")),e};Function.prototype.toString=dB(function(){return tB(this)&&oB(this).source||rB(this)},"toString");var hB=JE.exports,pB=hn,fB=qa,gB=hB,mB=fv,uP=function(e,t,n,r){r||(r={});var i=r.enumerable,o=r.name!==void 0?r.name:t;if(pB(n)&&gB(n,o,r),r.global)i?e[t]=n:mB(t,n);else{try{r.unsafe?e[t]&&(i=!0):delete e[t]}catch{}i?e[t]=n:fB.f(e,t,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e},dP={},yB=Math.ceil,vB=Math.floor,bB=Math.trunc||function(e){var t=+e;return(t>0?vB:yB)(t)},wB=bB,Os=function(e){var t=+e;return t!==t||t===0?0:wB(t)},xB=Os,SB=Math.max,kB=Math.min,_B=function(e,t){var n=xB(e);return n<0?SB(n+t,0):kB(n,t)},CB=Os,EB=Math.min,hP=function(e){var t=CB(e);return t>0?EB(t,9007199254740991):0},PB=hP,iu=function(e){return PB(e.length)},IB=Mp,MB=_B,AB=iu,pP=function(e){return function(t,n,r){var i=IB(t),o=AB(i),s=MB(r,o),a;if(e&&n!==n){for(;o>s;)if(a=i[s++],a!==a)return!0}else for(;o>s;s++)if((e||s in i)&&i[s]===n)return e||s||0;return!e&&-1}},TB={includes:pP(!0),indexOf:pP(!1)},jB=Ct,Ov=Do,OB=Mp,LB=TB.indexOf,DB=Pv,fP=jB([].push),gP=function(e,t){var n=OB(e),r=0,i=[],o;for(o in n)!Ov(DB,o)&&Ov(n,o)&&fP(i,o);for(;t.length>r;)Ov(n,o=t[r++])&&(~LB(i,o)||fP(i,o));return i},Lv=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],zB=gP,NB=Lv,RB=NB.concat("length","prototype");dP.f=Object.getOwnPropertyNames||function(e){return zB(e,RB)};var mP={};mP.f=Object.getOwnPropertySymbols;var FB=Ap,$B=Ct,BB=dP,UB=mP,VB=js,HB=$B([].concat),KB=FB("Reflect","ownKeys")||function(e){var t=BB.f(VB(e)),n=UB.f;return n?HB(t,n(e)):t},yP=Do,WB=KB,YB=rv,XB=qa,GB=function(e,t,n){for(var r=WB(t),i=XB.f,o=YB.f,s=0;s<r.length;s++){var a=r[s];!yP(e,a)&&!(n&&yP(n,a))&&i(e,a,o(t,a))}},qB=dn,ZB=hn,QB=/#|\.prototype\./,ou=function(e,t){var n=eU[JB(e)];return n===nU?!0:n===tU?!1:ZB(t)?qB(t):!!t},JB=ou.normalize=function(e){return String(e).replace(QB,".").toLowerCase()},eU=ou.data={},tU=ou.NATIVE="N",nU=ou.POLYFILL="P",rU=ou,Np=In,iU=rv.f,oU=kv,sU=uP,aU=fv,lU=GB,cU=rU,Qa=function(e,t){var n=e.target,r=e.global,i=e.stat,o,s,a,l,c,u;if(r?s=Np:i?s=Np[n]||aU(n,{}):s=Np[n]&&Np[n].prototype,s)for(a in t){if(c=t[a],e.dontCallGetSet?(u=iU(s,a),l=u&&u.value):l=s[a],o=cU(r?a:n+(i?".":"#")+a,e.forced),!o&&l!==void 0){if(typeof c==typeof l)continue;lU(c,l)}(e.sham||l&&l.sham)&&oU(c,"sham",!0),sU(s,a,c,e)}},vP={},uU=gP,dU=Lv,hU=Object.keys||function(e){return uU(e,dU)},pU=Lo,fU=ZE,gU=qa,mU=js,yU=Mp,vU=hU;vP.f=pU&&!fU?Object.defineProperties:function(e,t){mU(e);for(var n=yU(t),r=vU(t),i=r.length,o=0,s;i>o;)gU.f(e,s=r[o++],n[s]);return e};var bU=Ap,wU=bU("document","documentElement"),xU=js,SU=vP,bP=Lv,kU=Pv,_U=wU,CU=XE,EU=iP,wP=">",xP="<",Dv="prototype",zv="script",SP=EU("IE_PROTO"),Nv=function(){},kP=function(e){return xP+zv+wP+e+xP+"/"+zv+wP},_P=function(e){e.write(kP("")),e.close();var t=e.parentWindow.Object;return e=null,t},PU=function(){var e=CU("iframe"),t="java"+zv+":",n;return e.style.display="none",_U.appendChild(e),e.src=String(t),n=e.contentWindow.document,n.open(),n.write(kP("document.F=Object")),n.close(),n.F},Rp,Fp=function(){try{Rp=new ActiveXObject("htmlfile")}catch{}Fp=typeof document<"u"?document.domain&&Rp?_P(Rp):PU():_P(Rp);for(var e=bP.length;e--;)delete Fp[Dv][bP[e]];return Fp()};kU[SP]=!0;var CP=Object.create||function(e,t){var n;return e!==null?(Nv[Dv]=xU(e),n=new Nv,Nv[Dv]=null,n[SP]=e):n=Fp(),t===void 0?n:SU.f(n,t)},IU=Bi,MU=CP,AU=qa.f,Rv=IU("unscopables"),Fv=Array.prototype;Fv[Rv]===void 0&&AU(Fv,Rv,{configurable:!0,value:MU(null)});var $v=function(e){Fv[Rv][e]=!0},TU=Qa,jU=nu,OU=iu,LU=Os,DU=$v;TU({target:"Array",proto:!0},{at:function(e){var t=jU(this),n=OU(t),r=LU(e),i=r>=0?r:n+r;return i<0||i>=n?void 0:t[i]}}),DU("at");var zU=In,NU=Ct,su=function(e,t){return NU(zU[e].prototype[t])},RU=su;RU("Array","at");var FU=Ya,EP=Array.isArray||function(e){return FU(e)==="Array"},$U=TypeError,BU=9007199254740991,UU=function(e){if(e>BU)throw $U("Maximum allowed index exceeded");return e},VU=Ya,HU=Ct,KU=function(e){if(VU(e)==="Function")return HU(e)},PP=KU,WU=cv,YU=Ep,XU=PP(PP.bind),GU=function(e,t){return WU(e),t===void 0?e:YU?XU(e,t):function(){return e.apply(t,arguments)}},qU=EP,ZU=iu,QU=UU,JU=GU,IP=function(e,t,n,r,i,o,s,a){for(var l=i,c=0,u=s?JU(s,a):!1,d,h;c<r;)c in n&&(d=u?u(n[c],c,t):n[c],o>0&&qU(d)?(h=ZU(d),l=IP(e,t,d,h,l,o-1)-1):(QU(l+1),e[l]=d),l++),c++;return l},MP=IP,eV=Bi,tV=eV("toStringTag"),AP={};AP[tV]="z";var nV=String(AP)==="[object z]",rV=nV,iV=hn,$p=Ya,oV=Bi,sV=oV("toStringTag"),aV=Object,lV=$p(function(){return arguments}())==="Arguments",cV=function(e,t){try{return e[t]}catch{}},TP=rV?$p:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=cV(t=aV(e),sV))=="string"?n:lV?$p(t):(r=$p(t))==="Object"&&iV(t.callee)?"Arguments":r},uV=Ct,dV=dn,jP=hn,hV=TP,pV=Ap,fV=tP,OP=function(){},LP=pV("Reflect","construct"),Bv=/^\s*(?:class|function)\b/,gV=uV(Bv.exec),mV=!Bv.test(OP),au=function(e){if(!jP(e))return!1;try{return LP(OP,[],e),!0}catch{return!1}},DP=function(e){if(!jP(e))return!1;switch(hV(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return mV||!!gV(Bv,fV(e))}catch{return!0}};DP.sham=!0;var yV=!LP||dV(function(){var e;return au(au.call)||!au(Object)||!au(function(){e=!0})||e})?DP:au,zP=EP,vV=yV,bV=Ts,wV=Bi,xV=wV("species"),NP=Array,SV=function(e){var t;return zP(e)&&(t=e.constructor,vV(t)&&(t===NP||zP(t.prototype))?t=void 0:bV(t)&&(t=t[xV],t===null&&(t=void 0))),t===void 0?NP:t},kV=SV,RP=function(e,t){return new(kV(e))(t===0?0:t)},_V=Qa,CV=MP,EV=nu,PV=iu,IV=Os,MV=RP;_V({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=EV(this),n=PV(t),r=MV(t,0);return r.length=CV(r,t,t,n,0,e===void 0?1:IV(e)),r}});var AV=$v;AV("flat");var TV=su;TV("Array","flat");var jV=Qa,OV=MP,LV=cv,DV=nu,zV=iu,NV=RP;jV({target:"Array",proto:!0},{flatMap:function(e){var t=DV(this),n=zV(t),r;return LV(e),r=NV(t,0),r.length=OV(r,t,t,n,0,1,e,arguments.length>1?arguments[1]:void 0),r}});var RV=$v;RV("flatMap");var FV=su;FV("Array","flatMap");var $V=TP,BV=String,lu=function(e){if($V(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return BV(e)},UV=Qa,VV=Ct,HV=Xa,KV=Os,WV=lu,YV=dn,XV=VV("".charAt),GV=YV(function(){return"\u{20BB7}".at(-2)!=="\uD842"});UV({target:"String",proto:!0,forced:GV},{at:function(e){var t=WV(HV(this)),n=t.length,r=KV(e),i=r>=0?r:n+r;return i<0||i>=n?void 0:XV(t,i)}});var qV=su;qV("String","at");var ZV=js,FP=function(){var e=ZV(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Uv=dn,QV=In,Vv=QV.RegExp,Hv=Uv(function(){var e=Vv("a","y");return e.lastIndex=2,e.exec("abcd")!==null}),JV=Hv||Uv(function(){return!Vv("a","y").sticky}),eH=Hv||Uv(function(){var e=Vv("^r","gy");return e.lastIndex=2,e.exec("str")!==null}),tH={BROKEN_CARET:eH,MISSED_STICKY:JV,UNSUPPORTED_Y:Hv},nH=dn,rH=In,iH=rH.RegExp,oH=nH(function(){var e=iH(".","s");return!(e.dotAll&&e.test(`
`)&&e.flags==="s")}),sH=dn,aH=In,lH=aH.RegExp,cH=sH(function(){var e=lH("(?<a>b)","g");return e.exec("b").groups.a!=="b"||"b".replace(e,"$<a>c")!=="bc"}),Ja=$i,Bp=Ct,uH=lu,dH=FP,hH=tH,pH=mv,fH=CP,gH=aP.get,mH=oH,yH=cH,vH=pH("native-string-replace",String.prototype.replace),Up=RegExp.prototype.exec,Kv=Up,bH=Bp("".charAt),wH=Bp("".indexOf),xH=Bp("".replace),Wv=Bp("".slice),Yv=function(){var e=/a/,t=/b*/g;return Ja(Up,e,"a"),Ja(Up,t,"a"),e.lastIndex!==0||t.lastIndex!==0}(),$P=hH.BROKEN_CARET,Xv=/()??/.exec("")[1]!==void 0,SH=Yv||Xv||$P||mH||yH;SH&&(Kv=function(e){var t=this,n=gH(t),r=uH(e),i=n.raw,o,s,a,l,c,u,d;if(i)return i.lastIndex=t.lastIndex,o=Ja(Kv,i,r),t.lastIndex=i.lastIndex,o;var h=n.groups,p=$P&&t.sticky,g=Ja(dH,t),f=t.source,m=0,w=r;if(p&&(g=xH(g,"y",""),wH(g,"g")===-1&&(g+="g"),w=Wv(r,t.lastIndex),t.lastIndex>0&&(!t.multiline||t.multiline&&bH(r,t.lastIndex-1)!==`
`)&&(f="(?: "+f+")",w=" "+w,m++),s=new RegExp("^(?:"+f+")",g)),Xv&&(s=new RegExp("^"+f+"$(?!\\s)",g)),Yv&&(a=t.lastIndex),l=Ja(Up,p?s:t,w),p?l?(l.input=Wv(l.input,m),l[0]=Wv(l[0],m),l.index=t.lastIndex,t.lastIndex+=l[0].length):t.lastIndex=0:Yv&&l&&(t.lastIndex=t.global?l.index+l[0].length:a),Xv&&l&&l.length>1&&Ja(vH,l[0],s,function(){for(c=1;c<arguments.length-2;c++)arguments[c]===void 0&&(l[c]=void 0)}),l&&h)for(l.groups=u=fH(null),c=0;c<h.length;c++)d=h[c],u[d[0]]=l[d[1]];return l});var Gv=Kv,kH=Qa,BP=Gv;kH({target:"RegExp",proto:!0,forced:/./.exec!==BP},{exec:BP});var _H=Ep,UP=Function.prototype,VP=UP.apply,HP=UP.call,CH=typeof Reflect=="object"&&Reflect.apply||(_H?HP.bind(VP):function(){return HP.apply(VP,arguments)}),KP=$i,WP=uP,EH=Gv,YP=dn,XP=Bi,PH=kv,IH=XP("species"),qv=RegExp.prototype,MH=function(e,t,n,r){var i=XP(e),o=!YP(function(){var c={};return c[i]=function(){return 7},""[e](c)!==7}),s=o&&!YP(function(){var c=!1,u=/a/;return e==="split"&&(u={},u.constructor={},u.constructor[IH]=function(){return u},u.flags="",u[i]=/./[i]),u.exec=function(){return c=!0,null},u[i](""),!c});if(!o||!s||n){var a=/./[i],l=t(i,""[e],function(c,u,d,h,p){var g=u.exec;return g===EH||g===qv.exec?o&&!p?{done:!0,value:KP(a,u,d,h)}:{done:!0,value:KP(c,d,u,h)}:{done:!1}});WP(String.prototype,e,l[0]),WP(qv,i,l[1])}r&&PH(qv[i],"sham",!0)},Zv=Ct,AH=Os,TH=lu,jH=Xa,OH=Zv("".charAt),GP=Zv("".charCodeAt),LH=Zv("".slice),qP=function(e){return function(t,n){var r=TH(jH(t)),i=AH(n),o=r.length,s,a;return i<0||i>=o?e?"":void 0:(s=GP(r,i),s<55296||s>56319||i+1===o||(a=GP(r,i+1))<56320||a>57343?e?OH(r,i):s:e?LH(r,i,i+2):(s-55296<<10)+(a-56320)+65536)}},DH={codeAt:qP(!1),charAt:qP(!0)},zH=DH.charAt,NH=function(e,t,n){return t+(n?zH(e,t).length:1)},Qv=Ct,RH=nu,FH=Math.floor,Jv=Qv("".charAt),$H=Qv("".replace),eb=Qv("".slice),BH=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,UH=/\$([$&'`]|\d{1,2})/g,ZP=function(e,t,n,r,i,o){var s=n+e.length,a=r.length,l=UH;return i!==void 0&&(i=RH(i),l=BH),$H(o,l,function(c,u){var d;switch(Jv(u,0)){case"$":return"$";case"&":return e;case"`":return eb(t,0,n);case"'":return eb(t,s);case"<":d=i[eb(u,1,-1)];break;default:var h=+u;if(h===0)return c;if(h>a){var p=FH(h/10);return p===0?c:p<=a?r[p-1]===void 0?Jv(u,1):r[p-1]+Jv(u,1):c}d=r[h-1]}return d===void 0?"":d})},QP=$i,VH=js,HH=hn,KH=Ya,WH=Gv,YH=TypeError,XH=function(e,t){var n=e.exec;if(HH(n)){var r=QP(n,e,t);return r!==null&&VH(r),r}if(KH(e)==="RegExp")return QP(WH,e,t);throw new YH("RegExp#exec called on incompatible receiver")},GH=CH,JP=$i,Vp=Ct,qH=MH,ZH=dn,QH=js,JH=hn,eK=Ip,tK=Os,nK=hP,el=lu,rK=Xa,iK=NH,oK=uv,sK=ZP,aK=XH,lK=Bi,tb=lK("replace"),cK=Math.max,uK=Math.min,dK=Vp([].concat),nb=Vp([].push),eI=Vp("".indexOf),tI=Vp("".slice),hK=function(e){return e===void 0?e:String(e)},pK=function(){return"a".replace(/./,"$0")==="$0"}(),nI=function(){return/./[tb]?/./[tb]("a","$0")==="":!1}(),fK=!ZH(function(){var e=/./;return e.exec=function(){var t=[];return t.groups={a:"7"},t},"".replace(e,"$<a>")!=="7"});qH("replace",function(e,t,n){var r=nI?"$":"$0";return[function(i,o){var s=rK(this),a=eK(i)?void 0:oK(i,tb);return a?JP(a,i,s,o):JP(t,el(s),i,o)},function(i,o){var s=QH(this),a=el(i);if(typeof o=="string"&&eI(o,r)===-1&&eI(o,"$<")===-1){var l=n(t,s,a,o);if(l.done)return l.value}var c=JH(o);c||(o=el(o));var u=s.global,d;u&&(d=s.unicode,s.lastIndex=0);for(var h=[],p;p=aK(s,a),!(p===null||(nb(h,p),!u));){var g=el(p[0]);g===""&&(s.lastIndex=iK(a,nK(s.lastIndex),d))}for(var f="",m=0,w=0;w<h.length;w++){p=h[w];for(var b=el(p[0]),k=cK(uK(tK(p.index),a.length),0),S=[],C,_=1;_<p.length;_++)nb(S,hK(p[_]));var P=p.groups;if(c){var I=dK([b],S,k,a);P!==void 0&&nb(I,P),C=el(GH(o,void 0,I))}else C=sK(b,a,k,S,P,o);k>=m&&(f+=tI(a,m,k)+C,m=k+b.length)}return f+tI(a,m)}]},!fK||!pK||nI);var gK=Ts,mK=Ya,yK=Bi,vK=yK("match"),bK=function(e){var t;return gK(e)&&((t=e[vK])!==void 0?!!t:mK(e)==="RegExp")},wK=$i,xK=Do,SK=IE,kK=FP,rI=RegExp.prototype,_K=function(e){var t=e.flags;return t===void 0&&!("flags"in rI)&&!xK(e,"flags")&&SK(rI,e)?wK(kK,e):t},CK=Qa,EK=$i,rb=Ct,iI=Xa,PK=hn,IK=Ip,MK=bK,cu=lu,AK=uv,TK=_K,jK=ZP,OK=Bi,LK=OK("replace"),DK=TypeError,ib=rb("".indexOf);rb("".replace);var oI=rb("".slice),zK=Math.max;CK({target:"String",proto:!0},{replaceAll:function(e,t){var n=iI(this),r,i,o,s,a,l,c,u,d,h=0,p=0,g="";if(!IK(e)){if(r=MK(e),r&&(i=cu(iI(TK(e))),!~ib(i,"g")))throw new DK("`.replaceAll` does not allow non-global regexes");if(o=AK(e,LK),o)return EK(o,e,n,t)}for(s=cu(n),a=cu(e),l=PK(t),l||(t=cu(t)),c=a.length,u=zK(1,c),h=ib(s,a);h!==-1;)d=l?cu(t(a,h,s)):jK(a,s,h,[],void 0,t),g+=oI(s,p,h)+d,p=h+c,h=h+u>s.length?-1:ib(s,a,h+u);return p<s.length&&(g+=oI(s,p)),g}});var NK=su;NK("String","replaceAll");const RK=({children:e})=>{const t=H();return Y("shouldDisplayHandles",()=>t.isInAny("select.idle","select.pointing_handle"),[t])?y.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:e}):null},FK=({shapeId:e})=>{const t=H();return Y("show hovered",()=>t.isIn("select.editing_shape")?t.getHoveredShapeId()!==t.getEditingShapeId():t.isInAny("select.idle"),[t])?y.jsx(Nc,{className:"tl-user-indicator__hovered",id:e}):null},{PI:$K}=Math,tl=$K+1e-4;function sI(e,t={}){const{size:n=16,smoothing:r=.5}=t;if(e.length===0||n<=0)return{left:[],right:[]};const i=e[0],o=e[e.length-1],s=o.runningLength,a=Math.pow(n*r,2),l=[],c=[];let u=e[0].vector,d=e[0].point,h=d,p=d,g=h,f=!1,m;for(let w=0;w<e.length;w++){m=e[w];const{point:b,vector:k}=e[w],S=m.vector.dpr(u),C=(w<e.length-1?e[w+1]:e[w]).vector,_=w<e.length-1?C.dpr(m.vector):1,P=S<0&&!f,I=_!==null&&_<.2;if(P||I){if(_>-.62&&s-m.runningLength>m.radius){const A=u.clone().mul(m.radius);u.clone().cpr(C)<0?(p=E.Add(b,A),g=E.Sub(b,A)):(p=E.Sub(b,A),g=E.Add(b,A)),l.push(p),c.push(g)}else{const A=u.clone().mul(m.radius).per(),L=E.Sub(m.input,A);for(let z=1/13,$=0;$<1;$+=z)p=E.RotWith(L,m.input,tl*$),l.push(p),g=E.RotWith(L,m.input,tl+tl*-$),c.push(g)}d=p,h=g,I&&(f=!0);continue}if(f=!1,m===i||m===o){const A=E.Per(k).mul(m.radius);l.push(E.Sub(b,A)),c.push(E.Add(b,A));continue}const M=E.Lrp(C,k,_).per().mul(m.radius);p=E.Sub(b,M),(w<=1||E.Dist2(d,p)>a)&&(l.push(p),d=p),g=E.Add(b,M),(w<=1||E.Dist2(h,g)>a)&&(c.push(g),h=g),u=k}return{left:l,right:c}}function uu(e,t={}){const{size:n=16,start:r={},end:i={},last:o=!1}=t,{cap:s=!0}=r,{cap:a=!0}=i;if(e.length===0||n<=0)return[];const l=e[0],c=e[e.length-1],u=c.runningLength,d=r.taper===!1?0:r.taper===!0?Math.max(n,u):r.taper,h=i.taper===!1?0:i.taper===!0?Math.max(n,u):i.taper,{left:p,right:g}=sI(e,t),f=l.point,m=e.length>1?e[e.length-1].point:E.AddXY(l.point,1,1);if(e.length===1&&(!(d||h)||o)){const S=E.Add(f,E.Sub(f,m).uni().per().mul(-l.radius)),C=[];for(let _=1/13,P=_;P<=1;P+=_)C.push(E.RotWith(S,f,tl*2*P));return C}const w=[];if(!(d||h&&e.length===1))if(s)for(let S=1/8,C=S;C<=1;C+=S){const _=E.RotWith(g[0],f,tl*C);w.push(_)}else{const S=E.Sub(p[0],g[0]),C=E.Mul(S,.5),_=E.Mul(S,.51);w.push(E.Sub(f,C),E.Sub(f,_),E.Add(f,_),E.Add(f,C))}const b=[],k=c.vector.clone().per().neg();if(h||d&&e.length===1)b.push(m);else if(a){const S=E.Add(m,E.Mul(k,c.radius));for(let C=1/29,_=C;_<1;_+=C)b.push(E.RotWith(S,m,tl*3*_))}else b.push(E.Add(m,E.Mul(k,c.radius)),E.Add(m,E.Mul(k,c.radius*.99)),E.Sub(m,E.Mul(k,c.radius*.99)),E.Sub(m,E.Mul(k,c.radius)));return p.concat(b,g.reverse(),w)}const BK=.025,UK=.01;function zr(e,t={}){var m;const{streamline:n=.5,size:r=16,simulatePressure:i=!1}=t;if(e.length===0)return[];const o=.15+(1-n)*.85;let s=e.map(E.From),a=0;if(!i){let w=s[0];for(;w&&!(w.z>=BK);)s.shift(),w=s[0]}if(!i){let w=s[s.length-1];for(;w&&!(w.z>=UK);)s.pop(),w=s[s.length-1]}if(s.length===0)return[{point:E.From(e[0]),input:E.From(e[0]),pressure:i?.5:.15,vector:new E(1,1),distance:0,runningLength:0,radius:1}];let l=s[1];for(;l&&!(E.Dist(l,s[0])>r/3);)s[0].z=Math.max(s[0].z,l.z),s.splice(1,1),l=s[1];const c=s.pop();for(l=s[s.length-1];l&&!(E.Dist(l,c)>r/3);)s.pop(),l=s[s.length-1],a++;s.push(c);const u=t.last||!t.simulatePressure||s.length>1&&E.Dist(s[s.length-1],s[s.length-2])<r||a>0;if(s.length===2&&t.simulatePressure){const w=s[1];s=s.slice(0,-1);for(let b=1;b<5;b++){const k=E.Lrp(s[0],w,b/4);k.z=(s[0].z+(w.z-s[0].z))*b/4,s.push(k)}}const d=[{point:s[0],input:s[0],pressure:i?.5:s[0].z,vector:new E(1,1),distance:0,runningLength:0,radius:1}];let h=0,p=d[0],g,f;u&&n>0&&s.push(s[s.length-1].clone());for(let w=1,b=s.length;w<b;w++)g=!o||t.last&&w===b-1?s[w].clone():s[w].clone().lrp(p.point,1-o),!p.point.equals(g)&&(f=E.Dist(g,p.point),h+=f,!(w<4&&h<r)&&(p={input:s[w],point:g,pressure:i?.5:s[w].z,vector:E.Sub(p.point,g).uni(),distance:f,runningLength:h,radius:1},d.push(p)));if((m=d[1])!=null&&m.vector&&(d[0].vector=d[1].vector.clone()),h<1){const w=Math.max(.5,...d.map(b=>b.pressure));d.forEach(b=>b.pressure=w)}return d}const{min:zo}=Math,ob=.275;function nl(e,t){const{size:n=16,thinning:r=.5,simulatePressure:i=!0,easing:o=m=>m,start:s={},end:a={}}=t,{easing:l=Xt.easeOutQuad}=s,{easing:c=Xt.easeOutCubic}=a,u=e[e.length-1].runningLength;let d,h=e[0].pressure,p;if(!i&&u<n){const m=e.reduce((w,b)=>Math.max(w,b.pressure),.5);return e.forEach(w=>{w.pressure=m,w.radius=n*o(.5-r*(.5-w.pressure))}),e}else{let m;for(let w=0,b=e.length;w<b&&(p=e[w],!(p.runningLength>n*5));w++){const k=zo(1,p.distance/n);if(i){const S=zo(1,1-k);m=zo(1,h+(S-h)*(k*ob))}else m=zo(1,h+(p.pressure-h)*.5);h=h+(m-h)*.5}for(let w=0;w<e.length;w++){if(p=e[w],r){let{pressure:b}=p;const k=zo(1,p.distance/n);if(i){const S=zo(1,1-k);b=zo(1,h+(S-h)*(k*ob))}else b=zo(1,h+(b-h)*(k*ob));p.radius=n*o(.5-r*(.5-b)),h=b}else p.radius=n/2;d===void 0&&(d=p.radius)}}const g=s.taper===!1?0:s.taper===!0?Math.max(n,u):s.taper,f=a.taper===!1?0:a.taper===!0?Math.max(n,u):a.taper;if(g||f)for(let m=0;m<e.length;m++){p=e[m];const{runningLength:w}=p,b=w<g?l(w/g):1,k=u-w<f?c((u-w)/f):1;p.radius=Math.max(.01,p.radius*Math.min(b,k))}return e}function VK(e,t={}){return uu(nl(zr(e,t),t),t)}const aI=({scribble:e,zoom:t,color:n,opacity:r,className:i})=>{if(!e.points.length)return null;const o=VK(e.points,{size:e.size/t,start:{taper:e.taper,easing:Xt.linear},last:e.state==="stopping",simulatePressure:!1,streamline:.32});let s;if(o.length<4){const a=e.size/t/2,{x:l,y:c}=e.points[e.points.length-1];s=`M ${l-a},${c} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else s=Hc(o);return y.jsx("svg",{className:i&&pe("tl-overlays__item",i),children:y.jsx("path",{className:"tl-scribble",d:s,fill:n??`var(--color-${e.color})`,opacity:r??e.opacity})})},HK=({bounds:e,rotation:t})=>{const n=H();return Y("should display",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[n])?y.jsx(R2,{bounds:e,rotation:t}):null};function dr(){const e=H();return Y("isReadonlyMode",()=>e.getInstanceState().isReadonly,[e])}function KK({size:e,width:t,height:n,hideAlternateHandles:r}){const i=O(e/3),o=i/2;return y.jsxs("svg",{className:"tl-overlays__item",children:[y.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${O(0-o)},${O(e)} 
						${O(0-o)},${O(0-o)} 
						${O(e)},${O(0-o)}`,strokeWidth:i,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),y.jsx("line",{className:pe("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:O(t/2-e),y1:O(0-o),x2:O(t/2+e),y2:O(0-o),strokeWidth:i,"data-testid":"selection.crop.top","aria-label":"top handle"}),y.jsx("polyline",{className:pe("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${O(t-e)},${O(0-o)} 
						${O(t+o)},${O(0-o)} 
						${O(t+o)},${O(e)}`,strokeWidth:i,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),y.jsx("line",{className:pe("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:O(t+o),y1:O(n/2-e),x2:O(t+o),y2:O(n/2+e),strokeWidth:i,"data-testid":"selection.crop.right","aria-label":"right handle"}),y.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${O(t+o)},${O(n-e)} 
						${O(t+o)},${O(n+o)}
						${O(t-e)},${O(n+o)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),y.jsx("line",{className:pe("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:O(t/2-e),y1:O(n+o),x2:O(t/2+e),y2:O(n+o),strokeWidth:i,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),y.jsx("polyline",{className:pe("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${O(0+e)},${O(n+o)} 
						${O(0-o)},${O(n+o)}
						${O(0-o)},${O(n-e)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),y.jsx("line",{className:pe("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:O(0-o),y1:O(n/2-e),x2:O(0-o),y2:O(n/2+e),strokeWidth:i,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const WK=Pe(function({bounds:e,rotation:t}){const n=H(),r=x.useRef(null),i=dr(),o=ii("top"),s=ii("right"),a=ii("bottom"),l=ii("left"),c=ii("top_left"),u=ii("top_right"),d=ii("bottom_right"),h=ii("bottom_left"),p=!n.getIsMenuOpen()&&n.getInstanceState().cursor.type==="default",g=n.getInstanceState().isCoarsePointer,f=n.getOnlySelectedShape(),m=f&&n.isShapeOrAncestorLocked(f),w=f?n.getShapeUtil(f).expandSelectionOutlinePx(f):0;if(ja(r,e==null?void 0:e.x,e==null?void 0:e.y,1,n.getSelectionRotation(),{x:-w,y:-w}),!e)return null;e=e.clone().expandBy(w).zeroFix();const b=n.getZoomLevel(),k=n.getInstanceState().isChangingStyle,S=e.width,C=e.height,_=8/b,P=S<_*2,I=C<_*2,M=S<_*4,A=C<_*4,L=S<_*5,z=C<_*5,$=g?1.75:1,j=6/b*$,F=(M?j/2:j)*($*.75),R=(A?j/2:j)*($*.75),W=(f?!n.getShapeUtil(f).hideSelectionBoundsFg(f):!0)&&!k;let V=W&&n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.pointing_resize_handle","select.pointing_crop_handle")||W&&n.isIn("select.resizing")&&f&&n.isShapeOfType(f,"text");f&&V&&n.environment.isFirefox&&n.isShapeOfType(f,"embed")&&(V=!1);const D=n.isInAny("select.pointing_crop_handle","select.crop.idle","select.crop.pointing_crop")&&!k&&!i,B=n.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!k&&!i,X=!g&&!(P||I)&&(B||D)&&(f?!n.getShapeUtil(f).hideRotateHandle(f):!0)&&!m,ie=g&&(!M||!A)&&(B||D)&&(f?!n.getShapeUtil(f).hideRotateHandle(f):!0)&&!m,ue=B&&(f?n.getShapeUtil(f).canResize(f)&&!n.getShapeUtil(f).hideResizeHandles(f):!0)&&!D&&!m,ge=P||I,ce=P&&I,be=L||z,ft=ue||D,Ie=!X,Ce=!B||!ie,Me=!B||!ft,vr=!B||!ft||ge,gn=!B||!ft||ge,Mn=!B||!ft||ce&&!D;let gt=g;gt&&f&&f.type==="text"&&(gt=!1);let at=!0;D?at=be:ue&&(at=ge||ce||gt);const gi=Math.min(24/b,C-R*3),Pl=B&&g&&f&&n.isShapeOfType(f,"text")&&gi*b>=4;return y.jsx("svg",{className:"tl-overlays__item tl-selection__fg tl-svg-context","data-testid":"selection-foreground",children:y.jsxs("g",{ref:r,children:[V&&y.jsx("rect",{className:pe("tl-selection__fg__outline"),width:O(S),height:O(C)}),y.jsx(Hp,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:j,corner:"top_left_rotate",cursor:p?Vn("nwse-rotate",t):void 0,isHidden:Ie}),y.jsx(Hp,{"data-testid":"selection.rotate.top-right",cx:S+j*3,cy:0,targetSize:j,corner:"top_right_rotate",cursor:p?Vn("nesw-rotate",t):void 0,isHidden:Ie}),y.jsx(Hp,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:C+j*3,targetSize:j,corner:"bottom_left_rotate",cursor:p?Vn("swne-rotate",t):void 0,isHidden:Ie}),y.jsx(Hp,{"data-testid":"selection.rotate.bottom-right",cx:S+j*3,cy:C+j*3,targetSize:j,corner:"bottom_right_rotate",cursor:p?Vn("senw-rotate",t):void 0,isHidden:Ie}),y.jsx(XK,{"data-testid":"selection.rotate.mobile",cx:M?-j*1.5:S/2,cy:M?C/2:-j*1.5,size:_,isHidden:Ce}),y.jsx("rect",{className:pe("tl-transparent",{"tl-hidden":at}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:O(0-(A?R*2:R)),width:O(S),height:O(Math.max(1,R*2)),style:p?{cursor:Vn("ns-resize",t)}:void 0,...o}),y.jsx("rect",{className:pe("tl-transparent",{"tl-hidden":at}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:O(S-(M?0:F)),y:0,height:O(C),width:O(Math.max(1,F*2)),style:p?{cursor:Vn("ew-resize",t)}:void 0,...s}),y.jsx("rect",{className:pe("tl-transparent",{"tl-hidden":at}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:O(C-(A?0:R)),width:O(S),height:O(Math.max(1,R*2)),style:p?{cursor:Vn("ns-resize",t)}:void 0,...a}),y.jsx("rect",{className:pe("tl-transparent",{"tl-hidden":at}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:O(0-(M?F*2:F)),y:0,height:O(C),width:O(Math.max(1,F*2)),style:p?{cursor:Vn("ew-resize",t)}:void 0,...l}),y.jsx("rect",{className:pe("tl-transparent",{"tl-hidden":Me}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:O(0-(M?F*2:F*1.5)),y:O(0-(A?R*2:R*1.5)),width:O(F*3),height:O(R*3),style:p?{cursor:Vn("nwse-resize",t)}:void 0,...c}),y.jsx("rect",{className:pe("tl-transparent",{"tl-hidden":vr}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:O(S-(M?0:F*1.5)),y:O(0-(A?R*2:R*1.5)),width:O(F*3),height:O(R*3),style:p?{cursor:Vn("nesw-resize",t)}:void 0,...u}),y.jsx("rect",{className:pe("tl-transparent",{"tl-hidden":Mn}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:O(S-(M?F:F*1.5)),y:O(C-(A?R:R*1.5)),width:O(F*3),height:O(R*3),style:p?{cursor:Vn("nwse-resize",t)}:void 0,...d}),y.jsx("rect",{className:pe("tl-transparent",{"tl-hidden":gn}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:O(0-(M?F*3:F*1.5)),y:O(C-(A?0:R*1.5)),width:O(F*3),height:O(R*3),style:p?{cursor:Vn("nesw-resize",t)}:void 0,...h}),ue&&y.jsxs(y.Fragment,{children:[y.jsx("rect",{"data-testid":"selection.resize.top-left",className:pe("tl-corner-handle",{"tl-hidden":Me}),"aria-label":"top_left handle",x:O(0-_/2),y:O(0-_/2),width:O(_),height:O(_)}),y.jsx("rect",{"data-testid":"selection.resize.top-right",className:pe("tl-corner-handle",{"tl-hidden":vr}),"aria-label":"top_right handle",x:O(S-_/2),y:O(0-_/2),width:O(_),height:O(_)}),y.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:pe("tl-corner-handle",{"tl-hidden":Mn}),"aria-label":"bottom_right handle",x:O(S-_/2),y:O(C-_/2),width:O(_),height:O(_)}),y.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:pe("tl-corner-handle",{"tl-hidden":gn}),"aria-label":"bottom_left handle",x:O(0-_/2),y:O(C-_/2),width:O(_),height:O(_)})]}),Pl&&y.jsxs(y.Fragment,{children:[y.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:O(0-_/4),y:O(C/2-gi/2),rx:_/4,width:O(_/2),height:O(gi)}),y.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:_/4,x:O(S-_/4),y:O(C/2-gi/2),width:O(_/2),height:O(gi)})]}),D&&y.jsx(KK,{size:_,width:S,height:C,hideAlternateHandles:be})]})})}),Hp=function({cx:e,cy:t,targetSize:n,corner:r,cursor:i,isHidden:o,"data-testid":s}){const a=ii(r);return y.jsx("rect",{className:pe("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":s,"aria-label":`${r} target`,pointerEvents:"all",x:O(e-n*3),y:O(t-n*3),width:O(Math.max(1,n*3)),height:O(Math.max(1,n*3)),cursor:i,...a})},YK=Math.sqrt(Math.PI),XK=function({cx:e,cy:t,size:n,isHidden:r,"data-testid":i}){const o=ii("mobile_rotate"),s=H(),a=Y("zoom level",()=>s.getZoomLevel(),[s]),l=Math.max(14*(1/a),20/Math.max(1,a));return y.jsxs("g",{children:[y.jsx("circle",{"data-testid":i,pointerEvents:"all",className:pe("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":r}),cx:e,cy:t,r:l,...o}),y.jsx("circle",{className:pe("tl-mobile-rotate__fg",{"tl-hidden":r}),cx:e,cy:t,r:n/YK})]})},Dt={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},Zt={s:2,m:3.5,l:5,xl:10},No={s:18,m:24,l:36,xl:44},rl={s:18,m:22,l:26,xl:32},Ro={s:18,m:20,l:24,xl:28},Ui={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"};var lI={exports:{}};(function(e){(function(t,n){e.exports?e.exports=n():t.downscale=n()})(Oe,function(){function t(I,w,b,k,S,C,_,P){var I=document.createElement("canvas");I.width=b,I.height=k;var M=I.getContext("2d");return M.mozImageSmoothingEnabled=!0,M.imageSmoothingQuality="high",M.webkitImageSmoothingEnabled=!0,M.msImageSmoothingEnabled=!0,M.imageSmoothingEnabled=!0,M.drawImage(w,S,C,_,P,0,0,b,k),I}function n(m){return m+.49<<0}function r(m,w,b,k,S,C,_){for(var P=new ImageData(w,b),I=new Int32Array(m.data.buffer),M=m.width,A=new Int32Array(P.data.buffer),L=P.width,z=w/C,$=b/_,j=n(1/z),F=n(1/$),R=j*F,W=0;W<P.height;W++)for(var V=0;V<L;V++){for(var D=k+n(V/z)+(S+n(W/$))*M,B=0,X=0,ie=0,ue=0,ge=0;ge<F;ge++)for(var ce=0;ce<j;ce++){var be=I[D+ce+ge*M];B+=be<<24>>>24,X+=be<<16>>>24,ie+=be<<8>>>24,ue+=be>>>24}B=n(B/R),X=n(X/R),ie=n(ie/R),ue=n(ue/R),A[V+W*L]=ue<<24|ie<<16|X<<8|B}return P}function i(m,w,b,k){var S=new Date,C={},_=S,P="01";return{mark:m?function(I){I=P+". "+(I||"..."),C[I]={"time (ms)":new Date-_},_=new Date,P=("0"+((P>>0)+1)).substr(-2)}:new Function,finish:m?function(){C[P+" TOTAL"]={"time (ms)":new Date-S},console.log("IMAGE SOURCE:",w),console.log("DOWNSCALE TO:",b+"x"+k),console.table(C)}:new Function}}function o(){var m=[],w=[],b=[],k=new Object;return{createSetter:function(S){if(!this.get(S)){var C=m.push(S)-1;return w.push(k),b.push([]),function(_){w[C]=_,b[C]=b[C].reduce(function(P,I){I(_)},[])}}},get:function(S,C){var _=m.indexOf(S);if(~_){if(w[_]===k){b[_].push(C);return}C(w[_])}},has:function(S){return!!~m.indexOf(S)}}}function s(m,w,b,k){m.width=b,m.height=k;var S=m.getContext("2d");return S.drawImage(w,0,0),S.getImageData(0,0,b,k)}function a(m,w){m.width=w.width,m.height=w.height;var b=m.getContext("2d");return b.putImageData(w,0,0),m}function l(m,w,A,L,S,C){var _=S,P=C,I=S/C;m===0&&(m=w*I>>0),w===0&&(w=m/I>>0);var M=m/w;M>I?C=S/M>>0:S=C*M>>0;var A=A||(_-S)/2>>0,L=L||(P-C)/2>>0;return{destWidth:m,destHeight:w,sourceX:A,sourceY:L,sourceWidth:S,sourceHeight:C}}function c(m,w,b){if(w.returnCanvas){b(m);return}if(w.returnBlob){m.toBlob(b,"image/"+(w.imageType||"jpeg"),w.quality||.85);return}var k=m.toDataURL("image/"+(w.imageType||"jpeg"),w.quality||.85);b(k)}function u(m,w){var b=new XMLHttpRequest;b.open("GET",m),b.responseType="arraybuffer",b.addEventListener("load",function(){w(this.response)}),b.send()}function d(m,w){m.complete?w():m.addEventListener("load",w)}function h(m,w){m.readyState>1?w():m.addEventListener("loadeddata",w)}function p(m){if(m instanceof File)return"File";if(m instanceof HTMLImageElement)return"HTMLImageElement";if(m instanceof HTMLVideoElement)return"HTMLVideoElement";if(typeof m=="string")return"URL"}function g(m){if(m.length<3)return new TypeError("3 arguments required, but only "+m.length+" present.");if(!p(m[0]))return new TypeError("First argument should be HTMLImageElement, HTMLVideoElement, File of String");if(typeof m[1]!="number")return new TypeError("Second argument should be a number");if(typeof m[2]!="number")return new TypeError("Third argument should be a number")}function f(m,w,b,k){var S=i(k&&k.debug||!1,m,w,b),C=g(arguments);if(C instanceof TypeError)return Promise.reject(C);k=k||{};var _,P=new Promise(function($,j){_=$});f.canvas=f.canvas||document.createElement("canvas"),f.cache=f.cache||o();var I=f.canvas,M=f.cache;if(M.has(m))return S.mark(),M.get(m,function($){S.mark("PENDING CACHE");var j=$[0],F=$[1],R=l(w,b,k.sourceX,k.sourceY,F.width,F.height);if(R.sourceWidth/R.destWidth>=2&&R.sourceHeight/R.destHeight>=2){S.mark();var W=r(F,R.destWidth,R.destHeight,R.sourceX,R.sourceY,R.sourceWidth,R.sourceHeight);S.mark("DOWNSCALE"),I=a(I,W)}else I=t(I,j,R.destWidth,R.destHeight,R.sourceX,R.sourceY,R.sourceWidth,R.sourceHeight),S.mark("RESIZE WITH CANVAS");c(I,k,function(V){S.mark("PRODUCE RESULT"),_(V),S.finish()})}),P;var A=function($,j,F){var R=l(w,b,k.sourceX,k.sourceY,j,F);if(R.sourceWidth/R.destWidth>=2&&R.sourceHeight/R.destHeight>=2){S.mark();var W=s(I,$,j,F);S.mark("GET IMAGE DATA");var V=r(W,R.destWidth,R.destHeight,R.sourceX,R.sourceY,R.sourceWidth,R.sourceHeight);S.mark("DOWNSCALE"),I=a(I,V),p($)!=="HTMLVideoElement"&&M.createSetter($)([$,W])}else I=t(I,$,R.destWidth,R.destHeight,R.sourceX,R.sourceY,R.sourceWidth,R.sourceHeight),S.mark("RESIZE WITH CANVAS");c(I,k,function(D){S.mark("PRODUCE RESULT"),_(D),S.finish()})},L=window.URL||window.webkitURL;switch(p(m)){case"File":var z=document.createElement("img");S.mark(),z.src=L.createObjectURL(m),S.mark("READ FILE"),d(z,function(){S.mark("LOAD IMAGE"),A(z,z.naturalWidth,z.naturalHeight)});break;case"HTMLImageElement":S.mark(),d(m,function(){S.mark("LOAD IMAGE"),A(m,m.naturalWidth,m.naturalHeight)});break;case"HTMLVideoElement":h(m,function(){A(m,m.videoWidth,m.videoHeight)});break;case"URL":S.mark(),setTimeout(function(){u(m,function($){S.mark("LOAD ARRAY BUFFER");var j=new Uint8Array($),F=new Blob([j],{type:"image/jpeg"}),R=document.createElement("img");R.src=L.createObjectURL(F),S.mark(),d(R,function(){S.mark("LOAD IMAGE"),A(R,R.naturalWidth,R.naturalHeight)})})});break}return P}return f})})(lI);var GK=lI.exports;const qK=ns(GK);/*!
* canvas-size
* v1.2.6
* https://github.com/jhildenbiddle/canvas-size
* (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
* MIT license
*/function ZK(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,i,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(u){c=!0,i=u}finally{try{if(!l&&n.return!=null&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return a}}function cI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function Hn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cI(Object(n),!0).forEach(function(r){QK(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cI(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function QK(e,t,n){return t=aW(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function JK(e,t){if(e==null)return{};var n={},r=Object.keys(e),i,o;for(o=0;o<r.length;o++)i=r[o],!(t.indexOf(i)>=0)&&(n[i]=e[i]);return n}function eW(e,t){if(e==null)return{};var n=JK(e,t),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)r=o[i],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function uI(e,t){return nW(e)||ZK(e,t)||dI(e,t)||oW()}function Kp(e){return tW(e)||rW(e)||dI(e)||iW()}function tW(e){if(Array.isArray(e))return sb(e)}function nW(e){if(Array.isArray(e))return e}function rW(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function dI(e,t){if(e){if(typeof e=="string")return sb(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sb(e,t)}}function sb(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function iW(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oW(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sW(e,t){if(typeof e!="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function aW(e){var t=sW(e,"string");return typeof t=="symbol"?t:String(t)}function du(e){var t=e.sizes.shift(),n=Math.max(Math.ceil(t[0]),1),r=Math.max(Math.ceil(t[1]),1),i=[n-1,r-1,1,1],o=Date.now(),s=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,a,l;s?(a=new OffscreenCanvas(1,1),l=new OffscreenCanvas(n,r)):(a=document.createElement("canvas"),a.width=1,a.height=1,l=document.createElement("canvas"),l.width=n,l.height=r);var c=a.getContext("2d"),u=l.getContext("2d");u&&(u.fillRect.apply(u,i),c.drawImage(l,n-1,r-1,1,1,0,0,1,1));var d=c&&c.getImageData(0,0,1,1).data[3]!==0,h=Date.now()-o;return[a,l].forEach(function(p){p.height=0,p.width=0}),s?(postMessage({width:n,height:r,benchmark:h,isTestPass:d}),!d&&e.sizes.length&&du(e)):d?e.onSuccess(n,r,h):(e.onError(n,r,h),e.sizes.length&&du(e)),d}var ab={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},lW=["onError","onSuccess"],il={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},hu={};function lb(e){var t=e.width===e.height,n=e.height===1,r=e.width===1,i=[];if(!e.width||!e.height)e.sizes.forEach(function(u){var d=t||n?u:1,h=t||r?u:1;i.push([d,h])});else for(var o=e.min||il.min,s=e.step||il.step,a=Math.max(e.width,e.height);a>=o;){var l=t||n?a:1,c=t||r?a:1;i.push([l,c]),a-=s}return i}function Wp(e){var t=window&&"HTMLCanvasElement"in window,n=window&&"OffscreenCanvas"in window,r=Date.now(),i=e.onError,o=e.onSuccess,s=eW(e,lW),a=null;if(!t)return!1;if(e.useWorker&&n){var l=`
            var canvasTest = `.concat(du.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),c=new Blob([l],{type:"application/javascript"}),u=URL.createObjectURL(c);a=new Worker(u),URL.revokeObjectURL(u),a.onmessage=function(d){var h=d.data,p=h.width,g=h.height,f=h.benchmark,m=h.isTestPass;m?(hu[r].onSuccess(p,g,f),delete hu[r]):hu[r].onError(p,g,f)}}if(e.usePromise)return new Promise(function(d,h){var p=Hn(Hn({},e),{},{onError:function(m,w,b){var k;if(e.sizes.length===0)k=!0;else{var S=e.sizes.slice(-1),C=uI(S,1),_=uI(C[0],2),P=_[0],I=_[1];k=m===P&&w===I}i(m,w,b),k&&h({width:m,height:w,benchmark:b})},onSuccess:function(m,w,b){o(m,w,b),d({width:m,height:w,benchmark:b})}});if(a){var g=p.onError,f=p.onSuccess;hu[r]={onError:g,onSuccess:f},a.postMessage(s)}else du(p)});if(a)hu[r]={onError:i,onSuccess:o},a.postMessage(s);else return du(e)}var cb={maxArea:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=lb({width:e.max,height:e.max,min:e.min,step:e.step,sizes:Kp(ab.area)}),n=Hn(Hn(Hn({},il),e),{},{sizes:t});return Wp(n)},maxHeight:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=lb({width:1,height:e.max,min:e.min,step:e.step,sizes:Kp(ab.height)}),n=Hn(Hn(Hn({},il),e),{},{sizes:t});return Wp(n)},maxWidth:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=lb({width:e.max,height:1,min:e.min,step:e.step,sizes:Kp(ab.width)}),n=Hn(Hn(Hn({},il),e),{},{sizes:t});return Wp(n)},test:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Hn(Hn({},il),e);return t.sizes=Kp(t.sizes),t.width&&t.height&&(t.sizes=[[t.width,t.height]]),Wp(t)}};let ub=null;function hI(){return ub||(ub=cW()),ub}async function cW(){const e=await cb.maxWidth({usePromise:!0}),t=await cb.maxHeight({usePromise:!0}),n=await cb.maxArea({usePromise:!0});return{maxWidth:e.width,maxHeight:t.height,maxArea:n.width*n.height}}function pI(e,t){let n=0;for(;e[t+n];)n+=e[t+n]+1;return n+1}function uW(e){return new TextDecoder("ascii").decode(e.slice(0,3))==="GIF"}function dW(e){const t=new Uint8Array(e);let n,r,i=0,o=0;if(!uW(e))return!1;for(n=t[10]&128,r=t[10]&7,i+=6,i+=7,i+=n?3*Math.pow(2,r+1):0;o<2&&i<t.length;)switch(t[i]){case 44:o+=1,n=t[i+9]&128,r=t[i+9]&7,i+=10,i+=n?3*Math.pow(2,r+1):0,i+=pI(t,i+1)+1;break;case 33:i+=2,i+=pI(t,i);break;case 59:i=t.length;break;default:i=t.length;break}return o>1}function hW(e,t){const n=e.w/t.w,r=e.h/t.h;return n<=1&&r<=1?e:n>r?{w:e.w/n,h:e.h/n}:{w:e.w/r,h:e.h/r}}async function pW(e,t,n,r={}){let i=t*2,o=n*2;const{type:s="image/jpeg",quality:a=.92}=r,l=await hI(),c=t/n;if(i>l.maxWidth&&(i=l.maxWidth,o=i/c),o>l.maxHeight&&(o=l.maxHeight,i=o*c),i*o>l.maxArea){const u=Math.sqrt(l.maxArea/(i*o));i*=u,o*=u}return await qK(e,i,o,{imageType:s.replace("image/",""),quality:a})}async function fW(e){return await new Promise((t,n)=>{const r=new FileReader;r.onerror=()=>n(r.error),r.onload=()=>{t(r.result?dW(r.result):!1)},r.readAsArrayBuffer(e)})}function gW(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function mW(e){const t=new URL(e).host.replace("www.","");for(const n of Aa)if(fI(n.hostnames,t)){const r=n.fromEmbedUrl(e);if(r)return{definition:n,url:r,embedUrl:e}}}const yW=e=>e.split("*").map(t=>gW(t)).join(".+"),fI=(e,t)=>!!e.find(n=>{const r=new RegExp(yW(n));return t.match(r)});function vW(e){const t=new URL(e).host.replace("www.","");for(const n of Aa)if(fI(n.hostnames,t)){const r=n.toEmbedUrl(e);if(r)return{definition:n,embedUrl:r,url:e}}}function gI(e){return vW(e)??mW(e)}function Vi(e){try{return gI(e)}catch(t){console.error(t)}}const ol="  ",fn=class fn{static insertTextFirefox(t,n){t.setRangeText(n,t.selectionStart||0,t.selectionEnd||0,"end"),t.dispatchEvent(new InputEvent("input",{data:n,inputType:"insertText",isComposing:!1}))}static insert(t,n){const r=t.ownerDocument,i=r.activeElement;i!==t&&t.focus(),r.execCommand("insertText",!1,n)||fn.insertTextFirefox(t,n),i===r.body?t.blur():i instanceof HTMLElement&&i!==t&&i.focus()}static set(t,n){t.select(),fn.insert(t,n)}static getSelection(t){const{selectionStart:n,selectionEnd:r}=t;return t.value.slice(n||void 0,r||void 0)}static wrapSelection(t,n,r){const{selectionStart:i,selectionEnd:o}=t,s=fn.getSelection(t);fn.insert(t,n+s+(r??n)),t.selectionStart=(i||0)+n.length,t.selectionEnd=(o||0)+n.length}static replace(t,n,r){let i=0;t.value.replace(n,(...o)=>{const s=i+o[o.length-2],a=o[0].length;t.selectionStart=s,t.selectionEnd=s+a;const l=typeof r=="string"?r:r(...o);return fn.insert(t,l),t.selectionStart=s,i+=l.length-a,l})}static findLineEnd(t,n){const r=t.lastIndexOf(`
`,n-1)+1;return t.charAt(r)!=="	"?n:r+1}static indent(t){var a;const{selectionStart:n,selectionEnd:r,value:i}=t,o=i.slice(n,r),s=(a=/\n/g.exec(o))==null?void 0:a.length;if(s&&s>0){const l=i.lastIndexOf(`
`,n-1)+1,c=t.value.slice(l,r-1),u=c.replace(/^|\n/g,`$&${ol}`),d=u.length-c.length;t.setSelectionRange(l,r-1),fn.insert(t,u),t.setSelectionRange(n+1,r+d)}else fn.insert(t,ol)}static unindent(t){const{selectionStart:n,selectionEnd:r,value:i}=t,o=i.lastIndexOf(`
`,n-1)+1,s=fn.findLineEnd(i,r),a=t.value.slice(o,s),l=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),c=a.length-l.length;t.setSelectionRange(o,s),fn.insert(t,l);const u=/\t| {1,2}/.exec(i.slice(o,n)),d=u?u[0].length:0,h=n-d;t.setSelectionRange(n-d,Math.max(h,r-c))}static indentCE(t){var l;const n=window.getSelection(),r=t.innerText,i=Yp(t)??0,o=Yp(t)??0,s=r.slice(i,o),a=(l=/\n/g.exec(s))==null?void 0:l.length;if(a&&a>0){const c=r.lastIndexOf(`
`,i-1)+1,u=r.slice(c,o-1),d=u.replace(/^|\n/g,`$&${ol}`).length-u.length;n&&n.setBaseAndExtent(t,i+1,t,o+d)}else{const c=window.getSelection();t.innerText=r.slice(0,i)+ol+r.slice(i),c==null||c.setBaseAndExtent(t,i+1,t,i+2)}}static unindentCE(t){const n=window.getSelection(),r=t.innerText,i=Yp(t)??0,o=Yp(t)??0,s=r.lastIndexOf(`
`,i-1)+1,a=fn.findLineEnd(r,o),l=r.slice(s,a),c=l.replace(/(^|\n)(\t| {1,2})/g,"$1"),u=l.length-c.length;if(n){n.setBaseAndExtent(t,s,t,a);const d=/\t| {1,2}/.exec(r.slice(s,i)),h=d?d[0].length:0,p=i-h;n.setBaseAndExtent(t,i-h,t,Math.max(p,o-u))}}static normalizeText(t){return t.replace(fn.fixNewLines,`
`)}static normalizeTextForDom(t){return t.replace(fn.fixNewLines,`
`).split(`
`).map(n=>n||" ").join(`
`)}};v(fn,"fixNewLines",/\r?\n|\r/g);let Fo=fn;function Yp(e){if(typeof window.getSelection>"u")return;const t=window.getSelection();if(!t)return;let n=0;if(t.rangeCount!==0){const r=t.getRangeAt(0),i=r.cloneRange();i.selectNodeContents(e),i.setEnd(r.endContainer,r.endOffset),n=i.toString().length}return n}const bW=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function wW(e){return bW.test(e)}function xW(e){return e.replace(/\t/g,ol)}function SW(e){const t=e.split(`
`);for(;t[0]&&t[0].trim().length===0;)t.shift();let n=1/0;for(const r of t)if(r.trim().length>0){const i=r.length-r.trimStart().length;n=Math.min(n,i)}return t.map(r=>r.slice(n)).join(`
`)}function kW(e){return e.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function _W(e){return kW(SW(xW(e)))}const pu=(e,t)=>e.length<=t?e:e.substring(0,t-3)+"...";function CW(e,{maxImageDimension:t,maxAssetSize:n,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:i}){e.registerExternalAssetHandler("file",async({file:o})=>await new Promise((s,a)=>{!r.includes(o.type)&&!i.includes(o.type)&&(console.warn(`File type not allowed: ${o.type}`),a()),o.size>n&&(console.warn(`File size too big: ${(o.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`),a());const l=new FileReader;l.onerror=()=>a(l.error),l.onload=async()=>{let c=l.result;o.type==="video/quicktime"&&c.includes("video/quicktime")&&(c=c.replace("video/quicktime","video/mp4"));const u=r.includes(o.type);let d,h;if(u?(d=await H_.getImageSizeFromSrc(c),h=o.type==="image/gif"&&await fW(o)):(h=!0,d=await H_.getVideoSizeFromSrc(c)),isFinite(t)){const f=hW(d,{w:t,h:t});d!==f&&(o.type==="image/jpeg"||o.type==="image/png")&&(d=f)}(o.type==="image/jpeg"||o.type==="image/png")&&(c=await pW(c,d.w,d.h,{type:o.type,quality:.92}));const p=xs.createId(Ph(c)),g=xs.create({id:p,type:u?"image":"video",typeName:"asset",props:{name:o.name,src:c,w:d.w,h:d.h,mimeType:o.type,isAnimated:h}});s(g)},l.readAsDataURL(o)})),e.registerExternalAssetHandler("url",async({url:o})=>{var a,l,c;let s;try{const u=await(await fetch(o,{method:"GET",mode:"no-cors"})).text(),d=new DOMParser().parseFromString(u,"text/html");s={image:((a=d.head.querySelector('meta[property="og:image"]'))==null?void 0:a.getAttribute("content"))??"",title:((l=d.head.querySelector('meta[property="og:title"]'))==null?void 0:l.getAttribute("content"))??pu(o,32),description:((c=d.head.querySelector('meta[property="og:description"]'))==null?void 0:c.getAttribute("content"))??""}}catch(u){console.error(u),s={image:"",title:pu(o,32),description:""}}return{id:xs.createId(Ph(o)),typeName:"asset",type:"bookmark",props:{src:o,description:s.description,image:s.image,title:s.title},meta:{}}}),e.registerExternalContentHandler("svg-text",async({point:o,text:s})=>{const a=o??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageCenter()),l=new DOMParser().parseFromString(s,"image/svg+xml").querySelector("svg");if(!l)throw new Error("No <svg/> element present");let c=parseFloat(l.getAttribute("width")||"0"),u=parseFloat(l.getAttribute("height")||"0");if(!(c&&u)){document.body.appendChild(l);const h=l.getBoundingClientRect();document.body.removeChild(l),c=h.width,u=h.height}const d=await e.getAssetForExternalContent({type:"file",file:new File([s],"asset.svg",{type:"image/svg+xml"})});if(!d)throw Error("Could not create an asset");mI(e,[d],a)}),e.registerExternalContentHandler("embed",({point:o,url:s,embed:a})=>{const l=o??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageCenter()),{width:c,height:u}=a,d=Ve(),h={id:d,type:"embed",x:l.x-(c||450)/2,y:l.y-(u||450)/2,props:{w:c,h:u,url:s}};e.createShapes([h]).select(d)}),e.registerExternalContentHandler("files",async({point:o,files:s})=>{const a=o??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageCenter()),l=new E(a.x,a.y),c=[];await Promise.all(s.map(async(u,d)=>{if(u.size>n)return console.warn(`File size too big: ${(u.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`),null;if(!u.type)throw new Error("No mime type");if(!r.concat(i).includes(u.type))return console.warn(`${u.name} not loaded - Extension not allowed.`),null;try{const h=await e.getAssetForExternalContent({type:"file",file:u});if(!h)throw Error("Could not create an asset");c[d]=h}catch(h){return console.error(h),null}})),mI(e,he(c),l)}),e.registerExternalContentHandler("text",async({point:o,text:s})=>{const a=o??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageCenter()),l=e.getShapeUtil("text").getDefaultProps(),c=_W(s);let u,d,h,p="middle";const g=c.split(`
`).length>1,f=wW(c);g&&(p=g?f?"end":"start":"middle");const m=e.textMeasure.measureText(c,{...Dt,fontFamily:Ui[l.font],fontSize:No[l.size],maxWidth:null}),w=Math.min(g?e.getViewportPageBounds().width*.9:920,Math.max(200,e.getViewportPageBounds().width*.9));if(m.w>w){const b=e.textMeasure.measureText(c,{...Dt,fontFamily:Ui[l.font],fontSize:No[l.size],maxWidth:w});u=b.w,d=b.h,h=!1,p=f?"end":"start"}else u=m.w,d=m.h,h=!0;a.y-d/2<e.getViewportPageBounds().minY+40&&(a.y=e.getViewportPageBounds().minY+40+d/2),e.createShapes([{id:Ve(),type:"text",x:a.x-u/2,y:a.y-d/2,props:{text:c,align:p,autoSize:h,w:u}}])}),e.registerExternalContentHandler("url",async({point:o,url:s})=>{const a=Vi(s);if(a)return e.putExternalContent({type:"embed",url:a.url,point:o,embed:a.definition});const l=o??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageCenter()),c=xs.createId(Ph(s)),u=EW(e,s,l);let d=e.getAsset(c),h=!1;if(!d){h=!0;const p=await e.getAssetForExternalContent({type:"url",url:s});if(!p)throw Error("Could not create an asset");d=p}e.batch(()=>{h&&e.createAssets([d]),e.updateShapes([{id:u.id,type:u.type,props:{assetId:d.id}}])})})}async function mI(e,t,n){if(!t.length)return[];const r=E.From(n),i=[];for(const o of t)switch(o.type){case"bookmark":{i.push({id:Ve(),type:"bookmark",x:r.x-150,y:r.y-160,opacity:1,props:{assetId:o.id,url:o.props.src}}),r.x+=300;break}case"image":{i.push({id:Ve(),type:"image",x:r.x-o.props.w/2,y:r.y-o.props.h/2,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w;break}case"video":i.push({id:Ve(),type:"video",x:r.x-o.props.w/2,y:r.y-o.props.h/2,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w}return e.batch(()=>{const o=t.filter(s=>!e.getAsset(s.id));o.length&&e.createAssets(o),e.createShapes(i).select(...i.map(s=>s.id)),yI(e,n)}),i.map(o=>o.id)}function yI(e,t){const n=e.getViewportPageBounds();let r=e.getSelectionPageBounds();if(r){const i=r.center.sub(t);e.updateShapes(e.getSelectedShapes().map(o=>{const s=e.getShapeParentTransform(o).decompose().rotation,a=E.Rot(i,-s);return{id:o.id,type:o.type,x:o.x-a.x,y:o.y-a.y}}))}r=e.getSelectionPageBounds(),r&&!n.contains(r)&&e.zoomToSelection()}function EW(e,t,n){const r={id:Ve(),type:"bookmark",x:n.x-150,y:n.y-160,opacity:1,props:{assetId:null,url:t}};return e.batch(()=>{e.createShapes([r]).select(r.id),yI(e,n)}),e.getShape(r.id)}let PW=(mw=class extends ne{constructor(){super(...arguments);v(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")});v(this,"onKeyUp",t=>{var n;if(t.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(n=this.editor.root.getCurrent())==null||n.transition("editing_shape",{...t,target:"shape",shape:r}))}})}},v(mw,"id","idle"),mw),IW=(yw=class extends ne{constructor(){super(...arguments);v(this,"shape");v(this,"markId","");v(this,"onEnter",()=>{this.didTimeout=!1;const t=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:n=>!n.isLocked&&this.editor.getShapeUtil(n).canBind(n),margin:0,hitInside:!0,renderingOnly:!0});t?this.editor.setHintingShapes([t.id]):this.createArrowShape(),this.startPreciseTimeout()});v(this,"onExit",()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()});v(this,"onPointerMove",()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:this.editor.getShapeHandles(this.shape).find(t=>t.id==="end"),isCreating:!0,onInteractionEnd:"arrow"})}});v(this,"onPointerUp",()=>{this.cancel()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()});v(this,"preciseTimeout",-1);v(this,"didTimeout",!1)}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var c,u;const{originPagePoint:t}=this.editor.inputs,n=Ve();this.markId=`creating:${n}`,this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:"arrow",x:t.x,y:t.y}]);const r=this.editor.getShape(n);if(!r)throw Error("expected shape");const i=this.editor.getShapeHandles(r);if(!i)throw Error("expected handles for arrow");const o=this.editor.getShapeUtil("arrow"),s=this.shape,a=i.find(d=>d.id==="start"),l=(c=o.onHandleChange)==null?void 0:c.call(o,r,{handle:{...a,x:0,y:0},isPrecise:!0,initial:s});if(l){const d=(u=l.props)==null?void 0:u.start;(d==null?void 0:d.type)==="binding"&&this.editor.setHintingShapes([d.boundShapeId]),this.editor.updateShapes([l],{squashing:!0})}this.shape=this.editor.getShape(n),this.editor.select(n)}updateArrowShapeEndHandle(){var i,o,s;const t=this.shape;if(!t)throw Error("expected shape");const n=this.editor.getShapeHandles(t);if(!n)throw Error("expected handles for arrow");const r={...t,props:{...t.props,end:{...t.props.end,x:0,y:0}}};{const a=this.editor.getShapeUtil("arrow"),l=this.shape,c=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint),u=n.find(h=>h.id==="end"),d=(i=a.onHandleChange)==null?void 0:i.call(a,r,{handle:{...u,x:c.x,y:c.y},isPrecise:!1,initial:l});if(d){const h=(o=d.props)==null?void 0:o.end;(h==null?void 0:h.type)==="binding"&&this.editor.setHintingShapes([h.boundShapeId]),this.editor.updateShapes([d],{squashing:!0})}}{const a=this.editor.getShapeUtil("arrow"),l=this.shape,c=n.find(d=>d.id==="start"),u=(s=a.onHandleChange)==null?void 0:s.call(a,r,{handle:{...c,x:0,y:0},isPrecise:this.didTimeout,initial:l});u&&this.editor.updateShapes([u],{squashing:!0})}this.shape=this.editor.getShape(t.id)}startPreciseTimeout(){this.preciseTimeout=window.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},v(yw,"id","pointing"),yw);class Xp extends ne{constructor(){super(...arguments);v(this,"shapeType","arrow")}}v(Xp,"id","arrow"),v(Xp,"initial","idle"),v(Xp,"children",()=>[PW,IW]);class db extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"initialShape");v(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");v(this,"util",this.editor.getShapeUtil(this.shapeType));v(this,"isPen",!1);v(this,"segmentMode","free");v(this,"didJustShiftClickToExtendPreviousShapeLine",!1);v(this,"pagePointWhereCurrentSegmentChanged",{});v(this,"pagePointWhereNextSegmentChanged",null);v(this,"lastRecordedPoint",{});v(this,"mergeNextPoint",!1);v(this,"currentLineLength",0);v(this,"canDraw",!1);v(this,"markId",null);v(this,"onEnter",n=>{this.markId=null,this.info=n,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()});v(this,"onPointerMove",()=>{const{editor:{inputs:n}}=this;if(this.isPen!==n.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&n.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(n.isPen?E.Dist(n.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=n.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateShapes())});v(this,"onKeyDown",n=>{if(n.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateShapes()});v(this,"onKeyUp",n=>{if(n.key==="Shift")switch(this.editor.snaps.clear(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateShapes()});v(this,"onExit",()=>{this.editor.snaps.clear(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()});v(this,"onInterrupt",()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())})}canClose(){return this.shapeType!=="highlight"}getIsClosed(n,r){if(!this.canClose())return!1;const i=Zt[r],o=n[0].points[0],s=n[n.length-1],a=s.points[s.points.length-1];return o!==a&&this.currentLineLength>i*4&&E.Dist(o,a)<i*2}startShape(){const{inputs:{originPagePoint:n,isPen:r}}=this.editor;this.markId="draw start "+Re(),this.editor.mark(this.markId),this.isPen=r;const i=this.isPen?this.info.point.z*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=n.clone(),this.initialShape){const s=this.editor.getShape(this.initialShape.id);if(s&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const a=xn(s.props.segments);if(!a)throw Error("Expected a previous segment!");const l=xn(a.points);if(!l)throw Error("Expected a previous point!");const{x:c,y:u}=this.editor.getPointInShapeSpace(s,n).toFixed(),d=this.isPen?this.info.point.z*1.25:.5,h={type:this.segmentMode,points:[{x:l.x,y:l.y,z:+d.toFixed(2)},{x:c,y:u,z:+d.toFixed(2)}]},p=te.applyToPoint(this.editor.getShapePageTransform(s.id),l);this.pagePointWhereCurrentSegmentChanged=p,this.pagePointWhereNextSegmentChanged=null;const g=[...s.props.segments,h];this.currentLineLength=this.getLineLength(g);const f={id:s.id,type:this.shapeType,props:{segments:g}};this.canClose()&&(f.props.isClosed=this.getIsClosed(g,s.props.size)),this.editor.updateShapes([f]);return}}this.pagePointWhereCurrentSegmentChanged=n.clone();const o=Ve();this.editor.createShapes([{id:o,type:this.shapeType,x:n.x,y:n.y,props:{isPen:this.isPen,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+i.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(o)}updateShapes(){const{inputs:n}=this.editor,{initialShape:r}=this;if(!r)return;const{id:i,props:{size:o}}=r,s=this.editor.getShape(i);if(!s)return;const{segments:a}=s.props,{x:l,y:c,z:u}=this.editor.getPointInShapeSpace(s,n.currentPagePoint).toFixed(),d={x:l,y:c,z:this.isPen?+(u*1.25).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:h}=this;if(h===null)throw Error("We should have a point where the segment changed");if(E.Dist(h,n.currentPagePoint)>Vc){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const p=xn(a);if(!p)throw Error("Expected a previous segment!");const g=xn(p.points);if(!g)throw Error("Expected a previous last point!");let f;const m=this.editor.getPointInShapeSpace(s,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(p.type==="straight"){this.currentLineLength+=E.Dist(g,m),f={type:"straight",points:[{...g},m]};const b=this.editor.getShapePageTransform(s);this.pagePointWhereCurrentSegmentChanged=te.applyToPoint(b,g)}else f={type:"straight",points:[m,d]};const w={id:i,type:this.shapeType,props:{segments:[...a,f]}};this.canClose()&&(w.props.isClosed=this.getIsClosed(a,o)),this.editor.updateShapes([w],{squashing:!0})}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:h}=this;if(h===null)throw Error("We should have a point where the segment changed");if(E.Dist(h,n.currentPagePoint)>Vc){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const p=a.slice(),g=p[p.length-1],f=xn(g.points);if(!f)throw Error("No previous point!");const m={type:"free",points:[...E.PointsBetween(f,d,6).map(k=>k.toFixed().toJson())]},w=[...p,m];this.currentLineLength=this.getLineLength(w);const b={id:i,type:this.shapeType,props:{segments:w}};this.canClose()&&(b.props.isClosed=this.getIsClosed(w,o)),this.editor.updateShapes([b],{squashing:!0})}break}case"straight":{const h=a.slice(),p=h[h.length-1],{pagePointWhereCurrentSegmentChanged:g}=this,{currentPagePoint:f,ctrlKey:m}=this.editor.inputs;if(!g)throw Error("We should have a point where the segment changed");let w,b=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(b=!m,this.didJustShiftClickToExtendPreviousShapeLine=!1):b=!m;let k=this.editor.getPointInShapeSpace(s,f).toFixed().toJson(),S=!1,C;if((this.editor.user.getIsSnapMode()?!m:m)&&h.length>2){let P,I=8/this.editor.getZoomLevel();for(let M=0,A=a.length-2;M<A;M++){const L=a[M];if(!L)break;if(L.type==="free")continue;const z=L.points[0],$=xn(L.points);if(!(z&&$))continue;const j=E.NearestPointOnLineSegment(z,$,k),F=E.Dist(j,k);if(F<I){P=j.toFixed().toJson(),I=F,C=L;break}}P&&(S=!0,k=P)}if(S&&C){const P=this.editor.getShapePageTransform(s),I=C.points[0],M=xn(C.points);if(!M)throw Error("Expected a last point!");const A=te.applyToPoint(P,I),L=te.applyToPoint(P,M),z=te.applyToPoint(P,k);this.editor.snaps.setLines([{id:Re(),type:"points",points:[A,z,L]}])}else{if(this.editor.snaps.clear(),b){const P=E.Angle(g,f),I=Gh(P,24)-P;w=E.RotWith(f,g,I)}else w=f;k=this.editor.getPointInShapeSpace(s,w).toFixed().toJson()}this.currentLineLength+=E.Dist(p.points[0],k),h[h.length-1]={...p,type:"straight",points:[p.points[0],k]};const _={id:i,type:this.shapeType,props:{segments:h}};this.canClose()&&(_.props.isClosed=this.getIsClosed(a,o)),this.editor.updateShapes([_],{squashing:!0});break}case"free":{const h=a.slice(),p=h[h.length-1],g=[...p.points];if(g.length&&this.mergeNextPoint){const{z:m}=g[g.length-1];g[g.length-1]={x:d.x,y:d.y,z:m?Math.max(m,d.z):d.z}}else this.currentLineLength+=E.Dist(g[g.length-1],d),g.push(d);h[h.length-1]={...p,points:g},this.currentLineLength=this.getLineLength(h);const f={id:i,type:this.shapeType,props:{segments:h}};if(this.canClose()&&(f.props.isClosed=this.getIsClosed(h,o)),this.editor.updateShapes([f],{squashing:!0}),g.length>500){this.editor.updateShapes([{id:i,type:this.shapeType,props:{isComplete:!0}}]);const{currentPagePoint:m}=this.editor.inputs,w=Ve();this.editor.createShapes([{id:w,type:this.shapeType,x:qh(m.x),y:qh(m.y),props:{isPen:this.isPen,segments:[{type:"free",points:[{x:0,y:0,z:this.isPen?+(u*1.25).toFixed():.5}]}]}}]),this.initialShape=structuredClone(this.editor.getShape(w)),this.mergeNextPoint=!1,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(n){let r=0;for(const i of n)for(let o=0;o<i.points.length-1;o++){const s=i.points[o],a=i.points[o+1];r+=E.Sub(a,s).len2()}return Math.sqrt(r)}complete(){if(!this.canDraw){this.cancel();return}const{initialShape:n}=this;n&&(this.editor.updateShapes([{id:n.id,type:n.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}v(db,"id","drawing");let vI=(vw=class extends ne{constructor(){super(...arguments);v(this,"onPointerDown",t=>{this.parent.transition("drawing",t)});v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(vw,"id","idle"),vw);class Gp extends ne{constructor(){super(...arguments);v(this,"shapeType","draw");v(this,"onExit",()=>{const n=this.children.drawing;n.initialShape=void 0})}}v(Gp,"id","draw"),v(Gp,"initial","idle"),v(Gp,"children",()=>[vI,db]);class hb extends kp{constructor(){super(...arguments);v(this,"shapeType","frame");v(this,"onCreate",n=>{if(!n)return;const r=this.editor.getShapePageBounds(n),i=[],o=this.editor.getShapeAncestors(n).map(s=>s.id);this.editor.getCurrentPageShapes().map(s=>{if(s.id===n.id||s.isLocked)return;const a=this.editor.getShapePageBounds(s);a&&r.contains(a)&&MW(s,o,n)&&i.push(s.id)}),this.editor.reparentShapes(i,n.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")})}}v(hb,"id","frame"),v(hb,"initial","idle");function MW(e,t,n){return t.includes(e.id)?!1:e.parentId===n.parentId}let AW=(bw=class extends ne{constructor(){super(...arguments);v(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});v(this,"onKeyUp",t=>{var n;if(t.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(n=this.editor.root.getCurrent())==null||n.transition("editing_shape",{...t,target:"shape",shape:r}))}});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(bw,"id","idle"),bw),TW=(ww=class extends ne{constructor(){super(...arguments);v(this,"markId","");v(this,"onPointerUp",()=>{this.complete()});v(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){const{originPagePoint:n}=this.editor.inputs,r=Ve();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:"geo",x:n.x,y:n.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(ei)}}]).select(r).setCurrentTool("select.resizing",{...t,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()});v(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:t}=this.editor.inputs,n=Ve();this.markId=`creating:${n}`,this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:"geo",x:t.x,y:t.y,props:{geo:this.editor.getStyleForNextShape(ei),w:1,h:1}}]);const r=this.editor.getShape(n);if(!r)return;const i=r.props.geo==="star"?new se(0,0,200,190):r.props.geo==="cloud"?new se(0,0,300,180):new se(0,0,200,200),o=i.center,s=this.editor.getShapeParentTransform(r);s&&o.rot(-s.rotation()),this.editor.select(n),this.editor.updateShapes([{id:r.id,type:"geo",x:r.x-o.x,y:r.y-o.y,props:{geo:this.editor.getStyleForNextShape(ei),w:i.width,h:i.height}}]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},v(ww,"id","pointing"),ww);class qp extends ne{constructor(){super(...arguments);v(this,"shapeType","geo")}}v(qp,"id","geo"),v(qp,"initial","idle"),v(qp,"children",()=>[AW,TW]);class Zp extends ne{constructor(){super(...arguments);v(this,"shapeType","highlight");v(this,"onExit",()=>{const n=this.children.drawing;n.initialShape=void 0})}}v(Zp,"id","highlight"),v(Zp,"initial","idle"),v(Zp,"children",()=>[vI,db]);let jW=(xw=class extends ne{constructor(){super(...arguments);v(this,"shapeId","");v(this,"onEnter",t=>{this.shapeId=t.shapeId,this.editor.setCursor({type:"cross",rotation:0})});v(this,"onPointerDown",()=>{this.parent.transition("pointing",{shapeId:this.shapeId})});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(xw,"id","idle"),xw);const bI=2;let OW=(Sw=class extends ne{constructor(){super(...arguments);v(this,"shape",{});v(this,"markId");v(this,"onEnter",t=>{const{inputs:n}=this.editor,{currentPagePoint:r}=n;this.markId=void 0;const i=t.shapeId&&this.editor.getShape(t.shapeId);if(i&&n.shiftKey){this.markId=`creating:${i.id}`,this.editor.mark(this.markId),this.shape=i;const o=this.editor.getShapeHandles(this.shape);if(!o)return;const s=o.filter(f=>f.type==="vertex").sort(qt),a=s[s.length-1],l=s[s.length-2],c=te.applyToPoint(this.editor.getShapeParentTransform(this.shape),new E(this.shape.x,this.shape.y));let u,d,h;const p=E.Sub(r,c);E.Dist(a,l)<bI||E.Dist(p,a)<bI?(u=a.index,d=a.id,h={...a,x:p.x+.1,y:p.y+.1}):(u=zi(a.index),d="handle:"+u,h={id:d,type:"vertex",index:u,x:p.x+.1,y:p.y+.1,canBind:!1});const g=Po(this.shape.props.handles);g[h.id]=h,this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{handles:g}}])}else{const o=Ve();this.markId=`creating:${o}`,this.editor.mark(this.markId),this.editor.createShapes([{id:o,type:"line",x:r.x,y:r.y}]),this.editor.select(o),this.shape=this.editor.getShape(o)}});v(this,"onPointerMove",()=>{if(this.shape&&this.editor.inputs.isDragging){const t=this.editor.getShapeHandles(this.shape);if(!t)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const n=xn(t);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...n,x:n.x-.1,y:n.y-.1},onInteractionEnd:"line"})}});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()});v(this,"onInterrupt",()=>{this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clear()})}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}},v(Sw,"id","pointing"),Sw);class Qp extends ne{constructor(){super(...arguments);v(this,"shapeType","line")}}v(Qp,"id","line"),v(Qp,"initial","idle"),v(Qp,"children",()=>[jW,OW]);let LW=(kw=class extends ne{constructor(){super(...arguments);v(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(kw,"id","idle"),kw),DW=(_w=class extends ne{constructor(){super(...arguments);v(this,"dragged",!1);v(this,"info",{});v(this,"wasFocusedOnEnter",!1);v(this,"markId","");v(this,"shape",{});v(this,"onEnter",()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen(),this.wasFocusedOnEnter&&(this.shape=this.createShape())});v(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&(this.wasFocusedOnEnter||(this.shape=this.createShape()),this.editor.setCurrentTool("select.translating",{...t,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}}))});v(this,"onPointerUp",()=>{this.complete()});v(this,"onInterrupt",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()})}complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}createShape(){const{inputs:{originPagePoint:t}}=this.editor,n=Ve();this.markId=`creating:${n}`,this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:"note",x:t.x,y:t.y}]).select(n);const r=this.editor.getShape(n),i=this.editor.getShapeGeometry(r).bounds;return this.editor.updateShapes([{id:n,type:"note",x:r.x-i.width/2,y:r.y-i.height/2}]),this.editor.getShape(n)}},v(_w,"id","pointing"),_w);class Jp extends ne{constructor(){super(...arguments);v(this,"shapeType","note")}}v(Jp,"id","note"),v(Jp,"initial","idle"),v(Jp,"children",()=>[LW,DW]);function fu(e){const t=e.getShapeAtPoint(e.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:jr/e.getZoomLevel(),renderingOnly:!0});if(!t)return e.setHoveredShape(null);let n;const r=e.getOutermostSelectableShape(t);return r===t||r.id===e.getFocusedGroupId()||e.getSelectedShapeIds().includes(r.id)?n=t:n=r,e.setHoveredShape(n.id)}let zW=(Cw=class extends ne{constructor(){super(...arguments);v(this,"onPointerMove",t=>{switch(t.target){case"shape":case"canvas":fu(this.editor)}});v(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});v(this,"onKeyDown",t=>{var n;if(t.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(n=this.editor.root.getCurrent())==null||n.transition("editing_shape",{...t,target:"shape",shape:r}))}});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(Cw,"id","idle"),Cw),NW=(Ew=class extends ne{constructor(){super(...arguments);v(this,"shape");v(this,"markId","");v(this,"onExit",()=>{this.editor.setHintingShapes([])});v(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){const{inputs:{originPagePoint:n}}=this.editor,r=Ve();if(this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:"text",x:n.x,y:n.y,props:{text:"",autoSize:!1,w:20}}]),this.editor.select(r),this.shape=this.editor.getShape(r),!this.shape)return;const{shape:i}=this;this.editor.setCurrentTool("select.resizing",{...t,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"text",onCreate:()=>{this.editor.setEditingShape(i.id),this.editor.setCurrentTool("select.editing_shape")}})}});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.cancel()});v(this,"onCancel",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()})}complete(){var i;this.editor.mark("creating text shape");const t=Ve(),{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:n,y:r,props:{text:"",autoSize:!0}}]).select(t),this.editor.setEditingShape(t),this.editor.setCurrentTool("select"),(i=this.editor.root.getCurrent())==null||i.transition("editing_shape")}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}},v(Ew,"id","pointing"),Ew);class ef extends ne{constructor(){super(...arguments);v(this,"shapeType","text")}}v(ef,"id","text"),v(ef,"initial","idle"),v(ef,"children",()=>[zW,NW]);const RW=[ef,Gp,qp,Jp,Qp,hb,Xp,Zp];function Et(){return Cn({isDarkMode:vp()})}const pt=J.memo(function({theme:e,d:t,color:n,fill:r}){switch(r){case"none":return null;case"solid":return y.jsx("path",{fill:e[n].semi,d:t});case"semi":return y.jsx("path",{fill:e.solid,d:t});case"pattern":return y.jsx(FW,{theme:e,color:n,fill:r,d:t})}}),FW=function({d:e,color:t,theme:n}){const r=H(),i=Y("zoomLevel",()=>r.getZoomLevel(),[r]),o=Math.ceil(i),s=r.getZoomLevel()<=.18;return y.jsxs(y.Fragment,{children:[y.jsx("path",{fill:n[t].pattern,d:e}),y.jsx("path",{fill:s?n[t].semi:`url(#${Jh[`${o}_${n.id}`]})`,d:e})]})};function Kn({d:e,color:t,fill:n,theme:r}){if(n==="none")return;if(n==="pattern"){const o=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",e),s.setAttribute("fill",r[t].pattern);const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",e),a.setAttribute("fill","url(#hash_pattern)"),o.appendChild(s),o.appendChild(a),o}const i=document.createElementNS("http://www.w3.org/2000/svg","path");switch(i.setAttribute("d",e),n){case"semi":{i.setAttribute("fill",r.solid);break}case"solid":{i.setAttribute("fill",r[t].semi);break}}return i}function Nr(e,t){if(t){const n=document.createElementNS("http://www.w3.org/2000/svg","g");return n.appendChild(t),n.appendChild(e),n}else return e}function $W(e){return e.replace(/\s/g,"\xA0")}function tf(e,t,n){const{padding:r=0}=n,i=document.createElementNS("http://www.w3.org/2000/svg","text");if(i.setAttribute("font-size",n.fontSize+"px"),i.setAttribute("font-family",n.fontFamily),i.setAttribute("font-style",n.fontStyle),i.setAttribute("font-weight",n.fontWeight),i.setAttribute("line-height",n.lineHeight*n.fontSize+"px"),i.setAttribute("dominant-baseline","mathematical"),i.setAttribute("alignment-baseline","mathematical"),t.length===0)return i;const o=se.From(t[0].box);for(const{box:c}of t)o.union(c);const s=r+(n.offsetX??0),a=(n.offsetY??0)+n.fontSize/2+(n.verticalTextAlign==="start"?r:n.verticalTextAlign==="end"?n.height-r-o.height:(Math.ceil(n.height)-o.height)/2);let l=null;for(const{text:c,box:u}of t){if(l!==null&&u.y>l){const p=document.createElementNS("http://www.w3.org/2000/svg","tspan");p.setAttribute("alignment-baseline","mathematical"),p.setAttribute("x",s+"px"),p.setAttribute("y",u.y+a+"px"),p.textContent=`
`,i.appendChild(p)}const d=document.createElementNS("http://www.w3.org/2000/svg","tspan");d.setAttribute("alignment-baseline","mathematical"),d.setAttribute("x",u.x+s+"px"),d.setAttribute("y",u.y+a+"px");const h=$W(c);d.textContent=h,i.appendChild(d),l=u.y}return n.stroke&&n.strokeWidth&&(i.setAttribute("stroke",n.stroke),i.setAttribute("stroke-width",n.strokeWidth+"px")),n.fill&&i.setAttribute("fill",n.fill),i}function nf(e){return{key:`${Qr.id}:${e}`,getElement:async()=>{const t=BW(e);if(!t)return null;const n=t.$$_url,r=t.$$_fontface;if(!n||!r)return null;const i=await(await fetch(n)).blob(),o=await new Promise((l,c)=>{const u=new FileReader;u.onload=()=>l(u.result),u.onerror=c,u.readAsDataURL(i)}),s=r.replace(n,o),a=document.createElementNS("http://www.w3.org/2000/svg","style");return a.textContent=s,a}}}function BW(e){const t=Mc[e];for(const n of document.fonts)if(t.includes(n.family))return n;return null}function pb(e,t){return{key:`${Qr.id}:${e}`,getElement:async()=>{if(e!=="pattern")return null;const n=8/12,r=document.createElement("div");return r.innerHTML=`
				<svg>
					<defs>
						<mask id="hash_pattern_mask">
							<rect x="0" y="0" width="8" height="8" fill="white" />
							<g
								strokeLinecap="round"
								stroke="black"
							>
								<line x1="${n*1}" y1="${n*3}" x2="${n*3}" y2="${n*1}" />
								<line x1="${n*5}" y1="${n*7}" x2="${n*7}" y2="${n*5}" />
								<line x1="${n*9}" y1="${n*11}" x2="${n*11}" y2="${n*9}" />
							</g>
						</mask>
						<pattern
							id="hash_pattern"
							width="8"
							height="8"
							patternUnits="userSpaceOnUse"
						>
							<rect x="0" y="0" width="8" height="8" fill="${t.solid}" mask="url(#hash_pattern_mask)" />
						</pattern>
					</defs>
				</svg>
			`,Array.from(r.querySelectorAll("defs > *"))}}}function fb(){return{key:`${Qr.id}:pattern`,component:HW}}const gu=8,wI=(e,t,n)=>new Promise((r,i)=>{const o=gu*t*e,s=document.createElement("canvas");s.width=o,s.height=o;const a=s.getContext("2d");if(!a)return;a.fillStyle=n?"#212529":"#f8f9fa",a.fillRect(0,0,o,o),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*t*e;const l=8/12,c=u=>u*t*e;a.beginPath(),a.moveTo(c(l*1),c(l*3)),a.lineTo(c(l*3),c(l*1)),a.moveTo(c(l*5),c(l*7)),a.lineTo(c(l*7),c(l*5)),a.moveTo(c(l*9),c(l*11)),a.lineTo(c(l*11),c(l*9)),a.stroke(),s.toBlob(u=>{!u||He.throwToBlob.get()?i():r(u)})}),xI=(e,t)=>{const n=document.createElement("canvas");n.width=e[0],n.height=e[1];const r=n.getContext("2d");return r?(t(r),n.toDataURL()):""},UW=()=>{const e=[];for(let t=1;t<=Math.ceil(Io);t++){const n=xI([1,1],i=>{i.fillStyle=$h.lightMode.black.semi,i.fillRect(0,0,1,1)}),r=xI([1,1],i=>{i.fillStyle=$h.darkMode.black.semi,i.fillRect(0,0,1,1)});e.push({zoom:t,url:n,darkMode:!1}),e.push({zoom:t,url:r,darkMode:!0})}return e};function VW(){const e=H().getInstanceState().devicePixelRatio,[t,n]=x.useState(!1),r=x.useMemo(()=>UW(),[]),[i,o]=x.useState(r);return x.useEffect(()=>{const s=[];for(let l=1;l<=Math.ceil(Io);l++)s.push(wI(e,l,!1).then(c=>({zoom:l,url:URL.createObjectURL(c),darkMode:!1}))),s.push(wI(e,l,!0).then(c=>({zoom:l,url:URL.createObjectURL(c),darkMode:!0})));let a=!1;return Promise.all(s).then(l=>{a||(o(l),n(!0))}),()=>{a=!0,n(!1)}},[e]),{defs:y.jsx(y.Fragment,{children:i.map(s=>{const a=s.zoom+(s.darkMode?"_dark":"_light");return y.jsx("pattern",{id:Jh[a],width:gu,height:gu,patternUnits:"userSpaceOnUse",children:y.jsx("image",{href:s.url,width:gu,height:gu})},a)})}),isReady:t}}function HW(){const e=H(),t=x.useRef(null),{defs:n,isReady:r}=VW();return x.useEffect(()=>{if(r&&e.environment.isSafari){const i=SI(t.current);i&&requestAnimationFrame(()=>{i.style.display="none",requestAnimationFrame(()=>{i.style.display=""})})}},[e,r]),y.jsx("g",{ref:t,children:n})}function SI(e){return e.classList.contains("tl-html-layer")?e:e.parentElement?SI(e.parentElement):null}function Qt(e,t,n={}){const{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=n;let c=0,u=0,d=1,h=0,p=0;switch(l){case"dashed":{d=1,c=Math.min(t*a,e/4);break}case"dotted":{d=100,c=t/d;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(o==="outset"?(e+=c/2,p+=c/2):o==="skip"&&(e-=c,p-=c),s==="outset"?e+=c/2:s==="skip"&&(e-=c)),u=Math.floor(e/c/(2*d)),u-=u%i,u<3&&l==="dashed"?e/t<5?(c=e,u=1,h=0):(c=e*.333,h=e*.333):(u=Math.max(u,3),c=e/u/(2*d),r?(p=c/2,h=(e-u*c)/u):h=(e-u*c)/Math.max(1,u-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}function KW(e,t,n){const r=t==="end"?e.end.point:e.start.point,i=t==="end"?e.start.point:e.end.point,o=e.isStraight?E.Dist(i,r):Math.abs(e.bodyArc.length),s=Math.max(Math.min(o/5,n*3),n);let a;if(e.isStraight)a=E.Nudge(r,i,s);else{const l=BR(r,s,e.handleArc.center,e.handleArc.radius);a=t==="end"?e.handleArc.sweepFlag?l[0]:l[1]:e.handleArc.sweepFlag?l[1]:l[0]}return{point:r,int:a}}function WW({point:e,int:t}){const n=E.RotWith(t,e,Te/6),r=E.RotWith(t,e,-Te/6);return`M ${n.x} ${n.y} L ${e.x} ${e.y} L ${r.x} ${r.y}`}function YW({point:e,int:t}){const n=E.RotWith(t,e,Te/6),r=E.RotWith(t,e,-Te/6);return`M ${n.x} ${n.y} L ${e.x} ${e.y} L ${r.x} ${r.y} Z`}function XW({point:e,int:t}){const n=E.Sub(t,e).div(2),r=E.Add(e,E.Rot(n,Ke)),i=E.Sub(e,E.Rot(n,Ke));return`M ${r.x} ${r.y} L ${t.x} ${t.y} L ${i.x} ${i.y} Z`}function GW({point:e,int:t}){const n=E.Lrp(e,t,.45),r=E.Dist(n,e);return`M ${n.x-r},${n.y}
  a ${r},${r} 0 1,0 ${r*2},0
  a ${r},${r} 0 1,0 -${r*2},0 `}function qW({point:e,int:t}){const n=E.Lrp(e,t,.75),r=E.RotWith(n,e,Te/4),i=E.RotWith(n,e,-Te/4),o=E.Lrp(r,i,.5);return o.add(E.Sub(o,e)),`M ${o.x} ${o.y} L ${r.x} ${r.y} ${e.x} ${e.y} L ${i.x} ${i.y} Z`}function ZW({int:e,point:t}){const n=E.Lrp(t,e,.85),r=E.Sub(n,t).div(2),i=E.Add(t,E.Rot(r,Ke)),o=E.Sub(t,E.Rot(r,Ke)),s=E.Add(n,E.Rot(r,Ke)),a=E.Sub(n,E.Rot(r,Ke));return`M ${i.x} ${i.y} L ${s.x} ${s.y} L ${a.x} ${a.y} L ${o.x} ${o.y} Z`}function QW({int:e,point:t}){const n=E.Sub(e,t).div(2),r=E.Add(t,E.Rot(n,Ke)),i=E.Sub(t,E.Rot(n,Ke));return`M ${r.x} ${r.y} L ${i.x} ${i.y}`}function sl(e,t,n){const r=t==="end"?e.end.arrowhead:e.start.arrowhead;if(r==="none")return;const i=KW(e,t,n);if(i){switch(r){case"bar":return QW(i);case"square":return ZW(i);case"diamond":return qW(i);case"dot":return GW(i);case"inverted":return XW(i);case"arrow":return WW(i);case"triangle":return YW(i)}return""}}function JW(e){const{start:t,end:n,handleArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=e;return`M${t.handle.x},${t.handle.y} A${r} ${r} 0 ${i} ${o} ${n.handle.x},${n.handle.y}`}function gb(e){const{start:t,end:n,bodyArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=e;return`M${t.point.x},${t.point.y} A${r} ${r} 0 ${i} ${o} ${n.point.x},${n.point.y}`}function kI(e,t){return`M${e.x},${e.y}L${t.x},${t.y}`}function eY(e){return kI(e.start.handle,e.end.handle)}function mb(e){return kI(e.start.point,e.end.point)}function yb(e,t,n){const r=H(),i=x.useRef(null),o=x.useRef(!1),s=x.useRef(),a=Y("isEditing",()=>r.getEditingShapeId()===e,[r,e]);x.useEffect(()=>{const g=i.current;g&&a&&document.activeElement!==g&&g.focus()},[a]);const l=x.useCallback(()=>{const g=o.current;o.current=!1,requestAnimationFrame(()=>{const f=i.current;if(!f)return;const m=r.getShape(e);m&&(f.value=m.props.text,f.value.length&&!g&&f.select())})},[r,e]),c=x.useCallback(()=>{const g=s.current;requestAnimationFrame(()=>{var w;const f=i.current,m=r.getEditingShapeId();if(f&&m){if(m===e)if(g)if(!g.length)f.focus();else{o.current=!0,f.focus();const b=window.getSelection();b&&g.forEach(k=>b.addRange(k))}else f.focus()}else(w=window.getSelection())==null||w.removeAllRanges(),r.complete()})},[r,e]),u=x.useCallback(g=>{if(a)switch((g.ctrlKey||g.metaKey)&&St(g),g.key){case"Enter":{(g.ctrlKey||g.metaKey)&&r.complete();break}case"Tab":{Ee(g),g.shiftKey?Fo.unindent(g.currentTarget):Fo.indent(g.currentTarget);break}}},[r,a]),d=x.useCallback(g=>{if(!a)return;let f=Fo.normalizeText(g.currentTarget.value);const m=f.replace(/\t/g,ol);if(m!==f){const w=g.currentTarget.selectionStart;g.currentTarget.value=m,g.currentTarget.selectionStart=w+(m.length-f.length),g.currentTarget.selectionEnd=w+(m.length-f.length),f=m}r.updateShapes([{id:e,type:t,props:{text:f}}])},[r,e,t,a]),h=n.trim().length===0;x.useEffect(()=>{if(a&&i.current){let g=function(){var m,w;const f=(m=window.getSelection)==null?void 0:m.call(window);if(f&&f.type!=="None"){const b=[];if(f)for(let k=0;k<f.rangeCount;k++)b.push((w=f.getRangeAt)==null?void 0:w.call(f,k));s.current=b}};return document.addEventListener("selectionchange",g),()=>{document.removeEventListener("selectionchange",g)}}},[a]);const p=x.useCallback(g=>{r.dispatch({...En(g),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(e)}),St(g)},[r,e]);return{rInput:i,isEditing:a,handleFocus:l,handleBlur:c,handleKeyDown:u,handleChange:d,handleInputPointerDown:p,handleDoubleClick:St,isEmpty:h}}const tY=x.memo(function({id:e,text:t,size:n,font:r,position:i,width:o,labelColor:s}){const{rInput:a,isEditing:l,handleFocus:c,handleBlur:u,handleKeyDown:d,handleChange:h,isEmpty:p,handleInputPointerDown:g,handleDoubleClick:f}=yb(e,"arrow",t),m=Fo.normalizeTextForDom(t).trim().length>0;return!l&&!m?null:y.jsx("div",{className:"tl-arrow-label","data-font":r,"data-align":"center","data-hastext":!p,"data-isediting":l,style:{textAlign:"center",fontSize:Ro[n],lineHeight:Ro[n]*Dt.lineHeight+"px",transform:`translate(${i.x}px, ${i.y}px)`,color:s},children:y.jsxs("div",{className:"tl-arrow-label__inner",children:[y.jsx("p",{style:{width:o||"9px"},children:t?Fo.normalizeTextForDom(t):" "}),l&&y.jsx("textarea",{ref:a,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:t,onFocus:c,onChange:h,onKeyDown:d,onBlur:u,onContextMenu:St,onPointerDown:g,onDoubleClick:f})]})})});let nY=0;class rf extends Or{constructor(){super(...arguments);v(this,"canEdit",()=>!0);v(this,"canBind",()=>!1);v(this,"canSnap",()=>!1);v(this,"hideResizeHandles",()=>!0);v(this,"hideRotateHandle",()=>!0);v(this,"hideSelectionBoundsBg",()=>!0);v(this,"hideSelectionBoundsFg",()=>!0);v(this,"onHandleChange",(n,{handle:r,isPrecise:i})=>{const o=r.id;if(o==="middle"){const{start:f,end:m}=Lr(this.editor,n),w=E.Sub(m,f),b=E.Per(w),k=E.Med(m,f),S=E.Sub(k,b),C=E.Add(k,b),_=E.NearestPointOnLineSegment(S,C,r,!1);let P=E.Dist(_,k);return E.Clockwise(_,m,k)&&(P*=-1),{id:n.id,type:n.type,props:{bend:P}}}const s=Ht(n),a=this.editor.getShapePageTransform(s.id).applyToPoint(r);if(this.editor.inputs.ctrlKey)return s.props[o]={type:"point",x:r.x,y:r.y},s;const l=this.editor.getShapePageTransform(n.id).applyToPoint(r),c=this.editor.getShapeAtPoint(l,{hitInside:!0,hitFrameInside:!0,margin:0,filter:f=>!f.isLocked&&this.editor.getShapeUtil(f).canBind(f)});if(!c)return s.props[o]={type:"point",x:r.x,y:r.y},s;const u=this.editor.getShapeGeometry(c),d=se.ZeroFix(u.bounds),h=this.editor.getPointInShapeSpace(c,a);let p=i;if(!p){const f=s.props[o];(f.type==="point"||f.type==="binding"&&c.id!==f.boundShapeId)&&(p=this.editor.inputs.pointerVelocity.len()<.5)}if(!i){u.isClosed||(p=!0);const f=s.props[o==="start"?"end":"start"];f.type==="binding"&&c.id===f.boundShapeId&&f.isPrecise&&(p=!0)}const g={x:(h.x-d.minX)/d.width,y:(h.y-d.minY)/d.height};return p&&E.Dist(h,d.center)<Math.max(4,Math.min(Math.min(d.width,d.height)*.15,16))/this.editor.getZoomLevel()&&(g.x=.5,g.y=.5),s.props[o]={type:"binding",boundShapeId:c.id,normalizedAnchor:g,isPrecise:p,isExact:this.editor.inputs.altKey},s.props.start.type==="binding"&&s.props.end.type==="binding"&&s.props.start.boundShapeId===s.props.end.boundShapeId&&E.Equals(s.props.start.normalizedAnchor,s.props.end.normalizedAnchor)&&(s.props.end.normalizedAnchor.x+=.05),s});v(this,"onTranslateStart",n=>{const r=n.props.start.type==="binding"?n.props.start.boundShapeId:null,i=n.props.end.type==="binding"?n.props.end.boundShapeId:null,o=this.editor.getSelectedShapeIds();if(r&&(o.includes(r)||this.editor.isAncestorSelected(r))||i&&(o.includes(i)||this.editor.isAncestorSelected(i)))return;const{start:s,end:a}=Lr(this.editor,n);return{id:n.id,type:n.type,props:{...n.props,start:{type:"point",x:s.x,y:s.y},end:{type:"point",x:a.x,y:a.y}}}});v(this,"onResize",(n,r)=>{const{scaleX:i,scaleY:o}=r,s=Lr(this.editor,n),{start:a,end:l}=Ht(n.props);let{bend:c}=n.props;a.type==="point"&&(a.x=s.start.x*i,a.y=s.start.y*o),l.type==="point"&&(l.x=s.end.x*i,l.y=s.end.y*o);const u=Math.abs(i),d=Math.abs(o);return i<0&&o>=0?(c!==0&&(c*=-1,c*=Math.max(u,d)),a.type==="binding"&&(a.normalizedAnchor.x=1-a.normalizedAnchor.x),l.type==="binding"&&(l.normalizedAnchor.x=1-l.normalizedAnchor.x)):i>=0&&o<0?(c!==0&&(c*=-1,c*=Math.max(u,d)),a.type==="binding"&&(a.normalizedAnchor.y=1-a.normalizedAnchor.y),l.type==="binding"&&(l.normalizedAnchor.y=1-l.normalizedAnchor.y)):i>=0&&o>=0?c!==0&&(c*=Math.max(u,d)):i<0&&o<0&&(c!==0&&(c*=Math.max(u,d)),a.type==="binding"&&(a.normalizedAnchor.x=1-a.normalizedAnchor.x,a.normalizedAnchor.y=1-a.normalizedAnchor.y),l.type==="binding"&&(l.normalizedAnchor.x=1-l.normalizedAnchor.x,l.normalizedAnchor.y=1-l.normalizedAnchor.y)),{props:{start:a,end:l,bend:c}}});v(this,"onDoubleClickHandle",(n,r)=>{switch(r.id){case"start":return{id:n.id,type:n.type,props:{...n.props,arrowheadStart:n.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:n.id,type:n.type,props:{...n.props,arrowheadEnd:n.props.arrowheadEnd==="none"?"arrow":"none"}}}});v(this,"onEditEnd",n=>{const{id:r,type:i,props:{text:o}}=n;o.trimEnd()!==n.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])})}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{type:"point",x:0,y:0},end:{type:"point",x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",font:"draw"}}getGeometry(n){const r=this.editor.getArrowInfo(n),i=r.isStraight?new up({start:E.From(r.start.point),end:E.From(r.end.point)}):new $F({center:E.Cast(r.handleArc.center),radius:r.handleArc.radius,start:E.Cast(r.start.point),end:E.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});let o;if(n.props.text.trim()){const s=i.bounds,{w:a,h:l}=this.editor.textMeasure.measureText(n.props.text,{...Dt,fontFamily:Ui[n.props.font],fontSize:Ro[n.props.size],maxWidth:null});let c=a,u=l;if(s.width>s.height){c=Math.max(Math.min(a,64),Math.min(s.width-64,a));const{w:d,h}=this.editor.textMeasure.measureText(n.props.text,{...Dt,fontFamily:Ui[n.props.font],fontSize:Ro[n.props.size],maxWidth:c});c=d,u=h}if(c>16*Ro[n.props.size]){c=16*Ro[n.props.size];const{w:d,h}=this.editor.textMeasure.measureText(n.props.text,{...Dt,fontFamily:Ui[n.props.font],fontSize:Ro[n.props.size],maxWidth:c});c=d,u=h}o=new Ao({x:r.middle.x-c/2-4.25,y:r.middle.y-u/2-4.25,width:c+8.5,height:u+8.5,isFilled:!0,isLabel:!0})}return new Mo({children:o?[i,o]:[i],isSnappable:!1})}getHandles(n){const r=this.editor.getArrowInfo(n);return[{id:"start",type:"vertex",index:"a0",x:r.start.handle.x,y:r.start.handle.y,canBind:!0},{id:"middle",type:"virtual",index:"a2",x:r.middle.x,y:r.middle.y,canBind:!1},{id:"end",type:"vertex",index:"a3",x:r.end.handle.x,y:r.end.handle.y,canBind:!0}]}component(n){const r=Et(),i=this.editor.getOnlySelectedShape(),o=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","arrow.dragging")&&!this.editor.getInstanceState().isReadonly,s=this.editor.getArrowInfo(n),a=se.ZeroFix(this.editor.getShapeGeometry(n).bounds),l=J.useMemo(()=>this.editor.environment.isSafari?nY+=1:0,[n]);if(!(s!=null&&s.isValid))return null;const c=Zt[n.props.size],u=s.start.arrowhead&&sl(s,"start",c),d=s.end.arrowhead&&sl(s,"end",c),h=s.isStraight?mb(s):gb(s);let p=null;if(i===n&&o){const{strokeDasharray:S,strokeDashoffset:C}=Qt(s.isStraight?E.Dist(s.start.handle,s.end.handle):Math.abs(s.handleArc.length),2,{end:"skip",start:"skip",lengthRatio:2.5});p=n.props.start.type==="binding"||n.props.end.type==="binding"?y.jsx("path",{className:"tl-arrow-hint",d:s.isStraight?eY(s):JW(s),strokeDasharray:S,strokeDashoffset:C,strokeWidth:2,markerStart:n.props.start.type==="binding"?n.props.start.isExact?"":n.props.start.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:n.props.end.type==="binding"?n.props.end.isExact?"":n.props.end.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}const{strokeDasharray:g,strokeDashoffset:f}=Qt(s.isStraight?s.length:Math.abs(s.bodyArc.length),c,{style:n.props.dash}),m=n.props.text.trim()?this.editor.getShapeGeometry(n).children[1]:null,w=!(s.start.arrowhead==="none"||s.start.arrowhead==="arrow"),b=!(s.end.arrowhead==="none"||s.end.arrowhead==="arrow"),k=(n.id+"_clip_"+l).replace(":","_");return y.jsxs(y.Fragment,{children:[y.jsxs(Bn,{id:n.id,style:{minWidth:50,minHeight:50},children:[y.jsx("defs",{children:y.jsxs("mask",{id:k,children:[y.jsx("rect",{x:O(-100+a.minX),y:O(-100+a.minY),width:O(a.width+200),height:O(a.height+200),fill:"white"}),m&&y.jsx("rect",{x:m.x,y:m.y,width:m.w,height:m.h,fill:"black",rx:4,ry:4}),u&&w&&y.jsx("path",{d:u,fill:s.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),d&&b&&y.jsx("path",{d,fill:s.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),y.jsxs("g",{fill:"none",stroke:r[n.props.color].solid,strokeWidth:c,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[p,y.jsxs("g",{mask:`url(#${k})`,children:[y.jsx("rect",{x:O(a.minX-100),y:O(a.minY-100),width:O(a.width+200),height:O(a.height+200),opacity:0}),y.jsx("path",{d:h,strokeDasharray:g,strokeDashoffset:f})]}),u&&w&&n.props.fill!=="none"&&y.jsx(pt,{theme:r,d:u,color:n.props.color,fill:n.props.fill}),d&&b&&n.props.fill!=="none"&&y.jsx(pt,{theme:r,d,color:n.props.color,fill:n.props.fill}),u&&y.jsx("path",{d:u}),d&&y.jsx("path",{d})]})]}),y.jsx(tY,{id:n.id,text:n.props.text,font:n.props.font,size:n.props.size,position:s.middle,width:(m==null?void 0:m.w)??0,labelColor:r[n.props.labelColor].solid})]})}indicator(n){const{start:r,end:i}=Lr(this.editor,n),o=this.editor.getArrowInfo(n),s=this.editor.getShapeGeometry(n),a=s.bounds,l=n.props.text.trim()?s.children[1]:null,c=_p(n.id);if(!o||E.Equals(r,i))return null;const u=Zt[n.props.size],d=o.start.arrowhead&&sl(o,"start",u),h=o.end.arrowhead&&sl(o,"end",u),p=o.isStraight?mb(o):gb(o),g=d&&o.start.arrowhead!=="arrow"||h&&o.end.arrowhead!=="arrow"||!!l,f=(n.id+"_clip").replace(":","_");return c&&l?y.jsx("rect",{x:O(l.x),y:O(l.y),width:l.w,height:l.h,rx:3.5,ry:3.5}):y.jsxs("g",{children:[g&&y.jsx("defs",{children:y.jsxs("mask",{id:f,children:[y.jsx("rect",{x:a.minX-100,y:a.minY-100,width:a.w+200,height:a.h+200,fill:"white"}),l&&y.jsx("rect",{x:O(l.x),y:O(l.y),width:l.w,height:l.h,fill:"black",rx:3.5,ry:3.5}),d&&y.jsx("path",{d,fill:o.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),h&&y.jsx("path",{d:h,fill:o.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),y.jsxs("g",{...g?{mask:`url(#${f})`}:void 0,children:[g&&y.jsx("rect",{x:a.minX-100,y:a.minY-100,width:a.width+200,height:a.height+200,opacity:0}),y.jsx("path",{d:p})]}),d&&y.jsx("path",{d}),h&&y.jsx("path",{d:h}),l&&y.jsx("rect",{x:O(l.x),y:O(l.y),width:l.w,height:l.h,rx:3.5,ry:3.5})]})}toSvg(n,r){const i=Cn({isDarkMode:this.editor.user.getIsDarkMode()});r.addExportDef(pb(n.props.fill,i));const o=i[n.props.color].solid,s=this.editor.getArrowInfo(n),a=Zt[n.props.size],l=document.createElementNS("http://www.w3.org/2000/svg","g");if(!s)return l;const c=s.start.arrowhead&&sl(s,"start",a),u=s.end.arrowhead&&sl(s,"end",a),d=this.editor.getShapeGeometry(n),h=d.bounds,p=n.props.text.trim()?d.children[1]:null,g=(n.id+"_clip").replace(":","_");if(c||u||p){const S=document.createElementNS("http://www.w3.org/2000/svg","defs"),C=document.createElementNS("http://www.w3.org/2000/svg","mask");C.id=g;const _=document.createElementNS("http://www.w3.org/2000/svg","rect");if(_.setAttribute("x",h.minX-100+""),_.setAttribute("y",h.minY-100+""),_.setAttribute("width",h.width+200+""),_.setAttribute("height",h.height+200+""),_.setAttribute("fill","white"),C.appendChild(_),c&&C.appendChild(_I(c,s.start.arrowhead)),u&&C.appendChild(_I(u,s.end.arrowhead)),p){const P=document.createElementNS("http://www.w3.org/2000/svg","rect");P.setAttribute("x",p.x+""),P.setAttribute("y",p.y+""),P.setAttribute("width",p.w+""),P.setAttribute("height",p.h+""),P.setAttribute("fill","black"),C.appendChild(P)}S.appendChild(C),l.appendChild(S)}const f=document.createElementNS("http://www.w3.org/2000/svg","g");f.setAttribute("mask",`url(#${g})`),l.appendChild(f);const m=document.createElementNS("http://www.w3.org/2000/svg","rect");m.setAttribute("x","-100"),m.setAttribute("y","-100"),m.setAttribute("width",h.width+200+""),m.setAttribute("height",h.height+200+""),m.setAttribute("fill","transparent"),m.setAttribute("stroke","none"),f.appendChild(m);const w=rY(s.isStraight?mb(s):gb(s),o,a),{strokeDasharray:b,strokeDashoffset:k}=Qt(s.isStraight?s.length:Math.abs(s.bodyArc.length),a,{style:n.props.dash});if(w.setAttribute("stroke-dasharray",b),w.setAttribute("stroke-dashoffset",k),f.appendChild(w),c&&l.appendChild(CI(c,n.props.color,a,n.props.arrowheadStart==="arrow"?"none":n.props.fill,i)),u&&l.appendChild(CI(u,n.props.color,a,n.props.arrowheadEnd==="arrow"?"none":n.props.fill,i)),p){r.addExportDef(nf(n.props.font));const S={fontSize:Ro[n.props.size],lineHeight:Dt.lineHeight,fontFamily:Mc[n.props.font],padding:0,textAlign:"middle",width:p.w-8,verticalTextAlign:"middle",height:p.h,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},C=tf(this.editor,this.editor.textMeasure.measureTextSpans(n.props.text,S),S);C.setAttribute("fill",i[n.props.labelColor].solid),Array.from(C.children).forEach(P=>{const I=parseFloat(P.getAttribute("x")||"0"),M=parseFloat(P.getAttribute("y")||"0");P.setAttribute("x",I+4+p.x+"px"),P.setAttribute("y",M+p.y+"px")});const _=C.cloneNode(!0);_.setAttribute("stroke-width","2"),_.setAttribute("fill",i.background),_.setAttribute("stroke",i.background),l.appendChild(_),l.appendChild(C)}return l}getCanvasSvgDefs(){return[fb()]}}v(rf,"type","arrow"),v(rf,"props",WD),v(rf,"migrations",YD);function _I(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",e),n.setAttribute("fill",t==="arrow"?"none":"black"),n.setAttribute("stroke","none"),n}function rY(e,t,n){const r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r.setAttribute("fill","none"),r.setAttribute("stroke",t),r.setAttribute("stroke-width",n+""),r}function CI(e,t,n,r,i){const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",e),o.setAttribute("fill","none"),o.setAttribute("stroke",i[t].solid),o.setAttribute("stroke-width",n+"");const s=Kn({d:e,fill:r,color:t,theme:i});if(s){const a=document.createElementNS("http://www.w3.org/2000/svg","g");return a.appendChild(s),a.appendChild(o),a}else return o}const EI="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function mu({url:e,zoomLevel:t}){return y.jsx("a",{className:pe("tl-hyperlink-button",{"tl-hyperlink-button__hidden":t<.32}),href:e,target:"_blank",rel:"noopener noreferrer",onPointerDown:St,onPointerUp:St,title:e,draggable:!1,children:y.jsx("div",{className:"tl-hyperlink-button__icon",style:{mask:`url("${EI}") center 100% / 100% no-repeat`,WebkitMask:`url("${EI}") center 100% / 100% no-repeat`}})})}const iY=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function vb(e){return iY.map(t=>{const{offsetX:n,offsetY:r,blur:i,spread:o,color:s}=t,a=new E(n,r),{x:l,y:c}=a.rot(-e);return`${l}px ${c}px ${i}px ${o}px ${s}`}).join(", ")}class of extends Wa{constructor(){super(...arguments);v(this,"canResize",()=>!1);v(this,"hideSelectionBoundsFg",()=>!0);v(this,"onBeforeCreate",n=>{PI(this.editor,n)});v(this,"onBeforeUpdate",(n,r)=>{if(n.props.url!==r.props.url)if(Fn.isValid(r.props.url))PI(this.editor,r);else return{...r,props:{...r.props,url:n.props.url}}})}getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(n){const r=n.props.assetId?this.editor.getAsset(n.props.assetId):null,i=this.editor.getShapePageTransform(n).rotation(),o=oY(n);return y.jsx(As,{children:y.jsxs("div",{className:"tl-bookmark__container",style:{boxShadow:vb(i)},children:[y.jsxs("div",{className:"tl-bookmark__image_container",children:[r!=null&&r.props.image?y.jsx("img",{className:"tl-bookmark__image",draggable:!1,src:r==null?void 0:r.props.image,alt:(r==null?void 0:r.props.title)||""}):y.jsx("div",{className:"tl-bookmark__placeholder"}),y.jsx(mu,{url:n.props.url,zoomLevel:this.editor.getZoomLevel()})]}),y.jsxs("div",{className:"tl-bookmark__copy_container",children:[(r==null?void 0:r.props.title)&&y.jsx("h2",{className:"tl-bookmark__heading",children:pu((r==null?void 0:r.props.title)||"",54)}),(r==null?void 0:r.props.description)&&y.jsx("p",{className:"tl-bookmark__description",children:pu((r==null?void 0:r.props.description)||"",128)}),y.jsx("a",{className:"tl-bookmark__link",href:n.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:St,onPointerUp:St,onClick:St,children:pu(o,45)})]})]})})}indicator(n){return y.jsx("rect",{width:O(n.props.w),height:O(n.props.h),rx:"6",ry:"6"})}}v(of,"type","bookmark"),v(of,"props",XD),v(of,"migrations",GD);const oY=e=>{try{const t=new URL(e.props.url),n=t.pathname.replace(/\/*$/,"");return`${t.hostname}${n}`}catch{return e.props.url}};function PI(e,t){const{url:n}=t.props,r=xs.createId(Ph(n));e.getAsset(r)?t.props.assetId!==r&&e.updateShapes([{id:t.id,type:t.type,props:{assetId:r}}]):(e.updateShapes([{id:t.id,type:t.type,props:{assetId:null}}]),sY(e,t))}const sY=$_(async(e,t)=>{const{url:n}=t.props,r=await e.getAssetForExternalContent({type:"url",url:n});r&&e.batch(()=>{e.createAssets([r]),e.updateShapes([{id:t.id,type:t.type,props:{assetId:r.id}}])})},500);function $o(e,t=!1){const n=e.length;if(n<2)return"";let r=e[0].point,i=e[1].point;if(n===2)return`M${Tt(r)}L${Tt(i)}`;let o="";for(let s=2,a=n-1;s<a;s++)r=e[s].point,i=e[s+1].point,o+=Pn(r,i);return t?`M${Pn(e[0].point,e[1].point)}Q${Tt(e[1].point)}${Pn(e[1].point,e[2].point)}T${o}${Pn(e[n-1].point,e[0].point)}${Pn(e[0].point,e[1].point)}Z`:`M${Tt(e[0].point)}Q${Tt(e[1].point)}${Pn(e[1].point,e[2].point)}${e.length>3?"T":""}${o}L${Tt(e[n-1].point)}`}function aY(e,t={}){const{start:n={},end:r={}}=t,{cap:i=!0}=n,{cap:o=!0}=r;bs(!n.taper&&!r.taper,"cap taper not supported here"),bs(!n.easing&&!r.easing,"cap easing not supported here"),bs(i&&o,"cap must be true");const s=zr(e,t);nl(s,t);const a=lY(s);let l="";for(const c of a)l+=uY(c,t);return l}function lY(e){if(e.length<=2)return[e];const t=[];let n=[e[0]];for(let r=1;r<e.length-1;r++){const i=e[r-1],o=e[r],s=e[r+1],a=E.Angle(i.point,o.point),l=E.Angle(o.point,s.point),c=Math.abs($c(a,l))/Math.PI;if(c>.8){const p={...o,point:o.input};n.push(p),t.push(bb(n)),n=[p];continue}if(n.push(o),c<.25)continue;const u=(i.radius+o.radius+s.radius)/3,d=E.Dist(i.point,o.point)/u,h=E.Dist(o.point,s.point)/u;if(d+h<1.5){n.push(o),t.push(bb(n)),n=[o];continue}}return n.push(e[e.length-1]),t.push(bb(n)),t}function bb(e){const t=e[0];for(;e.length>2;){const r=e[1],i=E.Dist(t.point,r.point),o=(t.radius+r.radius)/2;if(i<o*.5)e.splice(1,1);else break}const n=e[e.length-1];for(;e.length>2;){const r=e[e.length-2],i=E.Dist(n.point,r.point),o=(n.radius+r.radius)/2;if(i<o*.5)e.splice(e.length-2,1);else break}return e.length>1&&(e[0]={...e[0],vector:E.FromAngle(E.Angle(e[1].point,e[0].point))},e[e.length-1]={...e[e.length-1],vector:E.FromAngle(E.Angle(e[e.length-1].point,e[e.length-2].point))}),e}function cY(e,t,n){return"M "+e+" "+t+" m -"+n+", 0 a "+n+","+n+" 0 1,1 "+n*2+",0 a "+n+","+n+" 0 1,1 -"+n*2+",0"}function uY(e,t={}){if(e.length===0)return"";if(e.length===1)return cY(e[0].point.x,e[0].point.y,e[0].radius);const{left:n,right:r}=sI(e,t);r.reverse();let i=`M${Tt(n[0])}T`;for(let o=1;o<n.length;o++)i+=Pn(n[o-1],n[o]);{const o=e[e.length-1],s=o.radius,a=o.vector.clone().per().neg(),l=E.Add(o.point,E.Mul(a,s)),c=E.Add(o.point,E.Mul(a,-s));i+=`${Tt(l)}A${O(s)},${O(s)} 0 0 1 ${Tt(c)}T`}for(let o=1;o<r.length;o++)i+=Pn(r[o-1],r[o]);{const o=e[0],s=o.radius,a=o.vector.clone().per(),l=E.Add(o.point,E.Mul(a,s)),c=E.Add(o.point,E.Mul(a,-s));i+=`${Tt(l)}A${O(s)},${O(s)} 0 0 1 ${Tt(c)}Z`}return i}function sf(){const e=H();return Y("zoom",()=>e.getZoomLevel()<.35,[e])}const dY=e=>e*.65+Uz(e*Te/2)*.35,hY=e=>({size:1+e,thinning:.5,streamline:.62+(1+e)/8*.06,smoothing:.62,easing:Xt.easeOutSine,simulatePressure:!0}),pY=e=>({size:1+e*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:dY}),II=e=>({size:1+e,thinning:0,streamline:.62+(1+e)/8*.06,smoothing:.62,simulatePressure:!1,easing:Xt.linear});function wb({strokeWidth:e,showAsComplete:t}){return{size:1+e,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:Xt.easeOutSine,last:t}}function af(e,t,n,r){return{...r?II(t):e.dash==="draw"?e.isPen?pY(t):hY(t):II(t),last:e.isComplete||n}}function al(e){const t=[];for(const n of e)if(n.type==="free"||n.points.length<2)t.push(...n.points.map(E.Cast));else{const r=Math.max(4,Math.floor(E.Dist(n.points[0],n.points[1])/16));t.push(...E.PointsBetween(n.points[0],n.points[1],r))}return t}function MI(e,t){return{draw:"none",solid:"none",dotted:`0.1 ${t*2}`,dashed:`${t*2} ${t*2}`}[e.props.dash]}class lf extends Or{constructor(){super(...arguments);v(this,"hideResizeHandles",n=>Sb(n));v(this,"hideRotateHandle",n=>Sb(n));v(this,"hideSelectionBoundsFg",n=>Sb(n));v(this,"onResize",(n,r)=>{const{scaleX:i,scaleY:o}=r,s=[];for(const a of n.props.segments)s.push({...a,points:a.points.map(({x:l,y:c,z:u})=>({x:qh(i*l),y:qh(o*c),z:u}))});return{props:{segments:s}}})}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1}}getGeometry(n){const r=al(n.props.segments),i=Zt[n.props.size];if(n.props.segments.length===1){const s=se.FromPoints(r);if(s.width<i*2&&s.height<i*2)return new vE({x:-i,y:-i,radius:i,isFilled:!0})}const o=zr(r,af(n.props,i,!0,!0)).map(s=>s.point);return n.props.isClosed?new _t({points:o,isFilled:n.props.fill!=="none"}):new Es({points:o})}component(n){var p;const r=Et(),i=sf(),o=Zt[n.props.size],s=al(n.props.segments),a=n.props.isComplete||((p=xn(n.props.segments))==null?void 0:p.type)==="straight";let l=o;!i&&!n.props.isPen&&n.props.dash==="draw"&&s.length===1&&(l+=Eo(n.id)()*(o/6));const c=af(n.props,l,a,i);if(!i&&n.props.dash==="draw")return y.jsxs(Bn,{id:n.id,children:[n.props.isClosed&&n.props.fill&&s.length>1?y.jsx(pt,{theme:r,fill:n.props.isClosed?n.props.fill:"none",color:n.props.color,d:$o(zr(s,c),n.props.isClosed)}):null,y.jsx("path",{d:aY(s,c),strokeLinecap:"round",fill:r[n.props.color].solid})]});const u=zr(s,c),d=u.length<2,h=d?xb(s[0],0):$o(u,n.props.isClosed);return y.jsxs(Bn,{id:n.id,children:[y.jsx(pt,{theme:r,color:n.props.color,fill:d||n.props.isClosed?n.props.fill:"none",d:h}),y.jsx("path",{d:h,strokeLinecap:"round",fill:d?r[n.props.color].solid:"none",stroke:r[n.props.color].solid,strokeWidth:o,strokeDasharray:d?"none":MI(n,o),strokeDashoffset:"0"})]})}indicator(n){var d;const r=sf(),i=Zt[n.props.size],o=al(n.props.segments);let s=i;!r&&!n.props.isPen&&n.props.dash==="draw"&&o.length===1&&(s+=Eo(n.id)()*(i/6));const a=n.props.isComplete||((d=xn(n.props.segments))==null?void 0:d.type)==="straight",l=af(n.props,s,a,!0),c=zr(o,l),u=c.length>1?$o(c,n.props.isClosed):xb(o[0],s);return y.jsx("path",{d:u})}toSvg(n,r){var f;const i=Cn({isDarkMode:this.editor.user.getIsDarkMode()});r.addExportDef(pb(n.props.fill,i));const{color:o}=n.props,s=Zt[n.props.size],a=al(n.props.segments),l=n.props.isComplete||((f=xn(n.props.segments))==null?void 0:f.type)==="straight";let c=s;!n.props.isPen&&n.props.dash==="draw"&&a.length===1&&(c+=Eo(n.id)()*(s/6));const u=af(n.props,c,l,!1),d=zr(a,u),h=d.length>1?$o(d,n.props.isClosed):xb(a[0],c);let p;if(n.props.dash==="draw"||d.length<2){nl(d,u);const m=uu(d,u),w=document.createElementNS("http://www.w3.org/2000/svg","path");w.setAttribute("d",Hc(m,!0)),w.setAttribute("fill",i[o].solid),w.setAttribute("stroke-linecap","round"),p=w}else{const m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d",h),m.setAttribute("stroke",i[o].solid),m.setAttribute("fill","none"),m.setAttribute("stroke-linecap","round"),m.setAttribute("stroke-width",s.toString()),m.setAttribute("stroke-dasharray",MI(n,s)),m.setAttribute("stroke-dashoffset","0"),p=m}const g=Kn({fill:n.props.isClosed?n.props.fill:"none",d:h,color:n.props.color,theme:i});if(g){const m=document.createElementNS("http://www.w3.org/2000/svg","g");return m.appendChild(g),m.appendChild(p),m}return p}getCanvasSvgDefs(){return[fb()]}expandSelectionOutlinePx(n){const r=n.props.dash==="draw"?1.6:1;return Zt[n.props.size]*r/2}}v(lf,"type","draw"),v(lf,"props",qD),v(lf,"migrations",ZD);function xb(e,t){const n=(t+1)*.5;return`M ${e.x} ${e.y} m -${n}, 0 a ${n},${n} 0 1,0 ${n*2},0 a ${n},${n} 0 1,0 -${n*2},0`}function Sb(e){return e.props.segments.length===1&&e.props.segments[0].points.length<2}function fY(e,t,n={}){const{newPoint:r,handle:i,scaleX:o,scaleY:s}=t,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:u=1/0}=n;let d=e.props.w*o,h=e.props.h*s;const p=new E(0,0);if(d>0){if(d<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=d-a;break}case"top":case"bottom":{p.x=(d-a)/2;break}default:p.x=0}d=a}}else if(p.x=d,d=-d,d<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=-d;break}default:p.x=-a}d=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=h-c;break}case"right":case"left":{p.y=(h-c)/2;break}default:p.y=0}h=c}}else if(p.y=h,h=-h,h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=-h;break}default:p.y=-c}h=c}const{x:g,y:f}=p.rot(e.rotation).add(r);return{x:g,y:f,props:{w:Math.min(l,d),h:Math.min(u,h)}}}const gY=e=>Object.entries(e).filter(([t,n])=>n).map(([t])=>t).join(" ");class cf extends Wa{constructor(){super(...arguments);v(this,"hideSelectionBoundsFg",n=>!this.canResize(n));v(this,"canEdit",()=>!0);v(this,"canUnmount",n=>{var r,i;return!!((i=(r=Vi(n.props.url))==null?void 0:r.definition)!=null&&i.canUnmount)});v(this,"canResize",n=>{var r,i;return!!((i=(r=Vi(n.props.url))==null?void 0:r.definition)!=null&&i.doesResize)});v(this,"canEditInReadOnly",()=>!0);v(this,"isAspectRatioLocked",n=>{var r;return((r=Vi(n.props.url))==null?void 0:r.definition.isAspectRatioLocked)??!1});v(this,"onResize",(n,r)=>{const i=this.isAspectRatioLocked(n),o=Vi(n.props.url);let s=(o==null?void 0:o.definition.minWidth)??200,a=(o==null?void 0:o.definition.minHeight)??200;if(i){const l=n.props.w/n.props.h;l>1?s*=l:a/=l}return fY(n,r,{minWidth:s,minHeight:a})})}getDefaultProps(){return{w:300,h:300,url:""}}component(n){const{w:r,h:i,url:o}=n.props,s=_p(n.id),a=x.useMemo(()=>gI(o),[o]),l=Y("is hovering",()=>{const{editingShapeId:h,hoveredShapeId:p}=this.editor.getCurrentPageState();if(h&&p!==h){const g=this.editor.getShape(h);if(g&&this.editor.isShapeOfType(g,"embed"))return!0}return!1},[]),c=this.editor.getShapePageTransform(n).rotation(),u=s||l;if((a==null?void 0:a.definition.type)==="github_gist"){const h=a.url.split("/").pop();if(!h)throw Error("No gist id!");return y.jsx(As,{className:"tl-embed-container",id:n.id,children:y.jsx(mY,{id:h,width:O(r),height:O(i),isInteractive:u,pageRotation:c})})}const d=gY({...QD,...(a==null?void 0:a.definition.overridePermissions)??{}});return y.jsx(As,{className:"tl-embed-container",id:n.id,children:a!=null&&a.definition?y.jsx("iframe",{className:"tl-embed",sandbox:d,src:a.embedUrl,width:O(r),height:O(i),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:u?"auto":"none",zIndex:u?"":"-1",boxShadow:vb(c),borderRadius:(a==null?void 0:a.definition.overrideOutlineRadius)??8,background:a==null?void 0:a.definition.backgroundColor}}):null})}indicator(n){const r=x.useMemo(()=>Vi(n.props.url),[n.props.url]);return y.jsx("rect",{width:O(n.props.w),height:O(n.props.h),rx:(r==null?void 0:r.definition.overrideOutlineRadius)??8,ry:(r==null?void 0:r.definition.overrideOutlineRadius)??8})}}v(cf,"type","embed"),v(cf,"props",JD),v(cf,"migrations",ez);function mY({id:e,file:t,isInteractive:n,width:r,height:i,style:o,pageRotation:s}){return y.jsx("iframe",{className:"tl-embed",draggable:!1,width:O(r),height:O(i),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...o,pointerEvents:n?"all":"none",zIndex:n?"":"-1",boxShadow:vb(s)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${e}.js${t?`?file=${t}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}const yY=x.forwardRef(({id:e,name:t,isEditing:n},r)=>{const i=H(),o=x.useCallback(l=>{l.key==="Enter"&&!l.nativeEvent.isComposing&&(St(l),l.currentTarget.blur(),i.setEditingShape(null))},[i]),s=x.useCallback(l=>{const c=i.getShape(e);if(!c)return;const u=c.props.name,d=l.currentTarget.value.trim();u!==d&&i.updateShapes([{id:e,type:"frame",props:{name:d}}],{squashing:!0})},[e,i]),a=x.useCallback(l=>{const c=i.getShape(e);if(!c)return;const u=c.props.name,d=l.currentTarget.value;u!==d&&i.updateShapes([{id:e,type:"frame",props:{name:d}}],{squashing:!0})},[e,i]);return y.jsxs("div",{className:`tl-frame-label ${n?"tl-frame-label__editing":""}`,children:[y.jsx("input",{className:"tl-frame-name-input",ref:r,style:{display:n?void 0:"none"},value:t,autoFocus:!0,onKeyDown:o,onBlur:s,onChange:a}),AI(t,"Frame")+String.fromCharCode(8203)]})}),vY=function({id:e,name:t,width:n,height:r}){const i=H(),o=Y("shape rotation",()=>Ar(i.getShapePageTransform(e).rotation()),[i,e]),s=_p(e),a=x.useRef(null),l=x.useCallback(h=>{const p=En(h);i.getEditingShapeId()!==e&&(i.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:i.getShape(e),...p}),h.preventDefault())},[i,e]);x.useEffect(()=>{const h=a.current;h&&s&&(h.focus(),h.select(),requestAnimationFrame(()=>{document.activeElement!==h&&(h.focus(),h.select())}))},[a,s]);const c=((o+Math.PI/4)*(2/Math.PI)+4)%4,u=["top","left","bottom","right"][Math.floor(c)];let d;switch(u){case"top":d="";break;case"right":d=`translate(${O(n)}px, 0px) rotate(90deg)`;break;case"bottom":d=`translate(${O(n)}px, ${O(r)}px) rotate(180deg)`;break;case"left":d=`translate(0px, ${O(r)}px) rotate(270deg)`;break}return y.jsx("div",{className:"tl-frame-heading",style:{overflow:s?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(u==="top"||u==="bottom"?n:r)}px + var(--space-5))`,bottom:"100%",transform:`${d} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:l,children:y.jsx("div",{className:"tl-frame-heading-hit-area",children:y.jsx(yY,{ref:a,id:e,name:t,isEditing:s})})})};function AI(e,t){return e.match(/^\s*$/)?t:e}class uf extends Wa{constructor(){super(...arguments);v(this,"canBind",()=>!0);v(this,"canEdit",()=>!0);v(this,"canReceiveNewChildrenOfType",(n,r)=>!n.isLocked);v(this,"canDropShapes",(n,r)=>!n.isLocked);v(this,"onDragShapesOver",(n,r)=>r.every(i=>i.parentId===n.id)?{shouldHint:!1}:(this.editor.reparentShapes(r.map(i=>i.id),n.id),{shouldHint:!0}));v(this,"onDragShapesOut",(n,r)=>{const i=this.editor.getShape(n.parentId);i&&this.editor.isShapeOfType(i,"group")?this.editor.reparentShapes(r,i.id):this.editor.reparentShapes(r,this.editor.getCurrentPageId())});v(this,"onResizeEnd",n=>{const r=this.editor.getShapePageBounds(n),i=this.editor.getSortedChildIdsForParent(n.id),o=[];for(const s of i){const a=this.editor.getShapePageBounds(s);r.includes(a)||o.push(s)}o.length>0&&this.editor.reparentShapes(o,this.editor.getCurrentPageId())});v(this,"onResize",(n,r)=>pE(n,r))}getDefaultProps(){return{w:160*2,h:90*2,name:""}}getGeometry(n){return new Ao({width:n.props.w,height:n.props.h,isFilled:!1})}component(n){const r=this.editor.getShapeGeometry(n).bounds,i=Et(),o=Y("is creating this shape",()=>{var l;const s=this.editor.getStateDescendant("select.resizing");if(!s||!s.getIsActive())return!1;const a=s==null?void 0:s.info;return a?a.isCreating&&((l=this.editor.getOnlySelectedShape())==null?void 0:l.id)===n.id:!1},[n.id]);return y.jsxs(y.Fragment,{children:[y.jsx(Bn,{children:y.jsx("rect",{className:pe("tl-frame__body",{"tl-frame__creating":o}),width:r.width,height:r.height,fill:i.solid,stroke:i.text})}),o?null:y.jsx(vY,{id:n.id,name:n.props.name,width:r.width,height:r.height})]})}toSvg(n){const r=Cn({isDarkMode:this.editor.user.getIsDarkMode()}),i=document.createElementNS("http://www.w3.org/2000/svg","g"),o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("width",n.props.w.toString()),o.setAttribute("height",n.props.h.toString()),o.setAttribute("fill",r.solid),o.setAttribute("stroke",r.black.solid),o.setAttribute("stroke-width","1"),o.setAttribute("rx","1"),o.setAttribute("ry","1"),i.appendChild(o);const s=((Ar(this.editor.getShapePageTransform(n.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4,a=["top","left","bottom","right"][Math.floor(s)];let l;switch(a){case"top":l="";break;case"right":l=`translate(${O(n.props.w)}px, 0px) rotate(90deg)`;break;case"bottom":l=`translate(${O(n.props.w)}px, ${O(n.props.h)}px) rotate(180deg)`;break;case"left":l=`translate(0px, ${O(n.props.h)}px) rotate(270deg)`;break;default:l=""}const c={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:n.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},u=this.editor.textMeasure.measureTextSpans(AI(n.props.name,"Frame")+String.fromCharCode(8203),c),d=u[0],h=xn(u),p=h.box.w+h.box.x-d.box.x,g=tf(this.editor,u,{offsetY:-c.height-2,...c});g.style.setProperty("transform",l);const f=document.createElementNS("http://www.w3.org/2000/svg","rect");return f.setAttribute("x","-8px"),f.setAttribute("y",-c.height-4+"px"),f.setAttribute("width",p+16+"px"),f.setAttribute("height",`${c.height}px`),f.setAttribute("rx","4px"),f.setAttribute("ry","4px"),f.setAttribute("fill",r.background),i.appendChild(f),i.appendChild(g),i}indicator(n){const r=this.editor.getShapeGeometry(n).bounds;return y.jsx("rect",{width:O(r.width),height:O(r.height),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}}v(uf,"type","frame"),v(uf,"props",tz),v(uf,"migrations",nz);function bY(e,t,n,r){if((e==="start-legacy"||e==="end-legacy")&&n.length!==0){const i=se.From(n[0].box);for(const{box:o}of n)i.union(o);if(e==="start-legacy")return(r-2*t-i.width)/2;if(e==="end-legacy")return-(r-2*t-i.width)/2}}function wY(e){return e==="start-legacy"||e==="middle-legacy"||e==="end-legacy"}const TI=J.memo(function({id:e,type:t,text:n,size:r,labelColor:i,font:o,align:s,verticalAlign:a,wrap:l,bounds:c}){const{rInput:u,isEmpty:d,isEditing:h,handleFocus:p,handleChange:g,handleKeyDown:f,handleBlur:m,handleInputPointerDown:w,handleDoubleClick:b}=yb(e,t,n),k=Fo.normalizeTextForDom(n),S=k.length>0,C=wY(s),_=Et();return!h&&!S?null:y.jsx("div",{className:"tl-text-label","data-font":o,"data-align":s,"data-hastext":!d,"data-isediting":h,"data-textwrap":!!l,style:{justifyContent:s==="middle"||C?"center":s,alignItems:a==="middle"?"center":a,...c?{top:c.minY,left:c.minX,width:c.width,height:c.height,position:"absolute"}:{}},children:y.jsxs("div",{className:"tl-text-label__inner",style:{fontSize:rl[r],lineHeight:rl[r]*Dt.lineHeight+"px",minHeight:Dt.lineHeight+32,minWidth:0,color:_[i].solid},children:[y.jsx("div",{className:"tl-text tl-text-content",dir:"ltr",children:k}),h&&y.jsx("textarea",{ref:u,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:n,onFocus:p,onChange:g,onKeyDown:f,onBlur:m,onContextMenu:St,onPointerDown:w,onDoubleClick:b})]})})});function jI({bounds:e,editor:t,font:n,shape:r}){const i={fontSize:rl[r.props.size],fontFamily:n,textAlign:r.props.align,verticalTextAlign:r.props.verticalAlign,width:Math.ceil(e.width),height:Math.ceil(e.height),padding:16,lineHeight:Dt.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0},o=t.textMeasure.measureTextSpans(r.props.text,i),s=bY(r.props.align,16,o,e.width);return s&&(i.offsetX=s),tf(t,o,i)}function Jt(e){return`${O(e.x)},${O(e.y)} `}function OI(e=""){let t=0,n=0,r=0,i=0;function o(){const s=t^t<<11;return t=n,n=r,r=i,i^=(i>>>19^s^s>>>8)>>>0,i/4294967296*2}for(let s=0;s<e.length+64;s++)t^=e.charCodeAt(s)|0,o();return o}function yu(e){let t="M";const n=e.length;let r,i,o;for(let s=0,a=n;s<a;s+=3)r=e[s],i=e[s+1],o=e[s+2],t+=`${Jt(r)}L${Jt(i)}Q${Jt(o)}`;return t+=`${Jt(e[0])}`,t}function vu(e,t,n,r,i){const o=[],s=OI(e);let a=t[0],l;const c=t.length;for(let u=0,d=c*i;u<d;u++){l=E.AddXY(t[(u+1)%c],s()*n,s()*n);const h=E.Sub(l,a),p=E.Len(h),g=E.Div(h,p).mul(Math.min(p/4,r));o.push(E.Add(a,g),E.Add(l,g.neg()),l),a=l}return o}function kb(e,t,n){let r=`M ${Jt(t[0])}L`,i=`M ${Jt(t[0])}L`;const o=n/3,s=n*2,a=OI(e);let l=t[0],c,u=t[0],d;const h=t.length;for(let p=0,g=h-1;p<g;p++){c=t[p+1],d=E.AddXY(t[p+1],a()*o,a()*o);const f=E.Sub(c,l),m=E.Len(f),w=E.Div(f,m).mul(Math.min(m/4,s)),b=E.Add(l,w),k=E.Add(c,w.neg()),S=E.Sub(d,u),C=E.Len(S),_=E.Div(S,C).mul(Math.min(C/4,s)),P=E.Add(u,_),I=E.Add(d,_.neg());p===g-1?(r+=`${Jt(b)}L ${Jt(c)}`,i+=`${Jt(P)}L ${Jt(d)}`):(r+=`${Jt(b)}L ${Jt(k)}Q ${Jt(c)}`,i+=`${Jt(P)}L ${Jt(I)}Q ${Jt(d)}`,l=c,u=d)}return[r,r+i]}function LI(e,t){const n=Math.min(e,t)/2,r=Math.max(e,t)-n*2;return Math.PI*(n*2)+2*r}function xY(e,t,n){const r=Math.min(e,t)/2,i=Math.max(e,t)-r*2,o=(Math.PI*(r*2)+2*i)/n,s=e>t?[{type:"straight",start:new E(r,0),delta:new E(1,0)},{type:"arc",center:new E(e-r,r),startAngle:-Te/2},{type:"straight",start:new E(e-r,t),delta:new E(-1,0)},{type:"arc",center:new E(r,r),startAngle:Te/2}]:[{type:"straight",start:new E(e,r),delta:new E(0,1)},{type:"arc",center:new E(r,t-r),startAngle:0},{type:"straight",start:new E(0,t-r),delta:new E(0,-1)},{type:"arc",center:new E(r,r),startAngle:Te}];let a=0;const l=[];for(let c=0;c<n;c++){const u=s[0];u.type==="straight"?l.push(E.Add(u.start,E.Mul(u.delta,a))):l.push(I2(u.center.x,u.center.y,r,u.startAngle+a/r)),a+=o;let d=u.type==="straight"?i:Te*r;for(;a>d;)a-=d,s.push(s.shift()),d=s[0].type==="straight"?i:Te*r}return l}const SY=(e,t,n,r,i)=>{switch(e){case"s":return t;case"m":return n;case"l":return r;case"xl":return i}};function bu(e,t,n,r){const i=Eo(n),o=LI(e,t),s=Math.max(Math.ceil(o/SY(r,50,70,100,130)),6,Math.ceil(o/Math.min(e,t))),a=o/s*.2,l=Math.max(e-a*2,1),c=Math.max(t-a*2,1),u=(e-l)/2,d=(t-c)/2,h=LI(l,c)/s,p=xY(l,c,s).map(b=>b.addXY(u,d)),g=e<20?0:a*.3,f=t<20?0:a*.3,m=p.slice(0);for(let b=0;b<Math.floor(s/2);b++)m[b]=E.AddXY(m[b],i()*g,i()*f),m[s-b-1]=E.AddXY(m[s-b-1],i()*g,i()*f);const w=[];for(let b=0;b<m.length;b++){const k=b===m.length-1?0:b+1,S=m[b],C=m[k],_=p[b],P=p[k],I=E.Average([_,P]),M=E.Angle(_,P)-Math.PI/2,A=E.Dist(_,P),L=h-A,z=E.Dist(S,C)/A,$=(Math.max(u,d)+L)*z,j=E.Add(I,E.FromAngle(M,$));j.x<0?j.x=0:j.x>e&&(j.x=e),j.y<0?j.y=0:j.y>t&&(j.y=t);const F=DI(S,C,j),R=E.Dist(F||E.Average([S,C]),S);w.push({leftPoint:S,rightPoint:C,arcPoint:j,center:F,radius:R})}return w}function DI(e,t,n){const r=e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y,i=(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y),o=(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x),s=-i/(2*r),a=-o/(2*r);return!Number.isFinite(s)||!Number.isFinite(a)?null:new E(s,a)}function kY(e,t,n,r){const i=[],o=bu(e,t,n,r);for(const{center:s,radius:a,leftPoint:l,rightPoint:c}of o)i.push(..._Y(l,c,s,a,10));return i}function wu(e,t,n,r){const i=bu(e,t,n,r);let o=`M${O(i[0].leftPoint.x)},${O(i[0].leftPoint.y)}`;for(const{leftPoint:s,rightPoint:a,radius:l,center:c}of i){if(c===null){o+=` L${O(a.x)},${O(a.y)}`;continue}const u=NI(s,a,c)?"0":"1";o+=` A${O(l)},${O(l)} 0 ${u},1 ${O(a.x)},${O(a.y)}`}return o+=" Z",o}function zI(e,t,n,r){const i=Eo(n),o=r==="s"?.5:r==="m"?.7:r==="l"?.9:1.6,s=h=>h+i()*o*2,a=bu(e,t,n,r),l=a.reduce((h,p)=>h+E.Dist(p.leftPoint,p.rightPoint),0)/a.length>o*15?h=>new E(s(h.x),s(h.y)):h=>h;let c=`M${O(a[0].leftPoint.x)},${O(a[0].leftPoint.y)}`,u=l(a[0].leftPoint),d=`M${O(u.x)},${O(u.y)}`;for(const{leftPoint:h,center:p,rightPoint:g,radius:f,arcPoint:m}of a){if(p===null){c+=` L${O(g.x)},${O(g.y)}`;const _=l(g);d+=` L${O(_.x)},${O(_.y)}`,u=_;continue}const w=NI(h,g,p)?"0":"1";c+=` A${O(f)},${O(f)} 0 ${w},1 ${O(g.x)},${O(g.y)}`;const b=l(g),k=l(m),S=DI(u,b,k);if(!S){d+=` L${O(b.x)},${O(b.y)}`,u=b;continue}const C=Math.abs(E.Dist(S,u));d+=` A${O(C)},${O(C)} 0 ${w},1 ${O(b.x)},${O(b.y)}`,u=b}return c+d+" Z"}function _Y(e,t,n,r,i){if(n===null)return[E.From(e),E.From(t)];const o=[],s=E.Angle(n,e),a=E.Angle(n,t),l=Xh(s,a);for(let c=0;c<i;c++){const u=c/(i-1),d=s+l*u,h=I2(n.x,n.y,r,d);o.push(h)}return o}function NI(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)>0}const CY=x.memo(function({dash:e,fill:t,color:n,strokeWidth:r,w:i,h:o,id:s,size:a}){const l=Et(),c=wu(i,o,s,a),u=bu(i,o,s,a);return y.jsxs(y.Fragment,{children:[y.jsx(pt,{theme:l,d:c,fill:t,color:n}),y.jsx("g",{strokeWidth:r,stroke:l[n].solid,fill:"none",pointerEvents:"all",children:u.map(({leftPoint:d,rightPoint:h,center:p,radius:g},f)=>{const m=p?g*Ar(Ar(E.Angle(p,h))-Ar(E.Angle(p,d))):E.Dist(d,h),{strokeDasharray:w,strokeDashoffset:b}=Qt(m,r,{style:e,start:"outset",end:"outset"});return y.jsx("path",{d:p?`M${d.x},${d.y}A${g},${g},0,0,1,${h.x},${h.y}`:`M${d.x},${d.y}L${h.x},${h.y}`,strokeDasharray:w,strokeDashoffset:b},f)})})]})});function EY({dash:e,fill:t,color:n,theme:r,strokeWidth:i,w:o,h:s,id:a,size:l}){const c=wu(o,s,a,l),u=bu(o,s,a,l),d=document.createElementNS("http://www.w3.org/2000/svg","g");d.setAttribute("stroke-width",i.toString()),d.setAttribute("stroke",r[n].solid),d.setAttribute("fill","none");for(const{leftPoint:p,rightPoint:g,center:f,radius:m}of u){const w=f?m*Ar(Ar(E.Angle(f,g))-Ar(E.Angle(f,p))):E.Dist(p,g),{strokeDasharray:b,strokeDashoffset:k}=Qt(w,i,{style:e,start:"outset",end:"outset"}),S=document.createElementNS("http://www.w3.org/2000/svg","path");S.setAttribute("d",f?`M${p.x},${p.y}A${m},${m},0,0,1,${g.x},${g.y}`:`M${p.x},${p.y}L${g.x},${g.y}`),S.setAttribute("stroke-dasharray",b.toString()),S.setAttribute("stroke-dashoffset",k.toString()),d.appendChild(S)}const h=Kn({d:c,fill:t,color:n,theme:r});return Nr(d,h)}const PY=x.memo(function({w:e,h:t,strokeWidth:n,dash:r,color:i,fill:o}){const s=Et(),a=e/2,l=t/2,c=Math.max(0,a),u=Math.max(0,l),d=Fc(c,u),{strokeDasharray:h,strokeDashoffset:p}=Qt(d<64?d*2:d,n,{style:r,snap:4,closed:!0}),g=`M${a-c},${l}a${c},${u},0,1,1,${c*2},0a${c},${u},0,1,1,-${c*2},0`;return y.jsxs(y.Fragment,{children:[y.jsx(pt,{theme:s,d:g,color:i,fill:o}),y.jsx("path",{d:g,strokeWidth:n,width:O(e),height:O(t),fill:"none",stroke:s[i].solid,strokeDasharray:h,strokeDashoffset:p,pointerEvents:"all"})]})});function IY({w:e,h:t,strokeWidth:n,dash:r,color:i,theme:o,fill:s}){const a=e/2,l=t/2,c=Math.max(0,a-n/2),u=Math.max(0,l-n/2),d=Fc(c,u),{strokeDasharray:h,strokeDashoffset:p}=Qt(d<64?d*2:d,n,{style:r,snap:4,closed:!0}),g=`M${a-c},${l}a${c},${u},0,1,1,${c*2},0a${c},${u},0,1,1,-${c*2},0`,f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("d",g),f.setAttribute("stroke-width",n.toString()),f.setAttribute("width",e.toString()),f.setAttribute("height",t.toString()),f.setAttribute("fill","none"),f.setAttribute("stroke",o[i].solid),f.setAttribute("stroke-dasharray",h),f.setAttribute("stroke-dashoffset",p);const m=Kn({d:g,fill:s,color:i,theme:o});return Nr(f,m)}function RI(e,t){if(t>e){const r=e/2;return`
    M0,${r}
    a${r},${r},0,1,1,${r*2},0
    L${e},${t-r}
    a${r},${r},0,1,1,-${r*2},0
    Z`}const n=t/2;return`
    M${n},0
    L${e-n},0
    a${n},${n},0,1,1,0,${n*2}
    L${n},${t}
    a${n},${n},0,1,1,0,${-n*2}
    Z`}function FI(e,t){if(e>t){const r=t/2;return Fc(r,r)+(e-r*2)*2}const n=e/2;return Fc(n,n)+(t-n*2)*2}const MY=x.memo(function({w:e,h:t,strokeWidth:n,dash:r,color:i,fill:o}){const s=Et(),a=RI(e,t),l=FI(e,t),{strokeDasharray:c,strokeDashoffset:u}=Qt(l<64?l*2:l,n,{style:r,snap:4,start:"outset",end:"outset",closed:!0});return y.jsxs(y.Fragment,{children:[y.jsx(pt,{theme:s,d:a,color:i,fill:o}),y.jsx("path",{d:a,strokeWidth:n,width:O(e),height:O(t),fill:"none",stroke:s[i].solid,strokeDasharray:c,strokeDashoffset:u,pointerEvents:"all"})]})});function $I({w:e,h:t,strokeWidth:n,dash:r,color:i,theme:o,fill:s}){const a=RI(e,t),l=FI(e,t),{strokeDasharray:c,strokeDashoffset:u}=Qt(l<64?l*2:l,n,{style:r,snap:4,closed:!0}),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",a),d.setAttribute("stroke-width",n.toString()),d.setAttribute("width",e.toString()),d.setAttribute("height",t.toString()),d.setAttribute("fill","none"),d.setAttribute("stroke",o[i].solid),d.setAttribute("stroke-dasharray",c),d.setAttribute("stroke-dashoffset",u);const h=Kn({d:a,fill:s,color:i,theme:o});return Nr(d,h)}const AY=x.memo(function({dash:e,fill:t,color:n,strokeWidth:r,outline:i,lines:o}){const s=Et(),a="M"+i[0]+"L"+i.slice(1)+"Z";return y.jsxs(y.Fragment,{children:[y.jsx(pt,{theme:s,d:a,fill:t,color:n}),y.jsxs("g",{strokeWidth:r,stroke:s[n].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(i.length)).map((l,c)=>{const u=i[c],d=i[(c+1)%i.length],h=E.Dist(u,d),{strokeDasharray:p,strokeDashoffset:g}=Qt(h,r,{style:e,start:"outset",end:"outset"});return y.jsx("line",{x1:u.x,y1:u.y,x2:d.x,y2:d.y,strokeDasharray:p,strokeDashoffset:g},c)}),o&&o.map(([l,c],u)=>{const d=E.Dist(l,c),{strokeDasharray:h,strokeDashoffset:p}=Qt(d,r,{style:e,start:"skip",end:"outset",snap:e==="dotted"?4:void 0});return y.jsx("path",{d:`M${l.x},${l.y}L${c.x},${c.y}`,stroke:s[n].solid,strokeWidth:r,fill:"none",strokeDasharray:h,strokeDashoffset:p},`line_fg_${u}`)})]})]})});function TY({dash:e,fill:t,color:n,theme:r,strokeWidth:i,outline:o,lines:s}){const a=document.createElementNS("http://www.w3.org/2000/svg","g");if(a.setAttribute("stroke-width",i.toString()),a.setAttribute("stroke",r[n].solid),a.setAttribute("fill","none"),Array.from(Array(o.length)).forEach((c,u)=>{const d=o[u],h=o[(u+1)%o.length],p=E.Dist(d,h),{strokeDasharray:g,strokeDashoffset:f}=Qt(p,i,{style:e}),m=document.createElementNS("http://www.w3.org/2000/svg","line");m.setAttribute("x1",d.x.toString()),m.setAttribute("y1",d.y.toString()),m.setAttribute("x2",h.x.toString()),m.setAttribute("y2",h.y.toString()),m.setAttribute("stroke-dasharray",g.toString()),m.setAttribute("stroke-dashoffset",f.toString()),a.appendChild(m)}),s)for(const[c,u]of s){const d=E.Dist(c,u),{strokeDasharray:h,strokeDashoffset:p}=Qt(d,i,{style:e,start:"skip",end:"skip",snap:e==="dotted"?4:2}),g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",c.x.toString()),g.setAttribute("y1",c.y.toString()),g.setAttribute("x2",u.x.toString()),g.setAttribute("y2",u.y.toString()),g.setAttribute("stroke-dasharray",h.toString()),g.setAttribute("stroke-dashoffset",p.toString()),a.appendChild(g)}const l=Kn({d:"M"+o[0]+"L"+o.slice(1)+"Z",fill:t,color:n,theme:r});return Nr(a,l)}const jY=x.memo(function({fill:e,color:t,strokeWidth:n,w:r,h:i,id:o,size:s}){const a=Et(),l=zI(r,i,o,s);return y.jsxs(y.Fragment,{children:[y.jsx(pt,{theme:a,d:l,fill:e,color:t}),y.jsx("path",{d:l,stroke:a[t].solid,strokeWidth:n,fill:"none"})]})});function OY({fill:e,color:t,strokeWidth:n,theme:r,w:i,h:o,id:s,size:a}){const l=zI(i,o,s,a),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("stroke-width",n.toString()),c.setAttribute("stroke",r[t].solid),c.setAttribute("fill","none");const u=Kn({d:l,fill:e,color:t,theme:r});return Nr(c,u)}x.memo(function({id:e,w:t,h:n,strokeWidth:r,fill:i,color:o}){const s=Et(),a=_b(e,t,n,r),l=VI(e,t,n,r);return y.jsxs(y.Fragment,{children:[y.jsx(pt,{theme:s,d:a,color:o,fill:i}),y.jsx("path",{d:l,fill:s[o].solid,strokeWidth:0,pointerEvents:"all"})]})});function LY({id:e,w:t,h:n,strokeWidth:r,fill:i,color:o,theme:s}){const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",VI(e,t,n,r)),a.setAttribute("fill",s[o].solid);const l=Kn({d:_b(e,t,n,r),fill:i,color:o,theme:s});return Nr(a,l)}function BI(e){return{size:1+e,thinning:.25,end:{taper:e},start:{taper:e},streamline:0,smoothing:1,simulatePressure:!1}}function UI(e,t,n,r){const i=Eo(e),o=t/2,s=n/2,a=Fc(o,s),l=[],c=De*i(),u=De+Ke/2+Math.abs(i())*Ke,d=Math.max(16,a/10);for(let h=0;h<d;h++){const p=h/(d-1),g=c+p*u,f=Math.cos(g),m=Math.sin(g);l.push(new E(o*f+t*.5+.05*i(),s*m+n/2+.05*i(),Math.min(1,.5+Math.abs(.5-(i()>0?Xt.easeInOutSine(p):Xt.easeInExpo(p)))/2)))}return zr(l,BI(r))}function VI(e,t,n,r){const i=BI(r);return Hc(uu(nl(UI(e,t,n,r),i),i))}function _b(e,t,n,r){return $o(UI(e,t,n,r))}const DY=x.memo(function({id:e,outline:t,lines:n,fill:r,color:i,strokeWidth:o}){const s=Et(),a=vu(e,t,o/3,o*2,2);let l=yu(a);if(n)for(const[d,h]of n)l+=`M${d.x},${d.y}L${h.x},${h.y}`;const c=vu(e,t,0,o*2,1),u=yu(c);return y.jsxs(y.Fragment,{children:[y.jsx(pt,{d:u,fill:r,color:i,theme:s}),y.jsx("path",{d:l,stroke:s[i].solid,strokeWidth:o,fill:"none"})]})});function zY({id:e,outline:t,lines:n,fill:r,color:i,theme:o,strokeWidth:s}){const a=vu(e,t,s/3,s*2,2);let l=yu(a);if(n)for(const[p,g]of n)l+=`M${p.x},${p.y}L${g.x},${g.y}`;const c=vu(e,t,0,s*2,1),u=yu(c),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",l),d.setAttribute("fill","none"),d.setAttribute("stroke",o[i].solid),d.setAttribute("stroke-width",s.toString());const h=Kn({d:u,fill:r,color:i,theme:o});return Nr(d,h)}const NY=x.memo(function({fill:e,color:t,strokeWidth:n,w:r,h:i,id:o,size:s}){const a=Et(),l=wu(r,i,o,s);return y.jsxs(y.Fragment,{children:[y.jsx(pt,{theme:a,d:l,fill:e,color:t}),y.jsx("path",{d:l,stroke:a[t].solid,strokeWidth:n,fill:"none"})]})});function RY({fill:e,color:t,strokeWidth:n,theme:r,w:i,h:o,id:s,size:a}){const l=wu(i,o,s,a),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("stroke-width",n.toString()),c.setAttribute("stroke",r[t].solid),c.setAttribute("fill","none");const u=Kn({d:l,fill:e,color:t,theme:r});return Nr(c,u)}const HI=x.memo(function({w:e,h:t,strokeWidth:n,fill:r,color:i}){const o=Et(),s=e/2,a=t/2,l=Math.max(0,s),c=Math.max(0,a),u=`M${s-l},${a}a${l},${c},0,1,1,${l*2},0a${l},${c},0,1,1,-${l*2},0`;return y.jsxs(y.Fragment,{children:[y.jsx(pt,{d:u,color:i,fill:r,theme:o}),y.jsx("path",{d:u,stroke:o[i].solid,strokeWidth:n,fill:"none"})]})});function FY({w:e,h:t,strokeWidth:n,fill:r,color:i,theme:o}){const s=e/2,a=t/2,l=Math.max(0,s),c=Math.max(0,a),u=`M${s-l},${a}a${l},${c},0,1,1,${l*2},0a${l},${c},0,1,1,-${l*2},0`,d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",u),d.setAttribute("stroke-width",n.toString()),d.setAttribute("width",e.toString()),d.setAttribute("height",t.toString()),d.setAttribute("fill","none"),d.setAttribute("stroke",o[i].solid);const h=Kn({d:u,fill:r,color:i,theme:o});return Nr(d,h)}const KI=x.memo(function({w:e,h:t,strokeWidth:n,fill:r,color:i}){const o=Et(),s=Cb(e,t);return y.jsxs(y.Fragment,{children:[y.jsx(pt,{d:s,color:i,fill:r,theme:o}),y.jsx("path",{d:s,stroke:o[i].solid,strokeWidth:n,fill:"none"})]})});function $Y({w:e,h:t,strokeWidth:n,fill:r,color:i,theme:o}){const s=Cb(e,t),a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",s),a.setAttribute("stroke-width",n.toString()),a.setAttribute("width",e.toString()),a.setAttribute("height",t.toString()),a.setAttribute("fill","none"),a.setAttribute("stroke",o[i].solid);const l=Kn({d:s,fill:r,color:i,theme:o});return Nr(a,l)}function Cb(e,t){let n;if(t>e){const r=e/2;n=`
    M0,${r}
    a${r},${r},0,1,1,${r*2},0
    L${e},${t-r}
    a${r},${r},0,1,1,-${r*2},0
    Z`}else{const r=t/2;n=`
    M${r},0
    L${e-r},0
    a${r},${r},0,1,1,0,${r*2}
    L${r},${t}
    a${r},${r},0,1,1,0,${-r*2}
    Z`}return n}const BY=x.memo(function({outline:e,lines:t,fill:n,color:r,strokeWidth:i}){const o=Et();let s="M"+e[0]+"L"+e.slice(1)+"Z";if(t)for(const[a,l]of t)s+=`M${a.x},${a.y}L${l.x},${l.y}`;return y.jsxs(y.Fragment,{children:[y.jsx(pt,{d:s,fill:n,color:r,theme:o}),y.jsx("path",{d:s,stroke:o[r].solid,strokeWidth:i,fill:"none"})]})});function UY({outline:e,lines:t,fill:n,color:r,strokeWidth:i,theme:o}){const s="M"+e[0]+"L"+e.slice(1)+"Z",a=s;let l=s;if(t)for(const[d,h]of t)l+=`M${d.x},${d.y}L${h.x},${h.y}`;const c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("stroke-width",i.toString()),c.setAttribute("stroke",o[r].solid),c.setAttribute("fill","none");const u=Kn({d:a,fill:n,color:r,theme:o});return Nr(c,u)}const Eb=16,hr=17*3;class df extends Wa{constructor(){super(...arguments);v(this,"canEdit",()=>!0);v(this,"onEditEnd",n=>{const{id:r,type:i,props:{text:o}}=n;o.trimEnd()!==n.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])});v(this,"onResize",(n,{handle:r,newPoint:i,scaleX:o,scaleY:s,initialShape:a})=>{let l=a.props.w*o,c=(a.props.h+a.props.growY)*s,u=0,d=0;if(n.props.text.trim()){let f=Math.max(Math.abs(l),hr),m=Math.max(Math.abs(c),hr);f<hr&&m===hr&&(f=hr),f===hr&&m<hr&&(m=hr);const w=hf(this.editor,{...n,props:{...n.props,w:f,h:m}}),b=Math.max(Math.abs(l),w.w)*Math.sign(l),k=Math.max(Math.abs(c),w.h)*Math.sign(c);u=Math.abs(b)-Math.abs(l),d=Math.abs(k)-Math.abs(c),l=b,c=k}const h=new E(0,0);o<0&&(h.x+=l),(r==="left"||r==="top_left"||r==="bottom_left")&&(h.x+=o<0?u:-u),s<0&&(h.y+=c),(r==="top"||r==="top_left"||r==="top_right")&&(h.y+=s<0?d:-d);const{x:p,y:g}=h.rot(n.rotation).add(i);return{x:p,y:g,props:{w:Math.max(Math.abs(l),1),h:Math.max(Math.abs(c),1),growY:0}}});v(this,"onBeforeCreate",n=>{if(!n.props.text)return n.props.growY?{...n,props:{...n.props,growY:0}}:void 0;const r=n.props.h,i=hf(this.editor,n).h;let o=null;if(i>r?o=i-r:n.props.growY&&(o=0),o!==null)return{...n,props:{...n.props,growY:o}}});v(this,"onBeforeUpdate",(n,r)=>{const i=n.props.text,o=r.props.text;if(i===o&&n.props.font===r.props.font&&n.props.size===r.props.size)return;if(i&&!o)return{...r,props:{...r.props,growY:0}};const s=n.props.w,a=n.props.h,l=hf(this.editor,r),c=l.w,u=l.h;if(!i&&o&&o.length===1){let h=Math.max(s,c),p=Math.max(a,u);return n.props.w<hr&&n.props.h<hr&&(h=Math.max(h,hr),p=Math.max(p,hr),h=Math.max(h,p),p=Math.max(h,p)),{...r,props:{...r.props,w:h,h:p,growY:0}}}let d=null;if(u>a?d=u-a:n.props.growY&&(d=0),d!==null)return{...r,props:{...r.props,growY:d,w:Math.max(r.props.w,c)}};if(c>n.props.w)return{...r,props:{...r.props,w:c}}});v(this,"onDoubleClick",n=>{if(this.editor.inputs.altKey)switch(n.props.geo){case"rectangle":return{...n,props:{geo:"check-box"}};case"check-box":return{...n,props:{geo:"rectangle"}}}})}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:""}}getGeometry(n){const r=Math.max(1,n.props.w),i=Math.max(1,n.props.h+n.props.growY),o=r/2,s=i/2,a=Zt[n.props.size],l=n.props.fill!=="none";let c;switch(n.props.geo){case"cloud":{c=new _t({points:kY(r,i,n.id,n.props.size),isFilled:l});break}case"triangle":{c=new _t({points:[new E(o,0),new E(r,i),new E(0,i)],isFilled:l});break}case"diamond":{c=new _t({points:[new E(o,0),new E(r,s),new E(o,i),new E(0,s)],isFilled:l});break}case"pentagon":{c=new _t({points:k0(r,i,5),isFilled:l});break}case"hexagon":{c=new _t({points:k0(r,i,6),isFilled:l});break}case"octagon":{c=new _t({points:k0(r,i,8),isFilled:l});break}case"ellipse":{c=new bE({width:r,height:i,isFilled:l});break}case"oval":{c=new HF({width:r,height:i,isFilled:l});break}case"star":{const f=De/5/2,m=Math.floor(5/4)*2,w=5*2-m,b=0,k=Math.floor(5/2)*2,S=Math.cos(-Ke+m*f)*r/2,C=Math.cos(-Ke+w*f)*r/2,_=Math.sin(-Ke+b*f)*i/2,P=Math.sin(-Ke+k*f)*i/2,I=r-Math.abs(S-C),M=i-Math.abs(P-_),A=r/2+C-(r/2-S),L=i/2+_-(i/2-P),z=1,$=(r-A)/2,j=(i-L)/2,F=(r+I)/2,R=(i+M)/2,W=F*z/2,V=R*z/2;c=new _t({points:Array.from(Array(5*2)).map((D,B)=>{const X=-Ke+B*f;return new E($+(B%2?W:F)*Math.cos(X),j+(B%2?V:R)*Math.sin(X))}),isFilled:l});break}case"rhombus":{const f=Math.min(r*.38,i*.38);c=new _t({points:[new E(f,0),new E(r,0),new E(r-f,i),new E(0,i)],isFilled:l});break}case"rhombus-2":{const f=Math.min(r*.38,i*.38);c=new _t({points:[new E(0,0),new E(r-f,0),new E(r,i),new E(f,i)],isFilled:l});break}case"trapezoid":{const f=Math.min(r*.38,i*.38);c=new _t({points:[new E(f,0),new E(r-f,0),new E(r,i),new E(0,i)],isFilled:l});break}case"arrow-right":{const f=Math.min(r,i)*.38,m=i*.16;c=new _t({points:[new E(0,m),new E(r-f,m),new E(r-f,0),new E(r,i/2),new E(r-f,i),new E(r-f,i-m),new E(0,i-m)],isFilled:l});break}case"arrow-left":{const f=Math.min(r,i)*.38,m=i*.16;c=new _t({points:[new E(f,0),new E(f,m),new E(r,m),new E(r,i-m),new E(f,i-m),new E(f,i),new E(0,i/2)],isFilled:l});break}case"arrow-up":{const f=r*.16,m=Math.min(r,i)*.38;c=new _t({points:[new E(r/2,0),new E(r,m),new E(r-f,m),new E(r-f,i),new E(f,i),new E(f,m),new E(0,m)],isFilled:l});break}case"arrow-down":{const f=r*.16,m=Math.min(r,i)*.38;c=new _t({points:[new E(f,0),new E(r-f,0),new E(r-f,i-m),new E(r,i-m),new E(r/2,i),new E(0,i-m),new E(f,i-m)],isFilled:l});break}case"check-box":case"x-box":case"rectangle":{c=new Ao({width:r,height:i,isFilled:l,isSnappable:!0});break}}const u=hf(this.editor,n),d=Math.min(r,Math.max(u.w,Math.min(32,Math.max(1,r-8)))),h=Math.min(i,Math.max(u.h,Math.min(32,Math.max(1,r-8)))),p=pf(n.props,a),g=p?p.map(f=>new Es({points:f})):[];return new Mo({children:[c,new Ao({x:n.props.align==="start"?0:n.props.align==="end"?r-d:(r-d)/2,y:n.props.verticalAlign==="start"?0:n.props.verticalAlign==="end"?i-h:(i-h)/2,width:d,height:h,isFilled:!0,isSnappable:!1,isLabel:!0}),...g],isSnappable:!1})}component(n){const{id:r,type:i,props:o}=n,s=Zt[o.size],{w:a,color:l,labelColor:c,fill:u,dash:d,growY:h,font:p,align:g,verticalAlign:f,size:m,text:w}=o,b=()=>{const k=o.h+h;switch(o.geo){case"cloud":{if(d==="solid")return y.jsx(NY,{color:l,fill:u,strokeWidth:s,w:a,h:k,id:r,size:m});if(d==="dashed"||d==="dotted")return y.jsx(CY,{color:l,fill:u,strokeWidth:s,w:a,h:k,id:r,size:m,dash:d});if(d==="draw")return y.jsx(jY,{color:l,fill:u,strokeWidth:s,w:a,h:k,id:r,size:m});break}case"ellipse":{if(d==="solid")return y.jsx(HI,{strokeWidth:s,w:a,h:k,color:l,fill:u});if(d==="dashed"||d==="dotted")return y.jsx(PY,{id:r,strokeWidth:s,w:a,h:k,dash:d,color:l,fill:u});if(d==="draw")return y.jsx(HI,{strokeWidth:s,w:a,h:k,color:l,fill:u});break}case"oval":{if(d==="solid")return y.jsx(KI,{strokeWidth:s,w:a,h:k,color:l,fill:u});if(d==="dashed"||d==="dotted")return y.jsx(MY,{id:r,strokeWidth:s,w:a,h:k,dash:d,color:l,fill:u});if(d==="draw")return y.jsx(KI,{strokeWidth:s,w:a,h:k,color:l,fill:u});break}default:{const S=this.editor.getShapeGeometry(n),C=S instanceof Mo?S.children[0].vertices:S.vertices,_=pf(n.props,s);if(d==="solid")return y.jsx(BY,{fill:u,color:l,strokeWidth:s,outline:C,lines:_});if(d==="dashed"||d==="dotted")return y.jsx(AY,{dash:d,fill:u,color:l,strokeWidth:s,outline:C,lines:_});if(d==="draw")return y.jsx(DY,{id:r,fill:u,color:l,strokeWidth:s,outline:C,lines:_})}}};return y.jsxs(y.Fragment,{children:[y.jsx(Bn,{id:r,children:b()}),y.jsxs(As,{id:n.id,style:{overflow:"hidden",width:n.props.w,height:n.props.h+o.growY},children:[y.jsx(TI,{id:r,type:i,font:p,fill:u,size:m,align:g,verticalAlign:f,text:w,labelColor:c,wrap:!0,bounds:o.geo==="cloud"?this.getGeometry(n).bounds:void 0}),n.props.url&&y.jsx(mu,{url:n.props.url,zoomLevel:this.editor.getZoomLevel()})]})]})}indicator(n){const{id:r,props:i}=n,{w:o,size:s}=i,a=i.h+i.growY,l=Zt[s];switch(i.geo){case"ellipse":return i.dash==="draw"?y.jsx("path",{d:_b(r,o,a,l)}):y.jsx("ellipse",{cx:o/2,cy:a/2,rx:o/2,ry:a/2});case"oval":return y.jsx("path",{d:Cb(o,a)});case"cloud":return y.jsx("path",{d:wu(o,a,r,s)});default:{const c=this.editor.getShapeGeometry(n),u=c instanceof Mo?c.children[0].vertices:c.vertices;let d;if(i.dash==="draw"){const p=vu(r,u,0,l*2,1);d=yu(p)}else d="M"+u[0]+"L"+u.slice(1)+"Z";const h=pf(n.props,l);if(h)for(const[p,g]of h)d+=`M${p.x},${p.y}L${g.x},${g.y}`;return y.jsx("path",{d})}}}toSvg(n,r){const{id:i,props:o}=n,s=Zt[o.size],a=Cn({isDarkMode:this.editor.user.getIsDarkMode()});r.addExportDef(pb(n.props.fill,a));let l;switch(o.geo){case"ellipse":{switch(o.dash){case"draw":l=LY({id:i,w:o.w,h:o.h,color:o.color,fill:o.fill,strokeWidth:s,theme:a});break;case"solid":l=FY({strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,theme:a});break;default:l=IY({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a});break}break}case"oval":{switch(o.dash){case"draw":l=$I({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a});break;case"solid":l=$Y({strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,theme:a});break;default:l=$I({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a})}break}case"cloud":{switch(o.dash){case"draw":l=OY({id:i,strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,size:o.size,theme:a});break;case"solid":l=RY({strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,size:o.size,id:i,theme:a});break;default:l=EY({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a,size:o.size})}break}default:{const c=this.editor.getShapeGeometry(n),u=c instanceof Mo?c.children[0].vertices:c.vertices,d=pf(n.props,s);switch(o.dash){case"draw":l=zY({id:i,fill:o.fill,color:o.color,strokeWidth:s,outline:u,lines:d,theme:a});break;case"solid":l=UY({fill:o.fill,color:o.color,strokeWidth:s,outline:u,lines:d,theme:a});break;default:l=TY({dash:o.dash,fill:o.fill,color:o.color,strokeWidth:s,outline:u,lines:d,theme:a});break}break}}if(o.text){const c=this.editor.getShapeGeometry(n).bounds;r.addExportDef(nf(n.props.font));const u=jI({editor:this.editor,shape:n,font:Mc[n.props.font],bounds:c}),d=u.cloneNode(!0);d.setAttribute("fill",a[n.props.labelColor].solid),d.setAttribute("stroke","none");const h=u.cloneNode(!0);h.setAttribute("stroke-width","2"),h.setAttribute("fill",a.background),h.setAttribute("stroke",a.background);const p=document.createElementNS("http://www.w3.org/2000/svg","g");if(p.append(h),p.append(d),l.nodeName==="g")return l.appendChild(p),l;{const g=document.createElementNS("http://www.w3.org/2000/svg","g");return g.appendChild(l),g.appendChild(p),g}}return l}getCanvasSvgDefs(){return[fb()]}}v(df,"type","geo"),v(df,"props",rz),v(df,"migrations",iz);function hf(e,t){const n=t.props.text;if(!n)return{w:0,h:0};const r=e.textMeasure.measureText("w",{...Dt,fontFamily:Ui[t.props.font],fontSize:rl[t.props.size],maxWidth:100}),i={s:2,m:3.5,l:5,xl:10},o=e.textMeasure.measureText(n,{...Dt,fontFamily:Ui[t.props.font],fontSize:rl[t.props.size],minWidth:r.w+"px",maxWidth:Math.max(0,Math.ceil(r.w+i[t.props.size]),Math.ceil(t.props.w-Eb*2))});return{w:o.w+Eb*2,h:o.h+Eb*2}}function pf(e,t){switch(e.geo){case"x-box":return VY(e.w,e.h,t,e.dash);case"check-box":return HY(e.w,e.h);default:return}}function VY(e,t,n,r){const i=r==="draw"?.62:0;if(r==="dashed")return[[new E(0,0),new E(e/2,t/2)],[new E(e,t),new E(e/2,t/2)],[new E(0,t),new E(e/2,t/2)],[new E(e,0),new E(e/2,t/2)]];const o=a=>Math.max(0,Math.min(e,a)),s=a=>Math.max(0,Math.min(t,a));return[[new E(o(n*i),s(n*i)),new E(o(e-n*i),s(t-n*i))],[new E(o(n*i),s(t-n*i)),new E(o(e-n*i),s(n*i))]]}function HY(e,t){const n=Math.min(e,t)*.82,r=(e-n)/2,i=(t-n)/2,o=a=>Math.max(0,Math.min(e,a)),s=a=>Math.max(0,Math.min(t,a));return[[new E(o(r+n*.25),s(i+n*.52)),new E(o(r+n*.45),s(i+n*.82))],[new E(o(r+n*.45),s(i+n*.82)),new E(o(r+n*.82),s(i+n*.22))]]}function KY(){const[e,t]=x.useState(!1);return x.useEffect(()=>{const n=CSS.supports("color","color(display-p3 1 1 1)"),r=matchMedia("(color-gamut: p3)");t(n&&r.matches);const i=()=>t(n&&r.matches);return r.addEventListener("change",i),()=>r.removeEventListener("change",i)},[]),Y(He.forceSrgb)||!e?"srgb":"p3"}const WI=.35,YI=.82;class ff extends Or{constructor(){super(...arguments);v(this,"hideResizeHandles",n=>gf(n));v(this,"hideRotateHandle",n=>gf(n));v(this,"hideSelectionBoundsFg",n=>gf(n));v(this,"onResize",(n,r)=>{const{scaleX:i,scaleY:o}=r,s=[];for(const a of n.props.segments)s.push({...a,points:a.points.map(({x:l,y:c,z:u})=>({x:i*l,y:o*c,z:u}))});return{props:{segments:s}}})}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1}}getGeometry(n){const r=ll(n);if(gf(n))return new vE({x:-r/2,y:-r/2,radius:r/2,isFilled:!0});const{strokePoints:i,sw:o}=XI(n,r,!0),s=wb({strokeWidth:o,showAsComplete:!0});return nl(i,s),new _t({points:uu(i,s),isFilled:!0})}component(n){return y.jsx(qI,{strokeWidth:ll(n),shape:n,opacity:WI})}backgroundComponent(n){return y.jsx(qI,{strokeWidth:ll(n),shape:n,opacity:YI})}indicator(n){var d;const r=sf(),i=ll(n),o=al(n.props.segments);let s=i;!r&&!n.props.isPen&&o.length===1&&(s+=Eo(n.id)()*(i/6));const a=n.props.isComplete||((d=xn(n.props.segments))==null?void 0:d.type)==="straight",l=wb({strokeWidth:i,showAsComplete:a}),c=zr(o,l);let u;return c.length<2?u=YY(o[0],s):u=$o(c,!1),y.jsx("path",{d:u})}toSvg(n){const r=Cn({isDarkMode:this.editor.user.getIsDarkMode()});return ZI(ll(n),n,WI,r)}toBackgroundSvg(n){const r=Cn({isDarkMode:this.editor.user.getIsDarkMode()});return ZI(ll(n),n,YI,r)}}v(ff,"type","highlight"),v(ff,"props",az),v(ff,"migrations",lz);function WY(e){return`M ${e.x} ${e.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function YY(e,t){const n=t/2;return`M ${e.x} ${e.y} m -${n}, 0 a ${n},${n} 0 1,0 ${n*2},0 a ${n},${n} 0 1,0 -${n*2},0`}function XI(e,t,n){var a;const r=al(e.props.segments),i=e.props.isComplete||((a=xn(e.props.segments))==null?void 0:a.type)==="straight";let o=t;!n&&!e.props.isPen&&r.length===1&&(o+=Eo(e.id)()*(t/6));const s=wb({strokeWidth:o,showAsComplete:i});return{strokePoints:zr(r,s),sw:o}}function GI(e,t,n){const{strokePoints:r,sw:i}=XI(e,t,n);return{solidStrokePath:r.length>1?$o(r,!1):WY(e.props.segments[0].points[0]),sw:i}}function qI({strokeWidth:e,shape:t,opacity:n}){const r=Et(),i=sf(),{solidStrokePath:o,sw:s}=GI(t,e,i),a=KY(),l=r[t.props.color].highlight[a];return y.jsx(Bn,{id:t.id,style:{opacity:n},children:y.jsx("path",{d:o,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:l,strokeWidth:s})})}function ZI(e,t,n,r){const{solidStrokePath:i,sw:o}=GI(t,e,!1),s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("d",i),s.setAttribute("fill","none"),s.setAttribute("stroke",r[t.props.color].highlight.srgb),s.setAttribute("stroke-width",`${o}`),s.setAttribute("opacity",`${n}`),s}function ll(e){return No[e.props.size]*1.12}function gf(e){return e.props.segments.length===1&&e.props.segments[0].points.length<2}function QI(){const[e,t]=x.useState(!1);return x.useEffect(()=>{const n=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{t(n.matches)};return r(),n.addEventListener("change",r),()=>n.removeEventListener("change",r)},[]),e}const XY=async e=>new Promise((t,n)=>{const r=new Image;r.onload=()=>t(r),r.onerror=()=>n(new Error("Failed to load image")),r.crossOrigin="anonymous",r.src=e}),GY=async e=>{const t=await XY(e),n=document.createElement("canvas");n.width=t.width,n.height=t.height;const r=n.getContext("2d");if(r)return r.drawImage(t,0,0),n.toDataURL()};async function qY(e){const t=await(await fetch(e)).blob();return new Promise((n,r)=>{const i=new FileReader;i.onloadend=()=>n(i.result),i.onerror=r,i.readAsDataURL(t)})}class mf extends Wa{constructor(){super(...arguments);v(this,"isAspectRatioLocked",()=>!0);v(this,"canCrop",()=>!0);v(this,"onDoubleClick",n=>{const r=n.props.assetId?this.editor.getAsset(n.props.assetId):void 0;!r||!(r.props.src&&"mimeType"in r.props&&r.props.mimeType==="image/gif")||this.editor.updateShapes([{type:"image",id:n.id,props:{playing:!n.props.playing}}])});v(this,"onDoubleClickEdge",n=>{const r=n.props;if(!r||this.editor.getCroppingShapeId()!==n.id)return;const i=Ht(r.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},o=1/(i.bottomRight.x-i.topLeft.x)*n.props.w,s=1/(i.bottomRight.y-i.topLeft.y)*n.props.h,a=new E(i.topLeft.x*o,i.topLeft.y*s).rot(n.rotation),l={id:n.id,type:n.type,x:n.x-a.x,y:n.y-a.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:o,h:s}};this.editor.updateShapes([l])})}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null}}component(n){var d,h;const r=JI(n),i=mE(n.id),o=QI(),[s,a]=x.useState(""),l=n.props.assetId?this.editor.getAsset(n.props.assetId):void 0;if((l==null?void 0:l.type)==="bookmark")throw Error("Bookmark assets can't be rendered as images");const c=Y("onlySelectedShape",()=>{var p;return n.id===((p=this.editor.getOnlySelectedShape())==null?void 0:p.id)},[this.editor])&&i&&this.editor.isInAny("select.crop","select.cropping","select.pointing_crop_handle"),u=o&&(((d=l==null?void 0:l.props.mimeType)==null?void 0:d.includes("video"))||((h=l==null?void 0:l.props.mimeType)==null?void 0:h.includes("gif")));return x.useEffect(()=>{if(l!=null&&l.props.src&&"mimeType"in l.props&&(l==null?void 0:l.props.mimeType)==="image/gif"){let p=!1;return(async()=>{const g=await GY(l.props.src);p||g&&a(g)})(),()=>{p=!0}}},[o,l==null?void 0:l.props]),y.jsxs(y.Fragment,{children:[(l==null?void 0:l.props.src)&&c&&y.jsx("div",{style:r,children:y.jsx("div",{className:"tl-image",style:{opacity:.1,backgroundImage:`url(${!n.props.playing||u?s:l.props.src})`},draggable:!1})}),y.jsxs(As,{id:n.id,style:{overflow:"hidden",width:n.props.w,height:n.props.h},children:[y.jsxs("div",{className:"tl-image-container",style:r,children:[l!=null&&l.props.src?y.jsx("div",{className:"tl-image",style:{backgroundImage:`url(${!n.props.playing||u?s:l.props.src})`},draggable:!1}):null,(l==null?void 0:l.props.isAnimated)&&!n.props.playing&&y.jsx("div",{className:"tl-image__tg",children:"GIF"})]}),"url"in n.props&&n.props.url&&y.jsx(mu,{url:n.props.url,zoomLevel:this.editor.getZoomLevel()})]})]})}indicator(n){return mE(n.id)?null:y.jsx("rect",{width:O(n.props.w),height:O(n.props.h)})}async toSvg(n){var l;const r=document.createElementNS("http://www.w3.org/2000/svg","g");let i=((l=n.props.assetId?this.editor.getAsset(n.props.assetId):null)==null?void 0:l.props.src)||"";i&&i.startsWith("http")&&(i=await qY(i)||"");const o=document.createElementNS("http://www.w3.org/2000/svg","image");o.setAttributeNS("http://www.w3.org/1999/xlink","href",i);const s=JI(n),a=n.props.crop;if(s.transform&&a){const{transform:c,width:u,height:d}=s,h=(a.bottomRight.x-a.topLeft.x)*u,p=(a.bottomRight.y-a.topLeft.y)*d,g=[new E(0,0),new E(h,0),new E(h,p),new E(0,p)],f=document.createElementNS("http://www.w3.org/2000/svg","polygon");f.setAttribute("points",g.map(k=>`${k.x},${k.y}`).join(" "));const m=document.createElementNS("http://www.w3.org/2000/svg","clipPath");m.setAttribute("id","cropClipPath"),m.appendChild(f);const w=document.createElementNS("http://www.w3.org/2000/svg","defs");w.appendChild(m),r.appendChild(w);const b=document.createElementNS("http://www.w3.org/2000/svg","g");b.setAttribute("clip-path","url(#cropClipPath)"),o.setAttribute("width",u.toString()),o.setAttribute("height",d.toString()),o.style.transform=c,b.appendChild(o),r.appendChild(b)}else o.setAttribute("width",n.props.w.toString()),o.setAttribute("height",n.props.h.toString()),r.appendChild(o);return r}}v(mf,"type","image"),v(mf,"props",uz),v(mf,"migrations",dz);function JI(e){const t=e.props.crop,n=t==null?void 0:t.topLeft;if(!n)return{width:e.props.w,height:e.props.h};const r=1/(t.bottomRight.x-t.topLeft.x)*e.props.w,i=1/(t.bottomRight.y-t.topLeft.y)*e.props.h,o=-n.x*r,s=-n.y*i;return{transform:`translate(${o}px, ${s}px)`,width:r,height:i}}function Pb(e,t){const{start:n,end:r}=e;return t?`M${O(n.x)},${O(n.y)} L${O(r.x)},${O(r.y)} `:`${O(r.x)},${O(r.y)} `}function Ib(e,t){const{a:n,b:r,c:i,d:o}=e;return E.Equals(n,o)?"":`${t?`M${O(n.x)},${O(n.y)}`:""}C${O(r.x)},${O(r.y)} ${O(i.x)},${O(i.y)} ${O(o.x)},${O(o.y)}`}function eM(e,t){let n=e.segments.reduce((r,i,o)=>r+Ib(i,o===0),"");return t&&(n+="Z"),n}function ZY(e,t){let n=e.segments.reduce((r,i,o)=>r+Pb(i,o===0),"");return t&&(n+="Z"),n}function tM(e,t=!1){return e instanceof Es?ZY(e,t):eM(e,t)}function nM(e){return{size:e,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function rM(e,t,n){const r=t.vertices,i=nM(n);return zr(r,i)}function QY(e,t,n){const r=nM(n);return uu(nl(rM(e,t,n),r),r)}function iM(e,t,n){const r=QY(e,t,n);return Hc(r)}function JY(e,t,n){if(e.props.dash==="draw"){const r=rM(e,t,n);return $o(r)}return tM(t)}const eX=new V0;class yf extends Or{constructor(){super(...arguments);v(this,"hideResizeHandles",()=>!0);v(this,"hideRotateHandle",()=>!0);v(this,"hideSelectionBoundsFg",()=>!0);v(this,"hideSelectionBoundsBg",()=>!0);v(this,"onResize",(n,r)=>{const{scaleX:i,scaleY:o}=r,s=Ht(n.props.handles);return Object.values(n.props.handles).forEach(({id:a,x:l,y:c})=>{s[a].x=l*i,s[a].y=c*o}),{props:{handles:s}}});v(this,"onHandleChange",(n,{handle:r})=>{const i=Ht(n);switch(r.id){case"start":case"end":{i.props.handles[r.id]={...i.props.handles[r.id],x:r.x,y:r.y};break}default:{const o="handle:"+r.index,s=n.props.handles[o];s?i.props.handles[o]={...s,x:r.x,y:r.y}:i.props.handles[o]={id:o,type:"vertex",canBind:!1,index:r.index,x:r.x,y:r.y};break}}return i})}getDefaultProps(){return{dash:"draw",size:"m",color:"black",spline:"line",handles:{start:{id:"start",type:"vertex",canBind:!1,canSnap:!0,index:"a1",x:0,y:0},end:{id:"end",type:"vertex",canBind:!1,canSnap:!0,index:"a2",x:.1,y:.1}}}}getGeometry(n){return xu(n)}getHandles(n){return eX.get(n.props,()=>{const r=n.props.handles,i=xu(n),o=Object.values(r).sort(qt),s=o.slice();for(let a=0;a<i.segments.length;a++){const l=i.segments[a].midPoint(),c=Zc(o[a].index,o[a+1].index);s.push({id:`mid-${a}`,type:"create",index:c,x:l.x,y:l.y})}return s.sort(qt)})}getOutlineSegments(n){return this.editor.getShapeGeometry(n).segments.map(r=>r.vertices)}component(n){const r=Et(),i=xu(n),o=Zt[n.props.size],{dash:s,color:a}=n.props;if(n.props.spline==="line"){if(s==="solid"){const l=i.points,c="M"+l[0]+"L"+l.slice(1);return y.jsxs(Bn,{id:n.id,children:[y.jsx(pt,{d:c,fill:"none",color:a,theme:r}),y.jsx("path",{d:c,stroke:r[a].solid,strokeWidth:o,fill:"none"})]})}if(s==="dashed"||s==="dotted"){const l=i.points,c="M"+l[0]+"L"+l.slice(1);return y.jsxs(Bn,{id:n.id,children:[y.jsx(pt,{d:c,fill:"none",color:a,theme:r}),y.jsx("g",{stroke:r[a].solid,strokeWidth:o,children:i.segments.map((u,d)=>{const{strokeDasharray:h,strokeDashoffset:p}=Qt(u.length,o,{style:s,start:d>0?"outset":"none",end:d<i.segments.length-1?"outset":"none"});return y.jsx("path",{strokeDasharray:h,strokeDashoffset:p,d:Pb(u,!0),fill:"none"},d)})})]})}if(s==="draw"){const l=i.points,[c,u]=kb(n.id,l,o);return y.jsxs(Bn,{id:n.id,children:[y.jsx(pt,{d:c,fill:"none",color:a,theme:r}),y.jsx("path",{d:u,stroke:r[a].solid,strokeWidth:o,fill:"none"})]})}}if(n.props.spline==="cubic"){const l=tM(i);if(s==="solid")return y.jsxs(Bn,{id:n.id,children:[y.jsx(pt,{d:l,fill:"none",color:a,theme:r}),y.jsx("path",{strokeWidth:o,stroke:r[a].solid,fill:"none",d:l})]});if(s==="dashed"||s==="dotted")return y.jsxs(Bn,{id:n.id,children:[y.jsx(pt,{d:l,fill:"none",color:a,theme:r}),y.jsx("g",{stroke:r[a].solid,strokeWidth:o,children:i.segments.map((c,u)=>{const{strokeDasharray:d,strokeDashoffset:h}=Qt(c.length,o,{style:s,start:u>0?"outset":"none",end:u<i.segments.length-1?"outset":"none"});return y.jsx("path",{strokeDasharray:d,strokeDashoffset:h,d:Ib(c,!0),fill:"none"},u)})})]});if(s==="draw")return y.jsxs(Bn,{id:n.id,children:[y.jsx(pt,{d:l,fill:"none",color:a,theme:r}),y.jsx("path",{d:iM(n,i,o),strokeWidth:1,stroke:r[a].solid,fill:r[a].solid})]})}}indicator(n){const r=Zt[n.props.size],i=xu(n),{dash:o}=n.props;let s;if(n.props.spline==="line"){const a=i.points;if(o==="solid"||o==="dotted"||o==="dashed")s="M"+a[0]+"L"+a.slice(1);else{const[l]=kb(n.id,a,r);s=l}}else s=JY(n,i,r);return y.jsx("path",{d:s})}toSvg(n){const r=Cn({isDarkMode:this.editor.user.getIsDarkMode()})[n.props.color].solid,i=xu(n),o=Zt[n.props.size];switch(n.props.dash){case"draw":{let s;if(i instanceof Cp)s=iM(n,i,o);else{const[l,c]=kb(n.id,i.points,o);s=c}const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("stroke-width",o+"px"),a.setAttribute("stroke",r),a.setAttribute("fill","none"),a.setAttribute("d",s),a}case"solid":{let s;if(i instanceof Cp)s=eM(i,!1);else{const l=i.points;s="M"+l[0]+"L"+l.slice(1)}const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("stroke-width",o+"px"),a.setAttribute("stroke",r),a.setAttribute("fill","none"),a.setAttribute("d",s),a}default:{const{segments:s}=i,a=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttribute("stroke",r),a.setAttribute("stroke-width",o.toString());const l=i instanceof Cp?Ib:Pb;return s.forEach((c,u)=>{const d=document.createElementNS("http://www.w3.org/2000/svg","path"),{strokeDasharray:h,strokeDashoffset:p}=Qt(c.length,o,{style:n.props.dash,start:u>0?"outset":"none",end:u<s.length-1?"outset":"none"});d.setAttribute("stroke-dasharray",h.toString()),d.setAttribute("stroke-dashoffset",p.toString()),d.setAttribute("d",l(c,!0)),d.setAttribute("fill","none"),a.appendChild(d)}),a}}}}v(yf,"type","line"),v(yf,"props",fz),v(yf,"migrations",gz);function xu(e){const{spline:t,handles:n}=e.props,r=Object.values(n).sort(qt).map(E.From);switch(t){case"cubic":return new Cp({points:r});case"line":return new Es({points:r})}}const Hi=200;class vf extends Or{constructor(){super(...arguments);v(this,"canEdit",()=>!0);v(this,"hideResizeHandles",()=>!0);v(this,"hideSelectionBoundsFg",()=>!0);v(this,"onBeforeCreate",n=>oM(this.editor,n,n.props.growY));v(this,"onBeforeUpdate",(n,r)=>{if(!(n.props.text===r.props.text&&n.props.font===r.props.font&&n.props.size===r.props.size))return oM(this.editor,r,n.props.growY)});v(this,"onEditEnd",n=>{const{id:r,type:i,props:{text:o}}=n;o.trimEnd()!==n.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])})}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,url:""}}getHeight(n){return Hi+n.props.growY}getGeometry(n){const r=this.getHeight(n);return new Ao({width:Hi,height:r,isFilled:!0})}component(n){const{id:r,type:i,props:{color:o,font:s,size:a,align:l,text:c,verticalAlign:u}}=n,d=Et(),h=o==="black"?"yellow":o;return y.jsxs(y.Fragment,{children:[y.jsx("div",{style:{position:"absolute",width:Hi,height:this.getHeight(n)},children:y.jsxs("div",{className:"tl-note__container",style:{color:d[h].solid,backgroundColor:d[h].solid},children:[y.jsx("div",{className:"tl-note__scrim"}),y.jsx(TI,{id:r,type:i,font:s,size:a,align:l,verticalAlign:u,text:c,labelColor:"black",wrap:!0})]})}),"url"in n.props&&n.props.url&&y.jsx(mu,{url:n.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(n){return y.jsx("rect",{rx:"7",width:O(Hi),height:O(this.getHeight(n))})}toSvg(n,r){r.addExportDef(nf(n.props.font));const i=Cn({isDarkMode:this.editor.user.getIsDarkMode()}),o=this.editor.getShapeGeometry(n).bounds,s=document.createElementNS("http://www.w3.org/2000/svg","g"),a=n.props.color==="black"?"yellow":n.props.color,l=document.createElementNS("http://www.w3.org/2000/svg","rect");l.setAttribute("rx","10"),l.setAttribute("width",Hi.toString()),l.setAttribute("height",o.height.toString()),l.setAttribute("fill",i[a].solid),l.setAttribute("stroke",i[a].solid),l.setAttribute("stroke-width","1"),s.appendChild(l);const c=document.createElementNS("http://www.w3.org/2000/svg","rect");c.setAttribute("rx","10"),c.setAttribute("width",Hi.toString()),c.setAttribute("height",o.height.toString()),c.setAttribute("fill",i.background),c.setAttribute("opacity",".28"),s.appendChild(c);const u=jI({editor:this.editor,shape:n,font:Mc[n.props.font],bounds:o});return u.setAttribute("fill",i.text),u.setAttribute("stroke","none"),s.appendChild(u),s}}v(vf,"type","note"),v(vf,"props",mz),v(vf,"migrations",yz);function oM(e,t,n=0){const r=e.textMeasure.measureText(t.props.text,{...Dt,fontFamily:Ui[t.props.font],fontSize:rl[t.props.size],maxWidth:Hi-34}).h+34;let i=null;if(r>Hi?i=r-Hi:n&&(i=0),i!==null)return{...t,props:{...t.props,growY:i}}}function tX(e,{initialBounds:t,scaleX:n,scaleY:r,newPoint:i}){const o=Math.max(.01,Math.min(Math.abs(n),Math.abs(r))),s=new E(0,0);n<0&&(s.x=-(t.width*o)),r<0&&(s.y=-(t.height*o));const{x:a,y:l}=E.Add(i,s.rot(e.rotation));return{x:a,y:l,props:{scale:o*e.props.scale}}}const nX=new V0;class bf extends Or{constructor(){super(...arguments);v(this,"canEdit",()=>!0);v(this,"isAspectRatioLocked",()=>!0);v(this,"onResize",(n,r)=>{const{initialBounds:i,initialShape:o,scaleX:s,handle:a}=r;if(r.mode==="scale_shape"||a!=="right"&&a!=="left")return{id:n.id,type:n.type,...tX(n,r)};{const l=i.width;let c=l*s;const u=new E(0,0);c=Math.max(1,Math.abs(c)),a==="left"?(u.x=l-c,s<0&&(u.x+=c)):s<0&&(u.x-=c);const{x:d,y:h}=u.rot(n.rotation).add(o);return{id:n.id,type:n.type,x:d,y:h,props:{w:c/o.props.scale,autoSize:!1}}}});v(this,"onBeforeCreate",n=>{if(!n.props.autoSize||n.props.text.trim())return;const r=this.getMinDimensions(n);return{...n,x:n.x-r.width/2,y:n.y-r.height/2}});v(this,"onEditEnd",n=>{const{id:r,type:i,props:{text:o}}=n,s=n.props.text.trimEnd();s.length===0?this.editor.deleteShapes([n.id]):s!==n.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])});v(this,"onBeforeUpdate",(n,r)=>{if(!r.props.autoSize)return;const i=n.props.size!==r.props.size||n.props.align!==r.props.align||n.props.font!==r.props.font||n.props.scale!==1&&r.props.scale===1,o=n.props.text!==r.props.text;if(!i&&!o)return;const s=this.getMinDimensions(n),a=sM(this.editor,r.props),l=s.width*n.props.scale,c=s.height*n.props.scale,u=a.width*r.props.scale,d=a.height*r.props.scale;let h;switch(r.props.align){case"middle":{h=new E((u-l)/2,o?0:(d-c)/2);break}case"end":{h=new E(u-l,o?0:(d-c)/2);break}default:{if(o)break;h=new E(0,(d-c)/2);break}}if(h){h.rot(r.rotation);const{x:p,y:g}=r;return{...r,x:p-h.x,y:g-h.y,props:{...r.props,w:u}}}else return{...r,props:{...r.props,w:u}}});v(this,"onDoubleClickEdge",n=>{if(!n.props.autoSize)return{id:n.id,type:n.type,props:{autoSize:!0}};if(n.props.scale!==1)return{id:n.id,type:n.type,props:{scale:1}}})}getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",align:"middle",autoSize:!0,scale:1}}getMinDimensions(n){return nX.get(n.props,r=>sM(this.editor,r))}getGeometry(n){const{scale:r}=n.props,{width:i,height:o}=this.getMinDimensions(n);return new Ao({width:i*r,height:o*r,isFilled:!0})}component(n){const{id:r,type:i,props:{text:o,color:s}}=n,a=Cn({isDarkMode:this.editor.user.getIsDarkMode()}),{width:l,height:c}=this.getMinDimensions(n),{rInput:u,isEmpty:d,isEditing:h,handleFocus:p,handleChange:g,handleKeyDown:f,handleBlur:m,handleInputPointerDown:w,handleDoubleClick:b}=yb(r,i,o);return y.jsx(As,{id:n.id,children:y.jsxs("div",{className:"tl-text-shape__wrapper tl-text-shadow","data-font":n.props.font,"data-align":n.props.align,"data-hastext":!d,"data-isediting":h,"data-textwrap":!0,style:{fontSize:No[n.props.size],lineHeight:No[n.props.size]*Dt.lineHeight+"px",transform:`scale(${n.props.scale})`,transformOrigin:"top left",width:Math.max(1,l),height:Math.max(No[n.props.size]*Dt.lineHeight,c),color:a[s].solid},children:[y.jsx("div",{className:"tl-text tl-text-content",dir:"ltr",children:o}),h?y.jsx("textarea",{ref:u,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:h,placeholder:"",spellCheck:"true",wrap:"off",dir:"ltr",datatype:"wysiwyg",defaultValue:o,onFocus:p,onChange:g,onKeyDown:f,onBlur:m,onTouchEnd:St,onContextMenu:St,onPointerDown:w,onDoubleClick:b}):null]})})}indicator(n){const r=this.editor.getShapeGeometry(n).bounds,i=H();return n.props.autoSize&&i.getEditingShapeId()===n.id?null:y.jsx("rect",{width:O(r.width),height:O(r.height)})}toSvg(n,r){r.addExportDef(nf(n.props.font));const i=Cn({isDarkMode:this.editor.user.getIsDarkMode()}),o=this.editor.getShapeGeometry(n).bounds,s=n.props.text,a=o.width/(n.props.scale??1),l=o.height/(n.props.scale??1),c={fontSize:No[n.props.size],fontFamily:Mc[n.props.font],textAlign:n.props.align,verticalTextAlign:"middle",width:a,height:l,padding:0,lineHeight:Dt.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},u=i[n.props.color].solid,d=document.createElementNS("http://www.w3.org/2000/svg","g"),h=tf(this.editor,this.editor.textMeasure.measureTextSpans(s,c),{...c,stroke:i.background,strokeWidth:2,fill:i.background,padding:0}),p=h.cloneNode(!0);return p.setAttribute("fill",u),p.setAttribute("stroke","none"),d.append(h),d.append(p),d}}v(bf,"type","text"),v(bf,"props",vz),v(bf,"migrations",bz);function sM(e,t){const{font:n,text:r,autoSize:i,size:o,w:s}=t,a=i?16:Math.max(16,s),l=No[o],c=i?null:Math.floor(Math.max(a,s)),u=e.textMeasure.measureText(r,{...Dt,fontFamily:Ui[n],fontSize:l,maxWidth:c});return i&&(u.w+=1),{width:Math.max(a,u.w),height:Math.max(l,u.h)}}class wf extends Wa{constructor(){super(...arguments);v(this,"canEdit",()=>!0);v(this,"isAspectRatioLocked",()=>!0)}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(n){return y.jsx(iX,{shape:n,videoUtil:this})}indicator(n){return y.jsx("rect",{width:O(n.props.w),height:O(n.props.h)})}toSvg(n){const r=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","image");return i.setAttributeNS("http://www.w3.org/1999/xlink","href",rX(n.id)),i.setAttribute("width",n.props.w.toString()),i.setAttribute("height",n.props.h.toString()),r.appendChild(i),r}}v(wf,"type","video"),v(wf,"props",wz),v(wf,"migrations",xz);function rX(e){const t=e.split(":")[1],n=document.querySelector(`.tl-video-shape-${t}`);if(n){const r=document.createElement("canvas");return r.width=n.videoWidth,r.height=n.videoHeight,r.getContext("2d").drawImage(n,0,0),r.toDataURL("image/png")}else throw new Error("Video with id "+t+" not found")}const iX=Pe(function(e){const{shape:t,videoUtil:n}=e,r=n.editor.getShapeGeometry(t).bounds.w*n.editor.getZoomLevel()>=110,i=t.props.assetId?n.editor.getAsset(t.props.assetId):null,{time:o,playing:s}=t.props,a=_p(t.id),l=QI(),c=J.useRef(null),u=J.useCallback(m=>{const w=m.currentTarget;n.editor.updateShapes([{type:"video",id:t.id,props:{playing:!0,time:w.currentTime}}])},[t.id,n.editor]),d=J.useCallback(m=>{const w=m.currentTarget;n.editor.updateShapes([{type:"video",id:t.id,props:{playing:!1,time:w.currentTime}}])},[t.id,n.editor]),h=J.useCallback(m=>{const w=m.currentTarget;a&&n.editor.updateShapes([{type:"video",id:t.id,props:{time:w.currentTime}}])},[a,t.id,n.editor]),[p,g]=J.useState(!1),f=J.useCallback(m=>{const w=m.currentTarget;o!==w.currentTime&&(w.currentTime=o),s||w.pause(),g(!0)},[s,o]);return J.useEffect(()=>{const m=c.current;m&&(p&&!a&&o!==m.currentTime&&(m.currentTime=o),a&&document.activeElement!==m&&m.focus())},[a,p,o]),J.useEffect(()=>{if(l){const m=c.current;m.pause(),m.currentTime=0}},[c,l]),y.jsxs(y.Fragment,{children:[y.jsx(As,{id:t.id,children:y.jsx("div",{className:"tl-counter-scaled",children:i!=null&&i.props.src?y.jsx("video",{ref:c,style:a?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${t.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:a&&r,onPlay:u,onPause:d,onTimeUpdate:h,onLoadedData:f,hidden:!p,children:y.jsx("source",{src:i.props.src})}):null})}),"url"in t.props&&t.props.url&&y.jsx(mu,{url:t.props.url,zoomLevel:n.editor.getZoomLevel()})]})}),oX=[bf,of,lf,df,vf,yf,uf,rf,ff,cf,mf,wf];function sX(e){return[e.sideEffects.registerAfterChangeHandler("instance",(t,n)=>{t.isFocused!==n.isFocused&&(n.isFocused?(e.getContainer().focus(),e.updateViewportScreenBounds()):(e.complete(),e.getContainer().blur(),e.updateViewportScreenBounds()))}),e.sideEffects.registerAfterChangeHandler("instance_page_state",(t,n)=>{if(t.croppingShapeId!==n.croppingShapeId){const r=e.isInAny("select.crop","select.pointing_crop_handle","select.cropping");!t.croppingShapeId&&n.croppingShapeId?r||e.setCurrentTool("select.crop.idle"):t.croppingShapeId&&!n.croppingShapeId&&r&&e.setCurrentTool("select.idle")}t.editingShapeId!==n.editingShapeId&&(!t.editingShapeId&&n.editingShapeId?e.isIn("select.editing_shape")||e.setCurrentTool("select.editing_shape"):t.editingShapeId&&!n.editingShapeId&&e.isIn("select.editing_shape")&&e.setCurrentTool("select.idle"))})]}class aM extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"scribbleId","id");v(this,"markId","");v(this,"excludedShapeIds",new Set);v(this,"onEnter",n=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=n;const{originPagePoint:r}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(o=>{if(this.editor.isShapeOrAncestorLocked(o))return!0;if(this.editor.isShapeOfType(o,"group")||this.editor.isShapeOfType(o,"frame")){const s=this.editor.getPointInShapeSpace(o,r);return this.editor.getShapeGeometry(o).bounds.containsPoint(s)}return!1}).map(o=>o.id));const i=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=i.id,this.update()});v(this,"pushPointToScribble",()=>{const{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,n,r)});v(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});v(this,"onPointerMove",()=>{this.update()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()})}update(){const n=this.editor.getErasingShapeIds(),r=this.editor.getZoomLevel(),i=this.editor.getCurrentPageShapes(),{inputs:{currentPagePoint:o,previousPagePoint:s}}=this.editor,{excludedShapeIds:a}=this;this.pushPointToScribble();const l=new Set(n);for(const c of i){if(this.editor.isShapeOfType(c,"group"))continue;const u=this.editor.getShapeMask(c.id);if(u&&!ni(o,u))continue;const d=this.editor.getShapeGeometry(c),h=this.editor.getPointInShapeSpace(c,s),p=this.editor.getPointInShapeSpace(c,o);d.hitTestLineSegment(h,p,jr/r)&&l.add(this.editor.getOutermostSelectableShape(c).id)}this.editor.setErasingShapes([...l].filter(c=>!a.has(c)))}complete(){this.editor.deleteShapes(this.editor.getCurrentPageState().erasingShapeIds),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}}v(aM,"id","erasing");let aX=(Pw=class extends ne{constructor(){super(...arguments);v(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(Pw,"id","idle"),Pw),lX=(Iw=class extends ne{constructor(){super(...arguments);v(this,"onEnter",()=>{const t=this.editor.getZoomLevel(),n=this.editor.getCurrentPageShapesSorted(),{inputs:{currentPagePoint:r}}=this.editor,i=new Set,o=i.size;for(let s=n.length,a=s-1;a>=0;a--){const l=n[a];if(!(this.editor.isShapeOrAncestorLocked(l)||this.editor.isShapeOfType(l,"group"))&&this.editor.isPointInShape(l,r,{hitInside:!1,margin:jr/t})){const c=this.editor.getOutermostSelectableShape(l);if(this.editor.isShapeOfType(c,"frame")&&i.size>o)break;i.add(c.id)}}this.editor.setErasingShapes([...i])});v(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.parent.transition("erasing",t)});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()});v(this,"onInterrupt",()=>{this.cancel()})}complete(){const t=this.editor.getErasingShapeIds();t.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(t)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}},v(Iw,"id","pointing"),Iw);class xf extends ne{constructor(){super(...arguments);v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}v(xf,"id","eraser"),v(xf,"initial","idle"),v(xf,"children",()=>[aX,lX,aM]);class lM extends ne{constructor(){super(...arguments);v(this,"onEnter",()=>{this.update()});v(this,"onPointerMove",()=>{this.update()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()})}update(){const{currentScreenPoint:n,previousScreenPoint:r}=this.editor.inputs,i=E.Sub(n,r);(Math.abs(i.x)>0||Math.abs(i.y)>0)&&this.editor.pan(i)}complete(){this.editor.slideCamera({speed:Math.min(2,this.editor.inputs.pointerVelocity.len()),direction:this.editor.inputs.pointerVelocity,friction:ep}),this.parent.transition("idle")}}v(lM,"id","dragging");let cX=(Mw=class extends ne{constructor(){super(...arguments);v(this,"onEnter",()=>{this.editor.setCursor({type:"grab",rotation:0})});v(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});v(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},v(Mw,"id","idle"),Mw),uX=(Aw=class extends ne{constructor(){super(...arguments);v(this,"onEnter",()=>{this.editor.stopCameraAnimation(),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})});v(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.parent.transition("dragging",t)});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onInterrupt",()=>{this.complete()})}complete(){this.parent.transition("idle")}},v(Aw,"id","pointing"),Aw);class Sf extends ne{constructor(){super(...arguments);v(this,"onDoubleClick",n=>{if(n.phase==="settle"){const{currentScreenPoint:r}=this.editor.inputs;this.editor.zoomIn(r,{duration:220,easing:Xt.easeOutQuint})}});v(this,"onTripleClick",n=>{if(n.phase==="settle"){const{currentScreenPoint:r}=this.editor.inputs;this.editor.zoomOut(r,{duration:320,easing:Xt.easeOutQuint})}});v(this,"onQuadrupleClick",n=>{if(n.phase==="settle"){const r=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:i}}=this.editor;r===1?this.editor.zoomToFit({duration:400,easing:Xt.easeOutQuint}):this.editor.resetZoom(i,{duration:320,easing:Xt.easeOutQuint})}})}}v(Sf,"id","hand"),v(Sf,"initial","idle"),v(Sf,"children",()=>[cX,uX,lM]);let dX=(Tw=class extends ne{constructor(){super(...arguments);v(this,"onPointerDown",t=>{this.parent.transition("lasering",t)})}},v(Tw,"id","idle"),Tw);class cM extends ne{constructor(){super(...arguments);v(this,"scribbleId","id");v(this,"onEnter",()=>{const n=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=n.id,this.pushPointToScribble()});v(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});v(this,"onPointerMove",()=>{this.pushPointToScribble()});v(this,"onPointerUp",()=>{this.complete()});v(this,"pushPointToScribble",()=>{const{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,n,r)});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()})}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}v(cM,"id","lasering");class kf extends ne{constructor(){super(...arguments);v(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}v(kf,"id","laser"),v(kf,"initial","idle"),v(kf,"children",()=>[dX,cM]);class uM extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"brush",new se);v(this,"initialSelectedShapeIds",[]);v(this,"excludedShapeIds",new Set);v(this,"initialStartShape",null);v(this,"onEnter",n=>{const{altKey:r,currentPagePoint:i}=this.editor.inputs;if(r){this.parent.transition("scribble_brushing",n);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(o=>this.editor.isShapeOfType(o,"group")||this.editor.isShapeOrAncestorLocked(o)).map(o=>o.id)),this.info=n,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(i)[0],this.onPointerMove()});v(this,"onExit",()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})});v(this,"onTick",()=>{nv(this.editor)});v(this,"onPointerMove",()=>{this.hitTestShapes()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onCancel",n=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds,{squashing:!0}),this.parent.transition("idle",n)});v(this,"onKeyDown",n=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",n):this.hitTestShapes()});v(this,"onKeyUp",()=>{this.hitTestShapes()});v(this,"onInterrupt",()=>{this.editor.updateInstanceState({brush:null})})}complete(){this.parent.transition("idle")}hitTestShapes(){const n=this.editor.getZoomLevel(),r=this.editor.getCurrentPageShapes(),i=this.editor.getCurrentPageId(),{inputs:{originPagePoint:o,currentPagePoint:s,shiftKey:a,ctrlKey:l}}=this.editor;this.brush.setTo(se.FromPoints([o,s]));const c=new Set(a?this.initialSelectedShapeIds:[]);let u,d,h,p,g,f;const{corners:m}=this.brush,{excludedShapeIds:w}=this;e:for(let b=0,k=r.length;b<k;b++){if(h=r[b],w.has(h.id)||c.has(h.id)||(p=this.editor.getShapePageBounds(h),!p))continue e;if(this.brush.contains(p)){this.handleHit(h,s,i,c,m);continue e}if(l||this.editor.isShapeOfType(h,"frame"))continue e;if(this.brush.collides(p)){const S=this.editor.getShapeGeometry(h);if(g=this.editor.getShapePageTransform(h),!g)continue e;f=g.clone().invert().applyToPoints(m);t:for(let C=0;C<f.length;C++)if(u=f[C],d=f[(C+1)%f.length],S.hitTestLineSegment(u,d,jr/n)){this.handleHit(h,s,i,c,m);break t}}}this.editor.updateInstanceState({brush:{...this.brush.toJson()}}),this.editor.setSelectedShapes(Array.from(c),{squashing:!0})}handleHit(n,r,i,o,s){if(n.parentId===i){o.add(n.id);return}const a=this.editor.getOutermostSelectableShape(n),l=this.editor.getShapeMask(a.id);l&&!VR(l,s)&&!ni(r,l)||o.add(a.id)}}v(uM,"id","brushing");function Mb(e){const t=e.getZoomLevel(),{inputs:{currentPagePoint:n}}=e;return e.getShapeAtPoint(n,{hitInside:!1,hitLabels:!1,margin:jr/t,renderingOnly:!0})??e.getSelectedShapeAtPoint(n)}function dM(e,t,n){if(!t)throw Error("Needs to translate a cropped shape!");const{crop:r}=t.props;if(!r)return;const i=e.inputs.shiftKey?Math.abs(n.x)<Math.abs(n.y)?"x":"y":null;i==="x"?n.x=0:i==="y"&&(n.y=0),n.rot(-t.rotation);const o=1/(r.bottomRight.x-r.topLeft.x)*t.props.w,s=1/(r.bottomRight.y-r.topLeft.y)*t.props.h,a=r.bottomRight.y-r.topLeft.y,l=r.bottomRight.x-r.topLeft.x,c=Ht(r);return c.topLeft.x=Math.min(1-l,Math.max(0,c.topLeft.x-n.x/o)),c.topLeft.y=Math.min(1-a,Math.max(0,c.topLeft.y-n.y/s)),c.bottomRight.x=c.topLeft.x+l,c.bottomRight.y=c.topLeft.y+a,{id:t.id,type:t.type,props:{crop:c}}}let hX=(jw=class extends ne{constructor(){super(...arguments);v(this,"onEnter",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0});const t=this.editor.getOnlySelectedShape();this.editor.on("change-history",this.cleanupCroppingState),t&&(this.editor.mark("crop"),this.editor.setCroppingShape(t.id))});v(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.off("change-history",this.cleanupCroppingState)});v(this,"onCancel",()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})});v(this,"onPointerDown",t=>{var n;if(!this.editor.getIsMenuOpen()){if(t.ctrlKey){this.cancel(),this.editor.root.handleEvent(t);return}switch(t.target){case"canvas":{const r=Mb(this.editor);if(r&&!this.editor.isShapeOfType(r,"group")){this.onPointerDown({...t,shape:r,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(t);break}case"shape":{if(t.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",t);return}else(n=this.editor.getShapeUtil(t.shape))!=null&&n.canCrop(t.shape)?(this.editor.setCroppingShape(t.shape.id),this.editor.setSelectedShapes([t.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",t)):(this.cancel(),this.editor.root.handleEvent(t));break}case"selection":{switch(t.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...t,onInteractionEnd:"select.crop"});break}case"top":case"right":case"bottom":case"left":{this.editor.setCurrentTool("select.pointing_crop_handle",{...t,onInteractionEnd:"select.crop"});break}case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.pointing_crop_handle",{...t,onInteractionEnd:"select.crop"});break}default:this.cancel()}break}}}});v(this,"onDoubleClick",t=>{var o;if(this.editor.inputs.shiftKey||t.phase!=="up")return;const n=this.editor.getCroppingShapeId();if(!n)return;const r=this.editor.getShape(n);if(!r)return;const i=this.editor.getShapeUtil(r);i&&t.target==="selection"&&((o=i.onDoubleClickEdge)==null||o.call(i,r))});v(this,"onKeyDown",()=>{this.nudgeCroppingImage(!1)});v(this,"onKeyRepeat",()=>{this.nudgeCroppingImage(!0)});v(this,"onKeyUp",t=>{switch(t.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}});v(this,"cleanupCroppingState",()=>{this.editor.getCroppingShapeId()||this.editor.setCurrentTool("select.idle",{})})}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(t=!1){const{editor:{inputs:{keys:n}}}=this,r=n.has("ShiftLeft"),i=new E(0,0);if(n.has("ArrowLeft")&&(i.x+=1),n.has("ArrowRight")&&(i.x-=1),n.has("ArrowUp")&&(i.y+=1),n.has("ArrowDown")&&(i.y-=1),i.equals(new E(0,0)))return;r&&i.mul(10);const o=this.editor.getShape(this.editor.getCroppingShapeId());if(!o)return;const s=dM(this.editor,o,i);s&&(t||this.editor.mark("translate crop"),this.editor.updateShapes([s]))}},v(jw,"id","idle"),jw);class hM extends ne{constructor(){super(...arguments);v(this,"onCancel",()=>{this.editor.setCurrentTool("select.crop.idle",{})});v(this,"onPointerMove",n=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",n)});v(this,"onPointerUp",n=>{this.editor.setCurrentTool("select.crop.idle",n)})}}v(hM,"id","pointing_crop");class pM extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"markId","translating crop");v(this,"snapshot",{});v(this,"onEnter",n=>{this.info=n,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()});v(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});v(this,"onPointerMove",()=>{this.updateShapes()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onKeyDown",n=>{switch(n.key){case"Alt":case"Shift":{this.updateShapes();return}}});v(this,"onKeyUp",n=>{switch(n.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}})}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const n=this.snapshot.shape;if(!n)return;const{originPagePoint:r,currentPagePoint:i}=this.editor.inputs,o=i.clone().sub(r),s=dM(this.editor,n,o);s&&this.editor.updateShapes([s],{squashing:!0})}}v(pM,"id","translating_crop");class _f extends ne{}v(_f,"id","crop"),v(_f,"initial","idle"),v(_f,"children",()=>[hX,pM,hM]);const pr=8,cl={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class fM extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",n=>{this.info=n,this.updateCursor()});v(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("resizing",this.info)});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){const n=this.editor.getSelectedShapes(),r=cl[this.info.handle];this.editor.updateInstanceState({cursor:{type:r,rotation:n.length===1?n[0].rotation:0}})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}v(fM,"id","pointing_resize_handle");class gM extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"markId","");v(this,"snapshot",{});v(this,"onEnter",n=>{this.info=n,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()});v(this,"onPointerMove",()=>{this.updateShapes()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"getDefaultCrop",()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}))}updateCursor(){const n=this.editor.getSelectedShapes()[0];if(!n)return;const r=cl[this.info.handle];this.editor.updateInstanceState({cursor:{type:r,rotation:n.rotation}})}updateShapes(){const{shape:n,cursorHandleOffset:r}=this.snapshot;if(!n||!this.editor.getShapeUtil("image"))return;const i=n.props,o=this.editor.inputs.currentPagePoint.clone().sub(r),s=this.editor.inputs.originPagePoint.clone().sub(r),a=o.clone().sub(s).rot(-n.rotation),l=i.crop??this.getDefaultCrop(),c=Ht(l),u=new E(n.x,n.y),d=new E(0,0),h=1/(l.bottomRight.x-l.topLeft.x)*i.w,p=1/(l.bottomRight.y-l.topLeft.y)*i.h;let g=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(p<pr)break;g=!0,c.topLeft.y=c.topLeft.y+a.y/p,p*(c.bottomRight.y-c.topLeft.y)<pr?(c.topLeft.y=c.bottomRight.y-pr/p,d.y=(c.topLeft.y-l.topLeft.y)*p):c.topLeft.y<=0?(c.topLeft.y=0,d.y=(c.topLeft.y-l.topLeft.y)*p):d.y=a.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(p<pr)break;g=!0,c.bottomRight.y=Math.min(1,c.bottomRight.y+a.y/p),p*(c.bottomRight.y-c.topLeft.y)<pr&&(c.bottomRight.y=c.topLeft.y+pr/p);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(h<pr)break;g=!0,c.topLeft.x=c.topLeft.x+a.x/h,h*(c.bottomRight.x-c.topLeft.x)<pr?(c.topLeft.x=c.bottomRight.x-pr/h,d.x=(c.topLeft.x-l.topLeft.x)*h):c.topLeft.x<=0?(c.topLeft.x=0,d.x=(c.topLeft.x-l.topLeft.x)*h):d.x=a.x;break}case"right":case"top_right":case"bottom_right":{if(h<pr)break;g=!0,c.bottomRight.x=Math.min(1,c.bottomRight.x+a.x/h),h*(c.bottomRight.x-c.topLeft.x)<pr&&(c.bottomRight.x=c.topLeft.x+pr/h);break}}if(!g)return;u.add(d.rot(n.rotation));const f={id:n.id,type:n.type,x:u.x,y:u.y,props:{crop:c,w:(c.bottomRight.x-c.topLeft.x)*h,h:(c.bottomRight.y-c.topLeft.y)*p}};this.editor.updateShapes([f],{squashing:!0}),this.updateCursor()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}createSnapshot(){const n=this.editor.getSelectionRotation(),{inputs:{originPagePoint:r}}=this.editor,i=this.editor.getOnlySelectedShape(),o=this.editor.getSelectionRotatedPageBounds(),s=E.RotWith(o.getHandlePoint(this.info.handle),o.point,n),a=E.Sub(r,s);return{shape:i,cursorHandleOffset:a}}}v(gM,"id","cropping");class mM extends ne{constructor(){super(...arguments);v(this,"shapeId","");v(this,"initialHandle",{});v(this,"initialAdjacentHandle",null);v(this,"initialPagePoint",{});v(this,"markId","");v(this,"initialPageTransform");v(this,"initialPageRotation");v(this,"info",{});v(this,"isPrecise",!1);v(this,"isPreciseId",null);v(this,"pointingId",null);v(this,"onEnter",n=>{const{shape:r,isCreating:i,handle:o}=n;this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.shapeId=r.id,this.markId=i?`creating:${r.id}`:"dragging handle",i||this.editor.mark(this.markId),this.initialHandle=Ht(o),this.initialPageTransform=this.editor.getShapePageTransform(r),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.updateInstanceState({cursor:{type:i?"cross":"grabbing",rotation:0}},{ephemeral:!0});const s=this.editor.getShapeHandles(r).sort(qt),a=s.findIndex(c=>c.id===n.handle.id);this.initialAdjacentHandle=null;for(let c=a+1;c<s.length;c++){const u=s[c];if(u.type==="vertex"&&u.id!=="middle"&&u.id!==n.handle.id){this.initialAdjacentHandle=u;break}}if(!this.initialAdjacentHandle)for(let c=s.length-1;c>=0;c--){const u=s[c];if(u.type==="vertex"&&u.id!=="middle"&&u.id!==n.handle.id){this.initialAdjacentHandle=u;break}}const l=r.props[n.handle.id];this.isPrecise=!1,(l==null?void 0:l.type)==="binding"?(this.editor.setHintingShapes([l.boundShapeId]),this.isPrecise=l.isPrecise,this.isPrecise?this.isPreciseId=l.boundShapeId:this.resetExactTimeout()):this.editor.setHintingShapes([]),this.update(),this.editor.select(this.shapeId)});v(this,"exactTimeout",-1);v(this,"onPointerMove",()=>{this.update()});v(this,"onKeyDown",()=>{this.update()});v(this,"onKeyUp",()=>{this.update()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})})}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}complete(){this.editor.snaps.clear();const{onInteractionEnd:n}=this.info;if(this.editor.getInstanceState().isToolLocked&&n){this.editor.setCurrentTool(n,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clear();const{onInteractionEnd:n}=this.info;if(n){this.editor.setCurrentTool(n,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var _;const{editor:n,shapeId:r,initialPagePoint:i}=this,{initialHandle:o,initialPageRotation:s,initialAdjacentHandle:a}=this,l=this.editor.getHintingShapeIds(),c=this.editor.user.getIsSnapMode(),{snaps:u,inputs:{currentPagePoint:d,shiftKey:h,ctrlKey:p,altKey:g,pointerVelocity:f}}=n,m=this.info.shape,w=n.getShape(r);if(!w)return;const b=n.getShapeUtil(w);let k=d.clone().sub(i).rot(-s).add(o);if(h&&a&&o.id!=="middle"){const P=E.Angle(a,k),I=Gh(P,24)-P;k=E.RotWith(k,a,I)}if(n.snaps.clear(),o.canSnap&&(c?!p:p)){const P=n.getShapePageTransform(w.id);if(!P)throw Error("Expected a page transform");const I=n.getShapeHandles(w).filter(({type:L})=>L==="vertex").sort(qt).findIndex(({index:L})=>o.index===L),M=b.getOutlineSegments(w).map(L=>te.applyToPoints(P,L)).filter((L,z)=>z!==I-1&&z!==I),A=u.getSnappingHandleDelta({additionalSegments:M,handlePoint:te.applyToPoint(P,k)});A&&(A.rot(-n.getShapeParentTransform(w).rotation()),k.add(A))}const S=(_=b.onHandleChange)==null?void 0:_.call(b,w,{handle:{...o,x:k.x,y:k.y},isPrecise:this.isPrecise||g,initial:m}),C={...w,...S};if(o.canBind){const P=C.props[o.id];(P==null?void 0:P.type)==="binding"?l[0]!==P.boundShapeId&&(n.setHintingShapes([P.boundShapeId]),this.pointingId=P.boundShapeId,this.isPrecise=f.len()<.5||g,this.isPreciseId=this.isPrecise?P.boundShapeId:null,this.resetExactTimeout()):l.length>0&&(n.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}S&&n.updateShapes([C],{squashing:!0})}}v(mM,"id","dragging_handle");class yM extends ne{constructor(){super(...arguments);v(this,"onEnter",()=>{const n=this.editor.getEditingShape();if(!n)throw Error("Entered editing state without an editing shape");fu(this.editor),this.editor.select(n)});v(this,"onExit",()=>{var i,o;const{editingShapeId:n}=this.editor.getCurrentPageState();if(!n)return;this.editor.setEditingShape(null);const r=this.editor.getShape(n);(o=(i=this.editor.getShapeUtil(r)).onEditEnd)==null||o.call(i,r),setTimeout(()=>{this.editor.updateViewportScreenBounds()},500)});v(this,"onPointerMove",n=>{switch(n.target){case"shape":case"canvas":{fu(this.editor);return}}});v(this,"onPointerDown",n=>{switch(n.target){case"canvas":{const r=Mb(this.editor);if(r){this.onPointerDown({...n,shape:r,target:"shape"});return}break}case"shape":{const{shape:r}=n,i=this.editor.getEditingShape();if(!i)throw Error("Expected an editing shape!");if(r.type===i.type)if(this.editor.isShapeOfType(r,"geo")||this.editor.isShapeOfType(r,"arrow")){const o=this.editor.getShapeUtil(r).getGeometry(r).children[1];if(o){const s=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint);if(o.bounds.containsPoint(s)){if(r.id===i.id)return;this.parent.transition("pointing_shape",n);return}}}else{if(r.id===i.id)this.editor.isShapeOfType(r,"frame")&&this.editor.setEditingShape(null);else{this.parent.transition("pointing_shape",n);return}return}break}}this.parent.transition("idle",n),this.editor.root.handleEvent(n)});v(this,"onComplete",n=>{this.parent.transition("idle",n)});v(this,"onCancel",n=>{this.parent.transition("idle",n)})}}v(yM,"id","editing_shape");function vM(e){const t=e.getOnlySelectedShape();return!!(t&&!e.isShapeOrAncestorLocked(t)&&e.getShapeUtil(t).canCrop(t))}function Cf(e){const t=e.getSelectedShapeIds(),{shiftKey:n,altKey:r,currentPagePoint:i}=e.inputs,o=e.getShapeAtPoint(i,{hitInside:!1,margin:jr/e.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:s=>!s.isLocked});if(o){const s=e.getOutermostSelectableShape(o);if(n&&!r)e.cancelDoubleClick(),t.includes(s.id)?(e.mark("deselecting shape"),e.deselect(s)):(e.mark("shift selecting shape"),e.setSelectedShapes([...t,s.id]));else{let a;s===o||s.id===e.getFocusedGroupId()||t.includes(s.id)?a=o:a=s,a&&!t.includes(a.id)&&(e.mark("selecting shape"),e.select(a.id))}}else{if(n)return;{t.length>0&&(e.mark("selecting none"),e.selectNone());const s=e.getFocusedGroupId();if(ar(s)){const a=e.getShape(s);e.isPointInShape(a,i,{margin:0,hitInside:!0})||e.setFocusedGroup(null)}}}}let pX=(Ow=class extends ne{constructor(){super(...arguments);v(this,"onEnter",()=>{this.parent.setCurrentToolIdMask(void 0),fu(this.editor),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});v(this,"onPointerMove",()=>{fu(this.editor)});v(this,"onPointerDown",t=>{if(this.editor.getIsMenuOpen())return;const n=t.ctrlKey&&vM(this.editor);if(t.ctrlKey&&!n){if(t.target==="shape"&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(t.shape)){this.parent.transition("pointing_shape",t);return}this.parent.transition("brushing",t);return}switch(t.target){case"canvas":{const r=Mb(this.editor);if(r&&!r.isLocked){this.onPointerDown({...t,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:s}}=this.editor;if((i.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&bM(this.editor,s)){this.onPointerDown({...t,target:"selection"});return}this.parent.transition("pointing_canvas",t);break}case"shape":{if(this.editor.isShapeOrAncestorLocked(t.shape)){this.parent.transition("pointing_canvas",t);break}this.parent.transition("pointing_shape",t);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",t):this.parent.transition("pointing_handle",t);break}case"selection":{switch(t.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.parent.transition("pointing_rotate_handle",t);break}case"top":case"right":case"bottom":case"left":{n?this.parent.transition("pointing_crop_handle",t):this.parent.transition("pointing_resize_handle",t);break}case"top_left":case"top_right":case"bottom_left":case"bottom_right":{n?this.parent.transition("pointing_crop_handle",t):this.parent.transition("pointing_resize_handle",t);break}default:{const r=this.editor.getHoveredShape();if(r&&!this.editor.getSelectedShapeIds().includes(r.id)&&!r.isLocked){this.onPointerDown({...t,shape:r,target:"shape"});return}this.parent.transition("pointing_selection",t)}}break}}});v(this,"onDoubleClick",t=>{var n,r,i,o,s;if(!(this.editor.inputs.shiftKey||t.phase!=="up"))switch(t.target){case"canvas":{const a=this.editor.getHoveredShape(),l=a&&!this.editor.isShapeOfType(a,"group")?a:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:jr/this.editor.getZoomLevel(),hitInside:!1}),c=this.editor.getFocusedGroupId();if(l){if(this.editor.isShapeOfType(l,"group")){Cf(this.editor);return}else{const u=this.editor.getShape(l.parentId);if(u&&this.editor.isShapeOfType(u,"group")&&!(c&&u.id===c)){Cf(this.editor);return}}this.onDoubleClick({...t,shape:l,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(t);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;const a=this.editor.getOnlySelectedShape();if(a){const l=this.editor.getShapeUtil(a);if(!this.canInteractWithShapeInReadOnly(a))return;if(t.handle==="right"||t.handle==="left"||t.handle==="top"||t.handle==="bottom"){const c=(n=l.onDoubleClickEdge)==null?void 0:n.call(l,a);if(c){this.editor.mark("double click edge"),this.editor.updateShapes([c]);return}}if(l.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.parent.transition("crop",t);return}this.shouldStartEditingShape(a)&&this.startEditingShape(a,t)}break}case"shape":{const{shape:a}=t,l=this.editor.getShapeUtil(a);if(a.type!=="video"&&a.type!=="embed"&&this.editor.getInstanceState().isReadonly)break;if(l.onDoubleClick){const c=(r=l.onDoubleClick)==null?void 0:r.call(l,a);if(c){this.editor.updateShapes([c]);return}else if(l.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.editor.mark("select and crop"),this.editor.select((i=t.shape)==null?void 0:i.id),this.parent.transition("crop",t);return}}this.shouldStartEditingShape(a)?this.startEditingShape(a,t):this.handleDoubleClickOnCanvas(t);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;const{shape:a,handle:l}=t,c=(s=(o=this.editor.getShapeUtil(a)).onDoubleClickHandle)==null?void 0:s.call(o,a,l);c?this.editor.updateShapes([c]):this.shouldStartEditingShape(a)&&this.startEditingShape(a,t)}}});v(this,"onRightClick",t=>{switch(t.target){case"canvas":{const n=this.editor.getHoveredShape(),r=n&&!this.editor.isShapeOfType(n,"group")?n:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:jr/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitFrameInside:!1,renderingOnly:!0});if(r){this.onRightClick({...t,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:s}}=this.editor;if((i.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&bM(this.editor,s)){this.onRightClick({...t,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:n}=this.editor.getCurrentPageState(),{shape:r}=t,i=this.editor.getOutermostSelectableShape(r,o=>!n.includes(o.id));n.includes(i.id)||(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([i.id]));break}}});v(this,"onCancel",()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())});v(this,"onKeyDown",t=>{switch(t.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);break}}});v(this,"onKeyRepeat",t=>{switch(t.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}});v(this,"onKeyUp",t=>{switch(t.code){case"Enter":{const n=this.editor.getSelectedShapes();if(n.every(i=>this.editor.isShapeOfType(i,"group"))){this.editor.setSelectedShapes(n.flatMap(i=>this.editor.getSortedChildIdsForParent(i.id)));return}const r=this.editor.getOnlySelectedShape();if(r&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...t,target:"shape",shape:r});return}vM(this.editor)&&this.parent.transition("crop",t);break}}});v(this,"isDarwin",window.navigator.userAgent.toLowerCase().indexOf("mac")>-1)}shouldStartEditingShape(t=this.editor.getOnlySelectedShape()){return!t||this.editor.isShapeOrAncestorLocked(t)&&t.type!=="embed"||!this.canInteractWithShapeInReadOnly(t)?!1:this.editor.getShapeUtil(t).canEdit(t)}startEditingShape(t,n){this.editor.isShapeOrAncestorLocked(t)&&t.type!=="embed"||(this.editor.mark("editing shape"),this.editor.setEditingShape(t.id),this.parent.transition("editing_shape",n))}handleDoubleClickOnCanvas(t){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");const n=Ve(),{x:r,y:i}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:n,type:"text",x:r,y:i,props:{text:"",autoSize:!0}}]);const o=this.editor.getShape(n);if(!o)return;const s=this.editor.getShapeUtil(o);this.editor.getInstanceState().isReadonly&&!s.canEditInReadOnly(o)||(this.editor.setEditingShape(n),this.editor.select(n),this.parent.transition("editing_shape",t))}nudgeSelectedShapes(t=!1){const{editor:{inputs:{keys:n}}}=this,r=n.has("ShiftLeft"),i=new E(0,0);if(n.has("ArrowLeft")&&(i.x-=1),n.has("ArrowRight")&&(i.x+=1),n.has("ArrowUp")&&(i.y-=1),n.has("ArrowDown")&&(i.y+=1),i.equals(new E(0,0)))return;t||this.editor.mark("nudge shapes");const{gridSize:o}=this.editor.getDocumentSettings(),s=this.editor.getInstanceState().isGridMode?r?o*mX:o:r?fX:gX;this.editor.nudgeShapes(this.editor.getSelectedShapeIds(),i.mul(s))}canInteractWithShapeInReadOnly(t){return!!(!this.editor.getInstanceState().isReadonly||this.editor.getShapeUtil(t).canEditInReadOnly(t))}},v(Ow,"id","idle"),Ow);const fX=10,gX=1,mX=5;function bM(e,t){const n=e.getSelectionRotatedPageBounds();if(!n)return!1;const r=e.getSelectionRotation();return r?ni(t,n.corners.map(i=>E.RotWith(i,n.point,r))):n.containsPoint(t)}class wM extends ne{constructor(){super(...arguments);v(this,"onEnter",()=>{const{inputs:n}=this.editor;n.shiftKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())});v(this,"onPointerMove",n=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",n)});v(this,"onPointerUp",()=>{Cf(this.editor),this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onInterrupt",()=>{this.parent.transition("idle")})}complete(){this.parent.transition("idle")}}v(wM,"id","pointing_canvas");class xM extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",n=>{this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd);const r=this.editor.getSelectedShapes()[0];r&&(this.updateCursor(r),this.editor.setCroppingShape(r.id))});v(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.setCurrentToolIdMask(void 0)});v(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})});v(this,"onPointerUp",()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()})}updateCursor(n){const r=cl[this.info.handle];this.editor.updateInstanceState({cursor:{type:r,rotation:n.rotation}})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}}v(xM,"id","pointing_crop_handle");class SM extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",n=>{this.info=n;const r=n.shape.props[n.handle.id];(r==null?void 0:r.type)==="binding"&&this.editor.setHintingShapes([r.boundShapeId]),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})});v(this,"onExit",()=>{this.editor.setHintingShapes([]),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});v(this,"onPointerUp",()=>{this.parent.transition("idle",this.info)});v(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("dragging_handle",this.info)});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()})}cancel(){this.parent.transition("idle")}}v(SM,"id","pointing_handle");class kM extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",n=>{this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.info=n,this.updateCursor()});v(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});v(this,"onPointerMove",()=>{const{isDragging:n}=this.editor.inputs;n&&this.parent.transition("rotating",this.info)});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){const n=this.editor.getSelectionRotation();this.editor.updateInstanceState({cursor:{type:cl[this.info.handle],rotation:n}})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}v(kM,"id","pointing_rotate_handle");class _M extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",n=>{this.info=n});v(this,"onPointerUp",n=>{Cf(this.editor),this.parent.transition("idle",n)});v(this,"onPointerMove",n=>{if(this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly)return;this.parent.transition("translating",n)}});v(this,"onDoubleClick",n=>{var o,s;const r=this.editor.getHoveredShape(),i=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(i){this.parent.transition("idle"),(s=(o=this.parent).onDoubleClick)==null||s.call(o,{...n,target:"shape",shape:this.editor.getShape(i)});return}});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()})}cancel(){this.parent.transition("idle")}}v(_M,"id","pointing_selection");class CM extends ne{constructor(){super(...arguments);v(this,"hitShape",{});v(this,"hitShapeForPointerUp",{});v(this,"didSelectOnEnter",!1);v(this,"onEnter",n=>{const r=this.editor.getSelectedShapeIds(),i=this.editor.getSelectionRotatedPageBounds(),o=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:s,shiftKey:a,altKey:l}}=this.editor;this.hitShape=n.shape;const c=this.editor.getOutermostSelectableShape(n.shape);if(this.editor.getShapeUtil(n.shape).onClick||c.id===o||r.includes(c.id)||this.editor.isAncestorSelected(c.id)||r.length>1&&(i!=null&&i.containsPoint(s))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=c;return}this.didSelectOnEnter=!0,a&&!l?(this.editor.cancelDoubleClick(),r.includes(c.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...r,c.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([c.id]))});v(this,"onPointerUp",n=>{var u;const r=this.editor.getSelectedShapeIds(),i=this.editor.getFocusedGroupId(),o=this.editor.getZoomLevel(),{inputs:{currentPagePoint:s,shiftKey:a}}=this.editor,l=this.editor.getShapeAtPoint(s,{margin:jr/o,hitInside:!0,renderingOnly:!0})??this.hitShape,c=l?this.editor.getOutermostSelectableShape(l):this.hitShapeForPointerUp;if(c){const d=this.editor.getShapeUtil(c);if(d.onClick){const h=(u=d.onClick)==null?void 0:u.call(d,c);if(h){this.editor.mark("shape on click"),this.editor.updateShapes([h]),this.parent.transition("idle",n);return}}if(c.id===i){r.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",n);return}}if(!this.didSelectOnEnter){const d=this.editor.getOutermostSelectableShape(l,h=>!r.includes(h.id));if(r.includes(d.id))if(a)this.editor.mark("deselecting on pointer up"),this.editor.deselect(c);else if(r.includes(c.id)){if(r.length===1&&(this.editor.isShapeOfType(c,"geo")||this.editor.isShapeOfType(c,"arrow"))){const h=this.editor.getShapeGeometry(c).children[1];if(h){const p=this.editor.getPointInShapeSpace(c,s);if(h.bounds.containsPoint(p,0)&&h.hitTestPoint(p)){this.editor.batch(()=>{this.editor.mark("editing on pointer up"),this.editor.select(c.id);const g=this.editor.getShapeUtil(c);this.editor.getInstanceState().isReadonly&&!g.canEditInReadOnly(c)||(this.editor.setEditingShape(c.id),this.editor.setCurrentTool("select.editing_shape"))});return}}}this.editor.mark("selecting on pointer up"),this.editor.select(c.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(c);else if(a){const h=this.editor.getShapeAncestors(d);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(p=>!h.find(g=>g.id===p)),d.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([d.id])}this.parent.transition("idle",n)});v(this,"onPointerMove",n=>{if(this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly)return;this.parent.transition("translating",n)}});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.cancel()});v(this,"onInterrupt",()=>{this.cancel()})}cancel(){this.parent.transition("idle")}}v(CM,"id","pointing_shape");class EM extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"markId","");v(this,"didHoldCommand",!1);v(this,"creationCursorOffset",{x:0,y:0});v(this,"snapshot",{});v(this,"onEnter",n=>{const{isCreating:r=!1,creationCursorOffset:i={x:0,y:0}}=n;this.info=n,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.creationCursorOffset=i,this.snapshot=this._createSnapshot(),r?(this.markId=`creating:${this.editor.getOnlySelectedShape().id}`,this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},{ephemeral:!0})):(this.markId="starting resizing",this.editor.mark(this.markId)),this.handleResizeStart(),this.updateShapes()});v(this,"onTick",()=>{nv(this.editor)});v(this,"onPointerMove",()=>{this.updateShapes()});v(this,"onKeyDown",()=>{this.updateShapes()});v(this,"onKeyUp",()=>{this.updateShapes()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.snaps.clear()});v(this,"_createSnapshot",()=>{const n=this.editor.getSelectedShapeIds(),r=this.editor.getSelectionRotation(),{inputs:{originPagePoint:i}}=this.editor,o=this.editor.getSelectionRotatedPageBounds(),s=E.RotWith(o.getHandlePoint(this.info.handle),o.point,r),a=E.Sub(i,s),l=new Map,c=[];n.forEach(d=>{const h=this.editor.getShape(d);if(h){if(h.type==="frame"&&c.push({id:d,children:he(this.editor.getSortedChildIdsForParent(h).map(p=>this.editor.getShape(p)))}),l.set(h.id,this._createShapeSnapshot(h)),this.editor.isShapeOfType(h,"frame")&&n.length===1)return;this.editor.visitDescendants(h.id,p=>{const g=this.editor.getShape(p);if(g&&(l.set(g.id,this._createShapeSnapshot(g)),this.editor.isShapeOfType(g,"frame")))return!1})}});const u=![...l.values()].some(d=>!P2(d.pageRotation,r)||d.isAspectRatioLocked);return{shapeSnapshots:l,selectionBounds:o,cursorHandleOffset:a,selectionRotation:r,selectedShapeIds:n,canShapesDeform:u,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:c}});v(this,"_createShapeSnapshot",n=>{const r=this.editor.getShapePageTransform(n),i=this.editor.getShapeUtil(n);return{shape:n,bounds:this.editor.getShapeGeometry(n).bounds,pageTransform:r,pageRotation:te.Decompose(r).rotation,isAspectRatioLocked:i.isAspectRatioLocked(n)}})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var n,r;if(this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(r=(n=this.info).onCreate)==null||r.call(n,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:n}=this.snapshot,r=[];n.forEach(({shape:i})=>{var s,a;const o=(a=(s=this.editor.getShapeUtil(i)).onResizeStart)==null?void 0:a.call(s,i);o&&r.push(o)}),r.length>0&&this.editor.updateShapes(r)}handleResizeEnd(){const{shapeSnapshots:n}=this.snapshot,r=[];n.forEach(({shape:i})=>{var a,l;const o=this.editor.getShape(i.id),s=(l=(a=this.editor.getShapeUtil(i)).onResizeEnd)==null?void 0:l.call(a,i,o);s&&r.push(s)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{altKey:n,shiftKey:r}=this.editor.inputs,{frames:i,shapeSnapshots:o,selectionBounds:s,cursorHandleOffset:a,selectedShapeIds:l,selectionRotation:c,canShapesDeform:u}=this.snapshot,d=r||!u,{ctrlKey:h}=this.editor.inputs,p=this.editor.inputs.currentPagePoint.clone().sub(a).sub(this.creationCursorOffset),g=this.editor.inputs.originPagePoint.clone().sub(a);if(this.editor.getInstanceState().isGridMode&&!h){const{gridSize:P}=this.editor.getDocumentSettings();p.snapToGrid(P)}const f=this.info.handle,m=PM(f,Math.PI);if(this.editor.snaps.clear(),(this.editor.user.getIsSnapMode()?!h:h)&&c%Ke===0){const{nudge:P}=this.editor.snaps.snapResize({dragDelta:E.Sub(p,g),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:PM(f,c),isAspectRatioLocked:d,isResizingFromCenter:n});p.add(P)}const w=E.RotWith(n?s.center:s.getHandlePoint(m),s.point,c),b=E.Sub(p,w).rot(-c),k=E.Sub(g,w).rot(-c),S=E.DivV(b,k);Number.isFinite(S.x)||(S.x=1),Number.isFinite(S.y)||(S.y=1);const C=f==="top"||f==="bottom",_=f==="left"||f==="right";d?_?S.y=Math.abs(S.x):C?S.x=Math.abs(S.y):Math.abs(S.x)>Math.abs(S.y)?S.y=Math.abs(S.x)*(S.y<0?-1:1):S.x=Math.abs(S.y)*(S.x<0?-1:1):(C&&(S.x=1),_&&(S.y=1)),this.info.isCreating||this.updateCursor({dragHandle:f,isFlippedX:S.x<0,isFlippedY:S.y<0,rotation:c});for(const P of o.keys()){const I=o.get(P);this.editor.resizeShape(P,S,{initialShape:I.shape,initialBounds:I.bounds,initialPageTransform:I.pageTransform,dragHandle:f,mode:l.length===1&&P===l[0]?"resize_bounds":"scale_shape",scaleOrigin:w,scaleAxisRotation:c})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:P,children:I}of i){if(!I.length)continue;const M=o.get(P).shape,A=this.editor.getShape(P);if(!(M&&A))continue;const L=A.x-M.x,z=A.y-M.y,$=new E(L,z).rot(-M.rotation);if($.x!==0||$.y!==0)for(const j of I)this.editor.updateShape({id:j.id,type:j.type,x:j.x-$.x,y:j.y-$.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:P}of i)if(P.length)for(const I of P)this.editor.updateShape({id:I.id,type:I.type,x:I.x,y:I.y})}}updateCursor({dragHandle:n,isFlippedX:r,isFlippedY:i,rotation:o}){const s={...this.editor.getInstanceState().cursor};switch(n){case"top_left":case"bottom_right":{s.type="nwse-resize",r!==i&&(s.type="nesw-resize");break}case"top_right":case"bottom_left":{s.type="nesw-resize",r!==i&&(s.type="nwse-resize");break}}s.rotation=o,this.editor.setCursor(s)}}v(EM,"id","resizing");const Ab=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function PM(e,t){t=t%De;const n=Math.round(t/(Te/4)),r=Ab.indexOf(e);return Ab[(r+n)%Ab.length]}const IM=Math.PI/180;class MM extends ne{constructor(){super(...arguments);v(this,"snapshot",{});v(this,"info",{});v(this,"markId","");v(this,"onEnter",n=>{this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.markId="rotate start",this.editor.mark(this.markId);const r=KC({editor:this.editor});if(!r)return this.parent.transition("idle",this.info);this.snapshot=r,this.handleStart()});v(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}});v(this,"onPointerMove",()=>{this.update()});v(this,"onKeyDown",()=>{this.update()});v(this,"onKeyUp",()=>{this.update()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"update",()=>{const n=this._getRotationFromPointerPosition({snapToNearestDegree:!1});pp({editor:this.editor,delta:n,snapshot:this.snapshot,stage:"update"}),this.editor.updateInstanceState({cursor:{type:cl[this.info.handle],rotation:n+this.snapshot.initialSelectionRotation}})});v(this,"cancel",()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)});v(this,"complete",()=>{pp({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)})}handleStart(){const n=this._getRotationFromPointerPosition({snapToNearestDegree:!1});pp({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.updateInstanceState({cursor:{type:cl[this.info.handle],rotation:n+this.snapshot.initialSelectionRotation}})}_getRotationFromPointerPosition({snapToNearestDegree:n}){const r=this.editor.getSelectionRotation(),i=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:o,currentPagePoint:s}}=this.editor,{initialCursorAngle:a,initialSelectionRotation:l}=this.snapshot;if(!i)return l;const c=i.center.clone().rotWith(i.point,r).angle(s)-a;let u=l+c;if(o)u=Gh(u,24);else if(n&&(u=Math.round(u/IM)*IM,this.editor.getInstanceState().isCoarsePointer)){const d=Gh(u,4),h=$c(u,d);Math.abs(h)<Hz(5)&&(u=d)}return u-l}}v(MM,"id","rotating");class AM extends ne{constructor(){super(...arguments);v(this,"hits",new Set);v(this,"size",0);v(this,"scribbleId","id");v(this,"initialSelectedShapeIds",new Set);v(this,"newlySelectedShapeIds",new Set);v(this,"onEnter",()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const n=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=n.id,this.updateScribbleSelection(!0),requestAnimationFrame(()=>{this.editor.updateInstanceState({brush:null})})});v(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});v(this,"onPointerMove",()=>{this.updateScribbleSelection(!0)});v(this,"onPointerUp",()=>{this.complete()});v(this,"onKeyDown",()=>{this.updateScribbleSelection(!1)});v(this,"onKeyUp",()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")});v(this,"onCancel",()=>{this.cancel()});v(this,"onComplete",()=>{this.complete()});v(this,"pushPointToScribble",()=>{const{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,n,r)})}updateScribbleSelection(n){const r=this.editor.getZoomLevel(),i=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:o,originPagePoint:s,previousPagePoint:a,currentPagePoint:l}}=this.editor,{newlySelectedShapeIds:c,initialSelectedShapeIds:u}=this;n&&this.pushPointToScribble();const d=i;let h,p,g,f;for(let m=0,w=d.length;m<w;m++)if(h=d[m],p=this.editor.getShapeGeometry(h),!(this.editor.isShapeOfType(h,"group")||c.has(h.id)||this.editor.isShapeOrAncestorLocked(h))){if(this.editor.isShapeOfType(h,"frame")){const b=this.editor.getPointInShapeSpace(h,s);if(p.bounds.containsPoint(b))continue}if(g=this.editor.getPointInShapeSpace(h,a),f=this.editor.getPointInShapeSpace(h,l),p.hitTestLineSegment(g,f,jr/r)){const b=this.editor.getOutermostSelectableShape(h),k=this.editor.getShapeMask(b.id);if(k&&AC(a,l,k)!==null&&!ni(l,k))continue;c.add(b.id)}}this.editor.setSelectedShapes([...new Set(o?[...c,...u]:[...c])],{squashing:!0})}complete(){this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds],{squashing:!0}),this.parent.transition("idle")}}v(AM,"id","scribble_brushing");const TM=100;class yX{constructor(t){v(this,"prevDroppingShapeId",null);v(this,"droppingNodeTimer",null);v(this,"first",!0);v(this,"dispose",()=>{this.clear()});this.editor=t,t.disposables.add(this.dispose)}updateDroppingNode(t,n){var r;this.first&&(this.prevDroppingShapeId=((r=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,t))==null?void 0:r.id)??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(t,TM*10,n):this.editor.inputs.pointerVelocity.len()>.5&&(clearInterval(this.droppingNodeTimer),this.setDragTimer(t,TM,n))}setDragTimer(t,n,r){this.droppingNodeTimer=setTimeout(()=>{this.editor.batch(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,t,r)}),this.droppingNodeTimer=null},n)}handleDrag(t,n,r){var l,c,u,d,h;n=he(n.map(p=>this.editor.getShape(p.id)));const i=((l=this.editor.getDroppingOverShape(t,n))==null?void 0:l.id)??null;if(i===this.prevDroppingShapeId)return;const{prevDroppingShapeId:o}=this,s=o&&this.editor.getShape(o),a=i&&this.editor.getShape(i);if(s&&((u=(c=this.editor.getShapeUtil(s)).onDragShapesOut)==null||u.call(c,s,n)),a){const p=(h=(d=this.editor.getShapeUtil(a)).onDragShapesOver)==null?void 0:h.call(d,a,n);p&&p.shouldHint&&this.editor.setHintingShapes([a.id])}else this.editor.setHintingShapes([]);r==null||r(),this.prevDroppingShapeId=i}dropShapes(t){var r,i;const{prevDroppingShapeId:n}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,t),n){const o=this.editor.getShape(n);if(!o)return;(i=(r=this.editor.getShapeUtil(o)).onDropShapesOver)==null||i.call(r,o,t)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearInterval(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}}class jM extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"selectionSnapshot",{});v(this,"snapshot",{});v(this,"markId","");v(this,"isCloning",!1);v(this,"isCreating",!1);v(this,"onCreate",()=>{});v(this,"dragAndDropManager",new yX(this.editor));v(this,"onEnter",n=>{const{isCreating:r=!1,onCreate:i=()=>{}}=n;if(this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.isCreating=r,this.onCreate=i,r?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=n,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=OM(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()});v(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.dragAndDropManager.clear()});v(this,"onTick",()=>{this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),nv(this.editor)});v(this,"onPointerMove",()=>{this.updateShapes()});v(this,"onKeyDown",()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()});v(this,"onKeyUp",()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onComplete",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()});v(this,"updateParentTransforms",()=>{const{editor:n,snapshot:{shapeSnapshots:r}}=this;r.forEach(i=>{const o=n.getShape(i.shape.id);if(!o)return null;const s=_n(o.parentId)?null:te.Inverse(n.getShapePageTransform(o.parentId));i.parentTransform=s})})}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=OM(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var n;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(n=this.onCreate)==null||n.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:n}=this.snapshot,r=[];n.forEach(i=>{var s,a;const o=(a=(s=this.editor.getShapeUtil(i)).onTranslateStart)==null?void 0:a.call(s,i);o&&r.push(o)}),r.length>0&&this.editor.updateShapes(r),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:n}=this.snapshot,r=[];n.forEach(i=>{var a,l;const o=this.editor.getShape(i.id),s=(l=(a=this.editor.getShapeUtil(i)).onTranslateEnd)==null?void 0:l.call(a,i,o);s&&r.push(s)}),r.length>0&&this.editor.updateShapes(r)}handleChange(){const{movingShapes:n}=this.snapshot,r=[];n.forEach(i=>{var a,l;const o=this.editor.getShape(i.id),s=(l=(a=this.editor.getShapeUtil(i)).onTranslate)==null?void 0:l.call(a,i,o);s&&r.push(s)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{snapshot:n}=this;this.dragAndDropManager.updateDroppingNode(n.movingShapes,this.updateParentTransforms),vX({editor:this.editor,shapeSnapshots:n.shapeSnapshots,averagePagePoint:n.averagePagePoint,initialSelectionPageBounds:n.initialPageBounds,initialSelectionSnapPoints:n.initialSnapPoints}),this.handleChange()}}v(jM,"id","translating");function OM(e){const t=[],n=[],r=he(e.getSelectedShapeIds().map(o=>{const s=e.getShape(o);if(!s)return null;t.push(s);const a=e.getShapePageTransform(o).point();if(!a)return null;n.push(a);const l=ji.isId(s.parentId)?null:te.Inverse(e.getShapePageTransform(s.parentId));return{shape:s,pagePoint:a,parentTransform:l}}));let i=[];if(e.getSelectedShapeIds().length===1)i=e.snaps.getSnapPointsCache().get(e.getSelectedShapeIds()[0]);else{const o=e.getSelectionPageBounds();o&&(i=o.snapPoints.map((s,a)=>({id:"selection:"+a,x:s.x,y:s.y})))}return{averagePagePoint:E.Average(n),movingShapes:t,shapeSnapshots:r,initialPageBounds:e.getSelectionPageBounds(),initialSnapPoints:i}}function vX({editor:e,shapeSnapshots:t,averagePagePoint:n,initialSelectionPageBounds:r,initialSelectionSnapPoints:i}){const{inputs:o}=e,s=e.getInstanceState().isGridMode,a=e.getDocumentSettings().gridSize,l=E.Sub(o.currentPagePoint,o.originPagePoint),c=e.inputs.shiftKey?Math.abs(l.x)<Math.abs(l.y)?"x":"y":null;if(c==="x"?l.x=0:c==="y"&&(l.y=0),e.snaps.clear(),(e.user.getIsSnapMode()?!o.ctrlKey:o.ctrlKey)&&e.inputs.pointerVelocity.len()<.5){const{nudge:h}=e.snaps.snapTranslate({dragDelta:l,initialSelectionPageBounds:r,lockedAxis:c,initialSelectionSnapPoints:i});l.add(h)}const u=E.Add(n,l);s&&!o.ctrlKey&&u.snapToGrid(a);const d=E.Sub(u,n);e.updateShapes(he(t.map(({shape:h,pagePoint:p,parentTransform:g})=>{const f=E.Add(p,d),m=g?te.applyToPoint(g,f):f;return{id:h.id,type:h.type,x:m.x,y:m.y}})),{squashing:!0})}class Ef extends ne{constructor(){super(...arguments);v(this,"onExit",()=>{this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)})}}v(Ef,"id","select"),v(Ef,"initial","idle"),v(Ef,"children",()=>[_f,gM,pX,wM,CM,jM,uM,AM,xM,_M,fM,yM,EM,MM,kM,SM,mM]);class LM extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",n=>{this.info=n});v(this,"onPointerDown",()=>{this.parent.transition("pointing",this.info)})}}v(LM,"id","idle");class DM extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",n=>{this.info=n});v(this,"onPointerUp",()=>{this.complete()});v(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)});v(this,"onCancel",()=>{this.cancel()})}complete(){const{currentScreenPoint:n}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(n,{duration:220}):this.editor.zoomIn(n,{duration:220}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}v(DM,"id","pointing");class zM extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"zoomBrush",new se);v(this,"onEnter",n=>{this.info=n,this.update()});v(this,"onExit",()=>{this.editor.updateInstanceState({zoomBrush:null})});v(this,"onPointerMove",()=>{this.update()});v(this,"onPointerUp",()=>{this.complete()});v(this,"onCancel",()=>{this.cancel()})}update(){const{inputs:{originPagePoint:n,currentPagePoint:r}}=this.editor;this.zoomBrush.setTo(se.FromPoints([n,r])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:n}=this,r=8/this.editor.getZoomLevel();if(n.width<r&&n.height<r){const i=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(i,{duration:220}):this.editor.zoomIn(i,{duration:220})}else{const i=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(n,i,{duration:220})}this.parent.transition("idle",this.info)}}v(zM,"id","zoom_brushing");class Pf extends ne{constructor(){super(...arguments);v(this,"info",{});v(this,"onEnter",n=>{this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.updateCursor()});v(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.setCurrentToolIdMask(void 0)});v(this,"onKeyDown",()=>{this.updateCursor()});v(this,"onKeyUp",n=>{this.updateCursor(),n.code==="KeyZ"&&this.complete()});v(this,"onInterrupt",()=>{this.complete()})}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.updateInstanceState({cursor:{type:"zoom-out",rotation:0}},{ephemeral:!0}):this.editor.updateInstanceState({cursor:{type:"zoom-in",rotation:0}},{ephemeral:!0})}}v(Pf,"id","zoom"),v(Pf,"initial","idle"),v(Pf,"children",()=>[LM,zM,DM]);const bX=[xf,Sf,kf,Pf,Ef];function Z(){return Z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Z.apply(this,arguments)}function re(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(e==null||e(r),n===!1||!r.defaultPrevented)return t==null?void 0:t(r)}}function wX(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function If(...e){return t=>e.forEach(n=>wX(n,t))}function We(...e){return x.useCallback(If(...e),e)}function si(e,t=[]){let n=[];function r(o,s){const a=x.createContext(s),l=n.length;n=[...n,s];function c(d){const{scope:h,children:p,...g}=d,f=(h==null?void 0:h[e][l])||a,m=x.useMemo(()=>g,Object.values(g));return x.createElement(f.Provider,{value:m},p)}function u(d,h){const p=(h==null?void 0:h[e][l])||a,g=x.useContext(p);if(g)return g;if(s!==void 0)return s;throw new Error(`\`${d}\` must be used within \`${o}\``)}return c.displayName=o+"Provider",[c,u]}const i=()=>{const o=n.map(s=>x.createContext(s));return function(s){const a=(s==null?void 0:s[e])||o;return x.useMemo(()=>({[`__scope${e}`]:{...s,[e]:a}}),[s,a])}};return i.scopeName=e,[r,xX(i,...t)]}function xX(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(i){const o=r.reduce((s,{useScope:a,scopeName:l})=>{const c=a(i)[`__scope${l}`];return{...s,...c}},{});return x.useMemo(()=>({[`__scope${t.scopeName}`]:o}),[o])}};return n.scopeName=t.scopeName,n}const Ls=x.forwardRef((e,t)=>{const{children:n,...r}=e,i=x.Children.toArray(n),o=i.find(kX);if(o){const s=o.props.children,a=i.map(l=>l===o?x.Children.count(s)>1?x.Children.only(null):x.isValidElement(s)?s.props.children:null:l);return x.createElement(Tb,Z({},r,{ref:t}),x.isValidElement(s)?x.cloneElement(s,void 0,a):null)}return x.createElement(Tb,Z({},r,{ref:t}),n)});Ls.displayName="Slot";const Tb=x.forwardRef((e,t)=>{const{children:n,...r}=e;return x.isValidElement(n)?x.cloneElement(n,{..._X(r,n.props),ref:t?If(t,n.ref):n.ref}):x.Children.count(n)>1?x.Children.only(null):null});Tb.displayName="SlotClone";const SX=({children:e})=>x.createElement(x.Fragment,null,e);function kX(e){return x.isValidElement(e)&&e.type===SX}function _X(e,t){const n={...t};for(const r in t){const i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...s)=>{o(...s),i(...s)}:i&&(n[r]=i):r==="style"?n[r]={...i,...o}:r==="className"&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}function Mf(e){const t=e+"CollectionProvider",[n,r]=si(t),[i,o]=n(t,{collectionRef:{current:null},itemMap:new Map}),s=p=>{const{scope:g,children:f}=p,m=J.useRef(null),w=J.useRef(new Map).current;return J.createElement(i,{scope:g,itemMap:w,collectionRef:m},f)},a=e+"CollectionSlot",l=J.forwardRef((p,g)=>{const{scope:f,children:m}=p,w=o(a,f),b=We(g,w.collectionRef);return J.createElement(Ls,{ref:b},m)}),c=e+"CollectionItemSlot",u="data-radix-collection-item",d=J.forwardRef((p,g)=>{const{scope:f,children:m,...w}=p,b=J.useRef(null),k=We(g,b),S=o(c,f);return J.useEffect(()=>(S.itemMap.set(b,{ref:b,...w}),()=>void S.itemMap.delete(b))),J.createElement(Ls,{[u]:"",ref:k},m)});function h(p){const g=o(e+"CollectionConsumer",p);return J.useCallback(()=>{const f=g.collectionRef.current;if(!f)return[];const m=Array.from(f.querySelectorAll(`[${u}]`));return Array.from(g.itemMap.values()).sort((w,b)=>m.indexOf(w.ref.current)-m.indexOf(b.ref.current))},[g.collectionRef,g.itemMap])}return[{Provider:s,Slot:l,ItemSlot:d},h,r]}const CX=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Fe=CX.reduce((e,t)=>{const n=x.forwardRef((r,i)=>{const{asChild:o,...s}=r,a=o?Ls:t;return x.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),x.createElement(a,Z({},s,{ref:i}))});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function jb(e,t){e&&wa.flushSync(()=>e.dispatchEvent(t))}function en(e){const t=x.useRef(e);return x.useEffect(()=>{t.current=e}),x.useMemo(()=>(...n)=>{var r;return(r=t.current)===null||r===void 0?void 0:r.call(t,...n)},[])}function EX(e,t=globalThis==null?void 0:globalThis.document){const n=en(e);x.useEffect(()=>{const r=i=>{i.key==="Escape"&&n(i)};return t.addEventListener("keydown",r),()=>t.removeEventListener("keydown",r)},[n,t])}const Ob="dismissableLayer.update",PX="dismissableLayer.pointerDownOutside",IX="dismissableLayer.focusOutside";let NM;const RM=x.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Af=x.forwardRef((e,t)=>{var n;const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:a,onDismiss:l,...c}=e,u=x.useContext(RM),[d,h]=x.useState(null),p=(n=d==null?void 0:d.ownerDocument)!==null&&n!==void 0?n:globalThis==null?void 0:globalThis.document,[,g]=x.useState({}),f=We(t,I=>h(I)),m=Array.from(u.layers),[w]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),b=m.indexOf(w),k=d?m.indexOf(d):-1,S=u.layersWithOutsidePointerEventsDisabled.size>0,C=k>=b,_=AX(I=>{const M=I.target,A=[...u.branches].some(L=>L.contains(M));!C||A||(o==null||o(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p),P=TX(I=>{const M=I.target;[...u.branches].some(A=>A.contains(M))||(s==null||s(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p);return EX(I=>{k===u.layers.size-1&&(i==null||i(I),!I.defaultPrevented&&l&&(I.preventDefault(),l()))},p),x.useEffect(()=>{if(d)return r&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(NM=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(d)),u.layers.add(d),FM(),()=>{r&&u.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=NM)}},[d,p,r,u]),x.useEffect(()=>()=>{d&&(u.layers.delete(d),u.layersWithOutsidePointerEventsDisabled.delete(d),FM())},[d,u]),x.useEffect(()=>{const I=()=>g({});return document.addEventListener(Ob,I),()=>document.removeEventListener(Ob,I)},[]),x.createElement(Fe.div,Z({},c,{ref:f,style:{pointerEvents:S?C?"auto":"none":void 0,...e.style},onFocusCapture:re(e.onFocusCapture,P.onFocusCapture),onBlurCapture:re(e.onBlurCapture,P.onBlurCapture),onPointerDownCapture:re(e.onPointerDownCapture,_.onPointerDownCapture)}))}),MX=x.forwardRef((e,t)=>{const n=x.useContext(RM),r=x.useRef(null),i=We(t,r);return x.useEffect(()=>{const o=r.current;if(o)return n.branches.add(o),()=>{n.branches.delete(o)}},[n.branches]),x.createElement(Fe.div,Z({},e,{ref:i}))});function AX(e,t=globalThis==null?void 0:globalThis.document){const n=en(e),r=x.useRef(!1),i=x.useRef(()=>{});return x.useEffect(()=>{const o=a=>{if(a.target&&!r.current){let c=function(){$M(PX,n,u,{discrete:!0})};var l=c;const u={originalEvent:a};a.pointerType==="touch"?(t.removeEventListener("click",i.current),i.current=c,t.addEventListener("click",i.current,{once:!0})):c()}else t.removeEventListener("click",i.current);r.current=!1},s=window.setTimeout(()=>{t.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(s),t.removeEventListener("pointerdown",o),t.removeEventListener("click",i.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function TX(e,t=globalThis==null?void 0:globalThis.document){const n=en(e),r=x.useRef(!1);return x.useEffect(()=>{const i=o=>{o.target&&!r.current&&$M(IX,n,{originalEvent:o},{discrete:!1})};return t.addEventListener("focusin",i),()=>t.removeEventListener("focusin",i)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function FM(){const e=new CustomEvent(Ob);document.dispatchEvent(e)}function $M(e,t,n,{discrete:r}){const i=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?jb(i,o):i.dispatchEvent(o)}const jX=Af,OX=MX,Tf=x.forwardRef((e,t)=>{var n;const{container:r=globalThis==null||(n=globalThis.document)===null||n===void 0?void 0:n.body,...i}=e;return r?gL.createPortal(x.createElement(Fe.div,Z({},i,{ref:t})),r):null}),Ds=globalThis!=null&&globalThis.document?x.useLayoutEffect:()=>{};function LX(e,t){return x.useReducer((n,r)=>t[n][r]??n,e)}const Rr=e=>{const{present:t,children:n}=e,r=DX(t),i=typeof n=="function"?n({present:r.isPresent}):x.Children.only(n),o=We(r.ref,i.ref);return typeof n=="function"||r.isPresent?x.cloneElement(i,{ref:o}):null};Rr.displayName="Presence";function DX(e){const[t,n]=x.useState(),r=x.useRef({}),i=x.useRef(e),o=x.useRef("none"),s=e?"mounted":"unmounted",[a,l]=LX(s,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return x.useEffect(()=>{const c=jf(r.current);o.current=a==="mounted"?c:"none"},[a]),Ds(()=>{const c=r.current,u=i.current;if(u!==e){const d=o.current,h=jf(c);e?l("MOUNT"):h==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&d!==h?"ANIMATION_OUT":"UNMOUNT"),i.current=e}},[e,l]),Ds(()=>{if(t){const c=d=>{const h=jf(r.current).includes(d.animationName);d.target===t&&h&&wa.flushSync(()=>l("ANIMATION_END"))},u=d=>{d.target===t&&(o.current=jf(r.current))};return t.addEventListener("animationstart",u),t.addEventListener("animationcancel",c),t.addEventListener("animationend",c),()=>{t.removeEventListener("animationstart",u),t.removeEventListener("animationcancel",c),t.removeEventListener("animationend",c)}}else l("ANIMATION_END")},[t,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:x.useCallback(c=>{c&&(r.current=getComputedStyle(c)),n(c)},[])}}function jf(e){return(e==null?void 0:e.animationName)||"none"}function Bo({prop:e,defaultProp:t,onChange:n=()=>{}}){const[r,i]=zX({defaultProp:t,onChange:n}),o=e!==void 0,s=o?e:r,a=en(n),l=x.useCallback(c=>{if(o){const u=typeof c=="function"?c(e):c;u!==e&&a(u)}else i(c)},[o,e,i,a]);return[s,l]}function zX({defaultProp:e,onChange:t}){const n=x.useState(e),[r]=n,i=x.useRef(r),o=en(t);return x.useEffect(()=>{i.current!==r&&(o(r),i.current=r)},[r,i,o]),n}const BM=x.forwardRef((e,t)=>x.createElement(Fe.span,Z({},e,{ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...e.style}}))),UM="ToastProvider",[Lb,NX,RX]=Mf("Toast"),[VM,kre]=si("Toast",[RX]),[FX,Of]=VM(UM),HM=e=>{const{__scopeToast:t,label:n="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:o=50,children:s}=e,[a,l]=x.useState(null),[c,u]=x.useState(0),d=x.useRef(!1),h=x.useRef(!1);return x.createElement(Lb.Provider,{scope:t},x.createElement(FX,{scope:t,label:n,duration:r,swipeDirection:i,swipeThreshold:o,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:x.useCallback(()=>u(p=>p+1),[]),onToastRemove:x.useCallback(()=>u(p=>p-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:h},s))};HM.propTypes={label(e){if(e.label&&typeof e.label=="string"&&!e.label.trim()){const t=`Invalid prop \`label\` supplied to \`${UM}\`. Expected non-empty \`string\`.`;return new Error(t)}return null}};const $X="ToastViewport",BX=["F8"],Db="toast.viewportPause",zb="toast.viewportResume",UX=x.forwardRef((e,t)=>{const{__scopeToast:n,hotkey:r=BX,label:i="Notifications ({hotkey})",...o}=e,s=Of($X,n),a=NX(n),l=x.useRef(null),c=x.useRef(null),u=x.useRef(null),d=x.useRef(null),h=We(t,d,s.onViewportChange),p=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),g=s.toastCount>0;x.useEffect(()=>{const m=w=>{var b;r.every(k=>w[k]||w.code===k)&&((b=d.current)===null||b===void 0||b.focus())};return document.addEventListener("keydown",m),()=>document.removeEventListener("keydown",m)},[r]),x.useEffect(()=>{const m=l.current,w=d.current;if(g&&m&&w){const b=()=>{if(!s.isClosePausedRef.current){const _=new CustomEvent(Db);w.dispatchEvent(_),s.isClosePausedRef.current=!0}},k=()=>{if(s.isClosePausedRef.current){const _=new CustomEvent(zb);w.dispatchEvent(_),s.isClosePausedRef.current=!1}},S=_=>{!m.contains(_.relatedTarget)&&k()},C=()=>{m.contains(document.activeElement)||k()};return m.addEventListener("focusin",b),m.addEventListener("focusout",S),m.addEventListener("pointermove",b),m.addEventListener("pointerleave",C),window.addEventListener("blur",b),window.addEventListener("focus",k),()=>{m.removeEventListener("focusin",b),m.removeEventListener("focusout",S),m.removeEventListener("pointermove",b),m.removeEventListener("pointerleave",C),window.removeEventListener("blur",b),window.removeEventListener("focus",k)}}},[g,s.isClosePausedRef]);const f=x.useCallback(({tabbingDirection:m})=>{const w=a().map(b=>{const k=b.ref.current,S=[k,...iG(k)];return m==="forwards"?S:S.reverse()});return(m==="forwards"?w.reverse():w).flat()},[a]);return x.useEffect(()=>{const m=d.current;if(m){const w=b=>{const k=b.altKey||b.ctrlKey||b.metaKey;if(b.key==="Tab"&&!k){const P=document.activeElement,I=b.shiftKey;if(b.target===m&&I){var S;(S=c.current)===null||S===void 0||S.focus();return}const M=f({tabbingDirection:I?"backwards":"forwards"}),A=M.findIndex(L=>L===P);if(Nb(M.slice(A+1)))b.preventDefault();else{var C,_;I?(C=c.current)===null||C===void 0||C.focus():(_=u.current)===null||_===void 0||_.focus()}}};return m.addEventListener("keydown",w),()=>m.removeEventListener("keydown",w)}},[a,f]),x.createElement(OX,{ref:l,role:"region","aria-label":i.replace("{hotkey}",p),tabIndex:-1,style:{pointerEvents:g?void 0:"none"}},g&&x.createElement(KM,{ref:c,onFocusFromOutsideViewport:()=>{const m=f({tabbingDirection:"forwards"});Nb(m)}}),x.createElement(Lb.Slot,{scope:n},x.createElement(Fe.ol,Z({tabIndex:-1},o,{ref:h}))),g&&x.createElement(KM,{ref:u,onFocusFromOutsideViewport:()=>{const m=f({tabbingDirection:"backwards"});Nb(m)}}))}),VX="ToastFocusProxy",KM=x.forwardRef((e,t)=>{const{__scopeToast:n,onFocusFromOutsideViewport:r,...i}=e,o=Of(VX,n);return x.createElement(BM,Z({"aria-hidden":!0,tabIndex:0},i,{ref:t,style:{position:"fixed"},onFocus:s=>{var a;const l=s.relatedTarget;!((a=o.viewport)!==null&&a!==void 0&&a.contains(l))&&r()}}))}),Lf="Toast",HX="toast.swipeStart",KX="toast.swipeMove",WX="toast.swipeCancel",YX="toast.swipeEnd",XX=x.forwardRef((e,t)=>{const{forceMount:n,open:r,defaultOpen:i,onOpenChange:o,...s}=e,[a=!0,l]=Bo({prop:r,defaultProp:i,onChange:o});return x.createElement(Rr,{present:n||a},x.createElement(WM,Z({open:a},s,{ref:t,onClose:()=>l(!1),onPause:en(e.onPause),onResume:en(e.onResume),onSwipeStart:re(e.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:re(e.onSwipeMove,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:re(e.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:re(e.onSwipeEnd,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),l(!1)})})))}),[GX,qX]=VM(Lf,{onClose(){}}),WM=x.forwardRef((e,t)=>{const{__scopeToast:n,type:r="foreground",duration:i,open:o,onClose:s,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:h,onSwipeEnd:p,...g}=e,f=Of(Lf,n),[m,w]=x.useState(null),b=We(t,j=>w(j)),k=x.useRef(null),S=x.useRef(null),C=i||f.duration,_=x.useRef(0),P=x.useRef(C),I=x.useRef(0),{onToastAdd:M,onToastRemove:A}=f,L=en(()=>{var j;m!=null&&m.contains(document.activeElement)&&((j=f.viewport)===null||j===void 0||j.focus()),s()}),z=x.useCallback(j=>{!j||j===1/0||(window.clearTimeout(I.current),_.current=new Date().getTime(),I.current=window.setTimeout(L,j))},[L]);x.useEffect(()=>{const j=f.viewport;if(j){const F=()=>{z(P.current),c==null||c()},R=()=>{const W=new Date().getTime()-_.current;P.current=P.current-W,window.clearTimeout(I.current),l==null||l()};return j.addEventListener(Db,R),j.addEventListener(zb,F),()=>{j.removeEventListener(Db,R),j.removeEventListener(zb,F)}}},[f.viewport,C,l,c,z]),x.useEffect(()=>{o&&!f.isClosePausedRef.current&&z(C)},[o,C,f.isClosePausedRef,z]),x.useEffect(()=>(M(),()=>A()),[M,A]);const $=x.useMemo(()=>m?qM(m):null,[m]);return f.viewport?x.createElement(x.Fragment,null,$&&x.createElement(ZX,{__scopeToast:n,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0},$),x.createElement(GX,{scope:n,onClose:L},wa.createPortal(x.createElement(Lb.ItemSlot,{scope:n},x.createElement(jX,{asChild:!0,onEscapeKeyDown:re(a,()=>{f.isFocusedToastEscapeKeyDownRef.current||L(),f.isFocusedToastEscapeKeyDownRef.current=!1})},x.createElement(Fe.li,Z({role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":f.swipeDirection},g,{ref:b,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:re(e.onKeyDown,j=>{j.key==="Escape"&&(a==null||a(j.nativeEvent),j.nativeEvent.defaultPrevented||(f.isFocusedToastEscapeKeyDownRef.current=!0,L()))}),onPointerDown:re(e.onPointerDown,j=>{j.button===0&&(k.current={x:j.clientX,y:j.clientY})}),onPointerMove:re(e.onPointerMove,j=>{if(!k.current)return;const F=j.clientX-k.current.x,R=j.clientY-k.current.y,W=!!S.current,V=["left","right"].includes(f.swipeDirection),D=["left","up"].includes(f.swipeDirection)?Math.min:Math.max,B=V?D(0,F):0,X=V?0:D(0,R),ie=j.pointerType==="touch"?10:2,ue={x:B,y:X},ge={originalEvent:j,delta:ue};W?(S.current=ue,Df(KX,d,ge,{discrete:!1})):ZM(ue,f.swipeDirection,ie)?(S.current=ue,Df(HX,u,ge,{discrete:!1}),j.target.setPointerCapture(j.pointerId)):(Math.abs(F)>ie||Math.abs(R)>ie)&&(k.current=null)}),onPointerUp:re(e.onPointerUp,j=>{const F=S.current,R=j.target;if(R.hasPointerCapture(j.pointerId)&&R.releasePointerCapture(j.pointerId),S.current=null,k.current=null,F){const W=j.currentTarget,V={originalEvent:j,delta:F};ZM(F,f.swipeDirection,f.swipeThreshold)?Df(YX,p,V,{discrete:!0}):Df(WX,h,V,{discrete:!0}),W.addEventListener("click",D=>D.preventDefault(),{once:!0})}})})))),f.viewport))):null});WM.propTypes={type(e){if(e.type&&!["foreground","background"].includes(e.type)){const t=`Invalid prop \`type\` supplied to \`${Lf}\`. Expected \`foreground | background\`.`;return new Error(t)}return null}};const ZX=e=>{const{__scopeToast:t,children:n,...r}=e,i=Of(Lf,t),[o,s]=x.useState(!1),[a,l]=x.useState(!1);return nG(()=>s(!0)),x.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:x.createElement(Tf,{asChild:!0},x.createElement(BM,r,o&&x.createElement(x.Fragment,null,i.label," ",n)))},QX=x.forwardRef((e,t)=>{const{__scopeToast:n,...r}=e;return x.createElement(Fe.div,Z({},r,{ref:t}))}),JX=x.forwardRef((e,t)=>{const{__scopeToast:n,...r}=e;return x.createElement(Fe.div,Z({},r,{ref:t}))}),eG="ToastAction",YM=x.forwardRef((e,t)=>{const{altText:n,...r}=e;return n?x.createElement(GM,{altText:n,asChild:!0},x.createElement(XM,Z({},r,{ref:t}))):null});YM.propTypes={altText(e){return e.altText?null:new Error(`Missing prop \`altText\` expected on \`${eG}\``)}};const tG="ToastClose",XM=x.forwardRef((e,t)=>{const{__scopeToast:n,...r}=e,i=qX(tG,n);return x.createElement(GM,{asChild:!0},x.createElement(Fe.button,Z({type:"button"},r,{ref:t,onClick:re(e.onClick,i.onClose)})))}),GM=x.forwardRef((e,t)=>{const{__scopeToast:n,altText:r,...i}=e;return x.createElement(Fe.div,Z({"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0},i,{ref:t}))});function qM(e){const t=[];return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&t.push(n.textContent),rG(n)){const r=n.ariaHidden||n.hidden||n.style.display==="none",i=n.dataset.radixToastAnnounceExclude==="";if(!r)if(i){const o=n.dataset.radixToastAnnounceAlt;o&&t.push(o)}else t.push(...qM(n))}}),t}function Df(e,t,n,{discrete:r}){const i=n.originalEvent.currentTarget,o=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?jb(i,o):i.dispatchEvent(o)}const ZM=(e,t,n=0)=>{const r=Math.abs(e.x),i=Math.abs(e.y),o=r>i;return t==="left"||t==="right"?o&&r>n:!o&&i>n};function nG(e=()=>{}){const t=en(e);Ds(()=>{let n=0,r=0;return n=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(r)}},[t])}function rG(e){return e.nodeType===e.ELEMENT_NODE}function iG(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function Nb(e){const t=document.activeElement;return e.some(n=>n===t?!0:(n.focus(),document.activeElement!==t))}const oG=XX,sG=QX,aG=JX,lG=YM,QM=XM,zs="2.0.0-beta.2";let Rb={fonts:{draw:`https://unpkg.com/@tldraw/assets@${zs}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`https://unpkg.com/@tldraw/assets@${zs}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`https://unpkg.com/@tldraw/assets@${zs}/fonts/IBMPlexSans-Medium.woff2`,monospace:`https://unpkg.com/@tldraw/assets@${zs}/fonts/IBMPlexMono-Medium.woff2`}};function cG(e){return x.useMemo(()=>e?{fonts:{...Rb.fonts,...e==null?void 0:e.fonts}}:Rb,[e])}const uG=["align-bottom-center","align-bottom-left","align-bottom-right","align-bottom","align-center-center","align-center-horizontal","align-center-left","align-center-right","align-center-vertical","align-left","align-right","align-top-center","align-top-left","align-top-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","aspect-ratio","avatar","blob","bring-forward","bring-to-front","check","checkbox-checked","checkbox-empty","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","collab","color","comment","cross-2","cross","dash-dashed","dash-dotted","dash-draw","dash-solid","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","file","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","hidden","image","info-circle","leading","link","lock-small","lock","menu","minus","mixed","pack","page","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","ruler","search","send-backward","send-to-back","settings-horizontal","settings-vertical-1","settings-vertical","share-1","share-2","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","status-online","stretch-horizontal","stretch-vertical","text-align-center","text-align-justify","text-align-left","text-align-right","tool-arrow","tool-embed","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-text","trash","triangle-down","triangle-up","twitter","undo","ungroup","unlock-small","unlock","vertical-align-center","vertical-align-end","vertical-align-start","visible","warning-triangle","zoom-in","zoom-out"];let Su={...Rb,icons:Object.fromEntries(uG.map(e=>[e,`https://unpkg.com/@tldraw/assets@${zs}/icons/icon/${e}.svg`])),translations:Object.fromEntries(jc.map(e=>[e.locale,`https://unpkg.com/@tldraw/assets@${zs}/translations/${e.locale}.json`])),embedIcons:Object.fromEntries(Aa.map(e=>[e.type,`https://unpkg.com/@tldraw/assets@${zs}/embed-icons/${e.type}.png`]))};function dG(e){return e?{fonts:Object.assign({...Su.fonts},{...e==null?void 0:e.fonts}),icons:Object.assign({...Su.icons},{...e==null?void 0:e.icons}),embedIcons:Object.assign({...Su.embedIcons},{...e==null?void 0:e.embedIcons}),translations:Object.assign({...Su.translations},{...e==null?void 0:e.translations})}:Su}function hG(e,t){const n=he(t.map(i=>e.getShape(i)).filter(i=>i&&e.isShapeOfType(i,"frame")));if(!n.length)return;const r=[];e.batch(()=>{n.map(i=>{const o=e.getSortedChildIdsForParent(i.id);o.length&&(e.reparentShapes(o,i.parentId,i.index),r.push(...o))}),e.setSelectedShapes(r),e.deleteShapes(t)})}const pG=50;function fG(e,t,n={}){const r=e.getShape(t);if(!r)return;const i=e.getSortedChildIdsForParent(r.id),o=he(i.map(p=>e.getShape(p)));if(!o.length)return;const s=se.FromPoints(o.flatMap(p=>{const g=e.getShapeGeometry(p.id);return e.getShapeLocalTransform(p).applyToPoints(g.vertices)})),{padding:a=pG}=n,l=s.w+2*a,c=s.h+2*a,u=a-s.minX,d=a-s.minY;if(u===0&&d===0&&r.props.w===l&&r.props.h===c)return;const h=new E(u,d).rot(r.rotation);e.batch(()=>{const p=i.map(g=>{const f=e.getShape(g);return{id:f.id,type:f.type,x:f.x+u,y:f.y+d}});p.push({id:r.id,type:r.type,x:r.x-h.x,y:r.y-h.y,props:{w:l,h:c}}),e.updateShapes(p)})}const JM=x.createContext(null);function gG({assetUrls:e,children:t}){return y.jsx(JM.Provider,{value:e,children:t})}function Fb(){const e=x.useContext(JM);if(!e)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return e}const $b={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy share link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy read-only link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to view (but not edit) this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},ul={locale:"en",label:"English",messages:$b};async function mG(e,t){if(!(await fetch(t.translations.en)).ok)return console.warn("No main translations found."),ul;if(e==="en")return ul;const n=jc.find(o=>o.locale===e);if(!n)return console.warn(`No translation found for locale ${e}`),ul;const r=await(await fetch(t.translations[n.locale])).json();if(!r)return console.warn(`No messages found for locale ${e}`),ul;const i=[];for(const o in ul.messages)r[o]||i.push(o);return i.length>0,{locale:e,label:n.label,messages:{...ul.messages,...r}}}const eA=x.createContext({}),yG=()=>x.useContext(eA),vG=Pe(function({overrides:e,children:t}){const n=H().user.getLocale(),r=Fb(),[i,o]=x.useState(()=>e&&e.en?{locale:"en",label:"English",messages:{...$b,...e.en}}:{locale:"en",label:"English",messages:$b});return x.useEffect(()=>{let s=!1;async function a(){const l=await mG(n,r);l&&!s&&(e&&e[n]?o({...l,messages:{...l.messages,...e[n]}}):o(l))}return a(),()=>{s=!0}},[r,n,e]),y.jsx(eA.Provider,{value:i,children:t})});function Se(){const e=yG();return x.useCallback(function(t){return e.messages[t]??t},[e])}function bG(e){return y.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...e,children:y.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[y.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),y.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:y.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const Wn=x.memo(function({small:e,invertIcon:t,icon:n,color:r,className:i,...o}){const s=Fb(),a=s.icons[n]??s.icons["question-mark-circle"],l=x.useRef(null);return x.useLayoutEffect(()=>{a||console.error(`Icon not found: ${n}. Add it to the assetUrls.icons object.`),l!=null&&l.current&&(l.current.style.webkitMask=`url(${a}) center 100% / 100% no-repeat`)},[l,a,n]),y.jsx("div",{...o,ref:l,className:pe("tlui-icon",{"tlui-icon__small":e},i),style:{color:r,mask:`url(${a}) center 100% / 100% no-repeat`,transform:t?"scale(-1, 1)":void 0}})}),tA=typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,nA=tA?"\u2318":"Ctrl",rA=tA?"\u2325":"Alt";function wG(e){return e.split(",")[0].split("").map(t=>{const n=t.replace(/\$/g,nA).replace(/\?/g,rA).replace(/!/g,"\u21E7");return n[0].toUpperCase()+n.slice(1)})}function ai(e){return"\u2014 "+e.split(",")[0].split("").map(t=>{const n=t.replace(/\$/g,nA).replace(/\?/g,rA).replace(/!/g,"\u21E7");return n[0].toUpperCase()+n.slice(1)}).join("\u2009")}function zf({children:e}){return y.jsx("kbd",{className:"tlui-kbd",children:wG(e).map((t,n)=>y.jsx("span",{children:t},n))})}const oe=x.forwardRef(function({label:e,icon:t,invertIcon:n,iconLeft:r,smallIcon:i,kbd:o,isChecked:s=!1,type:a,children:l,spinner:c,...u},d){const h=Se(),p=e?h(e):"";return y.jsxs("button",{ref:d,draggable:!1,type:"button",...u,title:u.title??p,className:pe("tlui-button",`tlui-button__${a}`,u.className),children:[r&&y.jsx(Wn,{icon:r,className:"tlui-button__icon-left",small:!0}),l,e&&y.jsxs("span",{className:"tlui-button__label",draggable:!1,children:[p,s&&y.jsx(Wn,{icon:"check"})]}),o&&y.jsx(zf,{children:o}),t&&!c&&y.jsx(Wn,{icon:t,small:!!e||i,invertIcon:n}),c&&y.jsx(bG,{})]})}),xG=oO["useId".toString()]||(()=>{});let SG=0;function Ki(e){const[t,n]=x.useState(xG());return Ds(()=>{e||n(r=>r??String(SG++))},[e]),e||(t?`radix-${t}`:"")}const Bb="focusScope.autoFocusOnMount",Ub="focusScope.autoFocusOnUnmount",iA={bubbles:!1,cancelable:!0},Vb=x.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...s}=e,[a,l]=x.useState(null),c=en(i),u=en(o),d=x.useRef(null),h=We(t,f=>l(f)),p=x.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;x.useEffect(()=>{if(r){let b=function(_){if(p.paused||!a)return;const P=_.target;a.contains(P)?d.current=P:Uo(d.current,{select:!0})},k=function(_){if(p.paused||!a)return;const P=_.relatedTarget;P!==null&&(a.contains(P)||Uo(d.current,{select:!0}))},S=function(_){if(document.activeElement===document.body)for(const P of _)P.removedNodes.length>0&&Uo(a)};var f=b,m=k,w=S;document.addEventListener("focusin",b),document.addEventListener("focusout",k);const C=new MutationObserver(S);return a&&C.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",b),document.removeEventListener("focusout",k),C.disconnect()}}},[r,a,p.paused]),x.useEffect(()=>{if(a){aA.add(p);const f=document.activeElement;if(!a.contains(f)){const m=new CustomEvent(Bb,iA);a.addEventListener(Bb,c),a.dispatchEvent(m),m.defaultPrevented||(kG(IG(oA(a)),{select:!0}),document.activeElement===f&&Uo(a))}return()=>{a.removeEventListener(Bb,c),setTimeout(()=>{const m=new CustomEvent(Ub,iA);a.addEventListener(Ub,u),a.dispatchEvent(m),m.defaultPrevented||Uo(f??document.body,{select:!0}),a.removeEventListener(Ub,u),aA.remove(p)},0)}}},[a,c,u,p]);const g=x.useCallback(f=>{if(!n&&!r||p.paused)return;const m=f.key==="Tab"&&!f.altKey&&!f.ctrlKey&&!f.metaKey,w=document.activeElement;if(m&&w){const b=f.currentTarget,[k,S]=_G(b);k&&S?!f.shiftKey&&w===S?(f.preventDefault(),n&&Uo(k,{select:!0})):f.shiftKey&&w===k&&(f.preventDefault(),n&&Uo(S,{select:!0})):w===b&&f.preventDefault()}},[n,r,p.paused]);return x.createElement(Fe.div,Z({tabIndex:-1},s,{ref:h,onKeyDown:g}))});function kG(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(Uo(r,{select:t}),document.activeElement!==n)return}function _G(e){const t=oA(e),n=sA(t,e),r=sA(t.reverse(),e);return[n,r]}function oA(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function sA(e,t){for(const n of e)if(!CG(n,{upTo:t}))return n}function CG(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function EG(e){return e instanceof HTMLInputElement&&"select"in e}function Uo(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&EG(e)&&t&&e.select()}}const aA=PG();function PG(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=lA(e,t),e.unshift(t)},remove(t){var n;e=lA(e,t),(n=e[0])===null||n===void 0||n.resume()}}}function lA(e,t){const n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function IG(e){return e.filter(t=>t.tagName!=="A")}let Hb=0;function Kb(){x.useEffect(()=>{var e,t;const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(e=n[0])!==null&&e!==void 0?e:cA()),document.body.insertAdjacentElement("beforeend",(t=n[1])!==null&&t!==void 0?t:cA()),Hb++,()=>{Hb===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(r=>r.remove()),Hb--}},[])}function cA(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}var li=function(){return li=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},li.apply(this,arguments)};function uA(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function MG(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,o;r<i;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}var Nf="right-scroll-bar-position",Rf="width-before-scroll-bar",AG="with-scroll-bars-hidden",TG="--removed-body-scroll-bar-size";function Wb(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function jG(e,t){var n=x.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(r){var i=n.value;i!==r&&(n.value=r,n.callback(r,i))}}}})[0];return n.callback=t,n.facade}var dA=new WeakMap;function OG(e,t){var n=jG(t||null,function(r){return e.forEach(function(i){return Wb(i,r)})});return x.useLayoutEffect(function(){var r=dA.get(n);if(r){var i=new Set(r),o=new Set(e),s=n.current;i.forEach(function(a){o.has(a)||Wb(a,null)}),o.forEach(function(a){i.has(a)||Wb(a,s)})}dA.set(n,e)},[e]),n}function LG(e){return e}function DG(e,t){t===void 0&&(t=LG);var n=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(o){var s=t(o,r);return n.push(s),function(){n=n.filter(function(a){return a!==s})}},assignSyncMedium:function(o){for(r=!0;n.length;){var s=n;n=[],s.forEach(o)}n={push:function(a){return o(a)},filter:function(){return n}}},assignMedium:function(o){r=!0;var s=[];if(n.length){var a=n;n=[],a.forEach(o),s=n}var l=function(){var u=s;s=[],u.forEach(o)},c=function(){return Promise.resolve().then(l)};c(),n={push:function(u){s.push(u),c()},filter:function(u){return s=s.filter(u),n}}}};return i}function zG(e){e===void 0&&(e={});var t=DG(null);return t.options=li({async:!0,ssr:!1},e),t}var hA=function(e){var t=e.sideCar,n=uA(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw new Error("Sidecar medium not found");return x.createElement(r,li({},n))};hA.isSideCarExport=!0;function NG(e,t){return e.useMedium(t),hA}var pA=zG(),Yb=function(){},Ff=x.forwardRef(function(e,t){var n=x.useRef(null),r=x.useState({onScrollCapture:Yb,onWheelCapture:Yb,onTouchMoveCapture:Yb}),i=r[0],o=r[1],s=e.forwardProps,a=e.children,l=e.className,c=e.removeScrollBar,u=e.enabled,d=e.shards,h=e.sideCar,p=e.noIsolation,g=e.inert,f=e.allowPinchZoom,m=e.as,w=m===void 0?"div":m,b=uA(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),k=h,S=OG([n,t]),C=li(li({},b),i);return x.createElement(x.Fragment,null,u&&x.createElement(k,{sideCar:pA,removeScrollBar:c,shards:d,noIsolation:p,inert:g,setCallbacks:o,allowPinchZoom:!!f,lockRef:n}),s?x.cloneElement(x.Children.only(a),li(li({},C),{ref:S})):x.createElement(w,li({},C,{className:l,ref:S}),a))});Ff.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},Ff.classNames={fullWidth:Rf,zeroRight:Nf};var fA,RG=function(){if(fA)return fA;if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function FG(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=RG();return t&&e.setAttribute("nonce",t),e}function $G(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function BG(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var UG=function(){var e=0,t=null;return{add:function(n){e==0&&(t=FG())&&($G(t,n),BG(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},VG=function(){var e=UG();return function(t,n){x.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},gA=function(){var e=VG(),t=function(n){var r=n.styles,i=n.dynamic;return e(r,i),null};return t},HG={left:0,top:0,right:0,gap:0},Xb=function(e){return parseInt(e||"",10)||0},KG=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],r=t[e==="padding"?"paddingTop":"marginTop"],i=t[e==="padding"?"paddingRight":"marginRight"];return[Xb(n),Xb(r),Xb(i)]},WG=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return HG;var t=KG(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},YG=gA(),XG=function(e,t,n,r){var i=e.left,o=e.top,s=e.right,a=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(AG,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(s,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Nf,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Rf,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Nf," .").concat(Nf,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(Rf," .").concat(Rf,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body {
    `).concat(TG,": ").concat(a,`px;
  }
`)},GG=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,i=r===void 0?"margin":r,o=x.useMemo(function(){return WG(i)},[i]);return x.createElement(YG,{styles:XG(o,!t,i,n?"":"!important")})},Gb=!1;if(typeof window<"u")try{var $f=Object.defineProperty({},"passive",{get:function(){return Gb=!0,!0}});window.addEventListener("test",$f,$f),window.removeEventListener("test",$f,$f)}catch{Gb=!1}var dl=Gb?{passive:!1}:!1,qG=function(e){return e.tagName==="TEXTAREA"},mA=function(e,t){var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!qG(e)&&n[t]==="visible")},ZG=function(e){return mA(e,"overflowY")},QG=function(e){return mA(e,"overflowX")},yA=function(e,t){var n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var r=vA(e,n);if(r){var i=bA(e,n),o=i[1],s=i[2];if(o>s)return!0}n=n.parentNode}while(n&&n!==document.body);return!1},JG=function(e){var t=e.scrollTop,n=e.scrollHeight,r=e.clientHeight;return[t,n,r]},eq=function(e){var t=e.scrollLeft,n=e.scrollWidth,r=e.clientWidth;return[t,n,r]},vA=function(e,t){return e==="v"?ZG(t):QG(t)},bA=function(e,t){return e==="v"?JG(t):eq(t)},tq=function(e,t){return e==="h"&&t==="rtl"?-1:1},nq=function(e,t,n,r,i){var o=tq(e,window.getComputedStyle(t).direction),s=o*r,a=n.target,l=t.contains(a),c=!1,u=s>0,d=0,h=0;do{var p=bA(e,a),g=p[0],f=p[1],m=p[2],w=f-m-o*g;(g||w)&&vA(e,a)&&(d+=w,h+=g),a=a.parentNode}while(!l&&a!==document.body||l&&(t.contains(a)||t===a));return(u&&(i&&d===0||!i&&s>d)||!u&&(i&&h===0||!i&&-s>h))&&(c=!0),c},Bf=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},wA=function(e){return[e.deltaX,e.deltaY]},xA=function(e){return e&&"current"in e?e.current:e},rq=function(e,t){return e[0]===t[0]&&e[1]===t[1]},iq=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},oq=0,hl=[];function sq(e){var t=x.useRef([]),n=x.useRef([0,0]),r=x.useRef(),i=x.useState(oq++)[0],o=x.useState(function(){return gA()})[0],s=x.useRef(e);x.useEffect(function(){s.current=e},[e]),x.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(i));var f=MG([e.lockRef.current],(e.shards||[]).map(xA),!0).filter(Boolean);return f.forEach(function(m){return m.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),f.forEach(function(m){return m.classList.remove("allow-interactivity-".concat(i))})}}},[e.inert,e.lockRef.current,e.shards]);var a=x.useCallback(function(f,m){if("touches"in f&&f.touches.length===2)return!s.current.allowPinchZoom;var w=Bf(f),b=n.current,k="deltaX"in f?f.deltaX:b[0]-w[0],S="deltaY"in f?f.deltaY:b[1]-w[1],C,_=f.target,P=Math.abs(k)>Math.abs(S)?"h":"v";if("touches"in f&&P==="h"&&_.type==="range")return!1;var I=yA(P,_);if(!I)return!0;if(I?C=P:(C=P==="v"?"h":"v",I=yA(P,_)),!I)return!1;if(!r.current&&"changedTouches"in f&&(k||S)&&(r.current=C),!C)return!0;var M=r.current||C;return nq(M,m,f,M==="h"?k:S,!0)},[]),l=x.useCallback(function(f){var m=f;if(!(!hl.length||hl[hl.length-1]!==o)){var w="deltaY"in m?wA(m):Bf(m),b=t.current.filter(function(C){return C.name===m.type&&C.target===m.target&&rq(C.delta,w)})[0];if(b&&b.should){m.cancelable&&m.preventDefault();return}if(!b){var k=(s.current.shards||[]).map(xA).filter(Boolean).filter(function(C){return C.contains(m.target)}),S=k.length>0?a(m,k[0]):!s.current.noIsolation;S&&m.cancelable&&m.preventDefault()}}},[]),c=x.useCallback(function(f,m,w,b){var k={name:f,delta:m,target:w,should:b};t.current.push(k),setTimeout(function(){t.current=t.current.filter(function(S){return S!==k})},1)},[]),u=x.useCallback(function(f){n.current=Bf(f),r.current=void 0},[]),d=x.useCallback(function(f){c(f.type,wA(f),f.target,a(f,e.lockRef.current))},[]),h=x.useCallback(function(f){c(f.type,Bf(f),f.target,a(f,e.lockRef.current))},[]);x.useEffect(function(){return hl.push(o),e.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,dl),document.addEventListener("touchmove",l,dl),document.addEventListener("touchstart",u,dl),function(){hl=hl.filter(function(f){return f!==o}),document.removeEventListener("wheel",l,dl),document.removeEventListener("touchmove",l,dl),document.removeEventListener("touchstart",u,dl)}},[]);var p=e.removeScrollBar,g=e.inert;return x.createElement(x.Fragment,null,g?x.createElement(o,{styles:iq(i)}):null,p?x.createElement(GG,{gapMode:"margin"}):null)}const aq=NG(pA,sq);var SA=x.forwardRef(function(e,t){return x.createElement(Ff,li({},e,{ref:t,sideCar:aq}))});SA.classNames=Ff.classNames;const qb=SA;var lq=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},pl=new WeakMap,Uf=new WeakMap,Vf={},Zb=0,kA=function(e){return e&&(e.host||kA(e.parentNode))},cq=function(e,t){return t.map(function(n){if(e.contains(n))return n;var r=kA(n);return r&&e.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},uq=function(e,t,n,r){var i=cq(t,Array.isArray(e)?e:[e]);Vf[n]||(Vf[n]=new WeakMap);var o=Vf[n],s=[],a=new Set,l=new Set(i),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};i.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(h){if(a.has(h))u(h);else{var p=h.getAttribute(r),g=p!==null&&p!=="false",f=(pl.get(h)||0)+1,m=(o.get(h)||0)+1;pl.set(h,f),o.set(h,m),s.push(h),f===1&&g&&Uf.set(h,!0),m===1&&h.setAttribute(n,"true"),g||h.setAttribute(r,"true")}})};return u(t),a.clear(),Zb++,function(){s.forEach(function(d){var h=pl.get(d)-1,p=o.get(d)-1;pl.set(d,h),o.set(d,p),h||(Uf.has(d)||d.removeAttribute(r),Uf.delete(d)),p||d.removeAttribute(n)}),Zb--,Zb||(pl=new WeakMap,pl=new WeakMap,Uf=new WeakMap,Vf={})}},Qb=function(e,t,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),i=t||lq(e);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),uq(r,i,n,"aria-hidden")):function(){return null}};const _A="Dialog",[CA,_re]=si(_A),[dq,Wi]=CA(_A),hq=e=>{const{__scopeDialog:t,children:n,open:r,defaultOpen:i,onOpenChange:o,modal:s=!0}=e,a=x.useRef(null),l=x.useRef(null),[c=!1,u]=Bo({prop:r,defaultProp:i,onChange:o});return x.createElement(dq,{scope:t,triggerRef:a,contentRef:l,contentId:Ki(),titleId:Ki(),descriptionId:Ki(),open:c,onOpenChange:u,onOpenToggle:x.useCallback(()=>u(d=>!d),[u]),modal:s},n)},EA="DialogPortal",[pq,PA]=CA(EA,{forceMount:void 0}),fq=e=>{const{__scopeDialog:t,forceMount:n,children:r,container:i}=e,o=Wi(EA,t);return x.createElement(pq,{scope:t,forceMount:n},x.Children.map(r,s=>x.createElement(Rr,{present:n||o.open},x.createElement(Tf,{asChild:!0,container:i},s))))},Jb="DialogOverlay",gq=x.forwardRef((e,t)=>{const n=PA(Jb,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=Wi(Jb,e.__scopeDialog);return o.modal?x.createElement(Rr,{present:r||o.open},x.createElement(mq,Z({},i,{ref:t}))):null}),mq=x.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,i=Wi(Jb,n);return x.createElement(qb,{as:Ls,allowPinchZoom:!0,shards:[i.contentRef]},x.createElement(Fe.div,Z({"data-state":MA(i.open)},r,{ref:t,style:{pointerEvents:"auto",...r.style}})))}),ku="DialogContent",yq=x.forwardRef((e,t)=>{const n=PA(ku,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=Wi(ku,e.__scopeDialog);return x.createElement(Rr,{present:r||o.open},o.modal?x.createElement(vq,Z({},i,{ref:t})):x.createElement(bq,Z({},i,{ref:t})))}),vq=x.forwardRef((e,t)=>{const n=Wi(ku,e.__scopeDialog),r=x.useRef(null),i=We(t,n.contentRef,r);return x.useEffect(()=>{const o=r.current;if(o)return Qb(o)},[]),x.createElement(IA,Z({},e,{ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:re(e.onCloseAutoFocus,o=>{var s;o.preventDefault(),(s=n.triggerRef.current)===null||s===void 0||s.focus()}),onPointerDownOutside:re(e.onPointerDownOutside,o=>{const s=o.detail.originalEvent,a=s.button===0&&s.ctrlKey===!0;(s.button===2||a)&&o.preventDefault()}),onFocusOutside:re(e.onFocusOutside,o=>o.preventDefault())}))}),bq=x.forwardRef((e,t)=>{const n=Wi(ku,e.__scopeDialog),r=x.useRef(!1),i=x.useRef(!1);return x.createElement(IA,Z({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var s;if((s=e.onCloseAutoFocus)===null||s===void 0||s.call(e,o),!o.defaultPrevented){var a;r.current||(a=n.triggerRef.current)===null||a===void 0||a.focus(),o.preventDefault()}r.current=!1,i.current=!1},onInteractOutside:o=>{var s,a;(s=e.onInteractOutside)===null||s===void 0||s.call(e,o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const l=o.target;!((a=n.triggerRef.current)===null||a===void 0)&&a.contains(l)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&i.current&&o.preventDefault()}}))}),IA=x.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,...s}=e,a=Wi(ku,n),l=x.useRef(null),c=We(t,l);return Kb(),x.createElement(x.Fragment,null,x.createElement(Vb,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o},x.createElement(Af,Z({role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":MA(a.open)},s,{ref:c,onDismiss:()=>a.onOpenChange(!1)}))),!1)}),wq="DialogTitle",xq=x.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,i=Wi(wq,n);return x.createElement(Fe.h2,Z({id:i.titleId},r,{ref:t}))}),Sq="DialogClose",kq=x.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,i=Wi(Sq,n);return x.createElement(Fe.button,Z({type:"button"},r,{ref:t,onClick:re(e.onClick,()=>i.onOpenChange(!1))}))});function MA(e){return e?"open":"closed"}const _q=hq,Cq=fq,Eq=gq,Pq=yq;function Hf({className:e,children:t}){return y.jsx("div",{className:pe("tlui-dialog__header",e),children:t})}function Kf({className:e,children:t}){return y.jsx(xq,{dir:"ltr",className:pe("tlui-dialog__header__title",e),children:t})}function Wf(){return y.jsx("div",{className:"tlui-dialog__header__close",children:y.jsx(kq,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:y.jsx(oe,{type:"icon","aria-label":"Close",onTouchEnd:e=>e.target.click(),children:y.jsx(Wn,{small:!0,icon:"cross-2"})})})})}function _u({className:e,children:t,style:n}){return y.jsx("div",{className:pe("tlui-dialog__body",e),style:n,children:t})}function e1({className:e,children:t}){return y.jsx("div",{className:pe("tlui-dialog__footer",e),children:t})}const t1=x.forwardRef(function({className:e,label:t,icon:n,iconLeft:r,autoselect:i=!1,autofocus:o=!1,defaultValue:s,placeholder:a,onComplete:l,onValueChange:c,onCancel:u,onBlur:d,shouldManuallyMaintainScrollPositionWhenFocused:h=!1,children:p,value:g},f){const m=H(),w=x.useRef(null);x.useImperativeHandle(f,()=>w.current);const b=Se(),k=x.useRef(s??""),S=x.useRef(s??""),[C,_]=x.useState(!1),P=x.useCallback(L=>{_(!0);const z=L.currentTarget;S.current=z.value,requestAnimationFrame(()=>{i&&z.select()})},[i]),I=x.useCallback(L=>{const z=L.currentTarget.value;S.current=z,c==null||c(z)},[c]),M=x.useCallback(L=>{switch(L.key){case"Enter":{L.currentTarget.blur(),St(L),l==null||l(L.currentTarget.value);break}case"Escape":{L.currentTarget.value=k.current,L.currentTarget.blur(),St(L),u==null||u(L.currentTarget.value);break}}},[l,u]),A=x.useCallback(L=>{_(!1);const z=L.currentTarget.value;d==null||d(z)},[d]);return x.useEffect(()=>{if(!m.environment.isIos)return;const L=window.visualViewport;if(C&&h&&L){const z=()=>{var $;($=w.current)==null||$.scrollIntoView({block:"center"})};return L.addEventListener("resize",z),L.addEventListener("scroll",z),requestAnimationFrame(()=>{var $;($=w.current)==null||$.scrollIntoView({block:"center"})}),()=>{L.removeEventListener("resize",z),L.removeEventListener("scroll",z)}}},[m,C,h]),y.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[p,t&&y.jsx("label",{children:b(t)}),r&&y.jsx(Wn,{icon:r,className:"tlui-icon-left",small:!0}),y.jsx("input",{ref:w,className:pe("tlui-input",e),type:"text",defaultValue:s,onKeyUp:M,onChange:I,onFocus:P,onBlur:A,autoFocus:o,placeholder:a,value:g}),n&&y.jsx(Wn,{icon:n,small:!!t})]})});function AA(e){return Fn.isValid(e)?{isValid:!0,hasProtocol:!0}:Fn.isValid("https://"+e)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const Iq=Pe(function({onClose:e}){const t=H().getOnlySelectedShape();return t&&"url"in t.props&&typeof t.props.url=="string"?y.jsx(Mq,{onClose:e,selectedShape:t}):null}),Mq=Pe(function({onClose:e,selectedShape:t}){const n=H(),r=Se(),i=x.useRef(null);x.useEffect(()=>{requestAnimationFrame(()=>{var p;return(p=i.current)==null?void 0:p.focus()})},[]);const o=x.useRef(t.props.url),[s,a]=x.useState(()=>{const p=AA(t.props.url),g=p.isValid===!0?p.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:g,safe:g,valid:!0}}),l=x.useCallback(p=>{const g=p.replace(/https?:\/\/(https?:\/\/)/,(w,b)=>b),f=AA(g),m=f.isValid===!0?f.hasProtocol?g:"https://"+g:"https://";a({actual:g,safe:m,valid:f.isValid})},[]),c=x.useCallback(()=>{const p=n.getOnlySelectedShape();p&&(n.updateShapes([{id:p.id,type:p.type,props:{url:""}}]),e())},[n,e]),u=x.useCallback(()=>{const p=n.getOnlySelectedShape();p&&(p&&"url"in p.props&&p.props.url!==s.safe&&n.updateShapes([{id:p.id,type:p.type,props:{url:s.safe}}]),e())},[n,e,s]),d=x.useCallback(()=>{e()},[e]);if(!t)return e(),null;const h=o.current&&!s.valid;return y.jsxs(y.Fragment,{children:[y.jsxs(Hf,{children:[y.jsx(Kf,{children:r("edit-link-dialog.title")}),y.jsx(Wf,{})]}),y.jsx(_u,{children:y.jsxs("div",{className:"tlui-edit-link-dialog",children:[y.jsx(t1,{ref:i,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autofocus:!0,value:s.actual,onValueChange:l,onComplete:u,onCancel:d}),y.jsx("div",{children:s.valid?r("edit-link-dialog.detail"):r("edit-link-dialog.invalid-url")})]})}),y.jsxs(e1,{className:"tlui-dialog__footer__actions",children:[y.jsx(oe,{type:"normal",onClick:d,onTouchEnd:d,children:r("edit-link-dialog.cancel")}),h?y.jsx(oe,{type:"danger",onTouchEnd:c,onClick:c,children:r("edit-link-dialog.clear")}):y.jsx(oe,{type:"primary",disabled:!s.valid,onTouchEnd:u,onClick:u,children:r("edit-link-dialog.save")})]})]})}),TA=Pe(function({onClose:e}){const t=H(),n=Se(),r=Fb(),[i,o]=x.useState(null),[s,a]=x.useState(""),[l,c]=x.useState(null),[u,d]=x.useState(!1),h=x.useRef(-1);return y.jsxs(y.Fragment,{children:[y.jsxs(Hf,{children:[y.jsx(Kf,{children:i?`${n("embed-dialog.title")} \u2014 ${i.title}`:n("embed-dialog.title")}),y.jsx(Wf,{})]}),i?y.jsxs(y.Fragment,{children:[y.jsxs(_u,{className:"tlui-embed-dialog__enter",children:[y.jsx(t1,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autofocus:!0,onValueChange:p=>{a(p);const g=Vi(p);c(g&&g.definition.type===i.type?g:null),d(!1),clearTimeout(h.current),h.current=setTimeout(()=>d(!g),320)}}),s===""?y.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[y.jsx("span",{children:n("embed-dialog.instruction")})," ",i.instructionLink&&y.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:i.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",y.jsx(Wn,{icon:"external-link",small:!0})]})]}):y.jsx("div",{className:"tlui-embed-dialog__warning",children:u?n("embed-dialog.invalid-url"):"\xA0"})]}),y.jsxs(e1,{className:"tlui-dialog__footer__actions",children:[y.jsx(oe,{type:"normal",onClick:()=>{o(null),c(null),a("")},label:"embed-dialog.back"}),y.jsx("div",{className:"tlui-embed__spacer"}),y.jsx(oe,{type:"normal",label:"embed-dialog.cancel",onClick:e}),y.jsx(oe,{type:"primary",disabled:!l,label:"embed-dialog.create",onClick:()=>{l&&(t.putExternalContent({type:"embed",url:s,point:t.getViewportPageCenter(),embed:l.definition}),e())}})]})]}):y.jsx(y.Fragment,{children:y.jsx(_u,{className:"tlui-embed-dialog__list",children:Aa.map(p=>y.jsx(oe,{type:"menu",onClick:()=>o(p),label:p.title,children:y.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${r.embedIcons[p.type]})`}})},p.type))})})]})});var n1={exports:{}};n1.exports,function(e){var t=function(){var n=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function s(l,c){if(!o[l]){o[l]={};for(var u=0;u<l.length;u++)o[l][l.charAt(u)]=u}return o[l][c]}var a={compressToBase64:function(l){if(l==null)return"";var c=a._compress(l,6,function(u){return r.charAt(u)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(l){return l==null?"":l==""?null:a._decompress(l.length,32,function(c){return s(r,l.charAt(c))})},compressToUTF16:function(l){return l==null?"":a._compress(l,15,function(c){return n(c+32)})+" "},decompressFromUTF16:function(l){return l==null?"":l==""?null:a._decompress(l.length,16384,function(c){return l.charCodeAt(c)-32})},compressToUint8Array:function(l){for(var c=a.compress(l),u=new Uint8Array(c.length*2),d=0,h=c.length;d<h;d++){var p=c.charCodeAt(d);u[d*2]=p>>>8,u[d*2+1]=p%256}return u},decompressFromUint8Array:function(l){if(l==null)return a.decompress(l);for(var c=new Array(l.length/2),u=0,d=c.length;u<d;u++)c[u]=l[u*2]*256+l[u*2+1];var h=[];return c.forEach(function(p){h.push(n(p))}),a.decompress(h.join(""))},compressToEncodedURIComponent:function(l){return l==null?"":a._compress(l,6,function(c){return i.charAt(c)})},decompressFromEncodedURIComponent:function(l){return l==null?"":l==""?null:(l=l.replace(/ /g,"+"),a._decompress(l.length,32,function(c){return s(i,l.charAt(c))}))},compress:function(l){return a._compress(l,16,function(c){return n(c)})},_compress:function(l,c,u){if(l==null)return"";var d,h,p={},g={},f="",m="",w="",b=2,k=3,S=2,C=[],_=0,P=0,I;for(I=0;I<l.length;I+=1)if(f=l.charAt(I),Object.prototype.hasOwnProperty.call(p,f)||(p[f]=k++,g[f]=!0),m=w+f,Object.prototype.hasOwnProperty.call(p,m))w=m;else{if(Object.prototype.hasOwnProperty.call(g,w)){if(w.charCodeAt(0)<256){for(d=0;d<S;d++)_=_<<1,P==c-1?(P=0,C.push(u(_)),_=0):P++;for(h=w.charCodeAt(0),d=0;d<8;d++)_=_<<1|h&1,P==c-1?(P=0,C.push(u(_)),_=0):P++,h=h>>1}else{for(h=1,d=0;d<S;d++)_=_<<1|h,P==c-1?(P=0,C.push(u(_)),_=0):P++,h=0;for(h=w.charCodeAt(0),d=0;d<16;d++)_=_<<1|h&1,P==c-1?(P=0,C.push(u(_)),_=0):P++,h=h>>1}b--,b==0&&(b=Math.pow(2,S),S++),delete g[w]}else for(h=p[w],d=0;d<S;d++)_=_<<1|h&1,P==c-1?(P=0,C.push(u(_)),_=0):P++,h=h>>1;b--,b==0&&(b=Math.pow(2,S),S++),p[m]=k++,w=String(f)}if(w!==""){if(Object.prototype.hasOwnProperty.call(g,w)){if(w.charCodeAt(0)<256){for(d=0;d<S;d++)_=_<<1,P==c-1?(P=0,C.push(u(_)),_=0):P++;for(h=w.charCodeAt(0),d=0;d<8;d++)_=_<<1|h&1,P==c-1?(P=0,C.push(u(_)),_=0):P++,h=h>>1}else{for(h=1,d=0;d<S;d++)_=_<<1|h,P==c-1?(P=0,C.push(u(_)),_=0):P++,h=0;for(h=w.charCodeAt(0),d=0;d<16;d++)_=_<<1|h&1,P==c-1?(P=0,C.push(u(_)),_=0):P++,h=h>>1}b--,b==0&&(b=Math.pow(2,S),S++),delete g[w]}else for(h=p[w],d=0;d<S;d++)_=_<<1|h&1,P==c-1?(P=0,C.push(u(_)),_=0):P++,h=h>>1;b--,b==0&&(b=Math.pow(2,S),S++)}for(h=2,d=0;d<S;d++)_=_<<1|h&1,P==c-1?(P=0,C.push(u(_)),_=0):P++,h=h>>1;for(;;)if(_=_<<1,P==c-1){C.push(u(_));break}else P++;return C.join("")},decompress:function(l){return l==null?"":l==""?null:a._decompress(l.length,32768,function(c){return l.charCodeAt(c)})},_decompress:function(l,c,u){var d=[],h=4,p=4,g=3,f="",m=[],w,b,k,S,C,_,P,I={val:u(0),position:c,index:1};for(w=0;w<3;w+=1)d[w]=w;for(k=0,C=Math.pow(2,2),_=1;_!=C;)S=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=u(I.index++)),k|=(S>0?1:0)*_,_<<=1;switch(k){case 0:for(k=0,C=Math.pow(2,8),_=1;_!=C;)S=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=u(I.index++)),k|=(S>0?1:0)*_,_<<=1;P=n(k);break;case 1:for(k=0,C=Math.pow(2,16),_=1;_!=C;)S=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=u(I.index++)),k|=(S>0?1:0)*_,_<<=1;P=n(k);break;case 2:return""}for(d[3]=P,b=P,m.push(P);;){if(I.index>l)return"";for(k=0,C=Math.pow(2,g),_=1;_!=C;)S=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=u(I.index++)),k|=(S>0?1:0)*_,_<<=1;switch(P=k){case 0:for(k=0,C=Math.pow(2,8),_=1;_!=C;)S=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=u(I.index++)),k|=(S>0?1:0)*_,_<<=1;d[p++]=n(k),P=p-1,h--;break;case 1:for(k=0,C=Math.pow(2,16),_=1;_!=C;)S=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=u(I.index++)),k|=(S>0?1:0)*_,_<<=1;d[p++]=n(k),P=p-1,h--;break;case 2:return m.join("")}if(h==0&&(h=Math.pow(2,g),g++),d[P])f=d[P];else if(P===p)f=b+b.charAt(0);else return null;m.push(f),d[p++]=b+f.charAt(0),h--,b=f,h==0&&(h=Math.pow(2,g),g++)}}};return a}();e!=null?e.exports=t:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return t})}(n1);var jA=n1.exports;async function Aq(e,t,n){var w,b,k;const{elements:r,files:i}=t,o={shapes:[],rootShapeIds:[],assets:[],schema:e.store.schema.serialize()},s=new Map,a=new Map,l=e.getCurrentPageId(),c=new Map,u=[],d=new Set;r.forEach(S=>{if(c.set(S.id,Ve()),S.boundElements!==null)for(const C of S.boundElements)C.type==="text"&&d.add(C.id)});let h="a1";for(const S of r){if(d.has(S.id))continue;const C=c.get(S.id),_={id:C,typeName:"shape",parentId:l,index:h,x:S.x,y:S.y,rotation:0,isLocked:S.locked,opacity:Tq(S.opacity),meta:{}};switch(S.angle!==0&&a.set(C,S.angle),S.groupIds&&S.groupIds.length>0?s.has(S.groupIds[0])?(w=s.get(S.groupIds[0]))==null||w.push(C):s.set(S.groupIds[0],[C]):u.push(C),S.type){case"rectangle":case"ellipse":case"diamond":{let P="",I="middle";if(S.boundElements!==null){for(const A of S.boundElements)if(A.type==="text"){const L=r.find(z=>z.id===A.id);L&&(P=L.text,I=OA[L.textAlign])}}const M=S.backgroundColor==="transparent"?S.strokeColor:S.backgroundColor;o.shapes.push({..._,type:"geo",props:{geo:S.type,url:S.link??"",w:S.width,h:S.height,size:Yf[S.strokeWidth]??"draw",color:Cu[M]??"black",text:P,align:I,dash:Xf(S),fill:Rq(S)}});break}case"freedraw":{o.shapes.push({..._,type:"draw",props:{dash:Xf(S),size:Yf[S.strokeWidth],color:Cu[S.strokeColor]??"black",segments:[{type:"free",points:S.points.map(([P,I,M=.5])=>({x:P,y:I,z:M}))}]}});break}case"line":{const P=S.points[0],I=S.points[S.points.length-1],M=HC(S.points.length);o.shapes.push({..._,type:"line",props:{dash:Xf(S),size:Yf[S.strokeWidth],color:Cu[S.strokeColor]??"black",spline:S.roundness?"cubic":"line",handles:{start:{id:"start",type:"vertex",index:M[0],x:P[0],y:P[1]},end:{id:"end",type:"vertex",index:M[M.length-1],x:I[0],y:I[1]},...Object.fromEntries(S.points.slice(1,-1).map(([A,L],z)=>{const $=Re();return[$,{id:$,type:"vertex",index:M[z+1],x:A,y:L}]}))}}});break}case"arrow":{let P="";if(S.boundElements!==null){for(const z of S.boundElements)if(z.type==="text"){const $=r.find(j=>j.id===z.id);$&&(P=$.text)}}const I=S.points[0],M=S.points[S.points.length-1],A=c.get((b=S.startBinding)==null?void 0:b.elementId),L=c.get((k=S.endBinding)==null?void 0:k.elementId);o.shapes.push({..._,type:"arrow",props:{text:P,bend:Nq(S,I,M),dash:Xf(S),size:Yf[S.strokeWidth]??"m",color:Cu[S.strokeColor]??"black",start:A?{type:"binding",boundShapeId:A,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:I[0],y:I[1]},end:L?{type:"binding",boundShapeId:L,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:M[0],y:M[1]},arrowheadEnd:LA[S.endArrowhead]??"none",arrowheadStart:LA[S.startArrowhead]??"none"}});break}case"text":{const{size:P,scale:I}=Oq(S.fontSize);o.shapes.push({..._,type:"text",props:{size:P,scale:I,font:Lq[S.fontFamily]??"draw",color:Cu[S.strokeColor]??"black",text:S.text,align:OA[S.textAlign]}});break}case"image":{const P=i[S.fileId];if(!P)break;const I=xs.createId();o.assets.push({id:I,typeName:"asset",type:"image",props:{w:S.width,h:S.height,name:S.id??"Untitled",isAnimated:!1,mimeType:P.mimeType,src:P.dataURL},meta:{}}),o.shapes.push({..._,type:"image",props:{w:S.width,h:S.height,assetId:I}})}}h=zi(h)}const p=n??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0);e.mark("paste"),e.putContentOntoCurrentPage(o,{point:p,select:!1,preserveIds:!0});for(const S of s.values())if(S.length>1){e.groupShapes(S);const C=e.getShape(S[0]);C!=null&&C.parentId&&ar(C.parentId)&&u.push(C.parentId)}for(const[S,C]of a)e.select(S),e.rotateShapesBy([S],C);const g=he(u.map(S=>e.getShape(S))),f=se.Common(g.map(S=>e.getShapePageBounds(S))),m=e.getViewportPageBounds().center;e.updateShapes(g.map(S=>{const C={x:(S.x??0)-(f.x+f.w/2),y:(S.y??0)-(f.y+f.h/2)};return{id:S.id,type:S.type,x:m.x+C.x,y:m.y+C.y}})),e.setSelectedShapes(u)}const Tq=e=>{const t=e/100;return t<.2?.1:t<.4?.25:t<.6?.5:t<.8?.75:1},Yf={1:"s",2:"m",3:"l",4:"xl"},jq={16:"s",20:"m",28:"l",36:"xl"};function Oq(e){const t=jq[e];return t?{size:t,scale:1}:e<16?{size:"s",scale:e/16}:e>36?{size:"xl",scale:e/36}:{size:"m",scale:1}}const Lq={1:"draw",2:"sans",3:"mono"},Cu={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},Dq={solid:"draw",dashed:"dashed",dotted:"dotted"},zq={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},OA={left:"start",center:"middle",right:"end"},LA={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function Nq(e,t,n){let r=0;if(e.points.length>2){const i=new E(t[0],t[1]),o=new E(n[0],n[1]),s=new E(e.points[1][0],e.points[1][1]),a=E.Sub(o,i),l=E.Per(a),c=E.Med(o,i),u=E.Sub(c,l),d=E.Add(c,l),h=E.NearestPointOnLineSegment(u,d,s,!1);r=E.Dist(h,c),E.Clockwise(h,o,c)&&(r*=-1)}return r}const Xf=e=>{let t=Dq[e.strokeStyle]??"draw";return t==="draw"&&e.roughness===0&&(t="solid"),t},Rq=e=>e.backgroundColor==="transparent"?"none":zq[e.fillStyle]??"solid";async function DA(e,t,n,r){const i=(await Promise.all(t.map(async o=>await(await fetch(o)).blob()))).map(o=>new File([o],"tldrawFile",{type:o.type}));e.mark("paste"),await e.putExternalContent({type:"files",files:i,point:n,ignoreParent:!1,sources:r}),t.forEach(o=>URL.revokeObjectURL(o))}function Fq(e,t,n){const r=n??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0);e.mark("paste"),e.putContentOntoCurrentPage(t,{point:r,select:!0})}async function r1(e,t,n,r){var i;try{if(new URL(t).pathname.match(/\.(png|jpe?g|gif|svg|webp)$/i)&&((i=(await fetch(t,{method:"HEAD"})).headers.get("content-type"))!=null&&i.match(/^image\//))){e.mark("paste"),DA(e,[t]);return}}catch(o){o.message!=="Failed to fetch"&&console.error(o)}return e.mark("paste"),await e.putExternalContent({type:"url",point:n,url:t,sources:r})}const zA=()=>{},NA=x.createContext({});function $q({onEvent:e,children:t}){return y.jsx(NA.Provider,{value:e??zA,children:t})}function fl(){return x.useContext(NA)??zA}function Bq(e){const t=document.implementation.createHTMLDocument("");return t.documentElement.innerHTML=e.trim(),t.body.textContent||t.body.innerText||""}const Uq=e=>{try{const t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}},Vq=e=>{const t=e.split(/[\n\s]/);for(const n of t)try{const r=new URL(n);if(!(r.protocol==="http:"||r.protocol==="https:"))return}catch{return}return gC(t)},Hq=e=>/^<svg/.test(e),Kq=["input","select","textarea"];function Gf(e){const{activeElement:t}=document;return e.getIsMenuOpen()||t&&(t.getAttribute("contenteditable")||Kq.indexOf(t.tagName.toLowerCase())>-1)}async function i1(e){return new Promise((t,n)=>{const r=new FileReader;r.addEventListener("loadend",()=>{const i=r.result;t(i)}),r.addEventListener("error",()=>{n(r.error)}),r.readAsText(e)})}const Wq=e=>e.types.find(t=>t.match(/^image\//)),o1=(e,t,n,r)=>{const i=Vq(t);if(i)for(const o of i)r1(e,o,n);else Uq(t)?r1(e,t,n):Hq(t)?(e.mark("paste"),e.putExternalContent({type:"svg-text",text:t,point:n,sources:r})):(e.mark("paste"),e.putExternalContent({type:"text",text:t,point:n,sources:r}))},Yq=async(e,t,n)=>{if(e.getEditingShapeId()!==null)return;if(!t)throw Error("No clipboard data");const r=[];for(const i of Object.values(t.items))switch(i.kind){case"file":{r.push({type:"file",source:new Promise(o=>o(i.getAsFile()))});break}case"string":{i.type==="text/html"?r.push({type:"html",source:new Promise(o=>i.getAsString(o))}):i.type==="text/plain"?r.push({type:"text",source:new Promise(o=>i.getAsString(o))}):r.push({type:i.type,source:new Promise(o=>i.getAsString(o))});break}}FA(e,r,n)},RA=async(e,t,n)=>{const r=[];for(const i of t){if(Wq(i))for(const o of i.types)o.match(/^image\//)&&r.push({type:"blob",source:i.getType(o)});i.types.includes("text/html")&&r.push({type:"html",source:new Promise(o=>i.getType("text/html").then(s=>i1(s).then(o)))}),i.types.includes("text/uri-list")&&r.push({type:"url",source:new Promise(o=>i.getType("text/uri-list").then(s=>i1(s).then(o)))}),i.types.includes("text/plain")&&r.push({type:"text",source:new Promise(o=>i.getType("text/plain").then(s=>i1(s).then(o)))})}return await FA(e,r,n)};async function FA(e,t,n){const r=t.filter(o=>(o.type==="file"||o.type==="blob")&&o.source!==null);if(r.length){const o=(await Promise.all(r.map(s=>s.source))).filter(Boolean).map(s=>URL.createObjectURL(s));return await DA(e,o,n)}const i=await Promise.all(t.filter(o=>o.type!=="file").map(o=>new Promise(s=>{const a=o;if(a.type==="file"){s({type:"error",data:null,reason:"unexpected file"});return}a.source.then(l=>{var u;const c=(u=l.match(/<tldraw[^>]*>(.*)<\/tldraw>/))==null?void 0:u[1];if(c)try{const d=jA.decompressFromBase64(c);if(d===null){s({type:"error",data:d,reason:"found tldraw data comment but could not parse base64"});return}else{const h=JSON.parse(d);if(h.type!=="application/tldraw"&&s({type:"error",data:h,reason:`found tldraw data comment but JSON was of a different type: ${h.type}`}),typeof h.data=="string"){s({type:"error",data:h,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}s({type:"tldraw",data:h.data});return}}catch{s({type:"error",data:c,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){s({type:"text",data:l,subtype:"html"});return}if(a.type==="url"){s({type:"text",data:l,subtype:"url"});return}try{const d=JSON.parse(l);if(d.type==="excalidraw/clipboard"){s({type:"excalidraw",data:d});return}else{s({type:"text",data:l,subtype:"json"});return}}catch{s({type:"text",data:l,subtype:"text"});return}}s({type:"error",data:l,reason:"unhandled case"})})})));for(const o of i)if(o.type==="tldraw"){Fq(e,o.data,n);return}for(const o of i)if(o.type==="excalidraw"){Aq(e,o.data,n);return}for(const o of i)if(o.type==="text"&&o.subtype==="html"){const s=new DOMParser().parseFromString(o.data,"text/html").querySelector("body");if(s&&Array.from(s.children).filter(a=>a.nodeType===1).length===1&&s.firstElementChild&&s.firstElementChild.tagName==="A"&&s.firstElementChild.hasAttribute("href")&&s.firstElementChild.getAttribute("href")!==""){const a=s.firstElementChild.getAttribute("href");o1(e,a,n,i);return}if(!i.some(a=>a.type==="text"&&a.subtype!=="html")&&o.data.trim()){o1(e,Bq(o.data),n,i);return}}for(const o of i)if(o.type==="text"&&o.subtype==="url"){r1(e,o.data,n,i);return}for(const o of i)if(o.type==="text"&&o.subtype==="text"&&o.data.trim()){o1(e,o.data,n,i);return}}const qf=e=>{var r;const t=e.getContentFromCurrentPage(e.getSelectedShapeIds());if(!t){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const n=jA.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:t}));if(!(typeof navigator>"u")){const i=t.shapes.map(o=>e.isShapeOfType(o,"text")||e.isShapeOfType(o,"geo")||e.isShapeOfType(o,"arrow")?o.props.text:e.isShapeOfType(o,"bookmark")||e.isShapeOfType(o,"embed")?o.props.url:null).filter(VL);if((r=navigator.clipboard)!=null&&r.write){const o=new Blob([`<tldraw>${n}</tldraw>`],{type:"text/html"});let s=i.join(" ");s===""&&(s=" "),navigator.clipboard.write([new ClipboardItem({"text/html":o,"text/plain":new Blob([s],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<tldraw>${n}</tldraw>`)}};function Xq(){const e=H(),t=fl(),n=x.useCallback(function(o){e.getSelectedShapeIds().length!==0&&(qf(e),t("copy",{source:o}))},[e,t]),r=x.useCallback(function(o){e.getSelectedShapeIds().length!==0&&(qf(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:o}))},[e,t]),i=x.useCallback(async function(o,s,a){e.getEditingShapeId()!==null||Gf(e)||(Array.isArray(o)&&o[0]instanceof ClipboardItem?(RA(e,o,a),t("paste",{source:"menu"})):navigator.clipboard.read().then(l=>{i(l,s,a)}))},[e,t]);return{copy:n,cut:r,paste:i}}function Gq(){const e=H(),t=fl(),n=Y("editor.isFocused",()=>e.getInstanceState().isFocused,[e]);x.useEffect(()=>{if(!n)return;const r=()=>{e.getSelectedShapeIds().length===0||e.getEditingShapeId()!==null||Gf(e)||(qf(e),t("copy",{source:"kbd"}))};function i(){e.getSelectedShapeIds().length===0||e.getEditingShapeId()!==null||Gf(e)||(qf(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:"kbd"}))}let o=!1;const s=l=>{l.button===1&&(o=!0,requestAnimationFrame(()=>{o=!1}))},a=l=>{if(o){l.stopPropagation();return}e.getEditingShapeId()!==null||Gf(e)||(l.clipboardData&&!e.inputs.shiftKey?Yq(e,l.clipboardData):navigator.clipboard.read().then(c=>{Array.isArray(c)&&c[0]instanceof ClipboardItem&&RA(e,c,e.inputs.currentPagePoint)}),t("paste",{source:"kbd"}))};return document.addEventListener("copy",r),document.addEventListener("cut",i),document.addEventListener("paste",a),document.addEventListener("pointerup",s),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",i),document.removeEventListener("paste",a),document.removeEventListener("pointerup",s)}},[e,t,n])}async function qq(e,t,n){const{type:r,quality:i,scale:o}=n,s=+e.getAttribute("width"),a=+e.getAttribute("height");let l=s*o,c=a*o;const u=await $A(e),d=URL.createObjectURL(new Blob([u],{type:"image/svg+xml"})),h=await hI();if(s>h.maxWidth&&(l=h.maxWidth,c=l/s*a),a>h.maxHeight&&(c=h.maxHeight,l=c/a*s),l*c>h.maxArea){const w=Math.sqrt(h.maxArea/(l*c));l*=w,c*=w}l=Math.floor(l),c=Math.floor(c);const p=l/s,g=await new Promise(w=>{const b=new Image;b.crossOrigin="anonymous",b.onload=async()=>{t&&await new Promise(C=>setTimeout(C,250));const k=document.createElement("canvas"),S=k.getContext("2d");k.width=l,k.height=c,S.imageSmoothingEnabled=!0,S.imageSmoothingQuality="high",S.drawImage(b,0,0,l,c),URL.revokeObjectURL(d),w(k)},b.onerror=()=>{w(null)},b.src=d});if(!g)return null;const f=await new Promise(w=>g.toBlob(b=>{(!b||He.throwToBlob.get())&&w(null),w(b)},"image/"+r,i));if(!f)return null;const m=new DataView(await f.arrayBuffer());return fi.setPhysChunk(m,p,{type:"image/"+r})}async function $A(e){const t=e.cloneNode(!0);e.setAttribute("width",+e.getAttribute("width")+""),e.setAttribute("height",+e.getAttribute("height")+"");const n=new FileReader,r=Array.from(t.querySelectorAll("image"));for(const i of r){const o=i.getAttribute("xlink:href");if(o&&!o.startsWith("data:")){const s=await(await fetch(o)).blob(),a=await new Promise((l,c)=>{n.onload=()=>l(n.result),n.onerror=()=>c(n.error),n.readAsDataURL(s)});i.setAttribute("xlink:href",a)}}return new XMLSerializer().serializeToString(t).replaceAll("&#10;      ","").replaceAll(/((\s|")[0-9]*\.[0-9]{2})([0-9]*)(\b|"|\))/g,"$1")}async function BA(e,t,n){const r=await e.getSvg(t!=null&&t.length?t:[...e.getCurrentPageShapeIds()],{scale:1,background:e.getInstanceState().exportBackground,...n});if(!r)throw new Error("Could not construct SVG.");return r}async function s1(e,t,n,r={}){switch(n){case"svg":return $A(await BA(e,t,r));case"json":{const i=e.getContentFromCurrentPage(t);return JSON.stringify(i)}default:ka(n)}}async function UA(e,t,n,r={}){switch(n){case"svg":return new Blob([await s1(e,t,"svg",r)],{type:"text/plain"});case"json":return new Blob([await s1(e,t,"json",r)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const i=await qq(await BA(e,t,r),e.environment.isSafari,{type:n,quality:1,scale:2});if(!i)throw new Error("Could not construct image.");return i}default:ka(n)}}const Zq={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function Qq(e,t,n,r={}){return{blobPromise:UA(e,t,n,r),mimeType:Zq[n]}}function Jq(e,t,n="svg",r={}){if(!window.navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(window.navigator.clipboard.write){const{blobPromise:i,mimeType:o}=Qq(e,t,n,r);return window.navigator.clipboard.write([new ClipboardItem({[o]:i})]).catch(s=>(console.error(s),i.then(a=>window.navigator.clipboard.write([new ClipboardItem({[o]:a})]))))}switch(n){case"json":case"svg":return eZ(async()=>s1(e,t,n,r));case"jpeg":case"png":throw new Error("Copy not supported");default:ka(n)}}async function eZ(e){var t,n;await((n=(t=navigator.clipboard)==null?void 0:t.writeText)==null?void 0:n.call(t,await e()))}const VA=x.createContext({});function tZ({children:e}){const[t,n]=x.useState([]),r=x.useCallback(s=>{const a=s.id??Re();return n(l=>[...l.filter(c=>c.id!==s.id),{...s,id:a}]),a},[]),i=x.useCallback(s=>(n(a=>a.filter(l=>l.id!==s)),s),[]),o=x.useCallback(()=>{n(()=>[])},[]);return y.jsx(VA.Provider,{value:{toasts:t,addToast:r,removeToast:i,clearToasts:o},children:e})}function ci(){const e=x.useContext(VA);if(!e)throw new Error("useToasts must be used within a ToastsProvider");return e}function nZ(){const e=H(),{addToast:t}=ci(),n=Se();return x.useCallback((r,i="svg")=>{Jq(e,r,i).catch(()=>{t({id:"copy-fail",icon:"warning-triangle",title:n("toast.error.copy-fail.title"),description:n("toast.error.copy-fail.desc")})})},[e,t,n])}const HA=x.createContext({});function rZ({children:e}){const t=H(),n=fl(),[r,i]=x.useState([]),o=x.useCallback(c=>{const u=c.id??Re();return i(d=>[...d.filter(h=>h.id!==c.id),{...c,id:u}]),n("open-menu",{source:"dialog",id:u}),t.addOpenMenu(u),u},[t,n]),s=x.useCallback((c,u)=>(i(d=>d.map(h=>h.id===c?{...h,...u}:h)),n("open-menu",{source:"dialog",id:c}),t.addOpenMenu(c),c),[t,n]),a=x.useCallback(c=>(i(u=>u.filter(d=>{var h;return d.id===c?((h=d.onClose)==null||h.call(d),!1):!0})),n("close-menu",{source:"dialog",id:c}),t.deleteOpenMenu(c),c),[t,n]),l=x.useCallback(()=>{i(c=>(c.forEach(u=>{var d;(d=u.onClose)==null||d.call(u),n("close-menu",{source:"dialog",id:u.id}),t.deleteOpenMenu(u.id)}),[]))},[t,n]);return y.jsx(HA.Provider,{value:{dialogs:r,addDialog:o,removeDialog:a,clearDialogs:l,updateDialog:s},children:e})}function Ns(){const e=x.useContext(HA);if(!e)throw new Error("useDialogs must be used within a DialogsProvider");return e}async function iZ(e,t,n="png",r={}){let i=`shapes at ${KA()}`;if(t.length===1){const a=e.getShape(t[0]);e.isShapeOfType(a,"frame")?i=a.props.name??"frame":i=`${a.id.replace(/:/,"_")} at ${KA()}`}i+=`.${n}`;const o=await UA(e,t,n,r),s=new File([o],i,{type:o.type});oZ(s)}function KA(){const e=new Date,t=String(e.getFullYear()).slice(2),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0");return`${t}-${n}-${r} ${i}.${o}.${s}`}function oZ(e){const t=document.createElement("a"),n=URL.createObjectURL(e);t.href=n,t.download=e.name,t.click(),URL.revokeObjectURL(n)}function sZ(){const e=H(),{addToast:t}=ci(),n=Se();return x.useCallback((r,i="png")=>{iZ(e,r,i,{scale:1,background:e.getInstanceState().exportBackground}).catch(o=>{console.error(o.message),t({id:"export-fail",title:n("toast.error.export-fail.title"),description:n("toast.error.export-fail.desc")})})},[e,t,n])}function WA(){const e=H(),t=x.useRef();return x.useEffect(()=>{const n=window.document.createElement("input");n.type="file",n.accept="image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/quicktime",n.multiple=!0,t.current=n;async function r(i){const o=i.target.files;!o||o.length===0||(await e.putExternalContent({type:"files",files:Array.from(o),point:e.getViewportPageBounds().center,ignoreParent:!1}),n.value="")}return n.addEventListener("change",r),()=>{t.current=void 0,n.removeEventListener("change",r)}},[e]),x.useCallback(()=>{var n;(n=t.current)==null||n.click()},[t])}function aZ(){const e=H(),t=x.useRef(null),n=x.useRef(null);return x.useCallback(async function(){const r=document.createElement("div"),i=document.createElement("style"),o=(f,m)=>{f&&(f.innerHTML=""),m&&document.head.contains(m)&&document.head.removeChild(m),f&&document.body.contains(f)&&document.body.removeChild(f)};o(t.current,n.current),t.current=r,n.current=i;const s=`tl-print-surface-${Re()}`;r.className=s,i.innerHTML=`
			.${s} {
				display: none;
			}

			.${s} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${s} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${s}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${s}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${s}__item__header {
					display: none;
				}

				.${s}__item__footer {
					display: none;
					text-align: right;
				}

				.${s}__item__footer__hide {
					display: none;
				}

				
			}

		`;const a=()=>{document.head.appendChild(i),document.body.appendChild(r)},l=()=>{e.once("change-history",()=>{o(r,i)})};window.addEventListener("beforeprint",a),window.addEventListener("afterprint",l);function c(f,m,w){try{r.innerHTML+=`<div class="${s}__item">
        <div class="${s}__item__header">
          ${f.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${s}__item__main">
          ${w.outerHTML}
        </div>
        <div class="${s}__item__footer ${s}__item__footer__${m?"":"hide"}">
          ${m??""}
        </div>
      </div>`}catch(b){console.error(b)}}function u(){e.environment.isChromeForIos?(a(),window.print()):e.environment.isSafari?(a(),document.execCommand("print",!1)):window.print()}const d=e.getSelectedShapeIds(),h=e.getCurrentPageId(),p=e.getPages(),g={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(e.getSelectedShapeIds().length>0){const f=await e.getSvg(d,g);if(f){const m=p.find(w=>w.id===h);c(`tldraw \u2014 ${m==null?void 0:m.name}`,null,f),u()}}else{const f=e.getCurrentPage(),m=await e.getSvg(e.getSortedChildIdsForParent(f.id),g);m&&(c(`tldraw \u2014 ${f.name}`,null,m),u())}window.removeEventListener("beforeprint",a),window.removeEventListener("afterprint",l)},[e])}const YA=x.createContext({});function lZ(e){return Object.fromEntries(e.map(t=>[t.id,t]))}function cZ({overrides:e,children:t}){const n=H(),{addDialog:r,clearDialogs:i}=Ns(),{clearToasts:o}=ci(),s=WA(),a=aZ(),{cut:l,copy:c,paste:u}=Xq(),d=nZ(),h=sZ(),p=fl(),g=x.useMemo(()=>{function f(){return n.isIn("select")||(n.complete(),n.setCurrentTool("select")),!1}function m(){return n.getSelectedShapeIds().length>0}const w=lZ([{id:"edit-link",label:"action.edit-link",icon:"link",readonlyOk:!1,onSelect(b){m()&&(f()||(p("edit-link",{source:b}),n.mark("edit-link"),r({component:Iq})))}},{id:"insert-embed",label:"action.insert-embed",readonlyOk:!1,kbd:"$i",onSelect(b){p("insert-embed",{source:b}),r({component:TA})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",readonlyOk:!1,onSelect(b){p("insert-media",{source:b}),s()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",readonlyOk:!1,onSelect(b){p("undo",{source:b}),n.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",readonlyOk:!1,onSelect(b){p("redo",{source:b}),n.redo()}},{id:"export-as-svg",label:"action.export-as-svg",menuLabel:"action.export-as-svg.short",contextMenuLabel:"action.export-as-svg.short",readonlyOk:!0,onSelect(b){p("export-as",{format:"svg",source:b}),h(n.getSelectedShapeIds(),"svg")}},{id:"export-as-png",label:"action.export-as-png",menuLabel:"action.export-as-png.short",contextMenuLabel:"action.export-as-png.short",readonlyOk:!0,onSelect(b){p("export-as",{format:"png",source:b}),h(n.getSelectedShapeIds(),"png")}},{id:"export-as-json",label:"action.export-as-json",menuLabel:"action.export-as-json.short",contextMenuLabel:"action.export-as-json.short",readonlyOk:!0,onSelect(b){p("export-as",{format:"json",source:b}),h(n.getSelectedShapeIds(),"json")}},{id:"copy-as-svg",label:"action.copy-as-svg",menuLabel:"action.copy-as-svg.short",contextMenuLabel:"action.copy-as-svg.short",kbd:"$!c",readonlyOk:!0,onSelect(b){p("copy-as",{format:"svg",source:b}),d(n.getSelectedShapeIds(),"svg")}},{id:"copy-as-png",label:"action.copy-as-png",menuLabel:"action.copy-as-png.short",contextMenuLabel:"action.copy-as-png.short",readonlyOk:!0,onSelect(b){p("copy-as",{format:"png",source:b}),d(n.getSelectedShapeIds(),"png")}},{id:"copy-as-json",label:"action.copy-as-json",menuLabel:"action.copy-as-json.short",contextMenuLabel:"action.copy-as-json.short",readonlyOk:!0,onSelect(b){p("copy-as",{format:"json",source:b}),d(n.getSelectedShapeIds(),"json")}},{id:"toggle-auto-size",label:"action.toggle-auto-size",readonlyOk:!1,onSelect(b){m()&&(f()||(p("toggle-auto-size",{source:b}),n.mark("toggling auto size"),n.updateShapes(n.getSelectedShapes().filter(k=>n.isShapeOfType(k,"text")&&k.props.autoSize===!1).map(k=>({id:k.id,type:k.type,props:{...k.props,w:8,autoSize:!0}})))))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(b){p("open-embed-link",{source:b});const k=n.getSelectedShapeIds(),S="No embed shapes selected";if(k.length!==1){console.error(S);return}const C=n.getShape(k[0]);if(!C||!n.isShapeOfType(C,"embed")){console.error(S);return}WF(C.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(b){var k,S;if(((k=n.root.getCurrent())==null?void 0:k.id)!=="zoom"&&(p("zoom-tool",{source:b}),!(n.inputs.shiftKey||n.inputs.ctrlKey))){const C=n.root.getCurrent();C&&((S=C.getCurrent())==null?void 0:S.id)==="idle"&&n.setCurrentTool("zoom",{onInteractionEnd:C.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",readonlyOk:!1,onSelect(b){m()&&(f()||n.batch(()=>{p("convert-to-bookmark",{source:b});const k=n.getSelectedShapes(),S=[],C=[];for(const _ of k){if(!_||!n.isShapeOfType(_,"embed")||!_.props.url)continue;const P=new E(_.x,_.y);P.rot(-_.rotation),P.add(new E(_.props.w/2-300/2,_.props.h/2-320/2)),P.rot(_.rotation);const I={id:Ve(),type:"bookmark",rotation:_.rotation,x:P.x,y:P.y,opacity:1,props:{url:_.props.url}};S.push(I),C.push(_.id)}n.mark("convert shapes to bookmark"),n.deleteShapes(C),n.createShapes(S)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",readonlyOk:!1,onSelect(b){m()&&(f()||(p("convert-to-embed",{source:b}),n.batch(()=>{const k=n.getSelectedShapeIds(),S=he(k.map(P=>n.getShape(P))),C=[],_=[];for(const P of S){if(!n.isShapeOfType(P,"bookmark"))continue;const{url:I}=P.props,M=Vi(P.props.url);if(!M||!M.definition)continue;const{width:A,height:L}=M.definition,z=new E(P.x,P.y);z.rot(-P.rotation),z.add(new E(P.props.w/2-A/2,P.props.h/2-L/2)),z.rot(P.rotation);const $={id:Ve(),type:"embed",x:z.x,y:z.y,rotation:P.rotation,props:{url:I,w:A,h:L}};C.push($),_.push(P.id)}n.mark("convert shapes to embed"),n.deleteShapes(_),n.createShapes(C)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",readonlyOk:!1,onSelect(b){if(!m()||f())return;p("duplicate-shapes",{source:b});const k=n.getSelectedShapeIds(),S=se.Common(he(k.map(_=>n.getShapePageBounds(_)))),C=n.getInstanceState().canMoveCamera?{x:S.width+10,y:0}:{x:16/n.getZoomLevel(),y:16/n.getZoomLevel()};n.mark("duplicate shapes"),n.duplicateShapes(k,C)}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",readonlyOk:!1,onSelect(b){m()&&(f()||(p("ungroup-shapes",{source:b}),n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",readonlyOk:!1,onSelect(b){if(!m()||f())return;p("group-shapes",{source:b});const k=n.getOnlySelectedShape();k&&n.isShapeOfType(k,"group")?(n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())):(n.mark("group"),n.groupShapes(n.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",readonlyOk:!1,onSelect(b){if(!m())return;p("remove-frame",{source:b});const k=n.getSelectedShapes();k.length>0&&k.every(S=>n.isShapeOfType(S,"frame"))&&(n.mark("remove-frame"),hG(n,k.map(S=>S.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",readonlyOk:!1,onSelect(b){if(!m())return;p("fit-frame-to-content",{source:b});const k=n.getOnlySelectedShape();k&&n.isShapeOfType(k,"frame")&&(n.mark("fit-frame-to-content"),fG(n,k.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",readonlyOk:!1,onSelect(b){m()&&(f()||(p("align-shapes",{operation:"left",source:b}),n.mark("align left"),n.alignShapes(n.getSelectedShapeIds(),"left")))}},{id:"align-center-horizontal",label:"action.align-center-horizontal",contextMenuLabel:"action.align-center-horizontal.short",kbd:"?H",icon:"align-center-horizontal",readonlyOk:!1,onSelect(b){m()&&(f()||(p("align-shapes",{operation:"center-horizontal",source:b}),n.mark("align center horizontal"),n.alignShapes(n.getSelectedShapeIds(),"center-horizontal")))}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",readonlyOk:!1,onSelect(b){m()&&(f()||(p("align-shapes",{operation:"right",source:b}),n.mark("align right"),n.alignShapes(n.getSelectedShapeIds(),"right")))}},{id:"align-center-vertical",label:"action.align-center-vertical",contextMenuLabel:"action.align-center-vertical.short",kbd:"?V",icon:"align-center-vertical",readonlyOk:!1,onSelect(b){m()&&(f()||(p("align-shapes",{operation:"center-vertical",source:b}),n.mark("align center vertical"),n.alignShapes(n.getSelectedShapeIds(),"center-vertical")))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",readonlyOk:!1,onSelect(b){m()&&(f()||(p("align-shapes",{operation:"top",source:b}),n.mark("align top"),n.alignShapes(n.getSelectedShapeIds(),"top")))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",readonlyOk:!1,onSelect(b){m()&&(f()||(p("align-shapes",{operation:"bottom",source:b}),n.mark("align bottom"),n.alignShapes(n.getSelectedShapeIds(),"bottom")))}},{id:"distribute-horizontal",label:"action.distribute-horizontal",contextMenuLabel:"action.distribute-horizontal.short",icon:"distribute-horizontal",kbd:"?!h",readonlyOk:!1,onSelect(b){m()&&(f()||(p("distribute-shapes",{operation:"horizontal",source:b}),n.mark("distribute horizontal"),n.distributeShapes(n.getSelectedShapeIds(),"horizontal")))}},{id:"distribute-vertical",label:"action.distribute-vertical",contextMenuLabel:"action.distribute-vertical.short",icon:"distribute-vertical",kbd:"?!V",readonlyOk:!1,onSelect(b){m()&&(f()||(p("distribute-shapes",{operation:"vertical",source:b}),n.mark("distribute vertical"),n.distributeShapes(n.getSelectedShapeIds(),"vertical")))}},{id:"stretch-horizontal",label:"action.stretch-horizontal",contextMenuLabel:"action.stretch-horizontal.short",icon:"stretch-horizontal",readonlyOk:!1,onSelect(b){m()&&(f()||(p("stretch-shapes",{operation:"horizontal",source:b}),n.mark("stretch horizontal"),n.stretchShapes(n.getSelectedShapeIds(),"horizontal")))}},{id:"stretch-vertical",label:"action.stretch-vertical",contextMenuLabel:"action.stretch-vertical.short",icon:"stretch-vertical",readonlyOk:!1,onSelect(b){m()&&(f()||(p("stretch-shapes",{operation:"vertical",source:b}),n.mark("stretch vertical"),n.stretchShapes(n.getSelectedShapeIds(),"vertical")))}},{id:"flip-horizontal",label:"action.flip-horizontal",contextMenuLabel:"action.flip-horizontal.short",kbd:"!h",readonlyOk:!1,onSelect(b){m()&&(f()||(p("flip-shapes",{operation:"horizontal",source:b}),n.mark("flip horizontal"),n.flipShapes(n.getSelectedShapeIds(),"horizontal")))}},{id:"flip-vertical",label:"action.flip-vertical",contextMenuLabel:"action.flip-vertical.short",kbd:"!v",readonlyOk:!1,onSelect(b){m()&&(f()||(p("flip-shapes",{operation:"vertical",source:b}),n.mark("flip vertical"),n.flipShapes(n.getSelectedShapeIds(),"vertical")))}},{id:"pack",label:"action.pack",icon:"pack",readonlyOk:!1,onSelect(b){m()&&(f()||(p("pack-shapes",{source:b}),n.mark("pack"),n.packShapes(n.getSelectedShapeIds(),16)))}},{id:"stack-vertical",label:"action.stack-vertical",contextMenuLabel:"action.stack-vertical.short",icon:"stack-vertical",readonlyOk:!1,onSelect(b){m()&&(f()||(p("stack-shapes",{operation:"vertical",source:b}),n.mark("stack-vertical"),n.stackShapes(n.getSelectedShapeIds(),"vertical",16)))}},{id:"stack-horizontal",label:"action.stack-horizontal",contextMenuLabel:"action.stack-horizontal.short",icon:"stack-horizontal",readonlyOk:!1,onSelect(b){m()&&(f()||(p("stack-shapes",{operation:"horizontal",source:b}),n.mark("stack-horizontal"),n.stackShapes(n.getSelectedShapeIds(),"horizontal",16)))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",readonlyOk:!1,onSelect(b){m()&&(f()||(p("reorder-shapes",{operation:"toFront",source:b}),n.mark("bring to front"),n.bringToFront(n.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",readonlyOk:!1,onSelect(b){m()&&(f()||(p("reorder-shapes",{operation:"forward",source:b}),n.mark("bring forward"),n.bringForward(n.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",readonlyOk:!1,onSelect(b){m()&&(f()||(p("reorder-shapes",{operation:"backward",source:b}),n.mark("send backward"),n.sendBackward(n.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",readonlyOk:!1,onSelect(b){m()&&(f()||(p("reorder-shapes",{operation:"toBack",source:b}),n.mark("send to back"),n.sendToBack(n.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",readonlyOk:!1,onSelect(b){m()&&(f()||(n.mark("cut"),l(b)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(b){m()&&(f()||c(b))}},{id:"paste",label:"action.paste",kbd:"$v",readonlyOk:!1,onSelect(b){var k;(k=navigator.clipboard)==null||k.read().then(S=>{u(S,b,b==="context-menu"?n.inputs.currentPagePoint:void 0)})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(b){n.batch(()=>{f()||(p("select-all-shapes",{source:b}),n.mark("select all kbd"),n.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(b){m()&&(f()||(p("select-none-shapes",{source:b}),n.mark("select none"),n.selectNone()))}},{id:"delete",label:"action.delete",kbd:"\u232B,del,backspace",icon:"trash",readonlyOk:!1,onSelect(b){m()&&(f()||(p("delete-shapes",{source:b}),n.mark("delete"),n.deleteShapes(n.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",readonlyOk:!1,onSelect(b){if(!m()||f())return;p("rotate-cw",{source:b}),n.mark("rotate-cw");const k=n.getSelectionRotation()%(Ke/2),S=Rc(k,0)||Rc(k,Ke/2);n.rotateShapesBy(n.getSelectedShapeIds(),Ke/2-(S?0:k))}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",readonlyOk:!1,onSelect(b){if(!m()||f())return;p("rotate-ccw",{source:b}),n.mark("rotate-ccw");const k=n.getSelectionRotation()%(Ke/2),S=Rc(k,0);n.rotateShapesBy(n.getSelectedShapeIds(),S?-(Ke/2):-k)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(b){p("zoom-in",{source:b}),n.zoomIn(n.getViewportScreenCenter(),{duration:Di})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(b){p("zoom-out",{source:b}),n.zoomOut(n.getViewportScreenCenter(),{duration:Di})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(b){p("reset-zoom",{source:b}),n.resetZoom(n.getViewportScreenCenter(),{duration:Di})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(b){p("zoom-to-fit",{source:b}),n.zoomToFit({duration:Di})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(b){m()&&(f()||(p("zoom-to-selection",{source:b}),n.zoomToSelection({duration:Di})))}},{id:"toggle-snap-mode",label:"action.toggle-snap-mode",menuLabel:"action.toggle-snap-mode.menu",readonlyOk:!1,onSelect(b){p("toggle-snap-mode",{source:b}),n.user.updateUserPreferences({isSnapMode:!n.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:"action.toggle-dark-mode",menuLabel:"action.toggle-dark-mode.menu",kbd:"$/",readonlyOk:!0,onSelect(b){p("toggle-dark-mode",{source:b}),n.user.updateUserPreferences({isDarkMode:!n.user.getIsDarkMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:"action.toggle-reduce-motion",menuLabel:"action.toggle-reduce-motion.menu",readonlyOk:!0,onSelect(b){p("toggle-reduce-motion",{source:b}),n.user.updateUserPreferences({animationSpeed:n.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:"action.toggle-edge-scrolling",menuLabel:"action.toggle-edge-scrolling.menu",readonlyOk:!0,onSelect(b){p("toggle-edge-scrolling",{source:b}),n.user.updateUserPreferences({edgeScrollSpeed:n.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:"action.toggle-transparent",menuLabel:"action.toggle-transparent.menu",contextMenuLabel:"action.toggle-transparent.context-menu",readonlyOk:!0,onSelect(b){p("toggle-transparent",{source:b}),n.updateInstanceState({exportBackground:!n.getInstanceState().exportBackground},{ephemeral:!0})},checkbox:!0},{id:"toggle-tool-lock",label:"action.toggle-tool-lock",menuLabel:"action.toggle-tool-lock.menu",readonlyOk:!1,kbd:"q",onSelect(b){p("toggle-tool-lock",{source:b}),n.updateInstanceState({isToolLocked:!n.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",readonlyOk:!1,onSelect(b){p("unlock-all",{source:b});const k=[];for(const S of n.getCurrentPageShapes())S.isLocked&&k.push({id:S.id,type:S.type,isLocked:!1});k.length>0&&n.updateShapes(k)}},{id:"toggle-focus-mode",label:"action.toggle-focus-mode",menuLabel:"action.toggle-focus-mode.menu",readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(b){requestAnimationFrame(()=>{n.batch(()=>{p("toggle-focus-mode",{source:b}),i(),o(),n.updateInstanceState({isFocusMode:!n.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:"action.toggle-grid",menuLabel:"action.toggle-grid.menu",readonlyOk:!0,kbd:"$'",onSelect(b){p("toggle-grid-mode",{source:b}),n.updateInstanceState({isGridMode:!n.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:"action.toggle-debug-mode",menuLabel:"action.toggle-debug-mode.menu",readonlyOk:!0,onSelect(b){p("toggle-debug-mode",{source:b}),n.updateInstanceState({isDebugMode:!n.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(b){p("print",{source:b}),a()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(b){p("exit-pen-mode",{source:b}),n.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(b){p("stop-following",{source:b}),n.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(b){p("zoom-to-content",{source:b}),n.zoomToContent()}},{id:"toggle-lock",label:"action.toggle-lock",readonlyOk:!1,kbd:"!l",onSelect(b){n.mark("locking"),p("toggle-lock",{source:b}),n.toggleLock(n.getSelectedShapeIds())}}]);return e?e(n,w,void 0):w},[n,p,e,r,s,h,d,l,c,u,i,o,a]);return y.jsx(YA.Provider,{value:g,children:t})}function tn(){const e=x.useContext(YA);if(!e)throw new Error("useTools must be used within a ToolProvider");return e}function Zf(e){return e.filter(t=>t!=null&&t!==!1)}function ve(e,...t){const n=Zf(t);return n.length===0?null:{id:e,type:"group",checkbox:n.every(r=>r.type==="item"&&r.actionItem.checkbox),disabled:n.every(r=>r.disabled),readonlyOk:n.some(r=>r.readonlyOk),children:n}}function ui(e,t,...n){const r=Zf(n);return r.length===0?null:{id:e,type:"submenu",label:t,children:r,disabled:r.every(i=>i.disabled),readonlyOk:r.some(i=>i.readonlyOk)}}function a1(e,t={}){const{readonlyOk:n=!0,disabled:r=!1}=t;return{id:e,type:"custom",disabled:r,readonlyOk:n}}function U(e,t={}){if(!e)throw Error("No action item provided to menuItem");if(!e.label)throw Error("Trying to create menu item for action item that doesn't have a label");const{checked:n=!1,disabled:r=!1}=t;return{id:e.id,type:"item",actionItem:e,disabled:r,checked:n,readonlyOk:e.readonlyOk}}function uZ(e){return e.getSelectedShapeIds().map(t=>e.getShape(t)).filter(t=>!(!t||e.isShapeOfType(t,"arrow")&&t.props.start.type==="binding"||e.isShapeOfType(t,"arrow")&&t.props.end.type==="binding"))}const XA=()=>{const e=H();return Y("threeStackableItems",()=>uZ(e).length>2,[e])};function dZ(e){const t=e.getSelectedShapes(),n=[],r=new Map;t.forEach(o=>{o.type==="arrow"?n.push(o):r.set(o.id,o)});const i=n.filter(o=>!(o.props.start.type==="binding"&&!r.has(o.props.start.boundShapeId)||o.props.end.type==="binding"&&!r.has(o.props.end.boundShapeId)));return Array.from(r.values()).concat(i)}const l1=()=>{const e=H();return Y("allowGroup",()=>dZ(e).length>1,[e])},c1=()=>{const e=H();return Y("allowUngroup",()=>e.getSelectedShapeIds().some(t=>{var n;return((n=e.getShape(t))==null?void 0:n.type)==="group"}),[e])},GA=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read,u1=[0,390,428,468,580,640,840,1023],qA=J.createContext(0);function hZ({forceMobile:e=!1,children:t}){const n=H(),r=Y("breakpoint",()=>{const{width:i}=n.getViewportScreenBounds(),o=e?3:u1.length-1;for(let s=0;s<o;s++)if(i>u1[s]&&i<=u1[s+1])return s;return o},[n]);return y.jsx(qA.Provider,{value:r,children:t})}function fr(){return x.useContext(qA)}function d1(){const e=H();return Y("hasLinkShapeSelected",()=>{const t=e.getSelectedShapes();return t.length===1&&"url"in t[0].props&&t[0].type!=="embed"},[e])}const ZA=J.createContext({}),pZ=({overrides:e,children:t})=>{const n=H(),r=tn(),i=Y("selected count",()=>n.getSelectedShapeIds().length,[n]),o=i>0,s=i>1,a=i>2,l=XA(),c=l1(),u=c1(),d=d1(),h=fr(),p=Y("zoom is 1",()=>n.getZoomLevel()===1,[n]),g=x.useMemo(()=>{const f=[U(r["align-left"],{disabled:!s}),U(r["align-center-horizontal"],{disabled:!s}),U(r["align-right"],{disabled:!s}),U(r["stretch-horizontal"],{disabled:!s}),U(r["align-top"],{disabled:!s}),U(r["align-center-vertical"],{disabled:!s}),U(r["align-bottom"],{disabled:!s}),U(r["stretch-vertical"],{disabled:!s}),U(r["distribute-horizontal"],{disabled:!a}),U(r["distribute-vertical"],{disabled:!a}),U(r["stack-horizontal"],{disabled:!l}),U(r["stack-vertical"],{disabled:!l}),U(r["send-to-back"],{disabled:!o}),U(r["send-backward"],{disabled:!o}),U(r["bring-forward"],{disabled:!o}),U(r["bring-to-front"],{disabled:!o}),h<5?U(r["zoom-to-100"],{disabled:!!p}):U(r["rotate-ccw"],{disabled:!o}),U(r["rotate-cw"],{disabled:!o}),U(r["edit-link"],{disabled:!d}),c?U(r.group,{disabled:!s}):u?U(r.ungroup):U(r.group,{disabled:!s})];return e?e(n,f,{actions:r,oneSelected:o,twoSelected:s,threeSelected:a}):f},[n,p,c,e,r,o,s,a,l,u,d,h]);return y.jsx(ZA.Provider,{value:g,children:t})};function fZ(){const e=J.useContext(ZA);if(!e)throw new Error("useActionsMenuSchema must be used inside of a ActionsMenuSchemaProvider.");return e}function gZ(){const e=H();return Y("onlyFlippableShape",()=>{const t=e.getSelectedShapes();return t.length===1&&t.every(n=>e.isShapeOfType(n,"group")||e.isShapeOfType(n,"arrow")||e.isShapeOfType(n,"line")||e.isShapeOfType(n,"draw"))},[e])}function QA(){const e=H();return Y("showAutoSizeToggle",()=>{const t=e.getSelectedShapes();return t.length===1&&e.isShapeOfType(t[0],"text")&&t[0].props.autoSize===!1},[e])}const JA=J.createContext({}),mZ=Pe(function({overrides:e,children:t}){var P;const n=H(),r=tn(),i=QA(),o=gZ(),s=n.getSelectedShapes(),a=s.length,l=a>0,c=a>1,u=a>2,d=XA(),h=Y("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[]),p=Y("isTransparentBg",()=>n.getInstanceState().exportBackground,[]),g=l1(),f=c1(),m=!!((P=window.navigator.clipboard)!=null&&P.write),w=d1(),b=n.getOnlySelectedShape(),k=l&&s.every(I=>n.isShapeOfType(I,"frame")),S=b&&n.isShapeOfType(b,"frame")&&n.getSortedChildIdsForParent(b).length>0,C=b&&n.isShapeOrAncestorLocked(b),_=x.useMemo(()=>{let I=Zf([ve("selection",i&&U(r["toggle-auto-size"]),w&&!C&&U(r["edit-link"]),l&&!C&&U(r.duplicate),g&&!C&&U(r.group),f&&!C&&U(r.ungroup),k&&!C&&U(r["remove-frame"]),S&&!C&&U(r["fit-frame-to-content"]),l&&U(r["toggle-lock"])),ve("modify",(c||o)&&ui("arrange","context-menu.arrange",c&&ve("align",U(r["align-left"]),U(r["align-center-horizontal"]),U(r["align-right"]),U(r["align-top"]),U(r["align-center-vertical"]),U(r["align-bottom"])),u&&ve("distribute",U(r["distribute-horizontal"]),U(r["distribute-vertical"])),c&&ve("stretch",U(r["stretch-horizontal"]),U(r["stretch-vertical"])),o&&!C&&ve("flip",U(r["flip-horizontal"]),U(r["flip-vertical"])),c&&ve("order",U(r.pack,{disabled:!c}),d&&U(r["stack-vertical"]),d&&U(r["stack-horizontal"]))),l&&!C&&ui("reorder","context-menu.reorder",ve("reorder",U(r["bring-to-front"]),U(r["bring-forward"]),U(r["send-backward"]),U(r["send-to-back"]))),l&&!C&&a1("MOVE_TO_PAGE_MENU",{readonlyOk:!1})),ve("clipboard-group",l&&!C&&U(r.cut),l&&U(r.copy),GA&&U(r.paste)),h&&ve("conversions",ui("copy-as","context-menu.copy-as",ve("copy-as-group",U(r["copy-as-svg"]),m&&U(r["copy-as-png"]),U(r["copy-as-json"])),ve("export-bg",U(r["toggle-transparent"],{checked:!p}))),ui("export-as","context-menu.export-as",ve("export-as-group",U(r["export-as-svg"]),U(r["export-as-png"]),U(r["export-as-json"])),ve("export-bg,",U(r["toggle-transparent"],{checked:!p})))),h&&ve("set-selection-group",U(r["select-all"]),l&&U(r["select-none"])),l&&!C&&ve("delete-group",U(r.delete))]);return e&&(I=e(n,I,{actions:r,oneSelected:l,twoSelected:c,threeSelected:u,showAutoSizeToggle:i,showUngroup:f,onlyFlippableShapeSelected:o})),I},[n,e,r,l,c,u,i,o,h,d,g,f,k,S,m,w,p,C]);return y.jsx(JA.Provider,{value:_,children:t})});function e3(){const e=J.useContext(JA);if(!e)throw new Error("useContextMenuSchema must be used inside of a TLUiContextMenuSchemaProvider.");return e}const t3=x.createContext({});function yZ({overrides:e,children:t}){const n=H(),r=fl(),{addDialog:i}=Ns(),o=WA(),s=x.useMemo(()=>{const a=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(c){n.setCurrentTool("select"),r("select-tool",{source:c,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(c){n.setCurrentTool("hand"),r("select-tool",{source:c,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",readonlyOk:!1,onSelect(c){n.setCurrentTool("eraser"),r("select-tool",{source:c,id:"eraser"})}},{id:"draw",label:"tool.draw",readonlyOk:!1,icon:"tool-pencil",kbd:"d,b,x",onSelect(c){n.setCurrentTool("draw"),r("select-tool",{source:c,id:"draw"})}},...[...ei.values].map(c=>({id:c,label:`tool.${c}`,readonlyOk:!1,meta:{geo:c},kbd:c==="rectangle"?"r":c==="ellipse"?"o":void 0,icon:"geo-"+c,onSelect(u){n.batch(()=>{n.updateInstanceState({stylesForNextShape:{...n.getInstanceState().stylesForNextShape,[ei.id]:c}},{ephemeral:!0}),n.setCurrentTool("geo"),r("select-tool",{source:u,id:`geo-${c}`})})}})),{id:"arrow",label:"tool.arrow",readonlyOk:!1,icon:"tool-arrow",kbd:"a",onSelect(c){n.setCurrentTool("arrow"),r("select-tool",{source:c,id:"arrow"})}},{id:"line",label:"tool.line",readonlyOk:!1,icon:"tool-line",kbd:"l",onSelect(c){n.setCurrentTool("line"),r("select-tool",{source:c,id:"line"})}},{id:"frame",label:"tool.frame",readonlyOk:!1,icon:"tool-frame",kbd:"f",onSelect(c){n.setCurrentTool("frame"),r("select-tool",{source:c,id:"frame"})}},{id:"text",label:"tool.text",readonlyOk:!1,icon:"tool-text",kbd:"t",onSelect(c){n.setCurrentTool("text"),r("select-tool",{source:c,id:"text"})}},{id:"asset",label:"tool.asset",readonlyOk:!1,icon:"tool-media",kbd:"$u",onSelect(c){o(),r("select-tool",{source:c,id:"media"})}},{id:"note",label:"tool.note",readonlyOk:!1,icon:"tool-note",kbd:"n",onSelect(c){n.setCurrentTool("note"),r("select-tool",{source:c,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(c){n.setCurrentTool("laser"),r("select-tool",{source:c,id:"laser"})}},{id:"embed",label:"tool.embed",readonlyOk:!1,icon:"tool-embed",onSelect(c){i({component:TA}),r("select-tool",{source:c,id:"embed"})}}];a.push({id:"highlight",label:"tool.highlight",readonlyOk:!0,icon:"tool-highlight",kbd:"!d",onSelect(c){n.setCurrentTool("highlight"),r("select-tool",{source:c,id:"highlight"})}});const l=Object.fromEntries(a.map(c=>[c.id,c]));return e?e(n,l,{insertMedia:o}):l},[e,n,r,o,i]);return y.jsx(t3.Provider,{value:s,children:t})}function h1(){const e=x.useContext(t3);if(!e)throw new Error("useTools must be used within a ToolProvider");return e}const n3=J.createContext({}),vZ=Pe(function({overrides:e,children:t}){const n=H(),r=h1(),i=tn(),o=x.useMemo(()=>{const s=he([ve("shortcuts-dialog.tools",U(i["toggle-tool-lock"]),U(r.select),U(r.draw),U(r.eraser),U(r.hand),U(r.rectangle),U(r.ellipse),U(r.arrow),U(r.line),U(r.text),U(r.frame),U(r.note),U(r.laser)),ve("shortcuts-dialog.file",U(i["insert-media"]),U(i.print)),ve("shortcuts-dialog.preferences",U(i["toggle-dark-mode"]),U(i["toggle-focus-mode"]),U(i["toggle-grid"])),ve("shortcuts-dialog.edit",U(i.undo),U(i.redo),U(i.cut),U(i.copy),U(i.paste),U(i["select-all"]),U(i.delete),U(i.duplicate),U(i["export-as-svg"]),U(i["export-as-png"])),ve("shortcuts-dialog.view",U(i["zoom-in"]),U(i["zoom-out"]),U(i["zoom-to-100"]),U(i["zoom-to-fit"]),U(i["zoom-to-selection"])),ve("shortcuts-dialog.transform",U(i["bring-to-front"]),U(i["bring-forward"]),U(i["send-backward"]),U(i["send-to-back"]),U(i.group),U(i.ungroup),U(i["flip-horizontal"]),U(i["flip-vertical"]),U(i["align-top"]),U(i["align-center-vertical"]),U(i["align-bottom"]),U(i["align-left"]),U(i["align-center-horizontal"]),U(i["align-right"]))]);return e?e(n,s,{tools:r,actions:i}):s},[n,e,i,r]);return y.jsx(n3.Provider,{value:o,children:t})});function bZ(){const e=J.useContext(n3);if(!e)throw new Error("Shortcuts must be used inside of a ShortcutsProvider.");return e}const wZ=()=>{const e=Se(),t=dr(),n=bZ();function r(i){if(!i||t&&!i.readonlyOk)return null;switch(i.type){case"group":return y.jsxs("div",{className:"tlui-shortcuts-dialog__group",children:[y.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:e(i.id)}),y.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:i.children.filter(o=>o&&o.type==="item"&&o.actionItem.kbd).map(r)})]},i.id);case"item":{const{id:o,label:s,shortcutsLabel:a,kbd:l}=i.actionItem;return y.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair",children:[y.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:e(a??s)}),y.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:y.jsx(zf,{children:l})})]},o)}}}return y.jsxs(y.Fragment,{children:[y.jsxs(Hf,{className:"tlui-shortcuts-dialog__header",children:[y.jsx(Kf,{children:e("shortcuts-dialog.title")}),y.jsx(Wf,{})]}),y.jsx(_u,{className:"tlui-shortcuts-dialog__body",children:n.map(r)}),y.jsx("div",{className:"tlui-dialog__scrim"})]})};function r3(){const e=H();return{languages:jc,currentLanguage:e.user.getLocale()}}const i3=J.createContext({}),xZ=Pe(function({overrides:e,children:t}){const n=H(),r=tn(),i=n.getSelectedShapeIds().length,o=i>0,s=i>1,a=i>2,{languages:l,currentLanguage:c}=r3(),{addDialog:u}=Ns(),d=x.useMemo(()=>{const h=he([ve("top",a1("LANGUAGE_MENU",{readonlyOk:!0}),U({id:"keyboard-shortcuts",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect(){u({component:wZ})}}))]);return e?e(n,h,{actions:r,currentLanguage:c,languages:l,oneSelected:o,twoSelected:s,threeSelected:a}):h},[n,e,l,r,o,s,a,c,u]);return y.jsx(i3.Provider,{value:d,children:t})});function SZ(){const e=J.useContext(i3);if(!e)throw new Error("useHelpMenuSchema must be used inside of a helpTLUiMenuSchemaProvider.");return e}function o3(){const e=H();return Y("useCanRedo",()=>e.getCanRedo(),[e])}function s3(){const e=H();return Y("useCanUndo",()=>e.getCanUndo(),[e])}const a3=J.createContext({});function kZ({overrides:e,children:t}){var F;const n=H(),r=tn(),i=fr()<5,o=Y("isDarkMode",()=>n.user.getIsDarkMode(),[n]),s=Y("animationSpeed",()=>n.user.getAnimationSpeed(),[n]),a=Y("edgeScrollSpeed",()=>n.user.getEdgeScrollSpeed(),[n]),l=Y("isGridMode",()=>n.getInstanceState().isGridMode,[n]),c=Y("isSnapMode",()=>n.user.getIsSnapMode(),[n]),u=Y("isToolLock",()=>n.getInstanceState().isToolLocked,[n]),d=Y("isFocusMode",()=>n.getInstanceState().isFocusMode,[n]),h=Y("isDebugMode",()=>n.getInstanceState().isDebugMode,[n]),p=Y("exportBackground",()=>n.getInstanceState().exportBackground,[n]),g=Y("emptyPage",()=>n.getCurrentPageShapeIds().size===0,[n]),f=Y("selectedCount",()=>n.getSelectedShapeIds().length,[n]),m=f===0,w=f>0,b=f>1,k=f>2,S=!!((F=window.navigator.clipboard)!=null&&F.write),C=d1(),_=QA(),P=l1(),I=c1(),M=s3(),A=o3(),L=Y("isZoomedTo100",()=>n.getZoomLevel()===1,[n]),z=Y("oneEmbedSelected",()=>{const R=n.getOnlySelectedShape();return R?!!(n.isShapeOfType(R,"embed")&&R.props.url&&!n.isShapeOrAncestorLocked(R)):!1},[]),$=Y("oneEmbeddableBookmarkSelected",()=>{const R=n.getOnlySelectedShape();return R?!!(n.isShapeOfType(R,"bookmark")&&R.props.url&&Vi(R.props.url)&&!n.isShapeOrAncestorLocked(R)):!1},[]),j=x.useMemo(()=>{const R=Zf([ve("menu",ui("file","menu.file",ve("print",U(r.print,{disabled:g}))),ui("edit","menu.edit",ve("undo-actions",U(r.undo,{disabled:!M}),U(r.redo,{disabled:!A})),ve("clipboard-actions",U(r.cut,{disabled:m}),U(r.copy,{disabled:m}),U(r.paste,{disabled:!GA})),ve("conversions",ui("copy-as","menu.copy-as",ve("copy-as-group",U(r["copy-as-svg"],{disabled:g}),U(r["copy-as-png"],{disabled:g||!S}),U(r["copy-as-json"],{disabled:g})),ve("export-bg",U(r["toggle-transparent"],{checked:!p}))),ui("export-as","menu.export-as",ve("export-as-group",U(r["export-as-svg"],{disabled:g}),U(r["export-as-png"],{disabled:g}),U(r["export-as-json"],{disabled:g})),ve("export-bg",U(r["toggle-transparent"],{checked:!p})))),ve("set-selection-group",U(r["select-all"],{disabled:g}),U(r["select-none"],{disabled:!w})),ve("selection",_&&U(r["toggle-auto-size"]),C&&U(r["edit-link"]),U(r.duplicate,{disabled:!w}),P&&U(r.group),I&&U(r.ungroup),U(r["unlock-all"],{disabled:g})),ve("delete-group",U(r.delete,{disabled:!w})),ve("embeds",z&&U(r["open-embed-link"]),z&&U(r["convert-to-bookmark"]),$&&U(r["convert-to-embed"]))),ui("view","menu.view",ve("view-actions",U(r["zoom-in"]),U(r["zoom-out"]),U(r["zoom-to-100"],{disabled:L}),U(r["zoom-to-fit"],{disabled:g}),U(r["zoom-to-selection"],{disabled:g||!w})))),ve("extras",U(r["insert-embed"]),U(r["insert-media"])),ve("preferences",ui("preferences","menu.preferences",ve("preferences-actions",U(r["toggle-snap-mode"],{checked:c}),U(r["toggle-tool-lock"],{checked:u}),U(r["toggle-grid"],{checked:l}),U(r["toggle-dark-mode"],{checked:o}),U(r["toggle-focus-mode"],{checked:d}),U(r["toggle-edge-scrolling"],{checked:a===1}),U(r["toggle-reduce-motion"],{checked:s===0}),U(r["toggle-debug-mode"],{checked:h}))),i&&a1("LANGUAGE_MENU",{readonlyOk:!0}))]);return e?e(n,R,{actions:r,noneSelected:m,oneSelected:w,twoSelected:b,threeSelected:k}):R},[n,e,r,w,b,k,g,i,P,I,C,S,_,m,M,A,s,o,l,c,u,d,p,h,a,L,$,z]);return y.jsx(a3.Provider,{value:j,children:t})}function _Z(){const e=J.useContext(a3);if(!e)throw new Error("useMenuSchema must be used inside of a TLUiMenuSchemaProvider.");return e}function $e(e){return{id:e.id,type:"item",readonlyOk:e.readonlyOk,toolItem:e}}const l3=J.createContext([]);function CZ({overrides:e,children:t}){const n=H(),r=h1(),i=J.useMemo(()=>{const o=he([$e(r.select),$e(r.hand),$e(r.draw),$e(r.eraser),$e(r.arrow),$e(r.text),$e(r.note),$e(r.asset),$e(r.rectangle),$e(r.ellipse),$e(r.diamond),$e(r.triangle),$e(r.trapezoid),$e(r.rhombus),$e(r.hexagon),$e(r.cloud),$e(r.star),$e(r.oval),$e(r["x-box"]),$e(r["check-box"]),$e(r["arrow-left"]),$e(r["arrow-up"]),$e(r["arrow-down"]),$e(r["arrow-right"]),$e(r.line),$e(r.highlight),$e(r.frame),$e(r.laser)]);return e?e(n,o,{tools:r}):o},[n,e,r]);return y.jsx(l3.Provider,{value:i,children:t})}function EZ(){const e=J.useContext(l3);if(!e)throw new Error("useToolbarSchema must be used within a ToolbarSchemaProvider");return e}function PZ(){const{addToast:e,removeToast:t,clearToasts:n}=ci(),{addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:s}=Ns(),a=fr()<5,l=Se();return x.useMemo(()=>({addToast:e,removeToast:t,clearToasts:n,addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:s,msg:l,isMobile:a}),[r,e,i,n,l,o,t,s,a])}function IZ(e,t){const n={};for(const r of e)if(r.translations)for(const[i,o]of Mi(r.translations)){let s=n[i];s||(s=n[i]={}),Object.assign(s,o)}return{actionsMenu:(r,i,o)=>{for(const s of e)s.actionsMenu&&(i=s.actionsMenu(r,i,{...t,...o}));return i},actions:(r,i)=>{for(const o of e)o.actions&&(i=o.actions(r,i,t));return i},contextMenu:(r,i,o)=>{for(const s of e)s.contextMenu&&(i=s.contextMenu(r,i,{...t,...o}));return i},helpMenu:(r,i,o)=>{for(const s of e)s.helpMenu&&(i=s.helpMenu(r,i,{...t,...o}));return i},menu:(r,i,o)=>{for(const s of e)s.menu&&(i=s.menu(r,i,{...t,...o}));return i},toolbar:(r,i,o)=>{for(const s of e)s.toolbar&&(i=s.toolbar(r,i,{...t,...o}));return i},keyboardShortcutsMenu:(r,i,o)=>{for(const s of e)s.keyboardShortcutsMenu&&(i=s.keyboardShortcutsMenu(r,i,{...t,...o}));return i},tools:(r,i,o)=>{for(const s of e)s.tools&&(i=s.tools(r,i,{...t,...o}));return i},translations:n}}function c3(e){return x.useMemo(()=>e,e)}function MZ(e){const t=c3(e==null?[]:Array.isArray(e)?e:[e]);return x.useMemo(()=>{const n={};for(const r of t)if(r.translations)for(const[i,o]of Mi(r.translations)){let s=n[i];s||(s=n[i]={}),Object.assign(s,o)}return n},[t])}function AZ(e){const t=PZ(),n=c3(e==null?[]:Array.isArray(e)?e:[e]);return x.useMemo(()=>IZ(n,t),[n,t])}function TZ({overrides:e,assetUrls:t,onUiEvent:n,forceMobile:r,children:i}){return y.jsx(gG,{assetUrls:dG(t),children:y.jsx(vG,{overrides:MZ(e),children:y.jsx($q,{onEvent:n,children:y.jsx(tZ,{children:y.jsx(rZ,{children:y.jsx(hZ,{forceMobile:r,children:y.jsx(jZ,{overrides:e,children:i})})})})})})})}function jZ({overrides:e,children:t}){const n=AZ(e);return y.jsx(cZ,{overrides:n.actions,children:y.jsx(yZ,{overrides:n.tools,children:y.jsx(CZ,{overrides:n.toolbar,children:y.jsx(pZ,{overrides:n.actionsMenu,children:y.jsx(vZ,{overrides:n.keyboardShortcutsMenu,children:y.jsx(mZ,{overrides:n.contextMenu,children:y.jsx(xZ,{overrides:n.helpMenu,children:y.jsx(kZ,{overrides:n.menu,children:t})})})})})})})})}function OZ(){const e=H(),t=tn()["back-to-content"],[n,r]=x.useState(!1);return x.useEffect(()=>{let i=!1;const o=setInterval(()=>{const s=e.getRenderingShapes(),a=e.getRenderingBounds(),l=s.filter(c=>c.maskedPageBounds&&a.includes(c.maskedPageBounds)).length===0&&e.getCurrentPageShapes().length>0;i!==l&&(r(l),i=l)},1e3);return()=>{clearInterval(o)}},[e]),n?y.jsx(oe,{iconLeft:t.icon,label:t.label,type:"low",onClick:()=>{t.onSelect("helper-buttons"),r(!1)}}):null}const LZ=x.createContext(void 0);function p1(e){const t=x.useContext(LZ);return e||t||"ltr"}const DZ=["top","right","bottom","left"],Vo=Math.min,Yn=Math.max,Qf=Math.round,Jf=Math.floor,Ho=e=>({x:e,y:e}),zZ={left:"right",right:"left",bottom:"top",top:"bottom"},NZ={start:"end",end:"start"};function f1(e,t,n){return Yn(e,Vo(t,n))}function Yi(e,t){return typeof e=="function"?e(t):e}function Xi(e){return e.split("-")[0]}function gl(e){return e.split("-")[1]}function g1(e){return e==="x"?"y":"x"}function m1(e){return e==="y"?"height":"width"}function ml(e){return["top","bottom"].includes(Xi(e))?"y":"x"}function y1(e){return g1(ml(e))}function RZ(e,t,n){n===void 0&&(n=!1);const r=gl(e),i=y1(e),o=m1(i);let s=i==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return t.reference[o]>t.floating[o]&&(s=eg(s)),[s,eg(s)]}function FZ(e){const t=eg(e);return[v1(e),t,v1(t)]}function v1(e){return e.replace(/start|end/g,t=>NZ[t])}function $Z(e,t,n){const r=["left","right"],i=["right","left"],o=["top","bottom"],s=["bottom","top"];switch(e){case"top":case"bottom":return n?t?i:r:t?r:i;case"left":case"right":return t?o:s;default:return[]}}function BZ(e,t,n,r){const i=gl(e);let o=$Z(Xi(e),n==="start",r);return i&&(o=o.map(s=>s+"-"+i),t&&(o=o.concat(o.map(v1)))),o}function eg(e){return e.replace(/left|right|bottom|top/g,t=>zZ[t])}function UZ(e){return{top:0,right:0,bottom:0,left:0,...e}}function u3(e){return typeof e!="number"?UZ(e):{top:e,right:e,bottom:e,left:e}}function tg(e){return{...e,top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}function h3(e,t,n){let{reference:r,floating:i}=e;const o=ml(t),s=y1(t),a=m1(s),l=Xi(t),c=o==="y",u=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,h=r[a]/2-i[a]/2;let p;switch(l){case"top":p={x:u,y:r.y-i.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-i.width,y:d};break;default:p={x:r.x,y:r.y}}switch(gl(t)){case"start":p[s]-=h*(n&&c?-1:1);break;case"end":p[s]+=h*(n&&c?-1:1);break}return p}const VZ=async(e,t,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:s}=n,a=o.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(t));let c=await s.getElementRects({reference:e,floating:t,strategy:i}),{x:u,y:d}=h3(c,r,l),h=r,p={},g=0;for(let f=0;f<a.length;f++){const{name:m,fn:w}=a[f],{x:b,y:k,data:S,reset:C}=await w({x:u,y:d,initialPlacement:r,placement:h,strategy:i,middlewareData:p,rects:c,platform:s,elements:{reference:e,floating:t}});u=b??u,d=k??d,p={...p,[m]:{...p[m],...S}},C&&g<=50&&(g++,typeof C=="object"&&(C.placement&&(h=C.placement),C.rects&&(c=C.rects===!0?await s.getElementRects({reference:e,floating:t,strategy:i}):C.rects),{x:u,y:d}=h3(c,h,l)),f=-1)}return{x:u,y:d,placement:h,strategy:i,middlewareData:p}};async function Eu(e,t){var n;t===void 0&&(t={});const{x:r,y:i,platform:o,rects:s,elements:a,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=Yi(t,e),g=u3(p),f=a[h?d==="floating"?"reference":"floating":d],m=tg(await o.getClippingRect({element:(n=await(o.isElement==null?void 0:o.isElement(f)))==null||n?f:f.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),w=d==="floating"?{...s.floating,x:r,y:i}:s.reference,b=await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),k=await(o.isElement==null?void 0:o.isElement(b))?await(o.getScale==null?void 0:o.getScale(b))||{x:1,y:1}:{x:1,y:1},S=tg(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:w,offsetParent:b,strategy:l}):w);return{top:(m.top-S.top+g.top)/k.y,bottom:(S.bottom-m.bottom+g.bottom)/k.y,left:(m.left-S.left+g.left)/k.x,right:(S.right-m.right+g.right)/k.x}}const HZ=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:r,placement:i,rects:o,platform:s,elements:a,middlewareData:l}=t,{element:c,padding:u=0}=Yi(e,t)||{};if(c==null)return{};const d=u3(u),h={x:n,y:r},p=y1(i),g=m1(p),f=await s.getDimensions(c),m=p==="y",w=m?"top":"left",b=m?"bottom":"right",k=m?"clientHeight":"clientWidth",S=o.reference[g]+o.reference[p]-h[p]-o.floating[g],C=h[p]-o.reference[p],_=await(s.getOffsetParent==null?void 0:s.getOffsetParent(c));let P=_?_[k]:0;(!P||!await(s.isElement==null?void 0:s.isElement(_)))&&(P=a.floating[k]||o.floating[g]);const I=S/2-C/2,M=P/2-f[g]/2-1,A=Vo(d[w],M),L=Vo(d[b],M),z=A,$=P-f[g]-L,j=P/2-f[g]/2+I,F=f1(z,j,$),R=!l.arrow&&gl(i)!=null&&j!==F&&o.reference[g]/2-(j<z?A:L)-f[g]/2<0,W=R?j<z?j-z:j-$:0;return{[p]:h[p]+W,data:{[p]:F,centerOffset:j-F-W,...R&&{alignmentOffset:W}},reset:R}}}),KZ=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,r;const{placement:i,middlewareData:o,rects:s,initialPlacement:a,platform:l,elements:c}=t,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:f=!0,...m}=Yi(e,t);if((n=o.arrow)!=null&&n.alignmentOffset)return{};const w=Xi(i),b=Xi(a)===a,k=await(l.isRTL==null?void 0:l.isRTL(c.floating)),S=h||(b||!f?[eg(a)]:FZ(a));!h&&g!=="none"&&S.push(...BZ(a,f,g,k));const C=[a,...S],_=await Eu(t,m),P=[];let I=((r=o.flip)==null?void 0:r.overflows)||[];if(u&&P.push(_[w]),d){const z=RZ(i,s,k);P.push(_[z[0]],_[z[1]])}if(I=[...I,{placement:i,overflows:P}],!P.every(z=>z<=0)){var M,A;const z=(((M=o.flip)==null?void 0:M.index)||0)+1,$=C[z];if($)return{data:{index:z,overflows:I},reset:{placement:$}};let j=(A=I.filter(F=>F.overflows[0]<=0).sort((F,R)=>F.overflows[1]-R.overflows[1])[0])==null?void 0:A.placement;if(!j)switch(p){case"bestFit":{var L;const F=(L=I.map(R=>[R.placement,R.overflows.filter(W=>W>0).reduce((W,V)=>W+V,0)]).sort((R,W)=>R[1]-W[1])[0])==null?void 0:L[0];F&&(j=F);break}case"initialPlacement":j=a;break}if(i!==j)return{reset:{placement:j}}}return{}}}};function p3(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function f3(e){return DZ.some(t=>e[t]>=0)}const WZ=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:r="referenceHidden",...i}=Yi(e,t);switch(r){case"referenceHidden":{const o=await Eu(t,{...i,elementContext:"reference"}),s=p3(o,n.reference);return{data:{referenceHiddenOffsets:s,referenceHidden:f3(s)}}}case"escaped":{const o=await Eu(t,{...i,altBoundary:!0}),s=p3(o,n.floating);return{data:{escapedOffsets:s,escaped:f3(s)}}}default:return{}}}}};async function YZ(e,t){const{placement:n,platform:r,elements:i}=e,o=await(r.isRTL==null?void 0:r.isRTL(i.floating)),s=Xi(n),a=gl(n),l=ml(n)==="y",c=["left","top"].includes(s)?-1:1,u=o&&l?-1:1,d=Yi(t,e);let{mainAxis:h,crossAxis:p,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...d};return a&&typeof g=="number"&&(p=a==="end"?g*-1:g),l?{x:p*u,y:h*c}:{x:h*c,y:p*u}}const XZ=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,r;const{x:i,y:o,placement:s,middlewareData:a}=t,l=await YZ(t,e);return s===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+l.x,y:o+l.y,data:{...l,placement:s}}}}},GZ=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:r,placement:i}=t,{mainAxis:o=!0,crossAxis:s=!1,limiter:a={fn:m=>{let{x:w,y:b}=m;return{x:w,y:b}}},...l}=Yi(e,t),c={x:n,y:r},u=await Eu(t,l),d=ml(Xi(i)),h=g1(d);let p=c[h],g=c[d];if(o){const m=h==="y"?"top":"left",w=h==="y"?"bottom":"right",b=p+u[m],k=p-u[w];p=f1(b,p,k)}if(s){const m=d==="y"?"top":"left",w=d==="y"?"bottom":"right",b=g+u[m],k=g-u[w];g=f1(b,g,k)}const f=a.fn({...t,[h]:p,[d]:g});return{...f,data:{x:f.x-n,y:f.y-r}}}}},qZ=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:n,y:r,placement:i,rects:o,middlewareData:s}=t,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Yi(e,t),u={x:n,y:r},d=ml(i),h=g1(d);let p=u[h],g=u[d];const f=Yi(a,t),m=typeof f=="number"?{mainAxis:f,crossAxis:0}:{mainAxis:0,crossAxis:0,...f};if(l){const k=h==="y"?"height":"width",S=o.reference[h]-o.floating[k]+m.mainAxis,C=o.reference[h]+o.reference[k]-m.mainAxis;p<S?p=S:p>C&&(p=C)}if(c){var w,b;const k=h==="y"?"width":"height",S=["top","left"].includes(Xi(i)),C=o.reference[d]-o.floating[k]+(S&&((w=s.offset)==null?void 0:w[d])||0)+(S?0:m.crossAxis),_=o.reference[d]+o.reference[k]+(S?0:((b=s.offset)==null?void 0:b[d])||0)-(S?m.crossAxis:0);g<C?g=C:g>_&&(g=_)}return{[h]:p,[d]:g}}}},ZZ=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){const{placement:n,rects:r,platform:i,elements:o}=t,{apply:s=()=>{},...a}=Yi(e,t),l=await Eu(t,a),c=Xi(n),u=gl(n),d=ml(n)==="y",{width:h,height:p}=r.floating;let g,f;c==="top"||c==="bottom"?(g=c,f=u===(await(i.isRTL==null?void 0:i.isRTL(o.floating))?"start":"end")?"left":"right"):(f=c,g=u==="end"?"top":"bottom");const m=p-l[g],w=h-l[f],b=!t.middlewareData.shift;let k=m,S=w;if(d){const _=h-l.left-l.right;S=u||b?Vo(w,_):_}else{const _=p-l.top-l.bottom;k=u||b?Vo(m,_):_}if(b&&!u){const _=Yn(l.left,0),P=Yn(l.right,0),I=Yn(l.top,0),M=Yn(l.bottom,0);d?S=h-2*(_!==0||P!==0?_+P:Yn(l.left,l.right)):k=p-2*(I!==0||M!==0?I+M:Yn(l.top,l.bottom))}await s({...t,availableWidth:S,availableHeight:k});const C=await i.getDimensions(o.floating);return h!==C.width||p!==C.height?{reset:{rects:!0}}:{}}}};function Ko(e){return g3(e)?(e.nodeName||"").toLowerCase():"#document"}function Xn(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Gi(e){var t;return(t=(g3(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function g3(e){return e instanceof Node||e instanceof Xn(e).Node}function qi(e){return e instanceof Element||e instanceof Xn(e).Element}function di(e){return e instanceof HTMLElement||e instanceof Xn(e).HTMLElement}function m3(e){return typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Xn(e).ShadowRoot}function Pu(e){const{overflow:t,overflowX:n,overflowY:r,display:i}=gr(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!["inline","contents"].includes(i)}function QZ(e){return["table","td","th"].includes(Ko(e))}function b1(e){const t=w1(),n=gr(e);return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function JZ(e){let t=yl(e);for(;di(t)&&!ng(t);){if(b1(t))return t;t=yl(t)}return null}function w1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function ng(e){return["html","body","#document"].includes(Ko(e))}function gr(e){return Xn(e).getComputedStyle(e)}function rg(e){return qi(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function yl(e){if(Ko(e)==="html")return e;const t=e.assignedSlot||e.parentNode||m3(e)&&e.host||Gi(e);return m3(t)?t.host:t}function y3(e){const t=yl(e);return ng(t)?e.ownerDocument?e.ownerDocument.body:e.body:di(t)&&Pu(t)?t:y3(t)}function Iu(e,t,n){var r;t===void 0&&(t=[]),n===void 0&&(n=!0);const i=y3(e),o=i===((r=e.ownerDocument)==null?void 0:r.body),s=Xn(i);return o?t.concat(s,s.visualViewport||[],Pu(i)?i:[],s.frameElement&&n?Iu(s.frameElement):[]):t.concat(i,Iu(i,[],n))}function v3(e){const t=gr(e);let n=parseFloat(t.width)||0,r=parseFloat(t.height)||0;const i=di(e),o=i?e.offsetWidth:n,s=i?e.offsetHeight:r,a=Qf(n)!==o||Qf(r)!==s;return a&&(n=o,r=s),{width:n,height:r,$:a}}function x1(e){return qi(e)?e:e.contextElement}function vl(e){const t=x1(e);if(!di(t))return Ho(1);const n=t.getBoundingClientRect(),{width:r,height:i,$:o}=v3(t);let s=(o?Qf(n.width):n.width)/r,a=(o?Qf(n.height):n.height)/i;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const eQ=Ho(0);function b3(e){const t=Xn(e);return!w1()||!t.visualViewport?eQ:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function tQ(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==Xn(e)?!1:t}function Rs(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1);const i=e.getBoundingClientRect(),o=x1(e);let s=Ho(1);t&&(r?qi(r)&&(s=vl(r)):s=vl(e));const a=tQ(o,n,r)?b3(o):Ho(0);let l=(i.left+a.x)/s.x,c=(i.top+a.y)/s.y,u=i.width/s.x,d=i.height/s.y;if(o){const h=Xn(o),p=r&&qi(r)?Xn(r):r;let g=h,f=g.frameElement;for(;f&&r&&p!==g;){const m=vl(f),w=f.getBoundingClientRect(),b=gr(f),k=w.left+(f.clientLeft+parseFloat(b.paddingLeft))*m.x,S=w.top+(f.clientTop+parseFloat(b.paddingTop))*m.y;l*=m.x,c*=m.y,u*=m.x,d*=m.y,l+=k,c+=S,g=Xn(f),f=g.frameElement}}return tg({width:u,height:d,x:l,y:c})}const nQ=[":popover-open",":modal"];function w3(e){return nQ.some(t=>{try{return e.matches(t)}catch{return!1}})}function rQ(e){let{elements:t,rect:n,offsetParent:r,strategy:i}=e;const o=i==="fixed",s=Gi(r),a=t?w3(t.floating):!1;if(r===s||a&&o)return n;let l={scrollLeft:0,scrollTop:0},c=Ho(1);const u=Ho(0),d=di(r);if((d||!d&&!o)&&((Ko(r)!=="body"||Pu(s))&&(l=rg(r)),di(r))){const h=Rs(r);c=vl(r),u.x=h.x+r.clientLeft,u.y=h.y+r.clientTop}return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x,y:n.y*c.y-l.scrollTop*c.y+u.y}}function iQ(e){return Array.from(e.getClientRects())}function x3(e){return Rs(Gi(e)).left+rg(e).scrollLeft}function oQ(e){const t=Gi(e),n=rg(e),r=e.ownerDocument.body,i=Yn(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),o=Yn(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight);let s=-n.scrollLeft+x3(e);const a=-n.scrollTop;return gr(r).direction==="rtl"&&(s+=Yn(t.clientWidth,r.clientWidth)-i),{width:i,height:o,x:s,y:a}}function sQ(e,t){const n=Xn(e),r=Gi(e),i=n.visualViewport;let o=r.clientWidth,s=r.clientHeight,a=0,l=0;if(i){o=i.width,s=i.height;const c=w1();(!c||c&&t==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:o,height:s,x:a,y:l}}function aQ(e,t){const n=Rs(e,!0,t==="fixed"),r=n.top+e.clientTop,i=n.left+e.clientLeft,o=di(e)?vl(e):Ho(1),s=e.clientWidth*o.x,a=e.clientHeight*o.y,l=i*o.x,c=r*o.y;return{width:s,height:a,x:l,y:c}}function S3(e,t,n){let r;if(t==="viewport")r=sQ(e,n);else if(t==="document")r=oQ(Gi(e));else if(qi(t))r=aQ(t,n);else{const i=b3(e);r={...t,x:t.x-i.x,y:t.y-i.y}}return tg(r)}function k3(e,t){const n=yl(e);return n===t||!qi(n)||ng(n)?!1:gr(n).position==="fixed"||k3(n,t)}function lQ(e,t){const n=t.get(e);if(n)return n;let r=Iu(e,[],!1).filter(a=>qi(a)&&Ko(a)!=="body"),i=null;const o=gr(e).position==="fixed";let s=o?yl(e):e;for(;qi(s)&&!ng(s);){const a=gr(s),l=b1(s);!l&&a.position==="fixed"&&(i=null),(o?!l&&!i:!l&&a.position==="static"&&i&&["absolute","fixed"].includes(i.position)||Pu(s)&&!l&&k3(e,s))?r=r.filter(c=>c!==s):i=a,s=yl(s)}return t.set(e,r),r}function cQ(e){let{element:t,boundary:n,rootBoundary:r,strategy:i}=e;const o=[...n==="clippingAncestors"?lQ(t,this._c):[].concat(n),r],s=o[0],a=o.reduce((l,c)=>{const u=S3(t,c,i);return l.top=Yn(u.top,l.top),l.right=Vo(u.right,l.right),l.bottom=Vo(u.bottom,l.bottom),l.left=Yn(u.left,l.left),l},S3(t,s,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function uQ(e){const{width:t,height:n}=v3(e);return{width:t,height:n}}function dQ(e,t,n){const r=di(t),i=Gi(t),o=n==="fixed",s=Rs(e,!0,o,t);let a={scrollLeft:0,scrollTop:0};const l=Ho(0);if(r||!r&&!o)if((Ko(t)!=="body"||Pu(i))&&(a=rg(t)),r){const d=Rs(t,!0,o,t);l.x=d.x+t.clientLeft,l.y=d.y+t.clientTop}else i&&(l.x=x3(i));const c=s.left+a.scrollLeft-l.x,u=s.top+a.scrollTop-l.y;return{x:c,y:u,width:s.width,height:s.height}}function _3(e,t){return!di(e)||gr(e).position==="fixed"?null:t?t(e):e.offsetParent}function C3(e,t){const n=Xn(e);if(!di(e)||w3(e))return n;let r=_3(e,t);for(;r&&QZ(r)&&gr(r).position==="static";)r=_3(r,t);return r&&(Ko(r)==="html"||Ko(r)==="body"&&gr(r).position==="static"&&!b1(r))?n:r||JZ(e)||n}const hQ=async function(e){const t=this.getOffsetParent||C3,n=this.getDimensions;return{reference:dQ(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,...await n(e.floating)}}};function pQ(e){return gr(e).direction==="rtl"}const fQ={convertOffsetParentRelativeRectToViewportRelativeRect:rQ,getDocumentElement:Gi,getClippingRect:cQ,getOffsetParent:C3,getElementRects:hQ,getClientRects:iQ,getDimensions:uQ,getScale:vl,isElement:qi,isRTL:pQ};function gQ(e,t){let n=null,r;const i=Gi(e);function o(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function s(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),o();const{left:c,top:u,width:d,height:h}=e.getBoundingClientRect();if(a||t(),!d||!h)return;const p=Jf(u),g=Jf(i.clientWidth-(c+d)),f=Jf(i.clientHeight-(u+h)),m=Jf(c),w={rootMargin:-p+"px "+-g+"px "+-f+"px "+-m+"px",threshold:Yn(0,Vo(1,l))||1};let b=!0;function k(S){const C=S[0].intersectionRatio;if(C!==l){if(!b)return s();C?s(!1,C):r=setTimeout(()=>{s(!1,1e-7)},100)}b=!1}try{n=new IntersectionObserver(k,{...w,root:i.ownerDocument})}catch{n=new IntersectionObserver(k,w)}n.observe(e)}return s(!0),o}function mQ(e,t,n,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:o=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=x1(e),u=i||o?[...c?Iu(c):[],...Iu(t)]:[];u.forEach(w=>{i&&w.addEventListener("scroll",n,{passive:!0}),o&&w.addEventListener("resize",n)});const d=c&&a?gQ(c,n):null;let h=-1,p=null;s&&(p=new ResizeObserver(w=>{let[b]=w;b&&b.target===c&&p&&(p.unobserve(t),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var k;(k=p)==null||k.observe(t)})),n()}),c&&!l&&p.observe(c),p.observe(t));let g,f=l?Rs(e):null;l&&m();function m(){const w=Rs(e);f&&(w.x!==f.x||w.y!==f.y||w.width!==f.width||w.height!==f.height)&&n(),f=w,g=requestAnimationFrame(m)}return n(),()=>{var w;u.forEach(b=>{i&&b.removeEventListener("scroll",n),o&&b.removeEventListener("resize",n)}),d==null||d(),(w=p)==null||w.disconnect(),p=null,l&&cancelAnimationFrame(g)}}const yQ=GZ,vQ=KZ,bQ=ZZ,wQ=WZ,E3=HZ,xQ=qZ,SQ=(e,t,n)=>{const r=new Map,i={platform:fQ,...n},o={...i.platform,_c:r};return VZ(e,t,{...i,platform:o})},kQ=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:r,padding:i}=typeof e=="function"?e(n):e;return r&&t(r)?r.current!=null?E3({element:r.current,padding:i}).fn(n):{}:r?E3({element:r,padding:i}).fn(n):{}}}};var ig=typeof document<"u"?x.useLayoutEffect:x.useEffect;function og(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,r,i;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(r=n;r--!==0;)if(!og(e[r],t[r]))return!1;return!0}if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(t,i[r]))return!1;for(r=n;r--!==0;){const o=i[r];if(!(o==="_owner"&&e.$$typeof)&&!og(e[o],t[o]))return!1}return!0}return e!==e&&t!==t}function P3(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function I3(e,t){const n=P3(e);return Math.round(t*n)/n}function M3(e){const t=x.useRef(e);return ig(()=>{t.current=e}),t}function _Q(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:i,elements:{reference:o,floating:s}={},transform:a=!0,whileElementsMounted:l,open:c}=e,[u,d]=x.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[h,p]=x.useState(r);og(h,r)||p(r);const[g,f]=x.useState(null),[m,w]=x.useState(null),b=x.useCallback(W=>{W!==_.current&&(_.current=W,f(W))},[]),k=x.useCallback(W=>{W!==P.current&&(P.current=W,w(W))},[]),S=o||g,C=s||m,_=x.useRef(null),P=x.useRef(null),I=x.useRef(u),M=l!=null,A=M3(l),L=M3(i),z=x.useCallback(()=>{if(!_.current||!P.current)return;const W={placement:t,strategy:n,middleware:h};L.current&&(W.platform=L.current),SQ(_.current,P.current,W).then(V=>{const D={...V,isPositioned:!0};$.current&&!og(I.current,D)&&(I.current=D,wa.flushSync(()=>{d(D)}))})},[h,t,n,L]);ig(()=>{c===!1&&I.current.isPositioned&&(I.current.isPositioned=!1,d(W=>({...W,isPositioned:!1})))},[c]);const $=x.useRef(!1);ig(()=>($.current=!0,()=>{$.current=!1}),[]),ig(()=>{if(S&&(_.current=S),C&&(P.current=C),S&&C){if(A.current)return A.current(S,C,z);z()}},[S,C,z,A,M]);const j=x.useMemo(()=>({reference:_,floating:P,setReference:b,setFloating:k}),[b,k]),F=x.useMemo(()=>({reference:S,floating:C}),[S,C]),R=x.useMemo(()=>{const W={position:n,left:0,top:0};if(!F.floating)return W;const V=I3(F.floating,u.x),D=I3(F.floating,u.y);return a?{...W,transform:"translate("+V+"px, "+D+"px)",...P3(F.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:V,top:D}},[n,a,F.floating,u.x,u.y]);return x.useMemo(()=>({...u,update:z,refs:j,elements:F,floatingStyles:R}),[u,z,j,F,R])}function A3(e){const[t,n]=x.useState(void 0);return Ds(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const o=i[0];let s,a;if("borderBoxSize"in o){const l=o.borderBoxSize,c=Array.isArray(l)?l[0]:l;s=c.inlineSize,a=c.blockSize}else s=e.offsetWidth,a=e.offsetHeight;n({width:s,height:a})});return r.observe(e,{box:"border-box"}),()=>r.unobserve(e)}else n(void 0)},[e]),t}const T3="Popper",[j3,sg]=si(T3),[CQ,O3]=j3(T3),EQ=e=>{const{__scopePopper:t,children:n}=e,[r,i]=x.useState(null);return x.createElement(CQ,{scope:t,anchor:r,onAnchorChange:i},n)},PQ="PopperAnchor",IQ=x.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:r,...i}=e,o=O3(PQ,n),s=x.useRef(null),a=We(t,s);return x.useEffect(()=>{o.onAnchorChange((r==null?void 0:r.current)||s.current)}),r?null:x.createElement(Fe.div,Z({},i,{ref:a}))}),L3="PopperContent",[MQ,Cre]=j3(L3),AQ=x.forwardRef((e,t)=>{var n,r,i,o,s,a,l,c;const{__scopePopper:u,side:d="bottom",sideOffset:h=0,align:p="center",alignOffset:g=0,arrowPadding:f=0,avoidCollisions:m=!0,collisionBoundary:w=[],collisionPadding:b=0,sticky:k="partial",hideWhenDetached:S=!1,updatePositionStrategy:C="optimized",onPlaced:_,...P}=e,I=O3(L3,u),[M,A]=x.useState(null),L=We(t,at=>A(at)),[z,$]=x.useState(null),j=A3(z),F=(n=j==null?void 0:j.width)!==null&&n!==void 0?n:0,R=(r=j==null?void 0:j.height)!==null&&r!==void 0?r:0,W=d+(p!=="center"?"-"+p:""),V=typeof b=="number"?b:{top:0,right:0,bottom:0,left:0,...b},D=Array.isArray(w)?w:[w],B=D.length>0,X={padding:V,boundary:D.filter(TQ),altBoundary:B},{refs:ie,floatingStyles:ue,placement:ge,isPositioned:ce,middlewareData:be}=_Q({strategy:"fixed",placement:W,whileElementsMounted:(...at)=>mQ(...at,{animationFrame:C==="always"}),elements:{reference:I.anchor},middleware:[XZ({mainAxis:h+R,alignmentAxis:g}),m&&yQ({mainAxis:!0,crossAxis:!1,limiter:k==="partial"?xQ():void 0,...X}),m&&vQ({...X}),bQ({...X,apply:({elements:at,rects:gi,availableWidth:Pl,availableHeight:Ig})=>{const{width:Mg,height:Ag}=gi.reference,Vs=at.floating.style;Vs.setProperty("--radix-popper-available-width",`${Pl}px`),Vs.setProperty("--radix-popper-available-height",`${Ig}px`),Vs.setProperty("--radix-popper-anchor-width",`${Mg}px`),Vs.setProperty("--radix-popper-anchor-height",`${Ag}px`)}}),z&&kQ({element:z,padding:f}),jQ({arrowWidth:F,arrowHeight:R}),S&&wQ({strategy:"referenceHidden",...X})]}),[ft,Ie]=D3(ge),Ce=en(_);Ds(()=>{ce&&(Ce==null||Ce())},[ce,Ce]);const Me=(i=be.arrow)===null||i===void 0?void 0:i.x,vr=(o=be.arrow)===null||o===void 0?void 0:o.y,gn=((s=be.arrow)===null||s===void 0?void 0:s.centerOffset)!==0,[Mn,gt]=x.useState();return Ds(()=>{M&&gt(window.getComputedStyle(M).zIndex)},[M]),x.createElement("div",{ref:ie.setFloating,"data-radix-popper-content-wrapper":"",style:{...ue,transform:ce?ue.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Mn,"--radix-popper-transform-origin":[(a=be.transformOrigin)===null||a===void 0?void 0:a.x,(l=be.transformOrigin)===null||l===void 0?void 0:l.y].join(" ")},dir:e.dir},x.createElement(MQ,{scope:u,placedSide:ft,onArrowChange:$,arrowX:Me,arrowY:vr,shouldHideArrow:gn},x.createElement(Fe.div,Z({"data-side":ft,"data-align":Ie},P,{ref:L,style:{...P.style,animation:ce?void 0:"none",opacity:(c=be.hide)!==null&&c!==void 0&&c.referenceHidden?0:void 0}}))))});function TQ(e){return e!==null}const jQ=e=>({name:"transformOrigin",options:e,fn(t){var n,r,i,o,s;const{placement:a,rects:l,middlewareData:c}=t,u=((n=c.arrow)===null||n===void 0?void 0:n.centerOffset)!==0,d=u?0:e.arrowWidth,h=u?0:e.arrowHeight,[p,g]=D3(a),f={start:"0%",center:"50%",end:"100%"}[g],m=((r=(i=c.arrow)===null||i===void 0?void 0:i.x)!==null&&r!==void 0?r:0)+d/2,w=((o=(s=c.arrow)===null||s===void 0?void 0:s.y)!==null&&o!==void 0?o:0)+h/2;let b="",k="";return p==="bottom"?(b=u?f:`${m}px`,k=`${-h}px`):p==="top"?(b=u?f:`${m}px`,k=`${l.floating.height+h}px`):p==="right"?(b=`${-h}px`,k=u?f:`${w}px`):p==="left"&&(b=`${l.floating.width+h}px`,k=u?f:`${w}px`),{data:{x:b,y:k}}}});function D3(e){const[t,n="center"]=e.split("-");return[t,n]}const S1=EQ,z3=IQ,N3=AQ,k1="rovingFocusGroup.onEntryFocus",OQ={bubbles:!1,cancelable:!0},_1="RovingFocusGroup",[C1,R3,LQ]=Mf(_1),[DQ,F3]=si(_1,[LQ]),[zQ,NQ]=DQ(_1),RQ=x.forwardRef((e,t)=>x.createElement(C1.Provider,{scope:e.__scopeRovingFocusGroup},x.createElement(C1.Slot,{scope:e.__scopeRovingFocusGroup},x.createElement(FQ,Z({},e,{ref:t}))))),FQ=x.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:o,currentTabStopId:s,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,...u}=e,d=x.useRef(null),h=We(t,d),p=p1(o),[g=null,f]=Bo({prop:s,defaultProp:a,onChange:l}),[m,w]=x.useState(!1),b=en(c),k=R3(n),S=x.useRef(!1),[C,_]=x.useState(0);return x.useEffect(()=>{const P=d.current;if(P)return P.addEventListener(k1,b),()=>P.removeEventListener(k1,b)},[b]),x.createElement(zQ,{scope:n,orientation:r,dir:p,loop:i,currentTabStopId:g,onItemFocus:x.useCallback(P=>f(P),[f]),onItemShiftTab:x.useCallback(()=>w(!0),[]),onFocusableItemAdd:x.useCallback(()=>_(P=>P+1),[]),onFocusableItemRemove:x.useCallback(()=>_(P=>P-1),[])},x.createElement(Fe.div,Z({tabIndex:m||C===0?-1:0,"data-orientation":r},u,{ref:h,style:{outline:"none",...e.style},onMouseDown:re(e.onMouseDown,()=>{S.current=!0}),onFocus:re(e.onFocus,P=>{const I=!S.current;if(P.target===P.currentTarget&&I&&!m){const M=new CustomEvent(k1,OQ);if(P.currentTarget.dispatchEvent(M),!M.defaultPrevented){const A=k().filter(j=>j.focusable),L=A.find(j=>j.active),z=A.find(j=>j.id===g),$=[L,z,...A].filter(Boolean).map(j=>j.ref.current);$3($)}}S.current=!1}),onBlur:re(e.onBlur,()=>w(!1))})))}),$Q="RovingFocusGroupItem",BQ=x.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:o,...s}=e,a=Ki(),l=o||a,c=NQ($Q,n),u=c.currentTabStopId===l,d=R3(n),{onFocusableItemAdd:h,onFocusableItemRemove:p}=c;return x.useEffect(()=>{if(r)return h(),()=>p()},[r,h,p]),x.createElement(C1.ItemSlot,{scope:n,id:l,focusable:r,active:i},x.createElement(Fe.span,Z({tabIndex:u?0:-1,"data-orientation":c.orientation},s,{ref:t,onMouseDown:re(e.onMouseDown,g=>{r?c.onItemFocus(l):g.preventDefault()}),onFocus:re(e.onFocus,()=>c.onItemFocus(l)),onKeyDown:re(e.onKeyDown,g=>{if(g.key==="Tab"&&g.shiftKey){c.onItemShiftTab();return}if(g.target!==g.currentTarget)return;const f=HQ(g,c.orientation,c.dir);if(f!==void 0){g.preventDefault();let m=d().filter(w=>w.focusable).map(w=>w.ref.current);if(f==="last")m.reverse();else if(f==="prev"||f==="next"){f==="prev"&&m.reverse();const w=m.indexOf(g.currentTarget);m=c.loop?KQ(m,w+1):m.slice(w+1)}setTimeout(()=>$3(m))}})})))}),UQ={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function VQ(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function HQ(e,t,n){const r=VQ(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return UQ[r]}function $3(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function KQ(e,t){return e.map((n,r)=>e[(t+r)%e.length])}const WQ=RQ,YQ=BQ,E1=["Enter"," "],XQ=["ArrowDown","PageUp","Home"],B3=["ArrowUp","PageDown","End"],GQ=[...XQ,...B3],qQ={ltr:[...E1,"ArrowRight"],rtl:[...E1,"ArrowLeft"]},ZQ={ltr:["ArrowLeft"],rtl:["ArrowRight"]},ag="Menu",[Mu,QQ,JQ]=Mf(ag),[Fs,lg]=si(ag,[JQ,sg,F3]),cg=sg(),U3=F3(),[V3,Wo]=Fs(ag),[eJ,Au]=Fs(ag),tJ=e=>{const{__scopeMenu:t,open:n=!1,children:r,dir:i,onOpenChange:o,modal:s=!0}=e,a=cg(t),[l,c]=x.useState(null),u=x.useRef(!1),d=en(o),h=p1(i);return x.useEffect(()=>{const p=()=>{u.current=!0,document.addEventListener("pointerdown",g,{capture:!0,once:!0}),document.addEventListener("pointermove",g,{capture:!0,once:!0})},g=()=>u.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",g,{capture:!0}),document.removeEventListener("pointermove",g,{capture:!0})}},[]),x.createElement(S1,a,x.createElement(V3,{scope:t,open:n,onOpenChange:d,content:l,onContentChange:c},x.createElement(eJ,{scope:t,onClose:x.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:u,dir:h,modal:s},r)))},H3=x.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,i=cg(n);return x.createElement(z3,Z({},i,r,{ref:t}))}),K3="MenuPortal",[nJ,W3]=Fs(K3,{forceMount:void 0}),rJ=e=>{const{__scopeMenu:t,forceMount:n,children:r,container:i}=e,o=Wo(K3,t);return x.createElement(nJ,{scope:t,forceMount:n},x.createElement(Rr,{present:n||o.open},x.createElement(Tf,{asChild:!0,container:i},r)))},Fr="MenuContent",[iJ,P1]=Fs(Fr),oJ=x.forwardRef((e,t)=>{const n=W3(Fr,e.__scopeMenu),{forceMount:r=n.forceMount,...i}=e,o=Wo(Fr,e.__scopeMenu),s=Au(Fr,e.__scopeMenu);return x.createElement(Mu.Provider,{scope:e.__scopeMenu},x.createElement(Rr,{present:r||o.open},x.createElement(Mu.Slot,{scope:e.__scopeMenu},s.modal?x.createElement(sJ,Z({},i,{ref:t})):x.createElement(aJ,Z({},i,{ref:t})))))}),sJ=x.forwardRef((e,t)=>{const n=Wo(Fr,e.__scopeMenu),r=x.useRef(null),i=We(t,r);return x.useEffect(()=>{const o=r.current;if(o)return Qb(o)},[]),x.createElement(I1,Z({},e,{ref:i,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:re(e.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)}))}),aJ=x.forwardRef((e,t)=>{const n=Wo(Fr,e.__scopeMenu);return x.createElement(I1,Z({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)}))}),I1=x.forwardRef((e,t)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:i,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:p,disableOutsideScroll:g,...f}=e,m=Wo(Fr,n),w=Au(Fr,n),b=cg(n),k=U3(n),S=QQ(n),[C,_]=x.useState(null),P=x.useRef(null),I=We(t,P,m.onContentChange),M=x.useRef(0),A=x.useRef(""),L=x.useRef(0),z=x.useRef(null),$=x.useRef("right"),j=x.useRef(0),F=g?qb:x.Fragment,R=g?{as:Ls,allowPinchZoom:!0}:void 0,W=D=>{var B,X;const ie=A.current+D,ue=S().filter(Ce=>!Ce.disabled),ge=document.activeElement,ce=(B=ue.find(Ce=>Ce.ref.current===ge))===null||B===void 0?void 0:B.textValue,be=ue.map(Ce=>Ce.textValue),ft=xJ(be,ie,ce),Ie=(X=ue.find(Ce=>Ce.textValue===ft))===null||X===void 0?void 0:X.ref.current;(function Ce(Me){A.current=Me,window.clearTimeout(M.current),Me!==""&&(M.current=window.setTimeout(()=>Ce(""),1e3))})(ie),Ie&&setTimeout(()=>Ie.focus())};x.useEffect(()=>()=>window.clearTimeout(M.current),[]),Kb();const V=x.useCallback(D=>{var B,X;return $.current===((B=z.current)===null||B===void 0?void 0:B.side)&&kJ(D,(X=z.current)===null||X===void 0?void 0:X.area)},[]);return x.createElement(iJ,{scope:n,searchRef:A,onItemEnter:x.useCallback(D=>{V(D)&&D.preventDefault()},[V]),onItemLeave:x.useCallback(D=>{var B;V(D)||((B=P.current)===null||B===void 0||B.focus(),_(null))},[V]),onTriggerLeave:x.useCallback(D=>{V(D)&&D.preventDefault()},[V]),pointerGraceTimerRef:L,onPointerGraceIntentChange:x.useCallback(D=>{z.current=D},[])},x.createElement(F,R,x.createElement(Vb,{asChild:!0,trapped:i,onMountAutoFocus:re(o,D=>{var B;D.preventDefault(),(B=P.current)===null||B===void 0||B.focus()}),onUnmountAutoFocus:s},x.createElement(Af,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:p},x.createElement(WQ,Z({asChild:!0},k,{dir:w.dir,orientation:"vertical",loop:r,currentTabStopId:C,onCurrentTabStopIdChange:_,onEntryFocus:re(l,D=>{w.isUsingKeyboardRef.current||D.preventDefault()})}),x.createElement(N3,Z({role:"menu","aria-orientation":"vertical","data-state":J3(m.open),"data-radix-menu-content":"",dir:w.dir},b,f,{ref:I,style:{outline:"none",...f.style},onKeyDown:re(f.onKeyDown,D=>{const B=D.target.closest("[data-radix-menu-content]")===D.currentTarget,X=D.ctrlKey||D.altKey||D.metaKey,ie=D.key.length===1;B&&(D.key==="Tab"&&D.preventDefault(),!X&&ie&&W(D.key));const ue=P.current;if(D.target!==ue||!GQ.includes(D.key))return;D.preventDefault();const ge=S().filter(ce=>!ce.disabled).map(ce=>ce.ref.current);B3.includes(D.key)&&ge.reverse(),bJ(ge)}),onBlur:re(e.onBlur,D=>{D.currentTarget.contains(D.target)||(window.clearTimeout(M.current),A.current="")}),onPointerMove:re(e.onPointerMove,Tu(D=>{const B=D.target,X=j.current!==D.clientX;if(D.currentTarget.contains(B)&&X){const ie=D.clientX>j.current?"right":"left";$.current=ie,j.current=D.clientX}}))})))))))}),lJ=x.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return x.createElement(Fe.div,Z({role:"group"},r,{ref:t}))}),M1="MenuItem",Y3="menu.itemSelect",X3=x.forwardRef((e,t)=>{const{disabled:n=!1,onSelect:r,...i}=e,o=x.useRef(null),s=Au(M1,e.__scopeMenu),a=P1(M1,e.__scopeMenu),l=We(t,o),c=x.useRef(!1),u=()=>{const d=o.current;if(!n&&d){const h=new CustomEvent(Y3,{bubbles:!0,cancelable:!0});d.addEventListener(Y3,p=>r==null?void 0:r(p),{once:!0}),jb(d,h),h.defaultPrevented?c.current=!1:s.onClose()}};return x.createElement(G3,Z({},i,{ref:l,disabled:n,onClick:re(e.onClick,u),onPointerDown:d=>{var h;(h=e.onPointerDown)===null||h===void 0||h.call(e,d),c.current=!0},onPointerUp:re(e.onPointerUp,d=>{var h;c.current||(h=d.currentTarget)===null||h===void 0||h.click()}),onKeyDown:re(e.onKeyDown,d=>{const h=a.searchRef.current!=="";n||h&&d.key===" "||E1.includes(d.key)&&(d.currentTarget.click(),d.preventDefault())})}))}),G3=x.forwardRef((e,t)=>{const{__scopeMenu:n,disabled:r=!1,textValue:i,...o}=e,s=P1(M1,n),a=U3(n),l=x.useRef(null),c=We(t,l),[u,d]=x.useState(!1),[h,p]=x.useState("");return x.useEffect(()=>{const g=l.current;if(g){var f;p(((f=g.textContent)!==null&&f!==void 0?f:"").trim())}},[o.children]),x.createElement(Mu.ItemSlot,{scope:n,disabled:r,textValue:i??h},x.createElement(YQ,Z({asChild:!0},a,{focusable:!r}),x.createElement(Fe.div,Z({role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0},o,{ref:c,onPointerMove:re(e.onPointerMove,Tu(g=>{r?s.onItemLeave(g):(s.onItemEnter(g),g.defaultPrevented||g.currentTarget.focus())})),onPointerLeave:re(e.onPointerLeave,Tu(g=>s.onItemLeave(g))),onFocus:re(e.onFocus,()=>d(!0)),onBlur:re(e.onBlur,()=>d(!1))}))))}),cJ=x.forwardRef((e,t)=>{const{checked:n=!1,onCheckedChange:r,...i}=e;return x.createElement(dJ,{scope:e.__scopeMenu,checked:n},x.createElement(X3,Z({role:"menuitemcheckbox","aria-checked":dg(n)?"mixed":n},i,{ref:t,"data-state":eT(n),onSelect:re(i.onSelect,()=>r==null?void 0:r(dg(n)?!0:!n),{checkForDefaultPrevented:!1})})))}),uJ="MenuRadioGroup";Fs(uJ,{value:void 0,onValueChange:()=>{}});const q3="MenuItemIndicator",[dJ,hJ]=Fs(q3,{checked:!1}),pJ=x.forwardRef((e,t)=>{const{__scopeMenu:n,forceMount:r,...i}=e,o=hJ(q3,n);return x.createElement(Rr,{present:r||dg(o.checked)||o.checked===!0},x.createElement(Fe.span,Z({},i,{ref:t,"data-state":eT(o.checked)})))}),Z3="MenuSub",[fJ,Q3]=Fs(Z3),gJ=e=>{const{__scopeMenu:t,children:n,open:r=!1,onOpenChange:i}=e,o=Wo(Z3,t),s=cg(t),[a,l]=x.useState(null),[c,u]=x.useState(null),d=en(i);return x.useEffect(()=>(o.open===!1&&d(!1),()=>d(!1)),[o.open,d]),x.createElement(S1,s,x.createElement(V3,{scope:t,open:r,onOpenChange:d,content:c,onContentChange:u},x.createElement(fJ,{scope:t,contentId:Ki(),triggerId:Ki(),trigger:a,onTriggerChange:l},n)))},ug="MenuSubTrigger",mJ=x.forwardRef((e,t)=>{const n=Wo(ug,e.__scopeMenu),r=Au(ug,e.__scopeMenu),i=Q3(ug,e.__scopeMenu),o=P1(ug,e.__scopeMenu),s=x.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=o,c={__scopeMenu:e.__scopeMenu},u=x.useCallback(()=>{s.current&&window.clearTimeout(s.current),s.current=null},[]);return x.useEffect(()=>u,[u]),x.useEffect(()=>{const d=a.current;return()=>{window.clearTimeout(d),l(null)}},[a,l]),x.createElement(H3,Z({asChild:!0},c),x.createElement(G3,Z({id:i.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":i.contentId,"data-state":J3(n.open)},e,{ref:If(t,i.onTriggerChange),onClick:d=>{var h;(h=e.onClick)===null||h===void 0||h.call(e,d),!(e.disabled||d.defaultPrevented)&&(d.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:re(e.onPointerMove,Tu(d=>{o.onItemEnter(d),!d.defaultPrevented&&!e.disabled&&!n.open&&!s.current&&(o.onPointerGraceIntentChange(null),s.current=window.setTimeout(()=>{n.onOpenChange(!0),u()},100))})),onPointerLeave:re(e.onPointerLeave,Tu(d=>{var h;u();const p=(h=n.content)===null||h===void 0?void 0:h.getBoundingClientRect();if(p){var g;const f=(g=n.content)===null||g===void 0?void 0:g.dataset.side,m=f==="right",w=m?-5:5,b=p[m?"left":"right"],k=p[m?"right":"left"];o.onPointerGraceIntentChange({area:[{x:d.clientX+w,y:d.clientY},{x:b,y:p.top},{x:k,y:p.top},{x:k,y:p.bottom},{x:b,y:p.bottom}],side:f}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(d),d.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:re(e.onKeyDown,d=>{const h=o.searchRef.current!=="";if(!(e.disabled||h&&d.key===" ")&&qQ[r.dir].includes(d.key)){var p;n.onOpenChange(!0),(p=n.content)===null||p===void 0||p.focus(),d.preventDefault()}})})))}),yJ="MenuSubContent",vJ=x.forwardRef((e,t)=>{const n=W3(Fr,e.__scopeMenu),{forceMount:r=n.forceMount,...i}=e,o=Wo(Fr,e.__scopeMenu),s=Au(Fr,e.__scopeMenu),a=Q3(yJ,e.__scopeMenu),l=x.useRef(null),c=We(t,l);return x.createElement(Mu.Provider,{scope:e.__scopeMenu},x.createElement(Rr,{present:r||o.open},x.createElement(Mu.Slot,{scope:e.__scopeMenu},x.createElement(I1,Z({id:a.contentId,"aria-labelledby":a.triggerId},i,{ref:c,align:"start",side:s.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var d;s.isUsingKeyboardRef.current&&((d=l.current)===null||d===void 0||d.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:re(e.onFocusOutside,u=>{u.target!==a.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:re(e.onEscapeKeyDown,u=>{s.onClose(),u.preventDefault()}),onKeyDown:re(e.onKeyDown,u=>{const d=u.currentTarget.contains(u.target),h=ZQ[s.dir].includes(u.key);if(d&&h){var p;o.onOpenChange(!1),(p=a.trigger)===null||p===void 0||p.focus(),u.preventDefault()}})})))))});function J3(e){return e?"open":"closed"}function dg(e){return e==="indeterminate"}function eT(e){return dg(e)?"indeterminate":e?"checked":"unchecked"}function bJ(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function wJ(e,t){return e.map((n,r)=>e[(t+r)%e.length])}function xJ(e,t,n){const r=t.length>1&&Array.from(t).every(a=>a===t[0])?t[0]:t,i=n?e.indexOf(n):-1;let o=wJ(e,Math.max(i,0));r.length===1&&(o=o.filter(a=>a!==n));const s=o.find(a=>a.toLowerCase().startsWith(r.toLowerCase()));return s!==n?s:void 0}function SJ(e,t){const{x:n,y:r}=e;let i=!1;for(let o=0,s=t.length-1;o<t.length;s=o++){const a=t[o].x,l=t[o].y,c=t[s].x,u=t[s].y;l>r!=u>r&&n<(c-a)*(r-l)/(u-l)+a&&(i=!i)}return i}function kJ(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return SJ(n,t)}function Tu(e){return t=>t.pointerType==="mouse"?e(t):void 0}const tT=tJ,nT=H3,rT=rJ,iT=oJ,oT=lJ,sT=X3,aT=cJ,_J=pJ,lT=gJ,cT=mJ,uT=vJ,dT="DropdownMenu",[CJ,Ere]=si(dT,[lg]),$r=lg(),[EJ,hT]=CJ(dT),PJ=e=>{const{__scopeDropdownMenu:t,children:n,dir:r,open:i,defaultOpen:o,onOpenChange:s,modal:a=!0}=e,l=$r(t),c=x.useRef(null),[u=!1,d]=Bo({prop:i,defaultProp:o,onChange:s});return x.createElement(EJ,{scope:t,triggerId:Ki(),triggerRef:c,contentId:Ki(),open:u,onOpenChange:d,onOpenToggle:x.useCallback(()=>d(h=>!h),[d]),modal:a},x.createElement(tT,Z({},l,{open:u,onOpenChange:d,dir:r,modal:a}),n))},IJ="DropdownMenuTrigger",MJ=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...i}=e,o=hT(IJ,n),s=$r(n);return x.createElement(nT,Z({asChild:!0},s),x.createElement(Fe.button,Z({type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,disabled:r},i,{ref:If(t,o.triggerRef),onPointerDown:re(e.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(o.onOpenToggle(),o.open||a.preventDefault())}),onKeyDown:re(e.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&o.onOpenToggle(),a.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})))}),AJ=e=>{const{__scopeDropdownMenu:t,...n}=e,r=$r(t);return x.createElement(rT,Z({},r,n))},TJ="DropdownMenuContent",jJ=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=hT(TJ,n),o=$r(n),s=x.useRef(!1);return x.createElement(iT,Z({id:i.contentId,"aria-labelledby":i.triggerId},o,r,{ref:t,onCloseAutoFocus:re(e.onCloseAutoFocus,a=>{var l;s.current||(l=i.triggerRef.current)===null||l===void 0||l.focus(),s.current=!1,a.preventDefault()}),onInteractOutside:re(e.onInteractOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,u=l.button===2||c;(!i.modal||u)&&(s.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),OJ=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=$r(n);return x.createElement(oT,Z({},i,r,{ref:t}))}),LJ=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=$r(n);return x.createElement(sT,Z({},i,r,{ref:t}))}),DJ=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=$r(n);return x.createElement(aT,Z({},i,r,{ref:t}))}),zJ=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=$r(n);return x.createElement(_J,Z({},i,r,{ref:t}))}),NJ=e=>{const{__scopeDropdownMenu:t,children:n,open:r,onOpenChange:i,defaultOpen:o}=e,s=$r(t),[a=!1,l]=Bo({prop:r,defaultProp:o,onChange:i});return x.createElement(lT,Z({},s,{open:a,onOpenChange:l}),n)},RJ=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=$r(n);return x.createElement(cT,Z({},i,r,{ref:t}))}),FJ=x.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,i=$r(n);return x.createElement(uT,Z({},i,r,{ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),pT=PJ,ju=MJ,A1=AJ,fT=jJ,$J=OJ,bl=LJ,gT=DJ,BJ=zJ,UJ=NJ,VJ=RJ,HJ=FJ;function $s(e,t){const n=H(),r=x.useRef(!1),i=fl(),o=x.useRef(0),s=x.useCallback(l=>{const c=Date.now();c-o.current<50||(o.current=c,r.current=l,n.batch(()=>{l?(n.complete(),n.addOpenMenu(e)):n.updateInstanceState({openMenus:n.getOpenMenus().filter(u=>!u.startsWith(e))}),t==null||t(l)}))},[n,e,t]),a=Y("is menu open",()=>n.getOpenMenus().includes(e),[n,e]);return x.useEffect(()=>(r.current&&(i("open-menu",{source:"unknown",id:e}),n.addOpenMenu(e)),()=>{r.current&&(n.deleteOpenMenu(e),n.getOpenMenus().forEach(l=>{l.startsWith(e)&&(i("close-menu",{source:"unknown",id:e}),n.deleteOpenMenu(l))}),r.current=!1)}),[n,e,i]),[a,s]}function Yo({id:e,children:t,modal:n=!1,debugOpen:r=!1}){const[i,o]=$s(e);return y.jsx(pT,{open:r||i,dir:"ltr",modal:n,onOpenChange:o,children:t})}function Ou({children:e,"data-testid":t}){return y.jsx(ju,{dir:"ltr","data-testid":t,asChild:!0,onTouchEnd:n=>Ee(n),children:e})}function Xo({side:e="bottom",align:t="start",sideOffset:n=8,alignOffset:r=8,children:i}){const o=Yt();return y.jsx(A1,{container:o,children:y.jsx(fT,{className:"tlui-menu",align:t,sideOffset:n,side:e,alignOffset:r,collisionPadding:4,children:i})})}function T1({id:e,children:t}){const[n,r]=$s(e);return y.jsx(UJ,{open:n,onOpenChange:r,children:t})}function j1({label:e,"data-testid":t,"data-direction":n}){return y.jsx(VJ,{dir:"ltr","data-direction":n,"data-testid":t,asChild:!0,children:y.jsx(oe,{type:"menu",className:"tlui-menu__submenu__trigger",label:e,icon:"chevron-right"})})}function O1({alignOffset:e=0,sideOffset:t=5,children:n}){const r=Yt();return y.jsx(A1,{container:r,children:y.jsx(HJ,{className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:t,collisionPadding:4,children:n})})}function Zi({children:e,size:t="medium"}){return y.jsx($J,{dir:"ltr",className:"tlui-menu__group","data-size":t,children:e})}function Gn({noClose:e,...t}){return y.jsx(bl,{dir:"ltr",asChild:!0,onClick:e||t.isChecked!==void 0?Ee:void 0,children:y.jsx(oe,{...t})})}function mT({children:e,onSelect:t,...n}){return y.jsxs(gT,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:r=>{t==null||t(r),Ee(r)},...n,children:[y.jsx(Wn,{small:!0,icon:n.checked?"check":"checkbox-empty"}),e]})}function KJ({children:e,onSelect:t,...n}){return y.jsxs(gT,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:r=>{t==null||t(r),Ee(r)},...n,children:[y.jsx("div",{className:"tlui-button__checkbox__indicator",children:y.jsx(BJ,{dir:"ltr",children:y.jsx(Wn,{icon:"check",small:!0})})}),e]})}let yT=0;function WJ(e,t){const n=Array(t),r=Math.floor(Math.sqrt(t));for(let i=0;i<t;i++)yT++,n[i]={id:Ve("box"+yT),type:"geo",x:i%r*132,y:Math.floor(i/r)*132};e.batch(()=>{e.createShapes(n).setSelectedShapes(n.map(i=>i.id))})}const YJ=x.memo(function({renderDebugMenuItems:e}){const t=Se();return y.jsxs("div",{className:"tlui-debug-panel",children:[y.jsx(XJ,{}),y.jsx(GJ,{}),y.jsxs(Yo,{id:"debug",children:[y.jsx(Ou,{children:y.jsx(oe,{type:"icon",icon:"dots-horizontal",title:t("debug-panel.more")})}),y.jsx(Xo,{side:"top",align:"end",alignOffset:0,children:y.jsx(qJ,{renderDebugMenuItems:e})})]})]})}),XJ=Pe(function(){const e=H();return y.jsx("div",{className:"tlui-debug-panel__current-state",children:e.getPath()})}),GJ=function(){const e=H(),t=Y("rendering shapes count",()=>e.getRenderingShapes().length,[e]);return y.jsxs("div",{children:[t," Shapes"]})},qJ=Pe(function({renderDebugMenuItems:e}){const t=H(),{addToast:n}=ci(),{addDialog:r}=Ns(),[i,o]=x.useState(!1);return y.jsxs(y.Fragment,{children:[y.jsxs(Zi,{children:[y.jsx(Gn,{type:"menu",onClick:()=>{n({id:Re(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0}),n({id:Re(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),n({id:Re(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,icon:"twitter",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]})},label:"Show toast"}),y.jsx(Gn,{type:"menu",onClick:()=>{r({component:({onClose:s})=>y.jsx(QJ,{displayDontShowAgain:!0,onCancel:()=>{s()},onContinue:()=>{s()}}),onClose:()=>{}})},label:"Show dialog"}),y.jsx(Gn,{type:"menu",onClick:()=>WJ(t,100),label:"Create 100 shapes"}),y.jsx(Gn,{type:"menu",onClick:()=>{function s({children:d}){let h=0;if(!d.length)return 0;for(const p of[...d])h++,h+=s(p);return h}const a=t.getSelectedShapes(),l=a.length===0?t.getRenderingShapes():a,c=l.map(d=>document.getElementById(d.id).parentElement);let u=c.length;for(const d of c)u+=s(d);window.alert(`Shapes ${l.length}, DOM nodes:${u}`)},label:"Count shapes / nodes"}),(()=>{if(i)throw Error("oh no!")})(),y.jsx(Gn,{type:"menu",onClick:()=>{o(!0)},label:"Throw error"}),y.jsx(Gn,{type:"menu",onClick:()=>{j2()},label:"Hard reset"})]}),y.jsxs(Zi,{children:[y.jsx(Lu,{flag:He.debugSvg}),y.jsx(Lu,{flag:He.forceSrgb}),y.jsx(Lu,{flag:He.debugGeometry}),y.jsx(Lu,{flag:He.hideShapes})]}),y.jsx(Zi,{children:Object.values(Ez).map(s=>y.jsx(Lu,{flag:s},s.name))}),e==null?void 0:e()]})});function ZJ({label:e,value:t,onChange:n}){return y.jsx(mT,{title:e,checked:t,onSelect:()=>n(!t),children:y.jsx("span",{className:"tlui-button__label",draggable:!1,children:e})})}const Lu=Pe(function({flag:e,onChange:t}){return y.jsx(ZJ,{label:e.name.replace(/([a-z0-9])([A-Z])/g,n=>`${n[0]} ${n[1].toLowerCase()}`).replace(/^[a-z]/,n=>n.toUpperCase()),value:e.get(),onChange:n=>{e.set(n),t==null||t(n)}})});function QJ({title:e="title",body:t="hello hello hello",cancel:n="Cancel",confirm:r="Continue",displayDontShowAgain:i=!1,onCancel:o,onContinue:s}){const[a,l]=x.useState(!1);return y.jsxs(y.Fragment,{children:[y.jsxs(Hf,{children:[y.jsx(Kf,{children:e}),y.jsx(Wf,{})]}),y.jsx(_u,{style:{maxWidth:350},children:t}),y.jsxs(e1,{className:"tlui-dialog__footer__actions",children:[i&&y.jsx(oe,{type:"normal",onClick:()=>l(!a),iconLeft:a?"check":"checkbox-empty",style:{marginRight:"auto"},children:"Don't show again"}),y.jsx(oe,{type:"normal",onClick:o,children:n}),y.jsx(oe,{type:"primary",onClick:async()=>s(),children:r})]})]})}const JJ=({id:e,component:t,onClose:n})=>{const{removeDialog:r}=Ns(),i=Yt(),o=x.useCallback(s=>{if(!s){if(n)try{n()}catch(a){console.warn(a)}r(e)}},[e,n,r]);return y.jsx(_q,{onOpenChange:o,defaultOpen:!0,children:y.jsx(Cq,{container:i,children:y.jsx(Eq,{dir:"ltr",className:"tlui-dialog__overlay",children:y.jsx(Pq,{dir:"ltr",className:"tlui-dialog__content",children:y.jsx(t,{onClose:()=>o(!1)})})})})})};function eee(){const{dialogs:e}=Ns();return y.jsx(y.Fragment,{children:e.map(t=>y.jsx(JJ,{...t},t.id))})}const tee=J.memo(eee);function nee(){const e=H(),t=Y("follow",()=>e.getInstanceState().followingUserId,[e]);return t?y.jsx(ree,{userId:t}):null}function ree({userId:e}){const t=mC(e);return t?y.jsx("div",{className:"tlui-following-indicator",style:{borderColor:t.color}}):null}function vT(){const e=H(),{languages:t,currentLanguage:n}=r3(),r=x.useCallback(i=>e.user.updateUserPreferences({locale:i}),[e]);return y.jsxs(T1,{id:"help menu language",children:[y.jsx(j1,{label:"menu.language","data-direction":"left"}),y.jsx(O1,{sideOffset:-4,children:y.jsx(Zi,{children:t.map(({locale:i,label:o})=>y.jsx(KJ,{title:i,checked:i===n,onSelect:()=>r(i),children:y.jsx("span",{className:"tlui-button__label",children:o})},i))})})]})}const iee=x.memo(function(){const e=Yt(),t=Se(),[n,r]=$s("help menu");return y.jsx("div",{className:"tlui-help-menu",children:y.jsxs(pT,{dir:"ltr",open:n,onOpenChange:r,modal:!1,children:[y.jsx(ju,{asChild:!0,dir:"ltr",children:y.jsx(oe,{type:"help",className:"tlui-button",smallIcon:!0,title:t("help-menu.title"),icon:"question-mark"})}),y.jsx(A1,{container:e,children:y.jsx(fT,{className:"tlui-menu",side:"top",sideOffset:8,align:"end",alignOffset:0,collisionPadding:4,children:y.jsx(oee,{})})})]})})});function oee(){const e=SZ(),t=dr();function n(r){if(!r||t&&!r.readonlyOk)return null;switch(r.type){case"custom":{if(r.id==="LANGUAGE_MENU")return y.jsx(vT,{},"item");break}case"group":return y.jsx(Zi,{size:"small",children:r.children.map(n)},r.id);case"submenu":return y.jsxs(T1,{id:`help menu ${r.id}`,children:[y.jsx(j1,{label:r.label}),y.jsx(O1,{children:r.children.map(n)})]},r.id);case"item":{const{id:i,kbd:o,label:s,onSelect:a,icon:l}=r.actionItem;return y.jsx(Gn,{type:"menu",kbd:o,label:s,onClick:()=>a("help-menu"),iconLeft:l},i)}}}return y.jsx(y.Fragment,{children:e.map(n)})}const bT="Popover",[wT,Pre]=si(bT,[sg]),L1=sg(),[see,wl]=wT(bT),aee=e=>{const{__scopePopover:t,children:n,open:r,defaultOpen:i,onOpenChange:o,modal:s=!1}=e,a=L1(t),l=x.useRef(null),[c,u]=x.useState(!1),[d=!1,h]=Bo({prop:r,defaultProp:i,onChange:o});return x.createElement(S1,a,x.createElement(see,{scope:t,contentId:Ki(),triggerRef:l,open:d,onOpenChange:h,onOpenToggle:x.useCallback(()=>h(p=>!p),[h]),hasCustomAnchor:c,onCustomAnchorAdd:x.useCallback(()=>u(!0),[]),onCustomAnchorRemove:x.useCallback(()=>u(!1),[]),modal:s},n))},lee="PopoverTrigger",cee=x.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,i=wl(lee,n),o=L1(n),s=We(t,i.triggerRef),a=x.createElement(Fe.button,Z({type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":kT(i.open)},r,{ref:s,onClick:re(e.onClick,i.onOpenToggle)}));return i.hasCustomAnchor?a:x.createElement(z3,Z({asChild:!0},o),a)}),xT="PopoverPortal",[uee,dee]=wT(xT,{forceMount:void 0}),hee=e=>{const{__scopePopover:t,forceMount:n,children:r,container:i}=e,o=wl(xT,t);return x.createElement(uee,{scope:t,forceMount:n},x.createElement(Rr,{present:n||o.open},x.createElement(Tf,{asChild:!0,container:i},r)))},Du="PopoverContent",pee=x.forwardRef((e,t)=>{const n=dee(Du,e.__scopePopover),{forceMount:r=n.forceMount,...i}=e,o=wl(Du,e.__scopePopover);return x.createElement(Rr,{present:r||o.open},o.modal?x.createElement(fee,Z({},i,{ref:t})):x.createElement(gee,Z({},i,{ref:t})))}),fee=x.forwardRef((e,t)=>{const n=wl(Du,e.__scopePopover),r=x.useRef(null),i=We(t,r),o=x.useRef(!1);return x.useEffect(()=>{const s=r.current;if(s)return Qb(s)},[]),x.createElement(qb,{as:Ls,allowPinchZoom:!0},x.createElement(ST,Z({},e,{ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:re(e.onCloseAutoFocus,s=>{var a;s.preventDefault(),o.current||(a=n.triggerRef.current)===null||a===void 0||a.focus()}),onPointerDownOutside:re(e.onPointerDownOutside,s=>{const a=s.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;o.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:re(e.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1})})))}),gee=x.forwardRef((e,t)=>{const n=wl(Du,e.__scopePopover),r=x.useRef(!1),i=x.useRef(!1);return x.createElement(ST,Z({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var s;if((s=e.onCloseAutoFocus)===null||s===void 0||s.call(e,o),!o.defaultPrevented){var a;r.current||(a=n.triggerRef.current)===null||a===void 0||a.focus(),o.preventDefault()}r.current=!1,i.current=!1},onInteractOutside:o=>{var s,a;(s=e.onInteractOutside)===null||s===void 0||s.call(e,o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const l=o.target;!((a=n.triggerRef.current)===null||a===void 0)&&a.contains(l)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&i.current&&o.preventDefault()}}))}),ST=x.forwardRef((e,t)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:s,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...d}=e,h=wl(Du,n),p=L1(n);return Kb(),x.createElement(Vb,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o},x.createElement(Af,{asChild:!0,disableOutsidePointerEvents:s,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>h.onOpenChange(!1)},x.createElement(N3,Z({"data-state":kT(h.open),role:"dialog",id:h.contentId},p,d,{ref:t,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))});function kT(e){return e?"open":"closed"}const mee=aee,yee=cee,_T=hee,CT=pee,D1=({id:e,children:t,onOpenChange:n,open:r})=>{const[i,o]=$s(e,n);return y.jsx(mee,{onOpenChange:o,open:r||i,children:y.jsx("div",{className:"tlui-popover",children:t})})},z1=({children:e,disabled:t,"data-testid":n})=>y.jsx(yee,{"data-testid":n,disabled:t,asChild:!0,dir:"ltr",children:e}),ET=({side:e,children:t,align:n="center",sideOffset:r=8,alignOffset:i=0})=>{const o=Yt();return y.jsx(_T,{container:o,children:y.jsx(CT,{className:"tlui-popover__content",side:e,sideOffset:r,align:n,alignOffset:i,dir:"ltr",children:t})})},PT=x.memo(function(){const e=Se(),t=Yt(),n=fZ(),r=dr();function i(o){if(!o||r&&!o.readonlyOk)return null;switch(o.type){case"item":{const{id:s,icon:a,label:l,kbd:c,onSelect:u}=o.actionItem;return y.jsx(oe,{"data-testid":`menu-item.${o.id}`,icon:a,type:"icon",title:l?c?`${e(l)} ${ai(c)}`:`${e(l)}`:c?`${ai(c)}`:"",onClick:()=>u("actions-menu"),disabled:o.disabled},s)}}}return y.jsxs(D1,{id:"actions-menu",children:[y.jsx(z1,{children:y.jsx(oe,{className:"tlui-menu__trigger","data-testid":"main.action-menu",icon:"dots-vertical",title:e("actions-menu.title"),type:"icon",smallIcon:!0})}),y.jsx(_T,{container:t,children:y.jsx(CT,{className:"tlui-popover__content",side:"bottom",dir:"ltr",sideOffset:6,children:y.jsx("div",{className:"tlui-actions-menu tlui-buttons__grid",children:n.map(i)})})})]})}),IT=Pe(function(){const e=H(),t=tn(),n=Se(),r=t.duplicate;return y.jsx(oe,{icon:r.icon,type:"icon",onClick:()=>r.onSelect("quick-actions"),disabled:!(e.isIn("select")&&e.getSelectedShapeIds().length>0),title:`${n(r.label)} ${ai(r.kbd)}`,smallIcon:!0})}),vee=x.memo(function(){const e=Se();return y.jsxs(Yo,{id:"main menu",children:[y.jsx(Ou,{children:y.jsx(oe,{type:"icon",className:"tlui-menu__trigger","data-testid":"main.menu",title:e("menu.title"),icon:"menu",smallIcon:!0})}),y.jsx(Xo,{alignOffset:0,sideOffset:6,children:y.jsx(bee,{})})]})});function bee(){const e=H(),t=Se(),n=_Z(),r=fr(),i=dr();function o(s,a,l,c){if(!a)return null;switch(a.type){case"custom":return i&&!a.readonlyOk?null:a.id==="LANGUAGE_MENU"?y.jsx(vT,{},"item"):null;case"group":return i&&!a.readonlyOk?null:y.jsx(Zi,{size:c<=1?"medium":r<3||(l==null?void 0:l.type)==="submenu"&&c>2?"tiny":"medium",children:a.children.map(u=>o(s,u,a,c+1))},a.id);case"submenu":return i&&!a.readonlyOk?null:y.jsxs(T1,{id:`main menu ${l?l.id+" ":""}${a.id}`,children:[y.jsx(j1,{label:a.label,"data-testid":`menu-item.${a.id}`}),y.jsx(O1,{sideOffset:-4,alignOffset:-1,children:a.children.map(u=>o(s,u,a,c+1))})]},a.id);case"item":{if(i&&!a.readonlyOk)return null;const{id:u,checkbox:d,menuLabel:h,label:p,onSelect:g,kbd:f}=a.actionItem,m=h??p,w=m?t(m):void 0;return d?y.jsxs(mT,{onSelect:()=>g("menu"),title:w||"",checked:a.checked,disabled:a.disabled,children:[w&&y.jsx("span",{className:"tlui-button__label",children:w}),f&&y.jsx(zf,{children:f})]},u):y.jsx(Gn,{type:"menu","data-testid":`menu-item.${a.id}`,kbd:f,label:m,onClick:()=>g("menu"),disabled:a.disabled},u)}}}return y.jsx(y.Fragment,{children:n.map(s=>o(e,s,null,0))})}const wee=function({name:e,id:t,isCurrentPage:n}){const r=H(),i=x.useRef(null),o=x.useCallback(a=>{r.renamePage(t,a||"New Page",{ephemeral:!0})},[r,t]),s=x.useCallback(a=>{r.mark("rename page"),r.renamePage(t,a||"New Page",{ephemeral:!1})},[r,t]);return y.jsx(t1,{className:"tlui-page-menu__item__input",ref:a=>i.current=a,defaultValue:e,onValueChange:o,onComplete:s,onCancel:s,shouldManuallyMaintainScrollPositionWhenFocused:!0,autofocus:n,autoselect:!0})},N1=(e,t,n,r)=>{let i;const o=e.getPages(),s=n>r?o[r-1]:o[r],a=n>r?o[r]:o[r+1];s&&!a?i=zi(s.index):!s&&a?i=ZR(o[0].index):i=Zc(s.index,a.index),i!==o[n].index&&(e.mark("moving page"),e.updatePage({id:t,index:i}))},MT=Pe(function({index:e,listSize:t,item:n,onRename:r}){const i=H(),o=Se(),s=i.getPages(),a=x.useCallback(()=>{i.mark("creating page");const d=ji.createId();i.duplicatePage(n.id,d)},[i,n]),l=x.useCallback(()=>{N1(i,n.id,e,e-1)},[i,n,e]),c=x.useCallback(()=>{N1(i,n.id,e,e+1)},[i,n,e]),u=x.useCallback(()=>{i.mark("deleting page"),i.deletePage(n.id)},[i,n]);return y.jsxs(Yo,{id:`page item submenu ${e}`,children:[y.jsx(Ou,{children:y.jsx(oe,{type:"icon",title:o("page-menu.submenu.title"),icon:"dots-vertical"})}),y.jsxs(Xo,{alignOffset:0,children:[y.jsxs(Zi,{children:[r&&y.jsx(bl,{dir:"ltr",onSelect:r,asChild:!0,children:y.jsx(oe,{type:"menu",label:"page-menu.submenu.rename"})}),y.jsx(bl,{dir:"ltr",onSelect:a,disabled:s.length>=Qh,asChild:!0,children:y.jsx(oe,{type:"menu",label:"page-menu.submenu.duplicate-page"})}),e>0&&y.jsx(bl,{dir:"ltr",onSelect:l,asChild:!0,children:y.jsx(oe,{type:"menu",label:"page-menu.submenu.move-up"})}),e<t-1&&y.jsx(bl,{dir:"ltr",onSelect:c,asChild:!0,children:y.jsx(oe,{type:"menu",label:"page-menu.submenu.move-down"})})]}),t>1&&y.jsx(Zi,{children:y.jsx(bl,{dir:"ltr",onSelect:u,asChild:!0,children:y.jsx(oe,{type:"menu",label:"page-menu.submenu.delete"})})})]})]})}),xee=function(){const e=H(),t=Se(),n=fr(),r=x.useCallback(()=>f(!1),[]),[i,o]=$s("page-menu",r),s=36,a=x.useRef(null),l=Y("pages",()=>e.getPages(),[e]),c=Y("currentPage",()=>e.getCurrentPage(),[e]),u=Y("currentPageId",()=>e.getCurrentPageId(),[e]),d=dr(),h=Y("maxPageCountReached",()=>e.getPages().length>=Qh,[e]),p=Y("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[g,f]=x.useState(!1),m=x.useCallback(()=>{d||f(M=>!M)},[d]),w=x.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[b,k]=x.useState(Object.fromEntries(l.map((M,A)=>[M.id,{y:A*s,offsetY:0,isSelected:!1}])));x.useLayoutEffect(()=>{k(Object.fromEntries(l.map((M,A)=>[M.id,{y:A*s,offsetY:0,isSelected:!1}])))},[s,l]),x.useEffect(()=>{i&&requestAnimationFrame(()=>{const M=document.querySelector(`[data-testid="page-menu-item-${u}"]`);if(M){const A=a.current;if(!A)return;const L=M.offsetTop,z=A.scrollTop;L<z&&A.scrollTo({top:L});const $=L+s,j=A.scrollTop+A.offsetHeight;$>j&&A.scrollTo({top:$-A.offsetHeight})}})},[s,u,i]);const S=x.useCallback(M=>{const{clientY:A,currentTarget:L}=M,{dataset:{id:z,index:$}}=L;if(!z||!$)return;const j=w.current;Oc(M.currentTarget,M),j.status="pointing",j.pointing={id:z,index:+$};const F=b[z].y;j.startY=A,j.startIndex=Math.max(0,Math.min(Math.round(F/s),l.length-1))},[s,l.length,b]),C=x.useCallback(M=>{const A=w.current;if(A.status==="pointing"){const{clientY:L}=M,z=L-A.startY;Math.abs(z)>5&&(A.status="dragging")}if(A.status==="dragging"){const{clientY:L}=M,z=L-A.startY,$=b[A.pointing.id],{startIndex:j,pointing:F}=A,R=$.y+z,W=Math.max(0,Math.min(Math.round(R/s),l.length-1)),V={...b};if(V[F.id]={y:$.y,offsetY:z,isSelected:!0},W!==A.dragIndex){A.dragIndex=W;for(let D=0;D<l.length;D++){const B=l[D];if(B.id===A.pointing.id)continue;let{y:X}=V[B.id];W===j?X=D*s:W<j?W<=D&&D<j?X=(D+1)*s:X=D*s:W>j&&(W>=D&&D>j?X=(D-1)*s:X=D*s),X!==V[B.id].y&&(V[B.id]={y:X,offsetY:0,isSelected:!0})}}k(V)}},[s,l,b]),_=x.useCallback(M=>{const A=w.current;if(A.status==="dragging"){const{id:L,index:z}=A.pointing;N1(e,L,z,A.dragIndex)}Lc(M.currentTarget,M),A.status="idle"},[e]),P=x.useCallback(M=>{const A=w.current;M.key==="Escape"&&(A.status==="dragging"&&k(Object.fromEntries(l.map((L,z)=>[L.id,{y:z*s,offsetY:0,isSelected:!1}]))),A.status="idle")},[s,l]),I=x.useCallback(()=>{d||e.batch(()=>{e.mark("creating page");const M=ji.createId();e.createPage({name:t("page-menu.new-page-initial-name"),id:M}),e.setCurrentPage(M),f(!0)})},[e,t,d]);return y.jsxs(D1,{id:"pages",onOpenChange:o,open:i,children:[y.jsx(z1,{children:y.jsx(oe,{className:"tlui-page-menu__trigger tlui-menu__trigger","data-testid":"main.page-menu",icon:"chevron-down",type:"menu",title:c.name,children:y.jsx("div",{className:"tlui-page-menu__name",children:c.name})})}),y.jsx(ET,{side:"bottom",align:"start",sideOffset:6,children:y.jsxs("div",{className:"tlui-page-menu__wrapper",children:[y.jsxs("div",{className:"tlui-page-menu__header",children:[y.jsx("div",{className:"tlui-page-menu__header__title",children:t("page-menu.title")}),!d&&y.jsxs("div",{className:"tlui-buttons__horizontal",children:[y.jsx(oe,{type:"icon","data-testid":"page-menu.edit",title:t(g?"page-menu.edit-done":"page-menu.edit-start"),icon:g?"check":"edit",onClick:m}),y.jsx(oe,{type:"icon","data-testid":"page-menu.create",icon:"plus",title:t(h?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:h,onClick:I})]})]}),y.jsx("div",{className:"tlui-page-menu__list tlui-menu__group",style:{height:s*l.length+4},ref:a,children:l.map((M,A)=>{const L=b[M.id]??{position:A*40,offsetY:0};return g?y.jsxs("div",{"data-testid":`page-menu-item-${M.id}`,className:"tlui-page_menu__item__sortable",style:{zIndex:M.id===c.id?888:A,transform:`translate(0px, ${L.y+L.offsetY}px)`},children:[y.jsx(oe,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",icon:"drag-handle-dots",onPointerDown:S,onPointerUp:_,onPointerMove:C,onKeyDown:P,"data-id":M.id,"data-index":A}),n<5&&p?y.jsx(oe,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const z=window.prompt("Rename page",M.name);z&&z!==M.name&&e.renamePage(M.id,z)},onDoubleClick:m,isChecked:M.id===c.id,children:y.jsx("span",{children:M.name})}):y.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:s},children:y.jsx(wee,{id:M.id,name:M.name,isCurrentPage:M.id===c.id})}),!d&&y.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":g,children:y.jsx(MT,{index:A,item:M,listSize:l.length})})]},M.id+"_editing"):y.jsxs("div",{"data-testid":`page-menu-item-${M.id}`,className:"tlui-page-menu__item",children:[y.jsxs(oe,{type:"normal",className:"tlui-page-menu__item__button tlui-page-menu__item__button__checkbox",onClick:()=>e.setCurrentPage(M.id),onDoubleClick:m,isChecked:M.id===c.id,title:t("page-menu.go-to-page"),children:[y.jsx("div",{className:"tlui-page-menu__item__button__check",children:M.id===c.id&&y.jsx(Wn,{icon:"check"})}),y.jsx("span",{children:M.name})]}),!d&&y.jsx("div",{className:"tlui-page_menu__item__submenu",children:y.jsx(MT,{index:A,item:M,listSize:l.length,onRename:()=>{if(e.environment.isIos){const z=window.prompt("Rename page",M.name);z&&z!==M.name&&e.renamePage(M.id,z)}else e.batch(()=>{f(!0),e.setCurrentPage(M.id)})}})})]},M.id)})})]})})]})},AT=x.memo(function(){const e=Se(),t=o3(),n=tn().redo;return y.jsx(oe,{"data-testid":"main.redo",icon:n.icon,type:"icon",title:`${e(n.label)} ${ai(n.kbd)}`,disabled:!t,onClick:()=>n.onSelect("quick-actions"),smallIcon:!0})}),TT=Pe(function(){const e=H(),t=tn(),n=Se(),r=t.delete;return dr()?null:y.jsx(oe,{icon:r.icon,type:"icon",onClick:()=>{r.onSelect("quick-actions"),e.getContainer().focus()},disabled:!(e.isIn("select")&&e.getSelectedShapeIds().length>0),title:`${n(r.label)} ${ai(r.kbd)}`,smallIcon:!0})}),jT=x.memo(function(){const e=Se(),t=s3(),n=tn().undo;return y.jsx(oe,{"data-testid":"main.undo",icon:n.icon,type:"icon",title:`${e(n.label)} ${ai(n.kbd)}`,disabled:!t,onClick:()=>n.onSelect("quick-actions"),smallIcon:!0})}),See=Pe(function(){const e=H(),t=fr(),n=dr();return y.jsx("div",{className:"tlui-menu-zone",children:y.jsxs("div",{className:"tlui-buttons__horizontal",children:[y.jsx(vee,{}),y.jsx(xee,{}),t>=6&&!n&&!e.isInAny("hand","zoom")&&y.jsxs(y.Fragment,{children:[y.jsx(jT,{}),y.jsx(AT,{}),y.jsx(TT,{}),y.jsx(IT,{}),y.jsx(PT,{})]})]})})});function kee(e,t){const[n,r]=J.useState(t);J.useLayoutEffect(()=>{const o=localStorage.getItem(e);if(o)try{r(JSON.parse(o))}catch{console.error(`Could not restore value ${e} from local storage.`)}},[e]);const i=J.useCallback(o=>{r(s=>{const a=typeof o=="function"?o(s):o;return localStorage.setItem(e,JSON.stringify(a)),a})},[e]);return[n,i]}class Ju{constructor(t){v(this,"dpr",1);v(this,"colors",{shapeFill:"rgba(144, 144, 144, .1)",selectFill:"#2f80ed",viewportFill:"rgba(144, 144, 144, .1)"});v(this,"id",Re());v(this,"cvs",null);v(this,"pageBounds",[]);v(this,"collaborators",[]);v(this,"canvasScreenBounds",new se);v(this,"canvasPageBounds",new se);v(this,"contentPageBounds",new se);v(this,"contentScreenBounds",new se);v(this,"originPagePoint",new E);v(this,"originPageCenter",new E);v(this,"isInViewport",!1);v(this,"debug",!1);v(this,"updateContentScreenBounds",()=>{const{contentScreenBounds:t,contentPageBounds:n,canvasScreenBounds:r}=this;let{x:i,y:o,w:s,h:a}=t;if(n.w>n.h){const l=r.w/(n.w/n.h);l>r.h?(i=(r.w-r.w*(r.h/l))/2,o=0,s=r.w*(r.h/l),a=r.h):(i=0,o=(r.h-l)/2,s=r.w,a=l)}else if(n.w<n.h){const l=r.h/(n.h/n.w);i=(r.w-l)/2,o=0,s=l,a=r.h}else i=r.h/2,o=0,s=r.h,a=r.h;t.set(i,o,s,a)});v(this,"updateCanvasPageBounds",()=>{const{canvasPageBounds:t,canvasScreenBounds:n,contentPageBounds:r,contentScreenBounds:i}=this;t.set(0,0,r.width/(i.width/n.width),r.height/(i.height/n.height)),t.center=r.center});v(this,"getScreenPoint",(t,n)=>{const{canvasScreenBounds:r}=this,i=(t-r.minX)*this.dpr,o=(n-r.minY)*this.dpr;return{x:i,y:o}});v(this,"getPagePoint",(t,n)=>{const{contentPageBounds:r,contentScreenBounds:i,canvasPageBounds:o}=this,{x:s,y:a}=this.getScreenPoint(t,n);return new E(o.minX+s*r.width/i.width,o.minY+a*r.height/i.height,1)});v(this,"minimapScreenPointToPagePoint",(t,n,r=!1,i=!1)=>{const{editor:o}=this,s=o.getViewportPageBounds();let{x:a,y:l}=this.getPagePoint(t,n);if(i){const c=this.editor.getCurrentPageBounds(),u=s,d=((c==null?void 0:c.minX)??0)-u.width/2,h=((c==null?void 0:c.maxX)??0)+u.width/2,p=((c==null?void 0:c.minY)??0)-u.height/2,g=((c==null?void 0:c.maxY)??0)+u.height/2,f=Math.max(0,d+u.width-a),m=Math.max(0,-(h-u.width-a)),w=Math.max(0,p+u.height-l),b=Math.max(0,-(g-u.height-l)),k=Math.max(0,f-m),S=Math.max(0,m-f),C=Math.max(0,w-b),_=Math.max(0,b-w);k&&k>S?a+=k/2:S&&(a-=S/2),C&&C>_?l+=C/2:_&&(l-=_/2),a=ti(a,d,h),l=ti(l,p,g)}if(r){const{originPagePoint:c}=this,u=Math.abs(a-c.x),d=Math.abs(l-c.y);u>d?l=c.y:a=c.x}return new E(a,l)});v(this,"render",()=>{const{cvs:t,pageBounds:n}=this;this.updateCanvasPageBounds();const{editor:r,canvasScreenBounds:i,canvasPageBounds:o,contentPageBounds:s,contentScreenBounds:a}=this,{width:l,height:c}=i,u=r.getSelectedShapeIds(),d=r.getViewportPageBounds();if(!t||!n)return;const h=t.getContext("2d");if(!h)throw new Error("Minimap (shapes): Could not get context");h.resetTransform(),h.globalAlpha=1,h.clearRect(0,0,l,c);const p=a.width/s.width,g=a.height/s.height;h.translate((l-a.width)/2,(c-a.height)/2),h.scale(p,g),h.translate(-s.minX,-s.minY);const f=8/p,m=8/p,w=1/p,b=1/p,k=f/4,S=m/4,C=new Path2D,_=new Path2D,{shapeFill:P,selectFill:I,viewportFill:M}=this.colors;let A;for(let F=0,R=n.length;F<R;F++)A=n[F],Ju.roundedRect(u.includes(A.id)?_:C,A.minX,A.minY,A.width,A.height,ti(f,w,A.width/k),ti(m,b,A.height/S));if(h.fillStyle=P,h.fill(C),h.fillStyle=I,h.fill(_),this.debug){const F=se.Common(n),{minX:R,minY:W,width:V,height:D}=F;h.strokeStyle="green",h.lineWidth=2/p,h.strokeRect(R+1/p,W+1/g,V-2/p,D-2/g)}{const{brush:F}=r.getInstanceState();if(F){const{x:R,y:W,w:V,h:D}=F;h.beginPath(),Ju.sharpRect(h,R,W,V,D),h.closePath(),h.fillStyle=M,h.fill()}}{const{minX:F,minY:R,width:W,height:V}=d;h.beginPath();const D=12/p,B=12/p;Ju.roundedRect(h,F,R,W,V,Math.min(W/4,D),Math.min(V/4,B)),h.closePath(),h.fillStyle=M,h.fill(),this.debug&&(h.strokeStyle="orange",h.strokeRect(F+1/p,R+1/g,W-2/p,V-2/g))}const L=2.5/p,z=2.5/g,$=r.getCurrentPageId();let j;for(let F=0;F<this.collaborators.length;F++)j=this.collaborators[F],j.currentPageId===$&&(h.beginPath(),h.ellipse(ti(j.cursor.x,o.minX+L,o.maxX-L),ti(j.cursor.y,o.minY+z,o.maxY-z),5/p,5/g,0,0,De),h.fillStyle=j.color,h.fill());if(this.debug){h.lineWidth=2/p;{const{minX:F,minY:R,width:W,height:V}=s;h.strokeStyle="red",h.strokeRect(F+1/p,R+1/g,W-2/p,V-2/g)}{const{minX:F,minY:R,width:W,height:V}=o;h.strokeStyle="blue",h.strokeRect(F+1/p,R+1/g,W-2/p,V-2/g)}}});this.editor=t}setDpr(t){this.dpr=+t.toFixed(2)}static roundedRect(t,n,r,i,o,s,a){if(s<1&&a<1){t.rect(n,r,i,o);return}t.moveTo(n+s,r),t.lineTo(n+i-s,r),t.quadraticCurveTo(n+i,r,n+i,r+a),t.lineTo(n+i,r+o-a),t.quadraticCurveTo(n+i,r+o,n+i-s,r+o),t.lineTo(n+s,r+o),t.quadraticCurveTo(n,r+o,n,r+o-a),t.lineTo(n,r+a),t.quadraticCurveTo(n,r,n+s,r)}static sharpRect(t,n,r,i,o,s,a){t.rect(n,r,i,o)}}function _ee({shapeFill:e,selectFill:t,viewportFill:n}){const r=H(),i=x.useRef(null),o=x.useRef(!1),s=vp(),a=R_("dpr",()=>r.getInstanceState().devicePixelRatio,[r]),l=x.useMemo(()=>r.store.query.records("instance_presence"),[r]),c=x.useMemo(()=>new Ju(r),[r]);x.useEffect(()=>{const g=requestAnimationFrame(()=>{const f=getComputedStyle(r.getContainer());c.colors={shapeFill:f.getPropertyValue(e).trim(),selectFill:f.getPropertyValue(t).trim(),viewportFill:f.getPropertyValue(n).trim()},c.render()});return()=>{cancelAnimationFrame(g)}},[r,t,e,n,c,s]);const u=x.useCallback(g=>{if(!r.getCurrentPageShapeIds().size)return;const f=c.minimapScreenPointToPagePoint(g.clientX,g.clientY,!1,!1),m=c.minimapScreenPointToPagePoint(g.clientX,g.clientY,!1,!0);c.originPagePoint.setTo(m),c.originPageCenter.setTo(r.getViewportPageBounds().center),r.centerOnPoint(f,{duration:Di})},[r,c]),d=x.useCallback(g=>{const f=g.currentTarget;if(Oc(f,g),!r.getCurrentPageShapeIds().size)return;o.current=!0,c.isInViewport=!1;const m=c.minimapScreenPointToPagePoint(g.clientX,g.clientY,!1,!1),w=c.minimapScreenPointToPagePoint(g.clientX,g.clientY,!1,!0),b=r.getViewportPageBounds();if(c.isInViewport=b.containsPoint(w),c.isInViewport)c.originPagePoint.setTo(w),c.originPageCenter.setTo(b.center);else{const S=E.Sub(b.center,b.point),C=E.Add(m,S);c.originPagePoint.setTo(C),c.originPageCenter.setTo(m),r.centerOnPoint(m,{duration:Di})}function k(S){f&&Lc(f,S),o.current=!1,document.body.removeEventListener("pointerup",k)}document.body.addEventListener("pointerup",k)},[r,c]),h=x.useCallback(g=>{const f=c.minimapScreenPointToPagePoint(g.clientX,g.clientY,g.shiftKey,!0);if(o.current){if(c.isInViewport){const k=c.originPagePoint.clone().sub(c.originPageCenter);r.centerOnPoint(E.Sub(f,k));return}r.centerOnPoint(f)}const m=c.getPagePoint(g.clientX,g.clientY),w=r.pageToScreen(m),b={type:"pointer",target:"canvas",name:"pointer_move",...En(g),point:w,isPen:r.getInstanceState().isPenMode};r.dispatch(b)},[r,c]),p=x.useCallback(g=>{const f=sC(g);r.dispatch({type:"wheel",name:"wheel",delta:f,point:new E(g.clientX,g.clientY),shiftKey:g.shiftKey,altKey:g.altKey,ctrlKey:g.metaKey||g.ctrlKey})},[r]);return vs("update when dpr changes",()=>{const g=a.get();c.setDpr(g);const f=i.current,m=f.getBoundingClientRect(),w=m.width*g,b=m.height*g;f.width=w,f.height=b,c.canvasScreenBounds.set(m.x,m.y,w,b),c.cvs=i.current},[a,c]),vs("minimap render when pagebounds or collaborators changes",()=>{const g=r.getCurrentPageShapeIds(),f=r.getCurrentPageBounds(),m=r.getViewportPageBounds();a.get(),c.contentPageBounds=f?se.Expand(f,m):m,c.updateContentScreenBounds();const w=[];g.forEach(b=>{let k=r.getShapePageBounds(b);if(!k)return;const S=r.getShapeMask(b);if(S){const C=$0(S,k.corners);if(!C)return;k=se.FromPoints(C)}k&&(k.id=b,w.push(k))}),c.pageBounds=w,c.collaborators=l.get(),c.render()},[r,c]),y.jsx("div",{className:"tlui-minimap",children:y.jsx("canvas",{ref:i,className:"tlui-minimap__canvas",onDoubleClick:u,onPointerMove:h,onPointerDown:d,onWheel:p})})}const R1=Pe(function(){const e=H(),t=Se(),n=fr(),r=e.getZoomLevel(),i=e.getCurrentPageShapeIds().size>0,o=e.getSelectedShapeIds().length>0,s=e.getZoomLevel()===1,a=x.useCallback(()=>{e.resetZoom(e.getViewportScreenCenter(),{duration:Di})},[e]);return y.jsxs(Yo,{id:"zoom",children:[y.jsx(Ou,{children:y.jsx(oe,{type:"icon",title:`${t("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu",className:n<5?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,icon:n<4?"zoom-in":void 0,children:n<4?null:y.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(r*100),"%"]})})}),y.jsx(Xo,{side:"top",align:"start",alignOffset:0,children:y.jsxs(Zi,{children:[y.jsx(zu,{action:"zoom-in","data-testid":"minimap.zoom-menu.zoom-in",noClose:!0}),y.jsx(zu,{action:"zoom-out","data-testid":"minimap.zoom-menu.zoom-out",noClose:!0}),y.jsx(zu,{action:"zoom-to-100","data-testid":"minimap.zoom-menu.zoom-to-100",noClose:!0,disabled:s}),y.jsx(zu,{action:"zoom-to-fit",disabled:!i,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0}),y.jsx(zu,{action:"zoom-to-selection",disabled:!o,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})]})})]})});function zu(e){const{action:t,disabled:n=!1,noClose:r=!1}=e,i=tn();return y.jsx(Gn,{type:"menu",label:i[t].label,kbd:i[t].kbd,"data-testid":e["data-testid"],onClick:()=>i[t].onSelect("zoom-menu"),noClose:r,disabled:n})}const Cee=x.memo(function(){const e=tn(),t=Se(),n=fr(),[r,i]=kee("minimap",!0),o=x.useCallback(()=>{i(s=>!s)},[i]);return n<4?null:y.jsxs("div",{className:"tlui-navigation-zone",children:[y.jsx("div",{className:"tlui-buttons__horizontal",children:n<6?y.jsx(R1,{}):r?y.jsxs(y.Fragment,{children:[y.jsx(R1,{}),y.jsx(oe,{type:"icon",icon:r?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:o})]}):y.jsxs(y.Fragment,{children:[y.jsx(oe,{type:"icon",icon:"minus","data-testid":"minimap.zoom-out",title:`${t(e["zoom-out"].label)} ${ai(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone")}),y.jsx(R1,{}),y.jsx(oe,{type:"icon",icon:"plus","data-testid":"minimap.zoom-in",title:`${t(e["zoom-in"].label)} ${ai(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone")}),y.jsx(oe,{type:"icon",icon:r?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:o})]})}),n>=6&&!r&&y.jsx(_ee,{viewportFill:"--color-muted-1",selectFill:"--color-selected",shapeFill:"--color-text-3"})]})}),Eee=Pe(function(){const e=H().getInstanceState().isPenMode,t=tn();if(!e)return null;const n=t["exit-pen-mode"];return y.jsx(oe,{type:"normal",label:n.label,iconLeft:n.icon,onClick:()=>n.onSelect("helper-buttons")})}),Pee=Pe(function(){const e=H(),t=tn();if(!e.getInstanceState().followingUserId)return null;const n=t["stop-following"];return y.jsx(oe,{type:"normal",label:n.label,iconLeft:n.icon,onClick:()=>n.onSelect("people-menu")})}),Iee=[lr,ks,Ma,Jr];function OT(){const e=H();return Y("getRelevantStyles",()=>{var r;const t=new U0(e.getSharedStyles()),n=e.getSelectedShapeIds().length>0||!!((r=e.root.getCurrent())!=null&&r.shapeType);if(t.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const i of Iee)t.applyValue(i,e.getStyleForNextShape(i));return t.size===0&&!n?null:{styles:t,opacity:e.getSharedOpacity()}},[e])}function Mee(e){const{uiType:t,items:n,title:r,style:i,value:o,onValueChange:s}=e,a=H(),l=Se(),c=x.useRef(!1),{handleButtonClick:u,handleButtonPointerDown:d,handleButtonPointerEnter:h,handleButtonPointerUp:p}=x.useMemo(()=>{const f=()=>{c.current=!1,window.removeEventListener("pointerup",f)};return{handleButtonClick:m=>{const{id:w}=m.currentTarget.dataset;o.type==="shared"&&o.value===w||(a.mark("point picker item"),s(i,w,!1))},handleButtonPointerDown:m=>{const{id:w}=m.currentTarget.dataset;a.mark("point picker item"),s(i,w,!0),c.current=!0,window.addEventListener("pointerup",f)},handleButtonPointerEnter:m=>{if(!c.current)return;const{id:w}=m.currentTarget.dataset;s(i,w,!0)},handleButtonPointerUp:m=>{const{id:w}=m.currentTarget.dataset;s(i,w,!1)}}},[o,a,s,i]),g=Y("theme",()=>Cn({isDarkMode:a.user.getIsDarkMode()}),[a]);return y.jsx("div",{className:pe("tlui-buttons__grid"),children:n.map(f=>y.jsx(oe,{type:"icon","data-id":f.value,"data-testid":`style.${t}.${f.value}`,"aria-label":f.value,"data-state":o.type==="shared"&&o.value===f.value?"hinted":void 0,title:r+" \u2014 "+l(`${t}-style.${f.value}`),className:pe("tlui-button-grid__button"),style:i===lr?{color:g[f.value].solid}:void 0,onPointerEnter:h,onPointerDown:d,onPointerUp:p,onClick:u,icon:f.icon},f.value))})}const xl=x.memo(Mee);function LT(e,[t,n]){return Math.min(n,Math.max(t,e))}function Aee(e){const t=x.useRef({value:e,previous:e});return x.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}const DT=["PageUp","PageDown"],zT=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],NT={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Nu="Slider",[F1,Tee,jee]=Mf(Nu),[RT,Ire]=si(Nu,[jee]),[Oee,hg]=RT(Nu),Lee=x.forwardRef((e,t)=>{const{name:n,min:r=0,max:i=100,step:o=1,orientation:s="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[r],value:u,onValueChange:d=()=>{},onValueCommit:h=()=>{},inverted:p=!1,...g}=e,[f,m]=x.useState(null),w=We(t,j=>m(j)),b=x.useRef(new Set),k=x.useRef(0),S=s==="horizontal",C=f?!!f.closest("form"):!0,_=S?Dee:zee,[P=[],I]=Bo({prop:u,defaultProp:c,onChange:j=>{var F;(F=[...b.current][k.current])===null||F===void 0||F.focus(),d(j)}}),M=x.useRef(P);function A(j){const F=Kee(P,j);$(j,F)}function L(j){$(j,k.current)}function z(){const j=M.current[k.current];P[k.current]!==j&&h(P)}function $(j,F,{commit:R}={commit:!1}){const W=Gee(o),V=qee(Math.round((j-r)/o)*o+r,W),D=LT(V,[r,i]);I((B=[])=>{const X=Vee(B,D,F);if(Xee(X,l*o)){k.current=X.indexOf(D);const ie=String(X)!==String(B);return ie&&R&&h(X),ie?X:B}else return B})}return x.createElement(Oee,{scope:e.__scopeSlider,disabled:a,min:r,max:i,valueIndexToChangeRef:k,thumbs:b.current,values:P,orientation:s},x.createElement(F1.Provider,{scope:e.__scopeSlider},x.createElement(F1.Slot,{scope:e.__scopeSlider},x.createElement(_,Z({"aria-disabled":a,"data-disabled":a?"":void 0},g,{ref:w,onPointerDown:re(g.onPointerDown,()=>{a||(M.current=P)}),min:r,max:i,inverted:p,onSlideStart:a?void 0:A,onSlideMove:a?void 0:L,onSlideEnd:a?void 0:z,onHomeKeyDown:()=>!a&&$(r,0,{commit:!0}),onEndKeyDown:()=>!a&&$(i,P.length-1,{commit:!0}),onStepKeyDown:({event:j,direction:F})=>{if(!a){const R=DT.includes(j.key)||j.shiftKey&&zT.includes(j.key)?10:1,W=k.current,V=P[W],D=o*R*F;$(V+D,W,{commit:!0})}}})))),C&&P.map((j,F)=>x.createElement(Uee,{key:F,name:n?n+(P.length>1?"[]":""):void 0,value:j})))}),[FT,$T]=RT(Nu,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Dee=x.forwardRef((e,t)=>{const{min:n,max:r,dir:i,inverted:o,onSlideStart:s,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...u}=e,[d,h]=x.useState(null),p=We(t,k=>h(k)),g=x.useRef(),f=p1(i),m=f==="ltr",w=m&&!o||!m&&o;function b(k){const S=g.current||d.getBoundingClientRect(),C=[0,S.width],_=$1(C,w?[n,r]:[r,n]);return g.current=S,_(k-S.left)}return x.createElement(FT,{scope:e.__scopeSlider,startEdge:w?"left":"right",endEdge:w?"right":"left",direction:w?1:-1,size:"width"},x.createElement(BT,Z({dir:f,"data-orientation":"horizontal"},u,{ref:p,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:k=>{const S=b(k.clientX);s==null||s(S)},onSlideMove:k=>{const S=b(k.clientX);a==null||a(S)},onSlideEnd:()=>{g.current=void 0,l==null||l()},onStepKeyDown:k=>{const S=NT[w?"from-left":"from-right"].includes(k.key);c==null||c({event:k,direction:S?-1:1})}})))}),zee=x.forwardRef((e,t)=>{const{min:n,max:r,inverted:i,onSlideStart:o,onSlideMove:s,onSlideEnd:a,onStepKeyDown:l,...c}=e,u=x.useRef(null),d=We(t,u),h=x.useRef(),p=!i;function g(f){const m=h.current||u.current.getBoundingClientRect(),w=[0,m.height],b=$1(w,p?[r,n]:[n,r]);return h.current=m,b(f-m.top)}return x.createElement(FT,{scope:e.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1},x.createElement(BT,Z({"data-orientation":"vertical"},c,{ref:d,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:f=>{const m=g(f.clientY);o==null||o(m)},onSlideMove:f=>{const m=g(f.clientY);s==null||s(m)},onSlideEnd:()=>{h.current=void 0,a==null||a()},onStepKeyDown:f=>{const m=NT[p?"from-bottom":"from-top"].includes(f.key);l==null||l({event:f,direction:m?-1:1})}})))}),BT=x.forwardRef((e,t)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:i,onSlideEnd:o,onHomeKeyDown:s,onEndKeyDown:a,onStepKeyDown:l,...c}=e,u=hg(Nu,n);return x.createElement(Fe.span,Z({},c,{ref:t,onKeyDown:re(e.onKeyDown,d=>{d.key==="Home"?(s(d),d.preventDefault()):d.key==="End"?(a(d),d.preventDefault()):DT.concat(zT).includes(d.key)&&(l(d),d.preventDefault())}),onPointerDown:re(e.onPointerDown,d=>{const h=d.target;h.setPointerCapture(d.pointerId),d.preventDefault(),u.thumbs.has(h)?h.focus():r(d)}),onPointerMove:re(e.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&i(d)}),onPointerUp:re(e.onPointerUp,d=>{const h=d.target;h.hasPointerCapture(d.pointerId)&&(h.releasePointerCapture(d.pointerId),o(d))})}))}),Nee="SliderTrack",Ree=x.forwardRef((e,t)=>{const{__scopeSlider:n,...r}=e,i=hg(Nee,n);return x.createElement(Fe.span,Z({"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation},r,{ref:t}))}),UT="SliderRange",Fee=x.forwardRef((e,t)=>{const{__scopeSlider:n,...r}=e,i=hg(UT,n),o=$T(UT,n),s=x.useRef(null),a=We(t,s),l=i.values.length,c=i.values.map(h=>HT(h,i.min,i.max)),u=l>1?Math.min(...c):0,d=100-Math.max(...c);return x.createElement(Fe.span,Z({"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0},r,{ref:a,style:{...e.style,[o.startEdge]:u+"%",[o.endEdge]:d+"%"}}))}),VT="SliderThumb",$ee=x.forwardRef((e,t)=>{const n=Tee(e.__scopeSlider),[r,i]=x.useState(null),o=We(t,a=>i(a)),s=x.useMemo(()=>r?n().findIndex(a=>a.ref.current===r):-1,[n,r]);return x.createElement(Bee,Z({},e,{ref:o,index:s}))}),Bee=x.forwardRef((e,t)=>{const{__scopeSlider:n,index:r,...i}=e,o=hg(VT,n),s=$T(VT,n),[a,l]=x.useState(null),c=We(t,m=>l(m)),u=A3(a),d=o.values[r],h=d===void 0?0:HT(d,o.min,o.max),p=Hee(r,o.values.length),g=u==null?void 0:u[s.size],f=g?Wee(g,h,s.direction):0;return x.useEffect(()=>{if(a)return o.thumbs.add(a),()=>{o.thumbs.delete(a)}},[a,o.thumbs]),x.createElement("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[s.startEdge]:`calc(${h}% + ${f}px)`}},x.createElement(F1.ItemSlot,{scope:e.__scopeSlider},x.createElement(Fe.span,Z({role:"slider","aria-label":e["aria-label"]||p,"aria-valuemin":o.min,"aria-valuenow":d,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0},i,{ref:c,style:d===void 0?{display:"none"}:e.style,onFocus:re(e.onFocus,()=>{o.valueIndexToChangeRef.current=r})}))))}),Uee=e=>{const{value:t,...n}=e,r=x.useRef(null),i=Aee(t);return x.useEffect(()=>{const o=r.current,s=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(s,"value").set;if(i!==t&&a){const l=new Event("input",{bubbles:!0});a.call(o,t),o.dispatchEvent(l)}},[i,t]),x.createElement("input",Z({style:{display:"none"}},n,{ref:r,defaultValue:t}))};function Vee(e=[],t,n){const r=[...e];return r[n]=t,r.sort((i,o)=>i-o)}function HT(e,t,n){const r=100/(n-t)*(e-t);return LT(r,[0,100])}function Hee(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function Kee(e,t){if(e.length===1)return 0;const n=e.map(i=>Math.abs(i-t)),r=Math.min(...n);return n.indexOf(r)}function Wee(e,t,n){const r=e/2,i=$1([0,50],[0,r]);return(r-i(t)*n)*n}function Yee(e){return e.slice(0,-1).map((t,n)=>e[n+1]-t)}function Xee(e,t){if(t>0){const n=Yee(e);return Math.min(...n)>=t}return!0}function $1(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}function Gee(e){return(String(e).split(".")[1]||"").length}function qee(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}const Zee=Lee,Qee=Ree,Jee=Fee,ete=$ee,tte=x.memo(function(e){const{title:t,steps:n,value:r,label:i,onValueChange:o}=e,s=H(),a=Se(),l=x.useCallback(d=>{o(d[0],!0)},[o]),c=x.useCallback(()=>{s.mark("click slider")},[s]),u=x.useCallback(()=>{r&&o(r,!1)},[r,o]);return y.jsx("div",{className:"tlui-slider__container",children:y.jsxs(Zee,{"data-testid":e["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:n,step:1,value:r?[r]:void 0,onPointerDown:c,onValueChange:l,onPointerUp:u,title:t+" \u2014 "+a(i),children:[y.jsx(Qee,{className:"tlui-slider__track",dir:"ltr",children:r!==null&&y.jsx(Jee,{className:"tlui-slider__range",dir:"ltr"})}),r!==null&&y.jsx(ete,{className:"tlui-slider__thumb",dir:"ltr"})]})})}),nte=x.memo(function({label:e,uiTypeA:t,uiTypeB:n,labelA:r,labelB:i,itemsA:o,itemsB:s,styleA:a,styleB:l,valueA:c,valueB:u,onValueChange:d}){const h=Se(),p=x.useMemo(()=>{var f;return((f=o.find(m=>c.type==="shared"&&c.value===m.value))==null?void 0:f.icon)??"mixed"},[o,c]),g=x.useMemo(()=>{var f;return((f=s.find(m=>u.type==="shared"&&u.value===m.value))==null?void 0:f.icon)??"mixed"},[s,u]);return c===void 0&&u===void 0?null:y.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[y.jsx("div",{title:h(e),className:"tlui-style-panel__double-select-picker-label",children:h(e)}),y.jsxs("div",{className:"tlui-buttons__horizontal",children:[y.jsxs(Yo,{id:`style panel ${t} A`,children:[y.jsx(ju,{asChild:!0,onTouchEnd:f=>Ee(f),children:y.jsx(oe,{type:"icon","data-testid":`style.${t}`,title:h(r)+" \u2014 "+(c===null||c.type==="mixed"?h("style-panel.mixed"):h(`${t}-style.${c.value}`)),icon:p,invertIcon:!0,smallIcon:!0})}),y.jsx(Xo,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:y.jsx("div",{className:"tlui-buttons__grid",children:o.map(f=>y.jsx(Gn,{type:"icon",title:h(r)+" \u2014 "+h(`${t}-style.${f.value}`),"data-testid":`style.${t}.${f.value}`,icon:f.icon,onClick:()=>d(a,f.value,!1),invertIcon:!0},f.value))})})]}),y.jsxs(Yo,{id:`style panel ${n}`,children:[y.jsx(ju,{asChild:!0,onTouchEnd:f=>Ee(f),children:y.jsx(oe,{type:"icon","data-testid":`style.${n}`,title:h(i)+" \u2014 "+(u===null||u.type==="mixed"?h("style-panel.mixed"):h(`${n}-style.${u.value}`)),icon:g,smallIcon:!0})}),y.jsx(Xo,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:y.jsx("div",{className:"tlui-buttons__grid",children:s.map(f=>y.jsx(Gn,{type:"icon",title:h(i)+" \u2014 "+h(`${n}-style.${f.value}`),"data-testid":`style.${n}.${f.value}`,icon:f.icon,onClick:()=>d(l,f.value,!1)},f.value))})})]})]})]})}),B1=x.memo(function({id:e,label:t,uiType:n,style:r,items:i,type:o,value:s,onValueChange:a}){const l=Se(),c=x.useMemo(()=>{var u;return(u=i.find(d=>s.type==="shared"&&d.value===s.value))==null?void 0:u.icon},[i,s]);return y.jsxs(Yo,{id:`style panel ${e}`,children:[y.jsx(ju,{asChild:!0,onTouchEnd:u=>Ee(u),children:y.jsx(oe,{type:o,"data-testid":`style.${n}`,title:s.type==="mixed"?l("style-panel.mixed"):l(`${n}-style.${s.value}`),label:t,icon:c??"mixed"})}),y.jsx(Xo,{side:"left",align:"center",alignOffset:0,children:y.jsx("div",{className:"tlui-buttons__grid",children:i.map(u=>y.jsx(Gn,{type:"icon","data-testid":`style.${n}.${u.value}`,title:l(`${n}-style.${u.value}`),icon:u.icon,onClick:()=>a(r,u.value,!1)},u.value))})})]})}),Br={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],horizontalAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-center"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"cloud",icon:"geo-cloud"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"star",icon:"geo-star"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},KT=function({isMobile:e}){const t=H(),n=OT(),r=x.useCallback(()=>{e||t.updateInstanceState({isChangingStyle:!1})},[t,e]);if(!n)return null;const{styles:i,opacity:o}=n,s=i.get(ei),a=i.get(Uh),l=i.get(Bh),c=i.get(Kh),u=i.get(Qr),d=s===void 0,h=a===void 0&&l===void 0,p=c===void 0,g=u===void 0;return y.jsxs("div",{className:"tlui-style-panel","data-ismobile":e,onPointerLeave:r,children:[y.jsx(rte,{styles:i,opacity:o}),!g&&y.jsx(ite,{styles:i}),!(d&&h&&p)&&y.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[y.jsx(ote,{styles:i}),y.jsx(ate,{styles:i}),y.jsx(ste,{styles:i})]})]})};function Ru(){const e=H();return J.useMemo(()=>function(t,n,r){e.batch(()=>{e.isIn("select")&&e.setStyleForSelectedShapes(t,n,{squashing:r}),e.setStyleForNextShapes(t,n,{squashing:r}),e.updateInstanceState({isChangingStyle:!0})})},[e])}const Fu=[.1,.25,.5,.75,1];function rte({styles:e,opacity:t}){const n=H(),r=Se(),i=Ru(),o=J.useCallback((h,p)=>{const g=Fu[h];n.batch(()=>{n.isIn("select")&&n.setOpacityForSelectedShapes(g,{ephemeral:p}),n.setOpacityForNextShapes(g,{ephemeral:p}),n.updateInstanceState({isChangingStyle:!0})})},[n]),s=e.get(lr),a=e.get(Ma),l=e.get(ks),c=e.get(Jr),u=a!==void 0||l!==void 0||c!==void 0,d=t.type==="mixed"?-1:Fu.indexOf(OL(Fu,h=>Math.abs(h-t.value)));return y.jsxs(y.Fragment,{children:[y.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles",children:[s===void 0?null:y.jsx(xl,{title:r("style-panel.color"),uiType:"color",style:lr,items:Br.color,value:s,onValueChange:i}),t===void 0?null:y.jsx(tte,{"data-testid":"style.opacity",value:d>=0?d:Fu.length-1,label:t.type==="mixed"?"style-panel.mixed":`opacity-style.${t.value}`,onValueChange:o,steps:Fu.length-1,title:r("style-panel.opacity")})]}),u&&y.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[a===void 0?null:y.jsx(xl,{title:r("style-panel.fill"),uiType:"fill",style:Ma,items:Br.fill,value:a,onValueChange:i}),l===void 0?null:y.jsx(xl,{title:r("style-panel.dash"),uiType:"dash",style:ks,items:Br.dash,value:l,onValueChange:i}),c===void 0?null:y.jsx(xl,{title:r("style-panel.size"),uiType:"size",style:Jr,items:Br.size,value:c,onValueChange:i})]})]})}function ite({styles:e}){const t=Se(),n=Ru(),r=e.get(Qr),i=e.get(Tc),o=e.get(Vh);return r===void 0&&i===void 0?null:y.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[r===void 0?null:y.jsx(xl,{title:t("style-panel.font"),uiType:"font",style:Qr,items:Br.font,value:r,onValueChange:n}),i===void 0?null:y.jsxs("div",{className:"tlui-style-panel__row",children:[y.jsx(xl,{title:t("style-panel.align"),uiType:"align",style:Tc,items:Br.horizontalAlign,value:i,onValueChange:n}),y.jsx("div",{className:"tlui-style-panel__row__extra-button",children:o===void 0?y.jsx(oe,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",icon:"vertical-align-center",disabled:!0}):y.jsx(B1,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:Vh,items:Br.verticalAlign,value:o,onValueChange:n})})]})]})}function ote({styles:e}){const t=Ru(),n=e.get(ei);return n===void 0?null:y.jsx(B1,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:ei,items:Br.geo,value:n,onValueChange:t})}function ste({styles:e}){const t=Ru(),n=e.get(Kh);return n===void 0?null:y.jsx(B1,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:Kh,items:Br.spline,value:n,onValueChange:t})}function ate({styles:e}){const t=Ru(),n=e.get(Uh),r=e.get(Bh);return!n||!r?null:y.jsx(nte,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:Bh,itemsA:Br.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:Uh,itemsB:Br.arrowheadEnd,valueB:n,onValueChange:t,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}function lte({toast:e}){const{removeToast:t}=ci(),n=Se(),r=o=>{o||t(e.id)},i=e.actions&&e.actions.length>0;return y.jsxs(oG,{onOpenChange:r,className:"tlui-toast__container",duration:e.keepOpen?1/0:5e3,children:[e.icon&&y.jsx("div",{className:"tlui-toast__icon",children:y.jsx(Wn,{icon:e.icon})}),y.jsxs("div",{className:"tlui-toast__main",children:[y.jsxs("div",{className:"tlui-toast__content",children:[e.title&&y.jsx(sG,{className:"tlui-toast__title",children:e.title}),e.description&&y.jsx(aG,{className:"tlui-toast__description",children:e.description})]}),e.actions&&y.jsxs("div",{className:"tlui-toast__actions",children:[e.actions.map((o,s)=>y.jsx(lG,{altText:o.label,asChild:!0,onClick:o.onClick,children:y.jsx(oe,{type:o.type,children:o.label})},s)),y.jsx(QM,{asChild:!0,children:y.jsx(oe,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:e.closeLabel??n("toast.close")})})]})]}),!i&&y.jsx(QM,{asChild:!0,children:y.jsx(oe,{type:"normal",className:"tlui-toast__close",children:e.closeLabel??n("toast.close")})})]})}function cte(){const{toasts:e}=ci();return y.jsx(y.Fragment,{children:e.map(t=>y.jsx(lte,{toast:t},t.id))})}const ute=x.memo(cte);function dte(){const{toasts:e}=ci(),[t,n]=x.useState(!1);return x.useEffect(()=>{let r=!1;return e.length?n(!0):setTimeout(()=>{r||n(!1)},1e3),()=>{r=!0}},[e.length,n]),t?y.jsx(UX,{className:"tlui-toast__viewport"}):null}function hte(){var a;const e=H(),t=Se(),n=(a=OT())==null?void 0:a.styles.get(lr),r=Cn({isDarkMode:e.user.getIsDarkMode()}),i=((n==null?void 0:n.type)==="shared"?r[n.value]:r.black).solid,o=Y("isHandOrEraserToolActive",()=>e.isInAny("hand","zoom","eraser","laser"),[e]),s=x.useCallback(l=>{l||e.updateInstanceState({isChangingStyle:!1})},[e]);return y.jsxs(D1,{id:"style menu",onOpenChange:s,children:[y.jsx(z1,{disabled:o,children:y.jsx(oe,{type:"tool","data-testid":"mobile.styles",style:{color:o?"var(--color-muted-1)":i},title:t("style-panel.title"),children:y.jsx(Wn,{icon:o?"blob":(n==null?void 0:n.type)==="mixed"?"mixed":"blob"})})}),y.jsx(ET,{side:"top",align:"end",children:y.jsx(KT,{isMobile:!0})})]})}const pte=["select","hand","draw","eraser","text","zoom","laser","highlight"];function fte({activeToolId:e}){const t=H(),n=fr(),r=Se(),i=Y("is tool locked",()=>t.getInstanceState().isToolLocked,[t]);return!e||pte.includes(e)?null:y.jsx(oe,{type:"normal",title:r("action.toggle-tool-lock"),className:pe("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":n<5}),icon:i?"lock":"unlock",onClick:()=>t.updateInstanceState({isToolLocked:!i}),smallIcon:!0})}const gte=x.memo(function(){const e=H(),t=Se(),n=fr(),r=J.useRef(void 0),i=dr(),o=EZ(),s=o.find(f=>f.toolItem.id==="laser"),a=Y("current tool id",()=>e.getCurrentToolId(),[e]),l=Y("geo",()=>e.getSharedStyles().getAsKnownValue(ei),[e]),c=!i,u=f=>f.label?`${t(f.label)} ${f.kbd?ai(f.kbd):""}`:"",d=o.find(f=>Sl(f.toolItem,a,l)),{itemsInPanel:h,itemsInDropdown:p,dropdownFirstItem:g}=J.useMemo(()=>{const f=[],m=[];let w;const b=Math.min(8,5+n);for(let k=4;k<o.length;k++){const S=o[k];k<b?f.push(S):(S===d&&(w=S),m.push(S))}return w||(r.current||(r.current=m[0]),w=r.current,m.includes(w)||(w=m[0])),r.current=w,m.length<=2&&(f.push(...m),m.length=0),{itemsInPanel:f,itemsInDropdown:m,dropdownFirstItem:w}},[o,d,n]);return y.jsx("div",{className:"tlui-toolbar",children:y.jsxs("div",{className:"tlui-toolbar__inner",children:[y.jsxs("div",{className:"tlui-toolbar__left",children:[!i&&y.jsxs("div",{className:"tlui-toolbar__extras",children:[n<6&&!(a==="hand"||a==="zoom")&&y.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[y.jsx(jT,{}),y.jsx(AT,{}),y.jsx(TT,{}),y.jsx(IT,{}),y.jsx(PT,{})]}),y.jsx(fte,{activeToolId:a})]}),y.jsxs("div",{className:pe("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":n<5}),children:[o.slice(0,2).map(({toolItem:f})=>y.jsx($u,{item:f,title:u(f),isSelected:Sl(f,a,l)},f.id)),i&&s&&y.jsx($u,{item:s.toolItem,title:u(s.toolItem),isSelected:Sl(s.toolItem,a,l)},s.toolItem.id),c&&y.jsxs(y.Fragment,{children:[o.slice(2,4).map(({toolItem:f})=>y.jsx($u,{item:f,title:u(f),isSelected:Sl(f,a,l)},f.id)),h.map(({toolItem:f})=>y.jsx($u,{item:f,title:u(f),isSelected:Sl(f,a,l)},f.id)),p.length?y.jsxs(y.Fragment,{children:[y.jsx($u,{item:g.toolItem,title:u(g.toolItem),isSelected:Sl(g.toolItem,a,l)},g.toolItem.id),y.jsxs(Yo,{id:"toolbar overflow",modal:!1,children:[y.jsx(Ou,{children:y.jsx(oe,{className:"tlui-toolbar__overflow",icon:"chevron-up",type:"tool","data-testid":"tools.more",title:t("tool-panel.more")})}),y.jsx(Xo,{side:"top",align:"center",children:y.jsx(mte,{toolbarItems:p})})]})]}):null]})]})]}),n<5&&!i&&y.jsx("div",{className:"tlui-toolbar__tools",children:y.jsx(hte,{})})]})})}),mte=Pe(function({toolbarItems:e}){const t=Se();return y.jsx("div",{className:"tlui-buttons__grid",children:e.map(({toolItem:{id:n,meta:r,kbd:i,label:o,onSelect:s,icon:a}})=>y.jsx(Gn,{type:"icon",className:"tlui-button-grid__button","data-testid":`tools.more.${n}`,"data-tool":n,"data-geo":(r==null?void 0:r.geo)??"","aria-label":o,onClick:()=>s("toolbar"),title:o?`${t(o)} ${i?ai(i):""}`:"",icon:a},n))})});function $u({item:e,title:t,isSelected:n}){var r;return y.jsx(oe,{type:"tool","data-testid":`tools.${e.id}`,"data-tool":e.id,"data-geo":((r=e.meta)==null?void 0:r.geo)??"","aria-label":e.label,title:t,icon:e.icon,"data-state":n?"selected":void 0,onClick:()=>e.onSelect("toolbar"),onTouchStart:i=>{Ee(i),e.onSelect("toolbar")}})}const Sl=(e,t,n)=>{var r,i;return(r=e.meta)!=null&&r.geo?t==="geo"&&n===((i=e.meta)==null?void 0:i.geo):t===e.id};function yte(){const e=H(),{addToast:t}=ci();x.useEffect(()=>{function n({name:r,count:i}){t({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${r} (${i}). Please delete some shapes or move to a different page to continue.`})}return e.addListener("max-shapes",n),()=>{e.removeListener("max-shapes",n)}},[e,t])}const U1=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function V1(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent("on".concat(t),n)}function Bu(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent&&e.detachEvent("on".concat(t),n)}function WT(e,t){const n=t.slice(0,t.length-1);for(let r=0;r<n.length;r++)n[r]=e[n[r].toLowerCase()];return n}function YT(e){typeof e!="string"&&(e=""),e=e.replace(/\s/g,"");const t=e.split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function vte(e,t){const n=e.length>=t.length?e:t,r=e.length>=t.length?t:e;let i=!0;for(let o=0;o<n.length;o++)r.indexOf(n[o])===-1&&(i=!1);return i}const Uu={backspace:8,"\u232B":8,tab:9,clear:12,enter:13,"\u21A9":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"\u21EA":20,",":188,".":190,"/":191,"`":192,"-":U1?173:189,"=":U1?61:187,";":U1?59:186,"'":222,"[":219,"]":221,"\\":220},hi={"\u21E7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,cmd:91,command:91},H1={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},zt={16:!1,18:!1,17:!1,91:!1},st={};for(let e=1;e<20;e++)Uu["f".concat(e)]=111+e;let Ye=[],Vu=null,XT="all";const Qi=new Map,Hu=e=>Uu[e.toLowerCase()]||hi[e.toLowerCase()]||e.toUpperCase().charCodeAt(0),bte=e=>Object.keys(Uu).find(t=>Uu[t]===e),wte=e=>Object.keys(hi).find(t=>hi[t]===e);function GT(e){XT=e||"all"}function Ku(){return XT||"all"}function xte(){return Ye.slice(0)}function Ste(){return Ye.map(e=>bte(e)||wte(e)||String.fromCharCode(e))}function kte(){const e=[];return Object.keys(st).forEach(t=>{st[t].forEach(n=>{let{key:r,scope:i,mods:o,shortcut:s}=n;e.push({scope:i,shortcut:s,mods:o,keys:r.split("+").map(a=>Hu(a))})})}),e}function _te(e){const t=e.target||e.srcElement,{tagName:n}=t;let r=!0;const i=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(t.type);return(t.isContentEditable||(i||n==="TEXTAREA"||n==="SELECT")&&!t.readOnly)&&(r=!1),r}function Cte(e){return typeof e=="string"&&(e=Hu(e)),Ye.indexOf(e)!==-1}function Ete(e,t){let n,r;e||(e=Ku());for(const i in st)if(Object.prototype.hasOwnProperty.call(st,i))for(n=st[i],r=0;r<n.length;)n[r].scope===e?n.splice(r,1).forEach(o=>{let{element:s}=o;return K1(s)}):r++;Ku()===e&&GT(t||"all")}function Pte(e){let t=e.keyCode||e.which||e.charCode;const n=Ye.indexOf(t);if(n>=0&&Ye.splice(n,1),e.key&&e.key.toLowerCase()==="meta"&&Ye.splice(0,Ye.length),(t===93||t===224)&&(t=91),t in zt){zt[t]=!1;for(const r in hi)hi[r]===t&&(Ur[r]=!1)}}function qT(e){if(typeof e>"u")Object.keys(st).forEach(i=>{Array.isArray(st[i])&&st[i].forEach(o=>pg(o)),delete st[i]}),K1(null);else if(Array.isArray(e))e.forEach(i=>{i.key&&pg(i)});else if(typeof e=="object")e.key&&pg(e);else if(typeof e=="string"){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let[i,o]=n;typeof i=="function"&&(o=i,i=""),pg({key:e,scope:i,method:o,splitKey:"+"})}}const pg=e=>{let{key:t,scope:n,method:r,splitKey:i="+"}=e;YT(t).forEach(o=>{const s=o.split(i),a=s.length,l=s[a-1],c=l==="*"?"*":Hu(l);if(!st[c])return;n||(n=Ku());const u=a>1?WT(hi,s):[],d=[];st[c]=st[c].filter(h=>{const p=(r?h.method===r:!0)&&h.scope===n&&vte(h.mods,u);return p&&d.push(h.element),!p}),d.forEach(h=>K1(h))})};function ZT(e,t,n,r){if(t.element!==r)return;let i;if(t.scope===n||t.scope==="all"){i=t.mods.length>0;for(const o in zt)Object.prototype.hasOwnProperty.call(zt,o)&&(!zt[o]&&t.mods.indexOf(+o)>-1||zt[o]&&t.mods.indexOf(+o)===-1)&&(i=!1);(t.mods.length===0&&!zt[16]&&!zt[18]&&!zt[17]&&!zt[91]||i||t.shortcut==="*")&&(t.keys=[],t.keys=t.keys.concat(Ye),t.method(e,t)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function QT(e,t){const n=st["*"];let r=e.keyCode||e.which||e.charCode;if(!Ur.filter.call(this,e))return;if((r===93||r===224)&&(r=91),Ye.indexOf(r)===-1&&r!==229&&Ye.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(a=>{const l=H1[a];e[a]&&Ye.indexOf(l)===-1?Ye.push(l):!e[a]&&Ye.indexOf(l)>-1?Ye.splice(Ye.indexOf(l),1):a==="metaKey"&&e[a]&&Ye.length===3&&(e.ctrlKey||e.shiftKey||e.altKey||(Ye=Ye.slice(Ye.indexOf(l))))}),r in zt){zt[r]=!0;for(const a in hi)hi[a]===r&&(Ur[a]=!0);if(!n)return}for(const a in zt)Object.prototype.hasOwnProperty.call(zt,a)&&(zt[a]=e[H1[a]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(Ye.indexOf(17)===-1&&Ye.push(17),Ye.indexOf(18)===-1&&Ye.push(18),zt[17]=!0,zt[18]=!0);const i=Ku();if(n)for(let a=0;a<n.length;a++)n[a].scope===i&&(e.type==="keydown"&&n[a].keydown||e.type==="keyup"&&n[a].keyup)&&ZT(e,n[a],i,t);if(!(r in st))return;const o=st[r],s=o.length;for(let a=0;a<s;a++)if((e.type==="keydown"&&o[a].keydown||e.type==="keyup"&&o[a].keyup)&&o[a].key){const l=o[a],{splitKey:c}=l,u=l.key.split(c),d=[];for(let h=0;h<u.length;h++)d.push(Hu(u[h]));d.sort().join("")===Ye.sort().join("")&&ZT(e,l,i,t)}}function Ur(e,t,n){Ye=[];const r=YT(e);let i=[],o="all",s=document,a=0,l=!1,c=!0,u="+",d=!1,h=!1;for(n===void 0&&typeof t=="function"&&(n=t),Object.prototype.toString.call(t)==="[object Object]"&&(t.scope&&(o=t.scope),t.element&&(s=t.element),t.keyup&&(l=t.keyup),t.keydown!==void 0&&(c=t.keydown),t.capture!==void 0&&(d=t.capture),typeof t.splitKey=="string"&&(u=t.splitKey),t.single===!0&&(h=!0)),typeof t=="string"&&(o=t),h&&qT(e,o);a<r.length;a++)e=r[a].split(u),i=[],e.length>1&&(i=WT(hi,e)),e=e[e.length-1],e=e==="*"?"*":Hu(e),e in st||(st[e]=[]),st[e].push({keyup:l,keydown:c,scope:o,mods:i,shortcut:r[a],method:n,key:r[a],splitKey:u,element:s});if(typeof s<"u"&&window){if(!Qi.has(s)){const p=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return QT(f,s)},g=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;QT(f,s),Pte(f)};Qi.set(s,{keydownListener:p,keyupListenr:g,capture:d}),V1(s,"keydown",p,d),V1(s,"keyup",g,d)}if(!Vu){const p=()=>{Ye=[]};Vu={listener:p,capture:d},V1(window,"focus",p,d)}}}function Ite(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(st).forEach(n=>{st[n].filter(r=>r.scope===t&&r.shortcut===e).forEach(r=>{r&&r.method&&r.method()})})}function K1(e){const t=Object.values(st).flat();if(t.findIndex(n=>{let{element:r}=n;return r===e})<0){const{keydownListener:n,keyupListenr:r,capture:i}=Qi.get(e)||{};n&&r&&(Bu(e,"keyup",r,i),Bu(e,"keydown",n,i),Qi.delete(e))}if((t.length<=0||Qi.size<=0)&&(Object.keys(Qi).forEach(n=>{const{keydownListener:r,keyupListenr:i,capture:o}=Qi.get(n)||{};r&&i&&(Bu(n,"keyup",i,o),Bu(n,"keydown",r,o),Qi.delete(n))}),Qi.clear(),Object.keys(st).forEach(n=>delete st[n]),Vu)){const{listener:n,capture:r}=Vu;Bu(window,"focus",n,r),Vu=null}}const W1={getPressedKeyString:Ste,setScope:GT,getScope:Ku,deleteScope:Ete,getPressedKeyCodes:xte,getAllKeyCodes:kte,isPressed:Cte,filter:_te,trigger:Ite,unbind:qT,keyMap:Uu,modifier:hi,modifierMap:H1};for(const e in W1)Object.prototype.hasOwnProperty.call(W1,e)&&(Ur[e]=W1[e]);if(typeof window<"u"){const e=window.hotkeys;Ur.noConflict=t=>(t&&window.hotkeys===Ur&&(window.hotkeys=e),Ur),window.hotkeys=Ur}const JT=["copy","cut","paste","asset"];function Mte(){const e=H(),t=dr(),n=tn(),r=h1(),i=Y("is focused",()=>e.getInstanceState().isFocused,[e]);x.useEffect(()=>{if(!i)return;const o=e.getContainer();Ur.setScope(e.store.id);const s=(l,c)=>{Ur(l,{element:o,scope:e.store.id},c)},a=()=>e.getIsMenuOpen()||e.getEditingShapeId()!==null||e.getCrashingError();for(const l of Object.values(n))l.kbd&&(t&&!l.readonlyOk||JT.includes(l.id)||s(ej(l.kbd),c=>{a()||(Ee(c),l.onSelect("kbd"))}));for(const l of Object.values(r))!l.kbd||!l.readonlyOk&&e.getInstanceState().isReadonly||JT.includes(l.id)||s(ej(l.kbd),c=>{a()||(Ee(c),l.onSelect("kbd"))});return()=>{Ur.deleteScope(e.store.id)}},[n,r,t,e,i])}function ej(e){return Ate(e).map(t=>{let n="";const r=t.split("");return r.length===1?n=r[0]:r[0]==="!"?n=`shift+${r[1]}`:r[0]==="?"?r.length===3&&r[1]==="!"?n=`alt+shift+${r[2]}`:n=`alt+${r[1]}`:r[0]==="$"?r[1]==="!"?n=`cmd+shift+${r[2]},ctrl+shift+${r[2]}`:r[1]==="?"?n=`cmd+\u2325+${r[2]},ctrl+alt+${r[2]}`:n=`cmd+${r[1]},ctrl+${r[1]}`:n=t,n}).join(",")}function Ate(e){typeof e!="string"&&(e=""),e=e.replace(/\s/g,"");const t=e.split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}const Tte=J.memo(function({shareZone:e,topZone:t,renderDebugMenuItems:n,children:r,hideUi:i,...o}){return y.jsx(TZ,{...o,children:y.jsx(jte,{hideUi:i,shareZone:e,topZone:t,renderDebugMenuItems:n,children:r})})}),jte=J.memo(function({children:e,hideUi:t,...n}){return y.jsxs(y.Fragment,{children:[e,t?null:y.jsx(Ote,{...n})]})}),Ote=J.memo(function({shareZone:e,topZone:t,renderDebugMenuItems:n}){const r=H(),i=Se(),o=fr(),s=Y("isReadonlyMode",()=>r.getInstanceState().isReadonly,[r]),a=Y("focus",()=>r.getInstanceState().isFocusMode,[r]),l=Y("debug",()=>r.getInstanceState().isDebugMode,[r]);Mte(),Gq(),yte();const{"toggle-focus-mode":c}=tn();return y.jsx(HM,{children:y.jsxs("div",{className:pe("tlui-layout",{"tlui-layout__mobile":o<5}),"data-breakpoint":o,children:[a?y.jsx("div",{className:"tlui-layout__top",children:y.jsx(oe,{type:"icon",className:"tlui-focus-button",title:`${i("focus-mode.toggle-focus-mode")}`,icon:"dot",onClick:()=>c.onSelect("menu")})}):y.jsxs(y.Fragment,{children:[y.jsxs("div",{className:"tlui-layout__top",children:[y.jsxs("div",{className:"tlui-layout__top__left",children:[y.jsx(See,{}),y.jsxs("div",{className:"tlui-helper-buttons",children:[y.jsx(Eee,{}),y.jsx(OZ,{}),y.jsx(Pee,{})]})]}),y.jsx("div",{className:"tlui-layout__top__center",children:t}),y.jsxs("div",{className:"tlui-layout__top__right",children:[e,o>=5&&!s&&y.jsx("div",{className:"tlui-style-panel__wrapper",children:y.jsx(KT,{})})]})]}),y.jsxs("div",{className:"tlui-layout__bottom",children:[y.jsxs("div",{className:"tlui-layout__bottom__main",children:[y.jsx(Cee,{}),y.jsx(gte,{}),o>=4&&y.jsx(iee,{})]}),l&&y.jsx(YJ,{renderDebugMenuItems:n??null})]})]}),y.jsx(ute,{}),y.jsx(tee,{}),y.jsx(dte,{}),y.jsx(nee,{})]})})}),tj="ContextMenu",[Lte,Mre]=si(tj,[lg]),pi=lg(),[Dte,nj]=Lte(tj),zte=e=>{const{__scopeContextMenu:t,children:n,onOpenChange:r,dir:i,modal:o=!0}=e,[s,a]=x.useState(!1),l=pi(t),c=en(r),u=x.useCallback(d=>{a(d),c(d)},[c]);return x.createElement(Dte,{scope:t,open:s,onOpenChange:u,modal:o},x.createElement(tT,Z({},l,{dir:i,open:s,onOpenChange:u,modal:o}),n))},Nte="ContextMenuTrigger",Rte=x.forwardRef((e,t)=>{const{__scopeContextMenu:n,disabled:r=!1,...i}=e,o=nj(Nte,n),s=pi(n),a=x.useRef({x:0,y:0}),l=x.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),c=x.useRef(0),u=x.useCallback(()=>window.clearTimeout(c.current),[]),d=h=>{a.current={x:h.clientX,y:h.clientY},o.onOpenChange(!0)};return x.useEffect(()=>u,[u]),x.useEffect(()=>void(r&&u()),[r,u]),x.createElement(x.Fragment,null,x.createElement(nT,Z({},s,{virtualRef:l})),x.createElement(Fe.span,Z({"data-state":o.open?"open":"closed","data-disabled":r?"":void 0},i,{ref:t,style:{WebkitTouchCallout:"none",...e.style},onContextMenu:r?e.onContextMenu:re(e.onContextMenu,h=>{u(),d(h),h.preventDefault()}),onPointerDown:r?e.onPointerDown:re(e.onPointerDown,fg(h=>{u(),c.current=window.setTimeout(()=>d(h),700)})),onPointerMove:r?e.onPointerMove:re(e.onPointerMove,fg(u)),onPointerCancel:r?e.onPointerCancel:re(e.onPointerCancel,fg(u)),onPointerUp:r?e.onPointerUp:re(e.onPointerUp,fg(u))})))}),Fte=e=>{const{__scopeContextMenu:t,...n}=e,r=pi(t);return x.createElement(rT,Z({},r,n))},$te="ContextMenuContent",Bte=x.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=nj($te,n),o=pi(n),s=x.useRef(!1);return x.createElement(iT,Z({},o,r,{ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var l;(l=e.onCloseAutoFocus)===null||l===void 0||l.call(e,a),!a.defaultPrevented&&s.current&&a.preventDefault(),s.current=!1},onInteractOutside:a=>{var l;(l=e.onInteractOutside)===null||l===void 0||l.call(e,a),!a.defaultPrevented&&!i.modal&&(s.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),Ute=x.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=pi(n);return x.createElement(oT,Z({},i,r,{ref:t}))}),Vte=x.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=pi(n);return x.createElement(sT,Z({},i,r,{ref:t}))}),Hte=x.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=pi(n);return x.createElement(aT,Z({},i,r,{ref:t}))}),Kte=e=>{const{__scopeContextMenu:t,children:n,onOpenChange:r,open:i,defaultOpen:o}=e,s=pi(t),[a,l]=Bo({prop:i,defaultProp:o,onChange:r});return x.createElement(lT,Z({},s,{open:a,onOpenChange:l}),n)},Wte=x.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=pi(n);return x.createElement(cT,Z({},i,r,{ref:t}))}),Yte=x.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,i=pi(n);return x.createElement(uT,Z({},i,r,{ref:t,style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))});function fg(e){return t=>t.pointerType!=="mouse"?e(t):void 0}const Xte=zte,Gte=Rte,Y1=Fte,qte=Bte,X1=Ute,G1=Vte,Zte=Hte,rj=Kte,ij=Wte,oj=Yte,Qte=Pe(function(){const e=H(),t=Yt(),n=e.getPages(),r=e.getCurrentPageId(),i=Se(),{addToast:o}=ci();return y.jsxs(rj,{children:[y.jsx(ij,{dir:"ltr",asChild:!0,children:y.jsx(oe,{type:"menu",label:"context-menu.move-to-page","data-testid":"menu-item.move-to-page",icon:"chevron-right"})}),y.jsx(Y1,{container:t,children:y.jsxs(oj,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:[y.jsx(X1,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.pages",children:n.map(s=>y.jsx(G1,{disabled:r===s.id,onSelect:()=>{e.mark("move_shapes_to_page"),e.moveShapesToPage(e.getSelectedShapeIds(),s.id);const a=e.getPage(s.id);a&&o({title:"Changed Page",description:`Moved to ${a.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{e.mark("change-page"),e.setCurrentPage(r)}}]})},asChild:!0,children:y.jsx(oe,{type:"menu",title:s.name,className:"tlui-context-menu__move-to-page__name",children:y.jsx("span",{className:"tlui-button__label",children:s.name})})},s.id))},"pages"),y.jsx(X1,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.new-page",children:y.jsx(G1,{onSelect:()=>{const s=ji.createId(),a=e.getSelectedShapeIds();e.batch(()=>{e.mark("move_shapes_to_page"),e.createPage({name:i("page-menu.new-page-initial-name"),id:s}),e.moveShapesToPage(a,s)})},asChild:!0,children:y.jsx(oe,{type:"menu",title:i("context.pages.new-page"),className:"tlui-context-menu__move-to-page__name",children:y.jsx("span",{className:"tlui-button__label",children:i("context.pages.new-page")})})},"new-page")},"new-page")]})})]})}),Jte=function({children:e}){const t=H(),n=e3(),r=x.useCallback(c=>{if(c){if(t.getInstanceState().isCoarsePointer){const u=t.getSelectedShapes(),{inputs:{currentPagePoint:d}}=t,h=t.getShapesAtPoint(d);if(!t.getSelectedShapes().length||!h.some(p=>u.includes(p))){const p=h.filter(g=>t.isShapeOrAncestorLocked(g));p.length&&t.select(...p.map(g=>g.id))}}}else{const u=t.getOnlySelectedShape();u&&t.isShapeOrAncestorLocked(u)&&t.setSelectedShapes([])}},[t]),[i,o]=$s("context menu",r),s=dr(),a=n.length===0||s&&n.every(c=>!c.readonlyOk),l=!Y("isSelectToolActive",()=>t.getCurrentToolId()==="select",[t])||a;return y.jsxs(Xte,{dir:"ltr",onOpenChange:o,modal:!1,children:[y.jsx(Gte,{onContextMenu:l?Ee:void 0,dir:"ltr",disabled:l,children:e}),i&&y.jsx(ene,{})]})},ene=x.forwardRef(function(){const e=H(),t=Se(),n=e3(),[r,i]=$s("context menu sub"),o=dr(),s=fr(),a=Yt(),[l,c]=x.useState(!1);function u(d,h,p,g){if(!h||o&&!h.readonlyOk)return null;switch(h.type){case"custom":{switch(h.id){case"MOVE_TO_PAGE_MENU":return y.jsx(Qte,{},h.id)}break}case"group":return y.jsx(X1,{dir:"ltr",className:pe("tlui-menu__group",{"tlui-menu__group__small":(p==null?void 0:p.type)==="submenu"}),"data-testid":`menu-item.${h.id}`,children:h.children.map(f=>u(d,f,h,g+1))},h.id);case"submenu":return y.jsxs(rj,{onOpenChange:i,children:[y.jsx(ij,{dir:"ltr",disabled:h.disabled,asChild:!0,children:y.jsx(oe,{type:"menu",label:h.label,"data-testid":`menu-item.${h.id}`,icon:"chevron-right"})}),y.jsx(Y1,{container:a,children:y.jsx(oj,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:h.children.map(f=>u(d,f,h,g+1))})})]},h.id);case"item":{if(o&&!h.readonlyOk)return null;const{id:f,checkbox:m,contextMenuLabel:w,label:b,onSelect:k,kbd:S,icon:C}=h.actionItem,_=w??b,P=_?t(_):void 0;return m?y.jsxs(Zte,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",disabled:h.disabled,onSelect:I=>{k("context-menu"),Ee(I)},title:P||void 0,checked:h.checked,children:[y.jsx(Wn,{small:!0,icon:h.checked?"check":"checkbox-empty"}),P&&y.jsx("span",{className:"tlui-button__label",draggable:!1,children:P}),S&&y.jsx(zf,{children:S})]},f):y.jsx(G1,{dir:"ltr",asChild:!0,children:y.jsx(oe,{type:"menu","data-testid":`menu-item.${f}`,kbd:S,label:_,disabled:h.disabled,iconLeft:s<3&&g>2?C:void 0,onClick:()=>{l?c(!1):k("context-menu")}})},f)}}}return y.jsx(Y1,{container:a,children:y.jsx(qte,{className:"tlui-menu scrollable",alignOffset:-4,collisionPadding:4,onContextMenu:Ee,children:n.map(d=>u(e,d,null,0))})})}),gg=(e,t)=>{const[n,r]=x.useState(2);return x.useEffect(()=>{const{url:i,style:o="normal",weight:s="500",display:a,featureSettings:l,stretch:c,unicodeRange:u,variant:d}=t;let h=!1;r(2);const p={style:o,weight:s,display:a,featureSettings:l,stretch:c,unicodeRange:u,variant:d},g=new FontFace(e,`url(${i})`,p);return g.load().then(()=>{h||(document.fonts.add(g),r(0))}).catch(f=>{h||(console.error(f),r(1))}),g.$$_url=i,g.$$_fontface=`
@font-face {
	font-family: ${g.family};
	font-stretch: ${g.stretch};
	font-weight: ${g.weight};
	font-style: ${g.style};
	src: url("${i}") format("woff2")
}`,()=>{document.fonts.delete(g),h=!0}},[e,t]),n};function tne(e){return{draw:{url:e.fonts.draw},serif:{url:e.fonts.serif},sansSerif:{url:e.fonts.sansSerif},monospace:{url:e.fonts.monospace}}}function nne(e){const t=x.useMemo(()=>tne(e),[e]),n=[gg("tldraw_draw",t.draw),gg("tldraw_serif",t.serif),gg("tldraw_sans",t.sansSerif),gg("tldraw_mono",t.monospace)];return{error:n.some(r=>r===1),done:!n.some(r=>r===2)}}function rne(e){const{children:t,maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:s,...a}=e,l=NF(a.components??{}),c=gE(a.shapeUtils??[]),u=gE(a.tools??[]),d={initialState:"select",...a,components:x.useMemo(()=>({Scribble:aI,CollaboratorScribble:aI,SelectionForeground:WK,SelectionBackground:HK,Handles:RK,HoveredShapeIndicator:FK,...l}),[l]),shapeUtils:x.useMemo(()=>[...oX,...c],[c]),tools:x.useMemo(()=>[...bX,...RW,...u],[u])},h=cG(a.assetUrls),{done:p,error:g}=nne(h);return g?y.jsx(OF,{children:"Could not load assets. Please refresh the page."}):p?y.jsx(MF,{...d,children:y.jsxs(Tte,{...d,children:[y.jsx(Jte,{children:y.jsx(N0,{})}),y.jsx(ine,{maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:s}),t]})}):y.jsx(hE,{children:"Loading assets..."})}function ine({maxImageDimension:e=1e3,maxAssetSize:t=10*1024*1024,acceptedImageMimeTypes:n=["image/jpeg","image/png","image/gif","image/svg+xml"],acceptedVideoMimeTypes:r=["video/mp4","video/quicktime"],onMount:i}){const o=H(),s=one(a=>{const l=[];return l.push(...sX(a)),CW(a,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:r}),l.push(i==null?void 0:i(a)),()=>{l.forEach(c=>c==null?void 0:c())}});return x.useLayoutEffect(()=>{if(o)return s==null?void 0:s(o)},[o,s]),null}function one(e){const t=x.useRef();return x.useLayoutEffect(()=>{t.current=e}),x.useDebugValue(e),x.useCallback((...n)=>{const r=t.current;return bs(r,"fn does not exist"),r(...n)},[])}ke({tldrawFileFormatVersion:rD,schema:ke({schemaVersion:Lh,storeVersion:Lh,recordVersions:c0(me,ke({version:Lh,subTypeVersions:c0(me,Lh).optional(),subTypeKey:me.optional()}))}),records:cn(ke({id:me,typeName:me}).allowUnknownProperties())});const sne=150,ane=e=>{const t=Math.abs(e.target.x-e.source.x),n=Math.abs(e.target.y-e.source.y),r=Math.max(0,t-(e.source.width+e.target.width)/2),i=Math.max(0,n-(e.source.height+e.target.height)/2);return Math.sqrt(t*t+n*n)-Math.sqrt(r*r+i*i)+sne},lne=e=>{const t=[],n=[],r=new Set,i=[],o=[],s=new Map;for(const l of e.getSelectedShapes())l.type==="arrow"?t.push(l):n.push(l);n.forEach((l,c)=>{const u=e.getShapeGeometry(l),d={index:c,x:l.x+u.center.x,y:l.y+u.center.y,width:u.center.x*2,height:u.center.y*2,id:l.id,fixed:"color"in l.props&&l.props.color==="red"?1:0,color:"color"in l.props?l.props.color:"black"};i.push(d),s.set(l.id,c)});for(const l of t){const c=s.get(l.props.start.boundShapeId),u=s.get(l.props.end.boundShapeId);if(!(c===void 0||u===void 0)){if(l.props.color==="light-blue"){r.add(c),r.add(u);continue}o.push({source:c,target:u})}}const a=r.size>0?[{type:"alignment",axis:"x",offsets:[...r].map(l=>({node:l,offset:0}))}]:[];return{colaNodes:i,colaLinks:o,constraints:a}},cne=(e,t)=>{t.start(1,1,1,0,!0,!1);for(const n of t.nodes()){if(e.getSelectedShapeIds().includes(n.id)){const i=e.getShape(n.id);if(!i)continue;n.x=i.x+n.width/2,n.y=i.y+n.height/2}const r=e.getShapeGeometry(n.id);n.width=r.center.x*2,n.height=r.center.y*2,e.updateShape({id:n.id,type:"geo",x:n.x-r.center.x,y:n.y-r.center.y})}};var sj={},mg={},kl={},Ji={};Object.defineProperty(Ji,"__esModule",{value:!0});var q1=function(){function e(t,n,r){this.source=t,this.target=n,this.type=r}return e}();Ji.PowerEdge=q1;var aj=function(){function e(t,n,r,i){var o=this;if(this.linkAccessor=r,this.modules=new Array(t),this.roots=[],i)this.initModulesFromGroup(i);else{this.roots.push(new _l);for(var s=0;s<t;++s)this.roots[0].add(this.modules[s]=new Wu(s))}this.R=n.length,n.forEach(function(a){var l=o.modules[r.getSourceIndex(a)],c=o.modules[r.getTargetIndex(a)],u=r.getType(a);l.outgoing.add(u,c),c.incoming.add(u,l)})}return e.prototype.initModulesFromGroup=function(t){var n=new _l;this.roots.push(n);for(var r=0;r<t.leaves.length;++r){var i=t.leaves[r],o=new Wu(i.id);this.modules[i.id]=o,n.add(o)}if(t.groups)for(var s=0;s<t.groups.length;++s){var a=t.groups[s],l={};for(var c in a)c!=="leaves"&&c!=="groups"&&a.hasOwnProperty(c)&&(l[c]=a[c]);n.add(new Wu(-1-s,new Yu,new Yu,this.initModulesFromGroup(a),l))}return n},e.prototype.merge=function(t,n,r){r===void 0&&(r=0);var i=t.incoming.intersection(n.incoming),o=t.outgoing.intersection(n.outgoing),s=new _l;s.add(t),s.add(n);var a=new Wu(this.modules.length,o,i,s);this.modules.push(a);var l=function(c,u,d){c.forAll(function(h,p){h.forAll(function(g){var f=g[u];f.add(p,a),f.remove(p,t),f.remove(p,n),t[d].remove(p,g),n[d].remove(p,g)})})};return l(o,"incoming","outgoing"),l(i,"outgoing","incoming"),this.R-=i.count()+o.count(),this.roots[r].remove(t),this.roots[r].remove(n),this.roots[r].add(a),a},e.prototype.rootMerges=function(t){t===void 0&&(t=0);for(var n=this.roots[t].modules(),r=n.length,i=new Array(r*(r-1)),o=0,s=0,a=r-1;s<a;++s)for(var l=s+1;l<r;++l){var c=n[s],u=n[l];i[o]={id:o,nEdges:this.nEdges(c,u),a:c,b:u},o++}return i},e.prototype.greedyMerge=function(){for(var t=0;t<this.roots.length;++t)if(!(this.roots[t].modules().length<2)){var n=this.rootMerges(t).sort(function(i,o){return i.nEdges==o.nEdges?i.id-o.id:i.nEdges-o.nEdges}),r=n[0];if(!(r.nEdges>=this.R))return this.merge(r.a,r.b,t),!0}},e.prototype.nEdges=function(t,n){var r=t.incoming.intersection(n.incoming),i=t.outgoing.intersection(n.outgoing);return this.R-r.count()-i.count()},e.prototype.getGroupHierarchy=function(t){var n=this,r=[],i={};lj(this.roots[0],i,r);var o=this.allEdges();return o.forEach(function(s){var a=n.modules[s.source],l=n.modules[s.target];t.push(new q1(typeof a.gid>"u"?s.source:r[a.gid],typeof l.gid>"u"?s.target:r[l.gid],s.type))}),r},e.prototype.allEdges=function(){var t=[];return e.getEdges(this.roots[0],t),t},e.getEdges=function(t,n){t.forAll(function(r){r.getEdges(n),e.getEdges(r.children,n)})},e}();Ji.Configuration=aj;function lj(e,t,n){e.forAll(function(r){if(r.isLeaf())t.leaves||(t.leaves=[]),t.leaves.push(r.id);else{var i=t;if(r.gid=n.length,!r.isIsland()||r.isPredefined()){if(i={id:r.gid},r.isPredefined())for(var o in r.definition)i[o]=r.definition[o];t.groups||(t.groups=[]),t.groups.push(r.gid),n.push(i)}lj(r.children,i,n)}})}var Wu=function(){function e(t,n,r,i,o){n===void 0&&(n=new Yu),r===void 0&&(r=new Yu),i===void 0&&(i=new _l),this.id=t,this.outgoing=n,this.incoming=r,this.children=i,this.definition=o}return e.prototype.getEdges=function(t){var n=this;this.outgoing.forAll(function(r,i){r.forAll(function(o){t.push(new q1(n.id,o.id,i))})})},e.prototype.isLeaf=function(){return this.children.count()===0},e.prototype.isIsland=function(){return this.outgoing.count()===0&&this.incoming.count()===0},e.prototype.isPredefined=function(){return typeof this.definition<"u"},e}();Ji.Module=Wu;function une(e,t){var n={};for(var r in e)r in t&&(n[r]=e[r]);return n}var _l=function(){function e(){this.table={}}return e.prototype.count=function(){return Object.keys(this.table).length},e.prototype.intersection=function(t){var n=new e;return n.table=une(this.table,t.table),n},e.prototype.intersectionCount=function(t){return this.intersection(t).count()},e.prototype.contains=function(t){return t in this.table},e.prototype.add=function(t){this.table[t.id]=t},e.prototype.remove=function(t){delete this.table[t.id]},e.prototype.forAll=function(t){for(var n in this.table)t(this.table[n])},e.prototype.modules=function(){var t=[];return this.forAll(function(n){n.isPredefined()||t.push(n)}),t},e}();Ji.ModuleSet=_l;var Yu=function(){function e(){this.sets={},this.n=0}return e.prototype.count=function(){return this.n},e.prototype.contains=function(t){var n=!1;return this.forAllModules(function(r){!n&&r.id==t&&(n=!0)}),n},e.prototype.add=function(t,n){var r=t in this.sets?this.sets[t]:this.sets[t]=new _l;r.add(n),++this.n},e.prototype.remove=function(t,n){var r=this.sets[t];r.remove(n),r.count()===0&&delete this.sets[t],--this.n},e.prototype.forAll=function(t){for(var n in this.sets)t(this.sets[n],Number(n))},e.prototype.forAllModules=function(t){this.forAll(function(n,r){return n.forAll(t)})},e.prototype.intersection=function(t){var n=new e;return this.forAll(function(r,i){if(i in t.sets){var o=r.intersection(t.sets[i]),s=o.count();s>0&&(n.sets[i]=o,n.n+=s)}}),n},e}();Ji.LinkSets=Yu;function dne(e,t,n,r){for(var i=e.length,o=new aj(i,t,n,r);o.greedyMerge(););var s=[],a=o.getGroupHierarchy(s);return s.forEach(function(l){var c=function(u){var d=l[u];typeof d=="number"&&(l[u]=e[d])};c("source"),c("target")}),{groups:a,powerEdges:s}}Ji.getGroups=dne;var Go={};Object.defineProperty(Go,"__esModule",{value:!0});function cj(e,t){var n={};for(var r in e)n[r]={};for(var r in t)n[r]={};return Object.keys(n).length}function uj(e,t){var n=0;for(var r in e)typeof t[r]<"u"&&++n;return n}function hne(e,t){var n={},r=function(i,o){typeof n[i]>"u"&&(n[i]={}),n[i][o]={}};return e.forEach(function(i){var o=t.getSourceIndex(i),s=t.getTargetIndex(i);r(o,s),r(s,o)}),n}function dj(e,t,n,r){var i=hne(e,r);e.forEach(function(o){var s=i[r.getSourceIndex(o)],a=i[r.getTargetIndex(o)];r.setLength(o,1+t*n(s,a))})}function pne(e,t,n){n===void 0&&(n=1),dj(e,n,function(r,i){return Math.sqrt(cj(r,i)-uj(r,i))},t)}Go.symmetricDiffLinkLengths=pne;function fne(e,t,n){n===void 0&&(n=1),dj(e,n,function(r,i){return Math.min(Object.keys(r).length,Object.keys(i).length)<1.1?0:uj(r,i)/cj(r,i)},t)}Go.jaccardLinkLengths=fne;function gne(e,t,n,r){var i=hj(e,t,r),o={};i.forEach(function(a,l){return a.forEach(function(c){return o[c]=l})});var s=[];return t.forEach(function(a){var l=r.getSourceIndex(a),c=r.getTargetIndex(a),u=o[l],d=o[c];u!==d&&s.push({axis:n,left:l,right:c,gap:r.getMinSeparation(a)})}),s}Go.generateDirectedEdgeConstraints=gne;function hj(e,t,n){var r=[],i=0,o=[],s=[];function a(w){w.index=w.lowlink=i++,o.push(w),w.onStack=!0;for(var b=0,k=w.out;b<k.length;b++){var S=k[b];typeof S.index>"u"?(a(S),w.lowlink=Math.min(w.lowlink,S.lowlink)):S.onStack&&(w.lowlink=Math.min(w.lowlink,S.index))}if(w.lowlink===w.index){for(var C=[];o.length&&(S=o.pop(),S.onStack=!1,C.push(S),S!==w););s.push(C.map(function(_){return _.id}))}}for(var l=0;l<e;l++)r.push({id:l,out:[]});for(var c=0,u=t;c<u.length;c++){var d=u[c],h=r[n.getSourceIndex(d)],p=r[n.getTargetIndex(d)];h.out.push(p)}for(var g=0,f=r;g<f.length;g++){var m=f[g];typeof m.index>"u"&&a(m)}return s}Go.stronglyConnectedComponents=hj;var Bs={};Object.defineProperty(Bs,"__esModule",{value:!0});var pj=function(){function e(){this.locks={}}return e.prototype.add=function(t,n){this.locks[t]=n},e.prototype.clear=function(){this.locks={}},e.prototype.isEmpty=function(){for(var t in this.locks)return!1;return!0},e.prototype.apply=function(t){for(var n in this.locks)t(Number(n),this.locks[n])},e}();Bs.Locks=pj;var mne=function(){function e(t,n,r){r===void 0&&(r=null),this.D=n,this.G=r,this.threshold=1e-4,this.numGridSnapNodes=0,this.snapGridSize=100,this.snapStrength=1e3,this.scaleSnapByMaxH=!1,this.random=new fj,this.project=null,this.x=t,this.k=t.length;var i=this.n=t[0].length;this.H=new Array(this.k),this.g=new Array(this.k),this.Hd=new Array(this.k),this.a=new Array(this.k),this.b=new Array(this.k),this.c=new Array(this.k),this.d=new Array(this.k),this.e=new Array(this.k),this.ia=new Array(this.k),this.ib=new Array(this.k),this.xtmp=new Array(this.k),this.locks=new pj,this.minD=Number.MAX_VALUE;for(var o=i,s;o--;)for(s=i;--s>o;){var a=n[o][s];a>0&&a<this.minD&&(this.minD=a)}for(this.minD===Number.MAX_VALUE&&(this.minD=1),o=this.k;o--;){for(this.g[o]=new Array(i),this.H[o]=new Array(i),s=i;s--;)this.H[o][s]=new Array(i);this.Hd[o]=new Array(i),this.a[o]=new Array(i),this.b[o]=new Array(i),this.c[o]=new Array(i),this.d[o]=new Array(i),this.e[o]=new Array(i),this.ia[o]=new Array(i),this.ib[o]=new Array(i),this.xtmp[o]=new Array(i)}}return e.createSquareMatrix=function(t,n){for(var r=new Array(t),i=0;i<t;++i){r[i]=new Array(t);for(var o=0;o<t;++o)r[i][o]=n(i,o)}return r},e.prototype.offsetDir=function(){for(var t=this,n=new Array(this.k),r=0,i=0;i<this.k;++i){var o=n[i]=this.random.getNextBetween(.01,1)-.5;r+=o*o}return r=Math.sqrt(r),n.map(function(s){return s*=t.minD/r})},e.prototype.computeDerivatives=function(t){var n=this,r=this.n;if(!(r<1)){for(var i,o=new Array(this.k),s=new Array(this.k),a=new Array(this.k),l=0,c=0;c<r;++c){for(i=0;i<this.k;++i)a[i]=this.g[i][c]=0;for(var u=0;u<r;++u)if(c!==u){for(var d=r;d--;){var h=0;for(i=0;i<this.k;++i){var p=o[i]=t[i][c]-t[i][u];h+=s[i]=p*p}if(h>1e-9)break;var g=this.offsetDir();for(i=0;i<this.k;++i)t[i][u]+=g[i]}var f=Math.sqrt(h),m=this.D[c][u],w=this.G!=null?this.G[c][u]:1;if(w>1&&f>m||!isFinite(m)){for(i=0;i<this.k;++i)this.H[i][c][u]=0;continue}w>1&&(w=1);var b=m*m,k=2*w*(f-m)/(b*f),S=f*f*f,C=2*-w/(b*S);for(isFinite(k)||console.log(k),i=0;i<this.k;++i)this.g[i][c]+=o[i]*k,a[i]-=this.H[i][c][u]=C*(S+m*(s[i]-h)+f*h)}for(i=0;i<this.k;++i)l=Math.max(l,this.H[i][c][c]=a[i])}for(var _=this.snapGridSize/2,P=this.snapGridSize,I=this.snapStrength,M=I/(_*_),A=this.numGridSnapNodes,c=0;c<A;++c)for(i=0;i<this.k;++i){var L=this.x[i][c],z=L/P,$=z%1,j=z-$,F=Math.abs($),p=F<=.5?L-j*P:L>0?L-(j+1)*P:L-(j-1)*P;-_<p&&p<=_&&(this.scaleSnapByMaxH?(this.g[i][c]+=l*M*p,this.H[i][c][c]+=l*M):(this.g[i][c]+=M*p,this.H[i][c][c]+=M))}this.locks.isEmpty()||this.locks.apply(function(R,W){for(i=0;i<n.k;++i)n.H[i][R][R]+=l,n.g[i][R]-=l*(W[i]-t[i][R])})}},e.dotProd=function(t,n){for(var r=0,i=t.length;i--;)r+=t[i]*n[i];return r},e.rightMultiply=function(t,n,r){for(var i=t.length;i--;)r[i]=e.dotProd(t[i],n)},e.prototype.computeStepSize=function(t){for(var n=0,r=0,i=0;i<this.k;++i)n+=e.dotProd(this.g[i],t[i]),e.rightMultiply(this.H[i],t[i],this.Hd[i]),r+=e.dotProd(t[i],this.Hd[i]);return r===0||!isFinite(r)?0:1*n/r},e.prototype.reduceStress=function(){this.computeDerivatives(this.x);for(var t=this.computeStepSize(this.g),n=0;n<this.k;++n)this.takeDescentStep(this.x[n],this.g[n],t);return this.computeStress()},e.copy=function(t,n){for(var r=t.length,i=n[0].length,o=0;o<r;++o)for(var s=0;s<i;++s)n[o][s]=t[o][s]},e.prototype.stepAndProject=function(t,n,r,i){e.copy(t,n),this.takeDescentStep(n[0],r[0],i),this.project&&this.project[0](t[0],t[1],n[0]),this.takeDescentStep(n[1],r[1],i),this.project&&this.project[1](n[0],t[1],n[1]);for(var o=2;o<this.k;o++)this.takeDescentStep(n[o],r[o],i)},e.mApply=function(t,n,r){for(var i=t;i-- >0;)for(var o=n;o-- >0;)r(i,o)},e.prototype.matrixApply=function(t){e.mApply(this.k,this.n,t)},e.prototype.computeNextPosition=function(t,n){var r=this;this.computeDerivatives(t);var i=this.computeStepSize(this.g);if(this.stepAndProject(t,n,this.g,i),this.project){this.matrixApply(function(s,a){return r.e[s][a]=t[s][a]-n[s][a]});var o=this.computeStepSize(this.e);o=Math.max(.2,Math.min(o,1)),this.stepAndProject(t,n,this.e,o)}},e.prototype.run=function(t){for(var n=Number.MAX_VALUE,r=!1;!r&&t-- >0;){var i=this.rungeKutta();r=Math.abs(n/i-1)<this.threshold,n=i}return n},e.prototype.rungeKutta=function(){var t=this;this.computeNextPosition(this.x,this.a),e.mid(this.x,this.a,this.ia),this.computeNextPosition(this.ia,this.b),e.mid(this.x,this.b,this.ib),this.computeNextPosition(this.ib,this.c),this.computeNextPosition(this.c,this.d);var n=0;return this.matrixApply(function(r,i){var o=(t.a[r][i]+2*t.b[r][i]+2*t.c[r][i]+t.d[r][i])/6,s=t.x[r][i]-o;n+=s*s,t.x[r][i]=o}),n},e.mid=function(t,n,r){e.mApply(t.length,t[0].length,function(i,o){return r[i][o]=t[i][o]+(n[i][o]-t[i][o])/2})},e.prototype.takeDescentStep=function(t,n,r){for(var i=0;i<this.n;++i)t[i]=t[i]-r*n[i]},e.prototype.computeStress=function(){for(var t=0,n=0,r=this.n-1;n<r;++n)for(var i=n+1,o=this.n;i<o;++i){for(var s=0,a=0;a<this.k;++a){var l=this.x[a][n]-this.x[a][i];s+=l*l}s=Math.sqrt(s);var c=this.D[n][i];if(isFinite(c)){var u=c-s,d=c*c;t+=u*u/d}}return t},e.zeroDistance=1e-10,e}();Bs.Descent=mne;var fj=function(){function e(t){t===void 0&&(t=1),this.seed=t,this.a=214013,this.c=2531011,this.m=2147483648,this.range=32767}return e.prototype.getNext=function(){return this.seed=(this.seed*this.a+this.c)%this.m,(this.seed>>16)/this.range},e.prototype.getNextBetween=function(t,n){return t+this.getNext()*(n-t)},e}();Bs.PseudoRandom=fj;var Nt={},Vr={};Object.defineProperty(Vr,"__esModule",{value:!0});var gj=function(){function e(t){this.scale=t,this.AB=0,this.AD=0,this.A2=0}return e.prototype.addVariable=function(t){var n=this.scale/t.scale,r=t.offset/t.scale,i=t.weight;this.AB+=i*n*r,this.AD+=i*n*t.desiredPosition,this.A2+=i*n*n},e.prototype.getPosn=function(){return(this.AD-this.AB)/this.A2},e}();Vr.PositionStats=gj;var yg=function(){function e(t,n,r,i){i===void 0&&(i=!1),this.left=t,this.right=n,this.gap=r,this.equality=i,this.active=!1,this.unsatisfiable=!1,this.left=t,this.right=n,this.gap=r,this.equality=i}return e.prototype.slack=function(){return this.unsatisfiable?Number.MAX_VALUE:this.right.scale*this.right.position()-this.gap-this.left.scale*this.left.position()},e}();Vr.Constraint=yg;var vg=function(){function e(t,n,r){n===void 0&&(n=1),r===void 0&&(r=1),this.desiredPosition=t,this.weight=n,this.scale=r,this.offset=0}return e.prototype.dfdv=function(){return 2*this.weight*(this.position()-this.desiredPosition)},e.prototype.position=function(){return(this.block.ps.scale*this.block.posn+this.offset)/this.scale},e.prototype.visitNeighbours=function(t,n){var r=function(i,o){return i.active&&t!==o&&n(i,o)};this.cOut.forEach(function(i){return r(i,i.right)}),this.cIn.forEach(function(i){return r(i,i.left)})},e}();Vr.Variable=vg;var Z1=function(){function e(t){this.vars=[],t.offset=0,this.ps=new gj(t.scale),this.addVariable(t)}return e.prototype.addVariable=function(t){t.block=this,this.vars.push(t),this.ps.addVariable(t),this.posn=this.ps.getPosn()},e.prototype.updateWeightedPosition=function(){this.ps.AB=this.ps.AD=this.ps.A2=0;for(var t=0,n=this.vars.length;t<n;++t)this.ps.addVariable(this.vars[t]);this.posn=this.ps.getPosn()},e.prototype.compute_lm=function(t,n,r){var i=this,o=t.dfdv();return t.visitNeighbours(n,function(s,a){var l=i.compute_lm(a,t,r);a===s.right?(o+=l*s.left.scale,s.lm=l):(o+=l*s.right.scale,s.lm=-l),r(s)}),o/t.scale},e.prototype.populateSplitBlock=function(t,n){var r=this;t.visitNeighbours(n,function(i,o){o.offset=t.offset+(o===i.right?i.gap:-i.gap),r.addVariable(o),r.populateSplitBlock(o,t)})},e.prototype.traverse=function(t,n,r,i){var o=this;r===void 0&&(r=this.vars[0]),i===void 0&&(i=null),r.visitNeighbours(i,function(s,a){n.push(t(s)),o.traverse(t,n,a,r)})},e.prototype.findMinLM=function(){var t=null;return this.compute_lm(this.vars[0],null,function(n){!n.equality&&(t===null||n.lm<t.lm)&&(t=n)}),t},e.prototype.findMinLMBetween=function(t,n){this.compute_lm(t,null,function(){});var r=null;return this.findPath(t,null,n,function(i,o){!i.equality&&i.right===o&&(r===null||i.lm<r.lm)&&(r=i)}),r},e.prototype.findPath=function(t,n,r,i){var o=this,s=!1;return t.visitNeighbours(n,function(a,l){!s&&(l===r||o.findPath(l,t,r,i))&&(s=!0,i(a,l))}),s},e.prototype.isActiveDirectedPathBetween=function(t,n){if(t===n)return!0;for(var r=t.cOut.length;r--;){var i=t.cOut[r];if(i.active&&this.isActiveDirectedPathBetween(i.right,n))return!0}return!1},e.split=function(t){return t.active=!1,[e.createSplitBlock(t.left),e.createSplitBlock(t.right)]},e.createSplitBlock=function(t){var n=new e(t);return n.populateSplitBlock(t,null),n},e.prototype.splitBetween=function(t,n){var r=this.findMinLMBetween(t,n);if(r!==null){var i=e.split(r);return{constraint:r,lb:i[0],rb:i[1]}}return null},e.prototype.mergeAcross=function(t,n,r){n.active=!0;for(var i=0,o=t.vars.length;i<o;++i){var s=t.vars[i];s.offset+=r,this.addVariable(s)}this.posn=this.ps.getPosn()},e.prototype.cost=function(){for(var t=0,n=this.vars.length;n--;){var r=this.vars[n],i=r.position()-r.desiredPosition;t+=i*i*r.weight}return t},e}();Vr.Block=Z1;var Q1=function(){function e(t){this.vs=t;var n=t.length;for(this.list=new Array(n);n--;){var r=new Z1(t[n]);this.list[n]=r,r.blockInd=n}}return e.prototype.cost=function(){for(var t=0,n=this.list.length;n--;)t+=this.list[n].cost();return t},e.prototype.insert=function(t){t.blockInd=this.list.length,this.list.push(t)},e.prototype.remove=function(t){var n=this.list.length-1,r=this.list[n];this.list.length=n,t!==r&&(this.list[t.blockInd]=r,r.blockInd=t.blockInd)},e.prototype.merge=function(t){var n=t.left.block,r=t.right.block,i=t.right.offset-t.left.offset-t.gap;n.vars.length<r.vars.length?(r.mergeAcross(n,t,i),this.remove(n)):(n.mergeAcross(r,t,-i),this.remove(r))},e.prototype.forEach=function(t){this.list.forEach(t)},e.prototype.updateBlockPositions=function(){this.list.forEach(function(t){return t.updateWeightedPosition()})},e.prototype.split=function(t){var n=this;this.updateBlockPositions(),this.list.forEach(function(r){var i=r.findMinLM();i!==null&&i.lm<J1.LAGRANGIAN_TOLERANCE&&(r=i.left.block,Z1.split(i).forEach(function(o){return n.insert(o)}),n.remove(r),t.push(i))})},e}();Vr.Blocks=Q1;var J1=function(){function e(t,n){this.vs=t,this.cs=n,this.vs=t,t.forEach(function(r){r.cIn=[],r.cOut=[]}),this.cs=n,n.forEach(function(r){r.left.cOut.push(r),r.right.cIn.push(r)}),this.inactive=n.map(function(r){return r.active=!1,r}),this.bs=null}return e.prototype.cost=function(){return this.bs.cost()},e.prototype.setStartingPositions=function(t){this.inactive=this.cs.map(function(n){return n.active=!1,n}),this.bs=new Q1(this.vs),this.bs.forEach(function(n,r){return n.posn=t[r]})},e.prototype.setDesiredPositions=function(t){this.vs.forEach(function(n,r){return n.desiredPosition=t[r]})},e.prototype.mostViolated=function(){for(var t=Number.MAX_VALUE,n=null,r=this.inactive,i=r.length,o=i,s=0;s<i;++s){var a=r[s];if(!a.unsatisfiable){var l=a.slack();if((a.equality||l<t)&&(t=l,n=a,o=s,a.equality))break}}return o!==i&&(t<e.ZERO_UPPERBOUND&&!n.active||n.equality)&&(r[o]=r[i-1],r.length=i-1),n},e.prototype.satisfy=function(){this.bs==null&&(this.bs=new Q1(this.vs)),this.bs.split(this.inactive);for(var t=null;(t=this.mostViolated())&&(t.equality||t.slack()<e.ZERO_UPPERBOUND&&!t.active);){var n=t.left.block,r=t.right.block;if(n!==r)this.bs.merge(t);else{if(n.isActiveDirectedPathBetween(t.right,t.left)){t.unsatisfiable=!0;continue}var i=n.splitBetween(t.left,t.right);if(i!==null)this.bs.insert(i.lb),this.bs.insert(i.rb),this.bs.remove(n),this.inactive.push(i.constraint);else{t.unsatisfiable=!0;continue}t.slack()>=0?this.inactive.push(t):this.bs.merge(t)}}},e.prototype.solve=function(){this.satisfy();for(var t=Number.MAX_VALUE,n=this.bs.cost();Math.abs(t-n)>1e-4;)this.satisfy(),t=n,n=this.bs.cost();return n},e.LAGRANGIAN_TOLERANCE=-1e-4,e.ZERO_UPPERBOUND=-1e-10,e}();Vr.Solver=J1;function yne(e,t,n){for(var r=e.map(function(m){return new vg(m.desiredCenter)}),i=[],o=e.length,s=0;s<o-1;s++){var a=e[s],l=e[s+1];i.push(new yg(r[s],r[s+1],(a.size+l.size)/2))}var c=r[0],u=r[o-1],d=e[0].size/2,h=e[o-1].size/2,p=null,g=null;t&&(p=new vg(t,c.weight*1e3),r.push(p),i.push(new yg(p,c,d))),n&&(g=new vg(n,u.weight*1e3),r.push(g),i.push(new yg(u,g,h)));var f=new J1(r,i);return f.solve(),{newCenters:r.slice(0,e.length).map(function(m){return m.position()}),lowerBound:p?p.position():c.position()-d,upperBound:g?g.position():u.position()+h}}Vr.removeOverlapInOneDimension=yne;var Cl={},vne=Oe&&Oe.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Cl,"__esModule",{value:!0});var mj=function(){function e(){this.findIter=function(t){for(var n=this._root,r=this.iterator();n!==null;){var i=this._comparator(t,n.data);if(i===0)return r._cursor=n,r;r._ancestors.push(n),n=n.get_child(i>0)}return null}}return e.prototype.clear=function(){this._root=null,this.size=0},e.prototype.find=function(t){for(var n=this._root;n!==null;){var r=this._comparator(t,n.data);if(r===0)return n.data;n=n.get_child(r>0)}return null},e.prototype.lowerBound=function(t){return this._bound(t,this._comparator)},e.prototype.upperBound=function(t){var n=this._comparator;function r(i,o){return n(o,i)}return this._bound(t,r)},e.prototype.min=function(){var t=this._root;if(t===null)return null;for(;t.left!==null;)t=t.left;return t.data},e.prototype.max=function(){var t=this._root;if(t===null)return null;for(;t.right!==null;)t=t.right;return t.data},e.prototype.iterator=function(){return new yj(this)},e.prototype.each=function(t){for(var n=this.iterator(),r;(r=n.next())!==null;)t(r)},e.prototype.reach=function(t){for(var n=this.iterator(),r;(r=n.prev())!==null;)t(r)},e.prototype._bound=function(t,n){for(var r=this._root,i=this.iterator();r!==null;){var o=this._comparator(t,r.data);if(o===0)return i._cursor=r,i;i._ancestors.push(r),r=r.get_child(o>0)}for(var s=i._ancestors.length-1;s>=0;--s)if(r=i._ancestors[s],n(t,r.data)>0)return i._cursor=r,i._ancestors.length=s,i;return i._ancestors.length=0,i},e}();Cl.TreeBase=mj;var yj=function(){function e(t){this._tree=t,this._ancestors=[],this._cursor=null}return e.prototype.data=function(){return this._cursor!==null?this._cursor.data:null},e.prototype.next=function(){if(this._cursor===null){var t=this._tree._root;t!==null&&this._minNode(t)}else if(this._cursor.right===null){var n;do if(n=this._cursor,this._ancestors.length)this._cursor=this._ancestors.pop();else{this._cursor=null;break}while(this._cursor.right===n)}else this._ancestors.push(this._cursor),this._minNode(this._cursor.right);return this._cursor!==null?this._cursor.data:null},e.prototype.prev=function(){if(this._cursor===null){var t=this._tree._root;t!==null&&this._maxNode(t)}else if(this._cursor.left===null){var n;do if(n=this._cursor,this._ancestors.length)this._cursor=this._ancestors.pop();else{this._cursor=null;break}while(this._cursor.left===n)}else this._ancestors.push(this._cursor),this._maxNode(this._cursor.left);return this._cursor!==null?this._cursor.data:null},e.prototype._minNode=function(t){for(;t.left!==null;)this._ancestors.push(t),t=t.left;this._cursor=t},e.prototype._maxNode=function(t){for(;t.right!==null;)this._ancestors.push(t),t=t.right;this._cursor=t},e}();Cl.Iterator=yj;var bg=function(){function e(t){this.data=t,this.left=null,this.right=null,this.red=!0}return e.prototype.get_child=function(t){return t?this.right:this.left},e.prototype.set_child=function(t,n){t?this.right=n:this.left=n},e}(),bne=function(e){vne(t,e);function t(n){var r=e.call(this)||this;return r._root=null,r._comparator=n,r.size=0,r}return t.prototype.insert=function(n){var r=!1;if(this._root===null)this._root=new bg(n),r=!0,this.size++;else{var i=new bg(void 0),o=!1,s=!1,a=null,l=i,c=null,u=this._root;for(l.right=this._root;;){if(u===null?(u=new bg(n),c.set_child(o,u),r=!0,this.size++):t.is_red(u.left)&&t.is_red(u.right)&&(u.red=!0,u.left.red=!1,u.right.red=!1),t.is_red(u)&&t.is_red(c)){var d=l.right===a;u===c.get_child(s)?l.set_child(d,t.single_rotate(a,!s)):l.set_child(d,t.double_rotate(a,!s))}var h=this._comparator(u.data,n);if(h===0)break;s=o,o=h<0,a!==null&&(l=a),a=c,c=u,u=u.get_child(o)}this._root=i.right}return this._root.red=!1,r},t.prototype.remove=function(n){if(this._root===null)return!1;var r=new bg(void 0),i=r;i.right=this._root;for(var o=null,s=null,a=null,l=!0;i.get_child(l)!==null;){var c=l;s=o,o=i,i=i.get_child(l);var u=this._comparator(n,i.data);if(l=u>0,u===0&&(a=i),!t.is_red(i)&&!t.is_red(i.get_child(l))){if(t.is_red(i.get_child(!l))){var d=t.single_rotate(i,l);o.set_child(c,d),o=d}else if(!t.is_red(i.get_child(!l))){var h=o.get_child(!c);if(h!==null)if(!t.is_red(h.get_child(!c))&&!t.is_red(h.get_child(c)))o.red=!1,h.red=!0,i.red=!0;else{var p=s.right===o;t.is_red(h.get_child(c))?s.set_child(p,t.double_rotate(o,c)):t.is_red(h.get_child(!c))&&s.set_child(p,t.single_rotate(o,c));var g=s.get_child(p);g.red=!0,i.red=!0,g.left.red=!1,g.right.red=!1}}}}return a!==null&&(a.data=i.data,o.set_child(o.right===i,i.get_child(i.left===null)),this.size--),this._root=r.right,this._root!==null&&(this._root.red=!1),a!==null},t.is_red=function(n){return n!==null&&n.red},t.single_rotate=function(n,r){var i=n.get_child(!r);return n.set_child(!r,i.get_child(r)),i.set_child(r,n),n.red=!0,i.red=!1,i},t.double_rotate=function(n,r){return n.set_child(!r,t.single_rotate(n.get_child(!r),!r)),t.single_rotate(n,r)},t}(mj);Cl.RBTree=bne;var wne=Oe&&Oe.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Nt,"__esModule",{value:!0});var eo=Vr,xne=Cl;function Xu(e){return e.bounds=typeof e.leaves<"u"?e.leaves.reduce(function(t,n){return n.bounds.union(t)},qo.empty()):qo.empty(),typeof e.groups<"u"&&(e.bounds=e.groups.reduce(function(t,n){return Xu(n).union(t)},e.bounds)),e.bounds=e.bounds.inflate(e.padding),e.bounds}Nt.computeGroupBounds=Xu;var qo=function(){function e(t,n,r,i){this.x=t,this.X=n,this.y=r,this.Y=i}return e.empty=function(){return new e(Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY)},e.prototype.cx=function(){return(this.x+this.X)/2},e.prototype.cy=function(){return(this.y+this.Y)/2},e.prototype.overlapX=function(t){var n=this.cx(),r=t.cx();return n<=r&&t.x<this.X?this.X-t.x:r<=n&&this.x<t.X?t.X-this.x:0},e.prototype.overlapY=function(t){var n=this.cy(),r=t.cy();return n<=r&&t.y<this.Y?this.Y-t.y:r<=n&&this.y<t.Y?t.Y-this.y:0},e.prototype.setXCentre=function(t){var n=t-this.cx();this.x+=n,this.X+=n},e.prototype.setYCentre=function(t){var n=t-this.cy();this.y+=n,this.Y+=n},e.prototype.width=function(){return this.X-this.x},e.prototype.height=function(){return this.Y-this.y},e.prototype.union=function(t){return new e(Math.min(this.x,t.x),Math.max(this.X,t.X),Math.min(this.y,t.y),Math.max(this.Y,t.Y))},e.prototype.lineIntersections=function(t,n,r,i){for(var o=[[this.x,this.y,this.X,this.y],[this.X,this.y,this.X,this.Y],[this.X,this.Y,this.x,this.Y],[this.x,this.Y,this.x,this.y]],s=[],a=0;a<4;++a){var l=e.lineIntersection(t,n,r,i,o[a][0],o[a][1],o[a][2],o[a][3]);l!==null&&s.push({x:l.x,y:l.y})}return s},e.prototype.rayIntersection=function(t,n){var r=this.lineIntersections(this.cx(),this.cy(),t,n);return r.length>0?r[0]:null},e.prototype.vertices=function(){return[{x:this.x,y:this.y},{x:this.X,y:this.y},{x:this.X,y:this.Y},{x:this.x,y:this.Y}]},e.lineIntersection=function(t,n,r,i,o,s,a,l){var c=r-t,u=a-o,d=i-n,h=l-s,p=h*c-u*d;if(p==0)return null;var g=t-o,f=n-s,m=u*f-h*g,w=m/p,b=c*f-d*g,k=b/p;return w>=0&&w<=1&&k>=0&&k<=1?{x:t+w*c,y:n+w*d}:null},e.prototype.inflate=function(t){return new e(this.x-t,this.X+t,this.y-t,this.Y+t)},e}();Nt.Rectangle=qo;function Sne(e,t,n){var r=e.rayIntersection(t.cx(),t.cy())||{x:e.cx(),y:e.cy()},i=t.rayIntersection(e.cx(),e.cy())||{x:t.cx(),y:t.cy()},o=i.x-r.x,s=i.y-r.y,a=Math.sqrt(o*o+s*s),l=a-n;return{sourceIntersection:r,targetIntersection:i,arrowStart:{x:r.x+l*o/a,y:r.y+l*s/a}}}Nt.makeEdgeBetween=Sne;function kne(e,t,n){var r=t.rayIntersection(e.x,e.y);r||(r={x:t.cx(),y:t.cy()});var i=r.x-e.x,o=r.y-e.y,s=Math.sqrt(i*i+o*o);return{x:r.x-n*i/s,y:r.y-n*o/s}}Nt.makeEdgeTo=kne;var _ne=function(){function e(t,n,r){this.v=t,this.r=n,this.pos=r,this.prev=ew(),this.next=ew()}return e}(),vj=function(){function e(t,n,r){this.isOpen=t,this.v=n,this.pos=r}return e}();function Cne(e,t){return e.pos>t.pos?1:e.pos<t.pos||e.isOpen?-1:t.isOpen?1:0}function ew(){return new xne.RBTree(function(e,t){return e.pos-t.pos})}var bj={getCentre:function(e){return e.cx()},getOpen:function(e){return e.y},getClose:function(e){return e.Y},getSize:function(e){return e.width()},makeRect:function(e,t,n,r){return new qo(n-r/2,n+r/2,e,t)},findNeighbours:Ene},wj={getCentre:function(e){return e.cy()},getOpen:function(e){return e.x},getClose:function(e){return e.X},getSize:function(e){return e.height()},makeRect:function(e,t,n,r){return new qo(e,t,n-r/2,n+r/2)},findNeighbours:Pne};function tw(e,t,n,r){r===void 0&&(r=!1);var i=e.padding,o=typeof e.groups<"u"?e.groups.length:0,s=typeof e.leaves<"u"?e.leaves.length:0,a=o?e.groups.reduce(function(C,_){return C.concat(tw(_,t,n,!0))},[]):[],l=(r?2:0)+s+o,c=new Array(l),u=new Array(l),d=0,h=function(C,_){u[d]=C,c[d++]=_};if(r){var p=e.bounds,g=t.getCentre(p),f=t.getSize(p)/2,m=t.getOpen(p),w=t.getClose(p),b=g-f+i/2,k=g+f-i/2;e.minVar.desiredPosition=b,h(t.makeRect(m,w,b,i),e.minVar),e.maxVar.desiredPosition=k,h(t.makeRect(m,w,k,i),e.maxVar)}s&&e.leaves.forEach(function(C){return h(C.bounds,C.variable)}),o&&e.groups.forEach(function(C){var _=C.bounds;h(t.makeRect(t.getOpen(_),t.getClose(_),t.getCentre(_),t.getSize(_)),C.minVar)});var S=nw(u,c,t,n);return o&&(c.forEach(function(C){C.cOut=[],C.cIn=[]}),S.forEach(function(C){C.left.cOut.push(C),C.right.cIn.push(C)}),e.groups.forEach(function(C){var _=(C.padding-t.getSize(C.bounds))/2;C.minVar.cIn.forEach(function(P){return P.gap+=_}),C.minVar.cOut.forEach(function(P){P.left=C.maxVar,P.gap+=_})})),a.concat(S)}function nw(e,t,n,r){var i,o=e.length,s=2*o;console.assert(t.length>=o);var a=new Array(s);for(i=0;i<o;++i){var l=e[i],c=new _ne(t[i],l,n.getCentre(l));a[i]=new vj(!0,c,n.getOpen(l)),a[i+o]=new vj(!1,c,n.getClose(l))}a.sort(Cne);var u=new Array,d=ew();for(i=0;i<s;++i){var h=a[i],c=h.v;if(h.isOpen)d.insert(c),n.findNeighbours(c,d);else{d.remove(c);var p=function(m,w){var b=(n.getSize(m.r)+n.getSize(w.r))/2+r;u.push(new eo.Constraint(m.v,w.v,b))},g=function(m,w,b){for(var k,S=c[m].iterator();(k=S[m]())!==null;)b(k,c),k[w].remove(c)};g("prev","next",function(m,w){return p(m,w)}),g("next","prev",function(m,w){return p(w,m)})}}return console.assert(d.size===0),u}function Ene(e,t){var n=function(r,i){for(var o=t.findIter(e),s;(s=o[r]())!==null;){var a=s.r.overlapX(e.r);if((a<=0||a<=s.r.overlapY(e.r))&&(e[r].insert(s),s[i].insert(e)),a<=0)break}};n("next","prev"),n("prev","next")}function Pne(e,t){var n=function(r,i){var o=t.findIter(e)[r]();o!==null&&o.r.overlapX(e.r)>0&&(e[r].insert(o),o[i].insert(e))};n("next","prev"),n("prev","next")}function xj(e,t){return nw(e,t,bj,1e-6)}Nt.generateXConstraints=xj;function Sj(e,t){return nw(e,t,wj,1e-6)}Nt.generateYConstraints=Sj;function kj(e){return tw(e,bj,1e-6)}Nt.generateXGroupConstraints=kj;function _j(e){return tw(e,wj,1e-6)}Nt.generateYGroupConstraints=_j;function Ine(e){var t=e.map(function(i){return new eo.Variable(i.cx())}),n=xj(e,t),r=new eo.Solver(t,n);r.solve(),t.forEach(function(i,o){return e[o].setXCentre(i.position())}),t=e.map(function(i){return new eo.Variable(i.cy())}),n=Sj(e,t),r=new eo.Solver(t,n),r.solve(),t.forEach(function(i,o){return e[o].setYCentre(i.position())})}Nt.removeOverlaps=Ine;var wg=function(e){wne(t,e);function t(n,r){var i=e.call(this,0,r)||this;return i.index=n,i}return t}(eo.Variable);Nt.IndexedVariable=wg;var Mne=function(){function e(t,n,r,i,o){var s=this;if(r===void 0&&(r=null),i===void 0&&(i=null),o===void 0&&(o=!1),this.nodes=t,this.groups=n,this.rootGroup=r,this.avoidOverlaps=o,this.variables=t.map(function(l,c){return l.variable=new wg(c,1)}),i&&this.createConstraints(i),o&&r&&typeof r.groups<"u"){t.forEach(function(l){if(!l.width||!l.height){l.bounds=new qo(l.x,l.x,l.y,l.y);return}var c=l.width/2,u=l.height/2;l.bounds=new qo(l.x-c,l.x+c,l.y-u,l.y+u)}),Xu(r);var a=t.length;n.forEach(function(l){s.variables[a]=l.minVar=new wg(a++,typeof l.stiffness<"u"?l.stiffness:.01),s.variables[a]=l.maxVar=new wg(a++,typeof l.stiffness<"u"?l.stiffness:.01)})}}return e.prototype.createSeparation=function(t){return new eo.Constraint(this.nodes[t.left].variable,this.nodes[t.right].variable,t.gap,typeof t.equality<"u"?t.equality:!1)},e.prototype.makeFeasible=function(t){var n=this;if(this.avoidOverlaps){var r="x",i="width";t.axis==="x"&&(r="y",i="height");var o=t.offsets.map(function(a){return n.nodes[a.node]}).sort(function(a,l){return a[r]-l[r]}),s=null;o.forEach(function(a){if(s){var l=s[r]+s[i];l>a[r]&&(a[r]=l)}s=a})}},e.prototype.createAlignment=function(t){var n=this,r=this.nodes[t.offsets[0].node].variable;this.makeFeasible(t);var i=t.axis==="x"?this.xConstraints:this.yConstraints;t.offsets.slice(1).forEach(function(o){var s=n.nodes[o.node].variable;i.push(new eo.Constraint(r,s,o.offset,!0))})},e.prototype.createConstraints=function(t){var n=this,r=function(i){return typeof i.type>"u"||i.type==="separation"};this.xConstraints=t.filter(function(i){return i.axis==="x"&&r(i)}).map(function(i){return n.createSeparation(i)}),this.yConstraints=t.filter(function(i){return i.axis==="y"&&r(i)}).map(function(i){return n.createSeparation(i)}),t.filter(function(i){return i.type==="alignment"}).forEach(function(i){return n.createAlignment(i)})},e.prototype.setupVariablesAndBounds=function(t,n,r,i){this.nodes.forEach(function(o,s){o.fixed?(o.variable.weight=o.fixedWeight?o.fixedWeight:1e3,r[s]=i(o)):o.variable.weight=1;var a=(o.width||0)/2,l=(o.height||0)/2,c=t[s],u=n[s];o.bounds=new qo(c-a,c+a,u-l,u+l)})},e.prototype.xProject=function(t,n,r){!this.rootGroup&&!(this.avoidOverlaps||this.xConstraints)||this.project(t,n,t,r,function(i){return i.px},this.xConstraints,kj,function(i){return i.bounds.setXCentre(r[i.variable.index]=i.variable.position())},function(i){var o=r[i.minVar.index]=i.minVar.position(),s=r[i.maxVar.index]=i.maxVar.position(),a=i.padding/2;i.bounds.x=o-a,i.bounds.X=s+a})},e.prototype.yProject=function(t,n,r){!this.rootGroup&&!this.yConstraints||this.project(t,n,n,r,function(i){return i.py},this.yConstraints,_j,function(i){return i.bounds.setYCentre(r[i.variable.index]=i.variable.position())},function(i){var o=r[i.minVar.index]=i.minVar.position(),s=r[i.maxVar.index]=i.maxVar.position(),a=i.padding/2;i.bounds.y=o-a,i.bounds.Y=s+a})},e.prototype.projectFunctions=function(){var t=this;return[function(n,r,i){return t.xProject(n,r,i)},function(n,r,i){return t.yProject(n,r,i)}]},e.prototype.project=function(t,n,r,i,o,s,a,l,c){this.setupVariablesAndBounds(t,n,i,o),this.rootGroup&&this.avoidOverlaps&&(Xu(this.rootGroup),s=s.concat(a(this.rootGroup))),this.solve(this.variables,s,r,i),this.nodes.forEach(l),this.rootGroup&&this.avoidOverlaps&&(this.groups.forEach(c),Xu(this.rootGroup))},e.prototype.solve=function(t,n,r,i){var o=new eo.Solver(t,n);o.setStartingPositions(r),o.setDesiredPositions(i),o.solve()},e}();Nt.Projection=Mne;var El={},Gu={};Object.defineProperty(Gu,"__esModule",{value:!0});var Cj=function(){function e(t){this.elem=t,this.subheaps=[]}return e.prototype.toString=function(t){for(var n="",r=!1,i=0;i<this.subheaps.length;++i){var o=this.subheaps[i];if(!o.elem){r=!1;continue}r&&(n=n+","),n=n+o.toString(t),r=!0}return n!==""&&(n="("+n+")"),(this.elem?t(this.elem):"")+n},e.prototype.forEach=function(t){this.empty()||(t(this.elem,this),this.subheaps.forEach(function(n){return n.forEach(t)}))},e.prototype.count=function(){return this.empty()?0:1+this.subheaps.reduce(function(t,n){return t+n.count()},0)},e.prototype.min=function(){return this.elem},e.prototype.empty=function(){return this.elem==null},e.prototype.contains=function(t){if(this===t)return!0;for(var n=0;n<this.subheaps.length;n++)if(this.subheaps[n].contains(t))return!0;return!1},e.prototype.isHeap=function(t){var n=this;return this.subheaps.every(function(r){return t(n.elem,r.elem)&&r.isHeap(t)})},e.prototype.insert=function(t,n){return this.merge(new e(t),n)},e.prototype.merge=function(t,n){return this.empty()?t:t.empty()?this:n(this.elem,t.elem)?(this.subheaps.push(t),this):(t.subheaps.push(this),t)},e.prototype.removeMin=function(t){return this.empty()?null:this.mergePairs(t)},e.prototype.mergePairs=function(t){if(this.subheaps.length==0)return new e(null);if(this.subheaps.length==1)return this.subheaps[0];var n=this.subheaps.pop().merge(this.subheaps.pop(),t),r=this.mergePairs(t);return n.merge(r,t)},e.prototype.decreaseKey=function(t,n,r,i){var o=t.removeMin(i);t.elem=o.elem,t.subheaps=o.subheaps,r!==null&&o.elem!==null&&r(t.elem,t);var s=new e(n);return r!==null&&r(n,s),this.merge(s,i)},e}();Gu.PairingHeap=Cj;var Ane=function(){function e(t){this.lessThan=t}return e.prototype.top=function(){return this.empty()?null:this.root.elem},e.prototype.push=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r,i=0,o;o=t[i];++i)r=new Cj(o),this.root=this.empty()?r:this.root.merge(r,this.lessThan);return r},e.prototype.empty=function(){return!this.root||!this.root.elem},e.prototype.isHeap=function(){return this.root.isHeap(this.lessThan)},e.prototype.forEach=function(t){this.root.forEach(t)},e.prototype.pop=function(){if(this.empty())return null;var t=this.root.min();return this.root=this.root.removeMin(this.lessThan),t},e.prototype.reduceKey=function(t,n,r){r===void 0&&(r=null),this.root=this.root.decreaseKey(t,n,r,this.lessThan)},e.prototype.toString=function(t){return this.root.toString(t)},e.prototype.count=function(){return this.root.count()},e}();Gu.PriorityQueue=Ane,Object.defineProperty(El,"__esModule",{value:!0});var Ej=Gu,Pj=function(){function e(t,n){this.id=t,this.distance=n}return e}(),Tne=function(){function e(t){this.id=t,this.neighbours=[]}return e}(),Ij=function(){function e(t,n,r){this.node=t,this.prev=n,this.d=r}return e}(),jne=function(){function e(t,n,r,i,o){this.n=t,this.es=n,this.neighbours=new Array(this.n);for(var s=this.n;s--;)this.neighbours[s]=new Tne(s);for(s=this.es.length;s--;){var a=this.es[s],l=r(a),c=i(a),u=o(a);this.neighbours[l].neighbours.push(new Pj(c,u)),this.neighbours[c].neighbours.push(new Pj(l,u))}}return e.prototype.DistanceMatrix=function(){for(var t=new Array(this.n),n=0;n<this.n;++n)t[n]=this.dijkstraNeighbours(n);return t},e.prototype.DistancesFromNode=function(t){return this.dijkstraNeighbours(t)},e.prototype.PathFromNodeToNode=function(t,n){return this.dijkstraNeighbours(t,n)},e.prototype.PathFromNodeToNodeWithPrevCost=function(t,n,r){var i=new Ej.PriorityQueue(function(f,m){return f.d<=m.d}),o=this.neighbours[t],s=new Ij(o,null,0),a={};for(i.push(s);!i.empty()&&(s=i.pop(),o=s.node,o.id!==n);)for(var l=o.neighbours.length;l--;){var c=o.neighbours[l],u=this.neighbours[c.id];if(!(s.prev&&u.id===s.prev.node.id)){var d=u.id+","+o.id;if(!(d in a&&a[d]<=s.d)){var h=s.prev?r(s.prev.node.id,o.id,u.id):0,p=s.d+c.distance+h;a[d]=p,i.push(new Ij(u,s,p))}}}for(var g=[];s.prev;)s=s.prev,g.push(s.node.id);return g},e.prototype.dijkstraNeighbours=function(t,n){n===void 0&&(n=-1);for(var r=new Ej.PriorityQueue(function(h,p){return h.d<=p.d}),i=this.neighbours.length,o=new Array(i);i--;){var s=this.neighbours[i];s.d=i===t?0:Number.POSITIVE_INFINITY,s.q=r.push(s)}for(;!r.empty();){var a=r.pop();if(o[a.id]=a.d,a.id===n){for(var l=[],c=a;typeof c.prev<"u";)l.push(c.prev.id),c=c.prev;return l}for(i=a.neighbours.length;i--;){var u=a.neighbours[i],c=this.neighbours[u.id],d=a.d+u.distance;a.d!==Number.MAX_VALUE&&c.d>d&&(c.d=d,c.prev=a,r.reduceKey(c.q,c,function(p,g){return p.q=g}))}}return o},e}();El.Calculator=jne;var dt={},Mj=Oe&&Oe.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(dt,"__esModule",{value:!0});var One=Nt,rw=function(){function e(){}return e}();dt.Point=rw;var iw=function(){function e(t,n,r,i){this.x1=t,this.y1=n,this.x2=r,this.y2=i}return e}();dt.LineSegment=iw;var Lne=function(e){Mj(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(rw);dt.PolyPoint=Lne;function qn(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}dt.isLeft=qn;function Hr(e,t,n){return qn(e,t,n)>0}function mr(e,t,n){return qn(e,t,n)<0}function Dne(e){var t=e.slice(0).sort(function(h,p){return h.x!==p.x?p.x-h.x:p.y-h.y}),n=e.length,r,i=0,o=t[0].x;for(r=1;r<n&&t[r].x===o;++r);var s=r-1,a=[];if(a.push(t[i]),s===n-1)t[s].y!==t[i].y&&a.push(t[s]);else{var l,c=n-1,u=t[n-1].x;for(r=n-2;r>=0&&t[r].x===u;r--);for(l=r+1,r=s;++r<=l;)if(!(qn(t[i],t[l],t[r])>=0&&r<l)){for(;a.length>1&&!(qn(a[a.length-2],a[a.length-1],t[r])>0);)a.length-=1;r!=i&&a.push(t[r])}c!=l&&a.push(t[c]);var d=a.length;for(r=l;--r>=s;)if(!(qn(t[c],t[s],t[r])>=0&&r>s)){for(;a.length>d&&!(qn(a[a.length-2],a[a.length-1],t[r])>0);)a.length-=1;r!=i&&a.push(t[r])}}return a}dt.ConvexHull=Dne;function zne(e,t,n){t.slice(0).sort(function(r,i){return Math.atan2(r.y-e.y,r.x-e.x)-Math.atan2(i.y-e.y,i.x-e.x)}).forEach(n)}dt.clockwiseRadialSweep=zne;function Nne(e,t){var n=t.slice(0);return n.push(t[0]),{rtan:xg(e,n),ltan:Sg(e,n)}}function xg(e,t){var n=t.length-1,r,i,o,s,a;if(mr(e,t[1],t[0])&&!Hr(e,t[n-1],t[0]))return 0;for(r=0,i=n;;){if(i-r===1)return Hr(e,t[r],t[i])?r:i;if(o=Math.floor((r+i)/2),a=mr(e,t[o+1],t[o]),a&&!Hr(e,t[o-1],t[o]))return o;s=Hr(e,t[r+1],t[r]),s?a||Hr(e,t[r],t[o])?i=o:r=o:a&&mr(e,t[r],t[o])?i=o:r=o}}function Sg(e,t){var n=t.length-1,r,i,o,s,a;if(Hr(e,t[n-1],t[0])&&!mr(e,t[1],t[0]))return 0;for(r=0,i=n;;){if(i-r===1)return mr(e,t[r],t[i])?r:i;if(o=Math.floor((r+i)/2),a=mr(e,t[o+1],t[o]),Hr(e,t[o-1],t[o])&&!a)return o;s=mr(e,t[r+1],t[r]),s?a?mr(e,t[r],t[o])?i=o:r=o:i=o:a?r=o:Hr(e,t[r],t[o])?i=o:r=o}}function kg(e,t,n,r,i,o){var s,a;s=n(t[0],e),a=r(e[s],t);for(var l=!1;!l;){for(l=!0;s===e.length-1&&(s=0),!i(t[a],e[s],e[s+1]);)++s;for(;a===0&&(a=t.length-1),!o(e[s],t[a],t[a-1]);)--a,l=!1}return{t1:s,t2:a}}dt.tangent_PolyPolyC=kg;function Rne(e,t){var n=Aj(t,e);return{t1:n.t2,t2:n.t1}}dt.LRtangent_PolyPolyC=Rne;function Aj(e,t){return kg(e,t,xg,Sg,Hr,mr)}dt.RLtangent_PolyPolyC=Aj;function Fne(e,t){return kg(e,t,Sg,Sg,mr,mr)}dt.LLtangent_PolyPolyC=Fne;function $ne(e,t){return kg(e,t,xg,xg,Hr,Hr)}dt.RRtangent_PolyPolyC=$ne;var qu=function(){function e(t,n){this.t1=t,this.t2=n}return e}();dt.BiTangent=qu;var Tj=function(){function e(){}return e}();dt.BiTangents=Tj;var Bne=function(e){Mj(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(rw);dt.TVGPoint=Bne;var ow=function(){function e(t,n,r,i){this.id=t,this.polyid=n,this.polyvertid=r,this.p=i,i.vv=this}return e}();dt.VisibilityVertex=ow;var _g=function(){function e(t,n){this.source=t,this.target=n}return e.prototype.length=function(){var t=this.source.p.x-this.target.p.x,n=this.source.p.y-this.target.p.y;return Math.sqrt(t*t+n*n)},e}();dt.VisibilityEdge=_g;var Une=function(){function e(t,n){if(this.P=t,this.V=[],this.E=[],n)this.V=n.V.slice(0),this.E=n.E.slice(0);else{for(var r=t.length,i=0;i<r;i++){for(var o=t[i],s=0;s<o.length;++s){var a=o[s],l=new ow(this.V.length,i,s,a);this.V.push(l),s>0&&this.E.push(new _g(o[s-1].vv,l))}o.length>1&&this.E.push(new _g(o[0].vv,o[o.length-1].vv))}for(var i=0;i<r-1;i++)for(var c=t[i],s=i+1;s<r;s++){var u=t[s],d=Oj(c,u);for(var h in d){var p=d[h],g=c[p.t1],f=u[p.t2];this.addEdgeIfVisible(g,f,i,s)}}}}return e.prototype.addEdgeIfVisible=function(t,n,r,i){this.intersectsPolys(new iw(t.x,t.y,n.x,n.y),r,i)||this.E.push(new _g(t.vv,n.vv))},e.prototype.addPoint=function(t,n){var r=this.P.length;this.V.push(new ow(this.V.length,r,0,t));for(var i=0;i<r;++i)if(i!==n){var o=this.P[i],s=Nne(t,o);this.addEdgeIfVisible(t,o[s.ltan],n,i),this.addEdgeIfVisible(t,o[s.rtan],n,i)}return t.vv},e.prototype.intersectsPolys=function(t,n,r){for(var i=0,o=this.P.length;i<o;++i)if(i!=n&&i!=r&&jj(t,this.P[i]).length>0)return!0;return!1},e}();dt.TangentVisibilityGraph=Une;function jj(e,t){for(var n=[],r=1,i=t.length;r<i;++r){var o=One.Rectangle.lineIntersection(e.x1,e.y1,e.x2,e.y2,t[r-1].x,t[r-1].y,t[r].x,t[r].y);o&&n.push(o)}return n}function Oj(e,t){for(var n=e.length-1,r=t.length-1,i=new Tj,o=0;o<n;++o)for(var s=0;s<r;++s){var a=e[o==0?n-1:o-1],l=e[o],c=e[o+1],u=t[s==0?r-1:s-1],d=t[s],h=t[s+1],p=qn(a,l,d),g=qn(l,u,d),f=qn(l,d,h),m=qn(u,d,l),w=qn(d,a,l),b=qn(d,l,c);p>=0&&g>=0&&f<0&&m>=0&&w>=0&&b<0?i.ll=new qu(o,s):p<=0&&g<=0&&f>0&&m<=0&&w<=0&&b>0?i.rr=new qu(o,s):p<=0&&g>0&&f<=0&&m>=0&&w<0&&b>=0?i.rl=new qu(o,s):p>=0&&g<0&&f>=0&&m<=0&&w>0&&b<=0&&(i.lr=new qu(o,s))}return i}dt.tangents=Oj;function Vne(e,t){for(var n=1,r=t.length;n<r;++n)if(mr(t[n-1],t[n],e))return!1;return!0}function Lj(e,t){return!e.every(function(n){return!Vne(n,t)})}function Hne(e,t){if(Lj(e,t)||Lj(t,e))return!0;for(var n=1,r=e.length;n<r;++n){var i=e[n],o=e[n-1];if(jj(new iw(o.x,o.y,i.x,i.y),t).length>0)return!0}return!1}dt.polysOverlap=Hne;var Zu={};Object.defineProperty(Zu,"__esModule",{value:!0});var yr={PADDING:10,GOLDEN_SECTION:(1+Math.sqrt(5))/2,FLOAT_EPSILON:1e-4,MAX_INERATIONS:100};function Kne(e,t,n,d,u,o){u===void 0&&(u=1),o===void 0&&(o=!0);var s=0,a=0,l=t,c=n,u=typeof u<"u"?u:1,d=typeof d<"u"?d:0,h=0,p=0,g=0,f=0,m=[];if(e.length==0)return;w(e),k(e),o&&b(e);function w(I){I.forEach(function(A){M(A)});function M(A){var L=Number.MAX_VALUE,z=Number.MAX_VALUE,$=0,j=0;A.array.forEach(function(F){var R=typeof F.width<"u"?F.width:d,W=typeof F.height<"u"?F.height:d;R/=2,W/=2,$=Math.max(F.x+R,$),L=Math.min(F.x-R,L),j=Math.max(F.y+W,j),z=Math.min(F.y-W,z)}),A.width=$-L,A.height=j-z}}function b(I){I.forEach(function(M){var A={x:0,y:0};M.array.forEach(function($){A.x+=$.x,A.y+=$.y}),A.x/=M.array.length,A.y/=M.array.length;var L={x:A.x-M.width/2,y:A.y-M.height/2},z={x:M.x-L.x+l/2-h/2,y:M.y-L.y+c/2-p/2};M.array.forEach(function($){$.x+=z.x,$.y+=z.y})})}function k(I,M){var A=Number.POSITIVE_INFINITY,L=0;I.sort(function(ie,ue){return ue.height-ie.height}),g=I.reduce(function(ie,ue){return ie.width<ue.width?ie.width:ue.width});for(var z=B=g,$=X=_(I),j=0,F=Number.MAX_VALUE,R=Number.MAX_VALUE,W=-1,V=Number.MAX_VALUE,D=Number.MAX_VALUE;V>g||D>yr.FLOAT_EPSILON;){if(W!=1)var B=$-($-z)/yr.GOLDEN_SECTION,F=S(I,B);if(W!=0)var X=z+($-z)/yr.GOLDEN_SECTION,R=S(I,X);if(V=Math.abs(B-X),D=Math.abs(F-R),F<A&&(A=F,L=B),R<A&&(A=R,L=X),F>R?(z=B,B=X,F=R,W=1):($=X,X=B,R=F,W=0),j++>100)break}S(I,L)}function S(I,M){m=[],h=0,p=0,f=a;for(var A=0;A<I.length;A++){var L=I[A];C(L,M)}return Math.abs(P()-u)}function C(I,M){for(var A=void 0,L=0;L<m.length;L++)if(m[L].space_left>=I.height&&m[L].x+m[L].width+I.width+yr.PADDING-M<=yr.FLOAT_EPSILON){A=m[L];break}m.push(I),A!==void 0?(I.x=A.x+A.width+yr.PADDING,I.y=A.bottom,I.space_left=I.height,I.bottom=I.y,A.space_left-=I.height+yr.PADDING,A.bottom+=I.height+yr.PADDING):(I.y=f,f+=I.height+yr.PADDING,I.x=s,I.bottom=I.y,I.space_left=I.height),I.y+I.height-p>-yr.FLOAT_EPSILON&&(p=I.y+I.height-a),I.x+I.width-h>-yr.FLOAT_EPSILON&&(h=I.x+I.width-s)}function _(I){var M=0;return I.forEach(function(A){return M+=A.width+yr.PADDING}),M}function P(){return h/p}}Zu.applyPacking=Kne;function Wne(e,t){for(var n={},r={},i=[],o=0,s=0;s<t.length;s++){var a=t[s],l=a.source,c=a.target;r[l.index]?r[l.index].push(c):r[l.index]=[c],r[c.index]?r[c.index].push(l):r[c.index]=[l]}for(var s=0;s<e.length;s++){var u=e[s];n[u.index]||d(u,!0)}function d(h,p){if(n[h.index]===void 0){p&&(o++,i.push({array:[]})),n[h.index]=o,i[o-1].array.push(h);var g=r[h.index];if(g)for(var f=0;f<g.length;f++)d(g[f],!1)}}return i}Zu.separateGraphs=Wne,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ji,n=Go,r=Bs,i=Nt,o=El,s=dt,a=Zu,l;(function(d){d[d.start=0]="start",d[d.tick=1]="tick",d[d.end=2]="end"})(l=e.EventType||(e.EventType={}));function c(d){return typeof d.leaves<"u"||typeof d.groups<"u"}var u=function(){function d(){var h=this;this._canvasSize=[1,1],this._linkDistance=20,this._defaultNodeSize=10,this._linkLengthCalculator=null,this._linkType=null,this._avoidOverlaps=!1,this._handleDisconnected=!0,this._running=!1,this._nodes=[],this._groups=[],this._rootGroup=null,this._links=[],this._constraints=[],this._distanceMatrix=null,this._descent=null,this._directedLinkConstraints=null,this._threshold=.01,this._visibilityGraph=null,this._groupCompactness=1e-6,this.event=null,this.linkAccessor={getSourceIndex:d.getSourceIndex,getTargetIndex:d.getTargetIndex,setLength:d.setLinkLength,getType:function(p){return typeof h._linkType=="function"?h._linkType(p):0}}}return d.prototype.on=function(h,p){return this.event||(this.event={}),typeof h=="string"?this.event[l[h]]=p:this.event[h]=p,this},d.prototype.trigger=function(h){this.event&&typeof this.event[h.type]<"u"&&this.event[h.type](h)},d.prototype.kick=function(){for(;!this.tick(););},d.prototype.tick=function(){if(this._alpha<this._threshold)return this._running=!1,this.trigger({type:l.end,alpha:this._alpha=0,stress:this._lastStress}),!0;var h=this._nodes.length;this._links.length;var p,g;for(this._descent.locks.clear(),g=0;g<h;++g)if(p=this._nodes[g],p.fixed){(typeof p.px>"u"||typeof p.py>"u")&&(p.px=p.x,p.py=p.y);var f=[p.px,p.py];this._descent.locks.add(g,f)}var m=this._descent.rungeKutta();return m===0?this._alpha=0:typeof this._lastStress<"u"&&(this._alpha=m),this._lastStress=m,this.updateNodePositions(),this.trigger({type:l.tick,alpha:this._alpha,stress:this._lastStress}),!1},d.prototype.updateNodePositions=function(){for(var h=this._descent.x[0],p=this._descent.x[1],g,f=this._nodes.length;f--;)g=this._nodes[f],g.x=h[f],g.y=p[f]},d.prototype.nodes=function(h){if(!h){if(this._nodes.length===0&&this._links.length>0){var p=0;this._links.forEach(function(f){p=Math.max(p,f.source,f.target)}),this._nodes=new Array(++p);for(var g=0;g<p;++g)this._nodes[g]={}}return this._nodes}return this._nodes=h,this},d.prototype.groups=function(h){var p=this;return h?(this._groups=h,this._rootGroup={},this._groups.forEach(function(g){typeof g.padding>"u"&&(g.padding=1),typeof g.leaves<"u"&&g.leaves.forEach(function(f,m){typeof f=="number"&&((g.leaves[m]=p._nodes[f]).parent=g)}),typeof g.groups<"u"&&g.groups.forEach(function(f,m){typeof f=="number"&&((g.groups[m]=p._groups[f]).parent=g)})}),this._rootGroup.leaves=this._nodes.filter(function(g){return typeof g.parent>"u"}),this._rootGroup.groups=this._groups.filter(function(g){return typeof g.parent>"u"}),this):this._groups},d.prototype.powerGraphGroups=function(h){var p=t.getGroups(this._nodes,this._links,this.linkAccessor,this._rootGroup);return this.groups(p.groups),h(p),this},d.prototype.avoidOverlaps=function(h){return arguments.length?(this._avoidOverlaps=h,this):this._avoidOverlaps},d.prototype.handleDisconnected=function(h){return arguments.length?(this._handleDisconnected=h,this):this._handleDisconnected},d.prototype.flowLayout=function(h,p){return arguments.length||(h="y"),this._directedLinkConstraints={axis:h,getMinSeparation:typeof p=="number"?function(){return p}:p},this},d.prototype.links=function(h){return arguments.length?(this._links=h,this):this._links},d.prototype.constraints=function(h){return arguments.length?(this._constraints=h,this):this._constraints},d.prototype.distanceMatrix=function(h){return arguments.length?(this._distanceMatrix=h,this):this._distanceMatrix},d.prototype.size=function(h){return h?(this._canvasSize=h,this):this._canvasSize},d.prototype.defaultNodeSize=function(h){return h?(this._defaultNodeSize=h,this):this._defaultNodeSize},d.prototype.groupCompactness=function(h){return h?(this._groupCompactness=h,this):this._groupCompactness},d.prototype.linkDistance=function(h){return h?(this._linkDistance=typeof h=="function"?h:+h,this._linkLengthCalculator=null,this):this._linkDistance},d.prototype.linkType=function(h){return this._linkType=h,this},d.prototype.convergenceThreshold=function(h){return h?(this._threshold=typeof h=="function"?h:+h,this):this._threshold},d.prototype.alpha=function(h){return arguments.length?(h=+h,this._alpha?h>0?this._alpha=h:this._alpha=0:h>0&&(this._running||(this._running=!0,this.trigger({type:l.start,alpha:this._alpha=h}),this.kick())),this):this._alpha},d.prototype.getLinkLength=function(h){return typeof this._linkDistance=="function"?+this._linkDistance(h):this._linkDistance},d.setLinkLength=function(h,p){h.length=p},d.prototype.getLinkType=function(h){return typeof this._linkType=="function"?this._linkType(h):0},d.prototype.symmetricDiffLinkLengths=function(h,p){var g=this;return p===void 0&&(p=1),this.linkDistance(function(f){return h*f.length}),this._linkLengthCalculator=function(){return n.symmetricDiffLinkLengths(g._links,g.linkAccessor,p)},this},d.prototype.jaccardLinkLengths=function(h,p){var g=this;return p===void 0&&(p=1),this.linkDistance(function(f){return h*f.length}),this._linkLengthCalculator=function(){return n.jaccardLinkLengths(g._links,g.linkAccessor,p)},this},d.prototype.start=function(h,p,g,f,m,w){var b=this;h===void 0&&(h=0),p===void 0&&(p=0),g===void 0&&(g=0),f===void 0&&(f=0),m===void 0&&(m=!0),w===void 0&&(w=!0);var k,S=this.nodes().length,C=S+2*this._groups.length;this._links.length;var _=this._canvasSize[0],P=this._canvasSize[1],I=new Array(C),M=new Array(C),A=null,L=this._avoidOverlaps;this._nodes.forEach(function(D,B){D.index=B,typeof D.x>"u"&&(D.x=_/2,D.y=P/2),I[B]=D.x,M[B]=D.y}),this._linkLengthCalculator&&this._linkLengthCalculator();var z;this._distanceMatrix?z=this._distanceMatrix:(z=new o.Calculator(C,this._links,d.getSourceIndex,d.getTargetIndex,function(D){return b.getLinkLength(D)}).DistanceMatrix(),A=r.Descent.createSquareMatrix(C,function(){return 2}),this._links.forEach(function(D){typeof D.source=="number"&&(D.source=b._nodes[D.source]),typeof D.target=="number"&&(D.target=b._nodes[D.target])}),this._links.forEach(function(D){var B=d.getSourceIndex(D),X=d.getTargetIndex(D);A[B][X]=A[X][B]=D.weight||1}));var $=r.Descent.createSquareMatrix(C,function(D,B){return z[D][B]});if(this._rootGroup&&typeof this._rootGroup.groups<"u"){var k=S,j=function(B,X,ie,ue){A[B][X]=A[X][B]=ie,$[B][X]=$[X][B]=ue};this._groups.forEach(function(B){j(k,k+1,b._groupCompactness,.1),I[k]=0,M[k++]=0,I[k]=0,M[k++]=0})}else this._rootGroup={leaves:this._nodes,groups:[]};var F=this._constraints||[];this._directedLinkConstraints&&(this.linkAccessor.getMinSeparation=this._directedLinkConstraints.getMinSeparation,F=F.concat(n.generateDirectedEdgeConstraints(S,this._links,this._directedLinkConstraints.axis,this.linkAccessor))),this.avoidOverlaps(!1),this._descent=new r.Descent([I,M],$),this._descent.locks.clear();for(var k=0;k<S;++k){var R=this._nodes[k];if(R.fixed){R.px=R.x,R.py=R.y;var W=[R.x,R.y];this._descent.locks.add(k,W)}}if(this._descent.threshold=this._threshold,this.initialLayout(h,I,M),F.length>0&&(this._descent.project=new i.Projection(this._nodes,this._groups,this._rootGroup,F).projectFunctions()),this._descent.run(p),this.separateOverlappingComponents(_,P,w),this.avoidOverlaps(L),L&&(this._nodes.forEach(function(D,B){D.x=I[B],D.y=M[B]}),this._descent.project=new i.Projection(this._nodes,this._groups,this._rootGroup,F,!0).projectFunctions(),this._nodes.forEach(function(D,B){I[B]=D.x,M[B]=D.y})),this._descent.G=A,this._descent.run(g),f){this._descent.snapStrength=1e3,this._descent.snapGridSize=this._nodes[0].width,this._descent.numGridSnapNodes=S,this._descent.scaleSnapByMaxH=S!=C;var V=r.Descent.createSquareMatrix(C,function(D,B){return D>=S||B>=S?A[D][B]:0});this._descent.G=V,this._descent.run(f)}return this.updateNodePositions(),this.separateOverlappingComponents(_,P,w),m?this.resume():this},d.prototype.initialLayout=function(h,p,g){if(this._groups.length>0&&h>0){var f=this._nodes.length,m=this._links.map(function(b){return{source:b.source.index,target:b.target.index}}),w=this._nodes.map(function(b){return{index:b.index}});this._groups.forEach(function(b,k){w.push({index:b.index=f+k})}),this._groups.forEach(function(b,k){typeof b.leaves<"u"&&b.leaves.forEach(function(S){return m.push({source:b.index,target:S.index})}),typeof b.groups<"u"&&b.groups.forEach(function(S){return m.push({source:b.index,target:S.index})})}),new d().size(this.size()).nodes(w).links(m).avoidOverlaps(!1).linkDistance(this.linkDistance()).symmetricDiffLinkLengths(5).convergenceThreshold(1e-4).start(h,0,0,0,!1),this._nodes.forEach(function(b){p[b.index]=w[b.index].x,g[b.index]=w[b.index].y})}else this._descent.run(h)},d.prototype.separateOverlappingComponents=function(h,p,g){var f=this;if(g===void 0&&(g=!0),!this._distanceMatrix&&this._handleDisconnected){var m=this._descent.x[0],w=this._descent.x[1];this._nodes.forEach(function(k,S){k.x=m[S],k.y=w[S]});var b=a.separateGraphs(this._nodes,this._links);a.applyPacking(b,h,p,this._defaultNodeSize,1,g),this._nodes.forEach(function(k,S){f._descent.x[0][S]=k.x,f._descent.x[1][S]=k.y,k.bounds&&(k.bounds.setXCentre(k.x),k.bounds.setYCentre(k.y))})}},d.prototype.resume=function(){return this.alpha(.1)},d.prototype.stop=function(){return this.alpha(0)},d.prototype.prepareEdgeRouting=function(h){h===void 0&&(h=0),this._visibilityGraph=new s.TangentVisibilityGraph(this._nodes.map(function(p){return p.bounds.inflate(-h).vertices()}))},d.prototype.routeEdge=function(h,p,g){p===void 0&&(p=5);var f=[],m=new s.TangentVisibilityGraph(this._visibilityGraph.P,{V:this._visibilityGraph.V,E:this._visibilityGraph.E}),w={x:h.source.x,y:h.source.y},b={x:h.target.x,y:h.target.y},k=m.addPoint(w,h.source.index),S=m.addPoint(b,h.target.index);m.addEdgeIfVisible(w,b,h.source.index,h.target.index),typeof g<"u"&&g(m);var C=function(F){return F.source.id},_=function(F){return F.target.id},P=function(F){return F.length()},I=new o.Calculator(m.V.length,m.E,C,_,P),M=I.PathFromNodeToNode(k.id,S.id);if(M.length===1||M.length===m.V.length){var A=i.makeEdgeBetween(h.source.innerBounds,h.target.innerBounds,p);f=[A.sourceIntersection,A.arrowStart]}else{for(var L=M.length-2,z=m.V[M[L]].p,$=m.V[M[0]].p,f=[h.source.innerBounds.rayIntersection(z.x,z.y)],j=L;j>=0;--j)f.push(m.V[M[j]].p);f.push(i.makeEdgeTo($,h.target.innerBounds,p))}return f},d.getSourceIndex=function(h){return typeof h.source=="number"?h.source:h.source.index},d.getTargetIndex=function(h){return typeof h.target=="number"?h.target:h.target.index},d.linkId=function(h){return d.getSourceIndex(h)+"-"+d.getTargetIndex(h)},d.dragStart=function(h){c(h)?d.storeOffset(h,d.dragOrigin(h)):(d.stopNode(h),h.fixed|=2)},d.stopNode=function(h){h.px=h.x,h.py=h.y},d.storeOffset=function(h,p){typeof h.leaves<"u"&&h.leaves.forEach(function(g){g.fixed|=2,d.stopNode(g),g._dragGroupOffsetX=g.x-p.x,g._dragGroupOffsetY=g.y-p.y}),typeof h.groups<"u"&&h.groups.forEach(function(g){return d.storeOffset(g,p)})},d.dragOrigin=function(h){return c(h)?{x:h.bounds.cx(),y:h.bounds.cy()}:h},d.drag=function(h,p){c(h)?(typeof h.leaves<"u"&&h.leaves.forEach(function(g){h.bounds.setXCentre(p.x),h.bounds.setYCentre(p.y),g.px=g._dragGroupOffsetX+p.x,g.py=g._dragGroupOffsetY+p.y}),typeof h.groups<"u"&&h.groups.forEach(function(g){return d.drag(g,p)})):(h.px=p.x,h.py=p.y)},d.dragEnd=function(h){c(h)?(typeof h.leaves<"u"&&h.leaves.forEach(function(p){d.dragEnd(p),delete p._dragGroupOffsetX,delete p._dragGroupOffsetY}),typeof h.groups<"u"&&h.groups.forEach(d.dragEnd)):h.fixed&=-7},d.mouseOver=function(h){h.fixed|=4,h.px=h.x,h.py=h.y},d.mouseOut=function(h){h.fixed&=-5},d}();e.Layout=u}(kl);var Yne=Oe&&Oe.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(mg,"__esModule",{value:!0});var sw=kl,Dj=function(e){Yne(t,e);function t(n){var r=e.call(this)||this,i=n;return i.trigger&&(r.trigger=i.trigger),i.kick&&(r.kick=i.kick),i.drag&&(r.drag=i.drag),i.on&&(r.on=i.on),r.dragstart=r.dragStart=sw.Layout.dragStart,r.dragend=r.dragEnd=sw.Layout.dragEnd,r}return t.prototype.trigger=function(n){},t.prototype.kick=function(){},t.prototype.drag=function(){},t.prototype.on=function(n,r){return this},t}(sw.Layout);mg.LayoutAdaptor=Dj;function Xne(e){return new Dj(e)}mg.adaptor=Xne;var aw={},Cg={},Gne=Oe&&Oe.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Cg,"__esModule",{value:!0});var Zn=kl,zj=function(e){Gne(t,e);function t(){var n=e.call(this)||this;n.event=d3.dispatch(Zn.EventType[Zn.EventType.start],Zn.EventType[Zn.EventType.tick],Zn.EventType[Zn.EventType.end]);var r=n;return n.drag=function(){if(!i)var i=d3.behavior.drag().origin(Zn.Layout.dragOrigin).on("dragstart.d3adaptor",Zn.Layout.dragStart).on("drag.d3adaptor",function(o){Zn.Layout.drag(o,d3.event),r.resume()}).on("dragend.d3adaptor",Zn.Layout.dragEnd);if(!arguments.length)return i;this.call(i)},n}return t.prototype.trigger=function(n){var r={type:Zn.EventType[n.type],alpha:n.alpha,stress:n.stress};this.event[r.type](r)},t.prototype.kick=function(){var n=this;d3.timer(function(){return e.prototype.tick.call(n)})},t.prototype.on=function(n,r){return typeof n=="string"?this.event.on(n,r):this.event.on(Zn.EventType[n],r),this},t}(Zn.Layout);Cg.D3StyleLayoutAdaptor=zj;function qne(){return new zj}Cg.d3adaptor=qne;var lw={},Zne=Oe&&Oe.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(lw,"__esModule",{value:!0});var Qn=kl,Qne=function(e){Zne(t,e);function t(n){var r=e.call(this)||this;r.d3Context=n,r.event=n.dispatch(Qn.EventType[Qn.EventType.start],Qn.EventType[Qn.EventType.tick],Qn.EventType[Qn.EventType.end]);var i=r;return r.drag=function(){if(!o)var o=n.drag().subject(Qn.Layout.dragOrigin).on("start.d3adaptor",Qn.Layout.dragStart).on("drag.d3adaptor",function(s){Qn.Layout.drag(s,n.event),i.resume()}).on("end.d3adaptor",Qn.Layout.dragEnd);if(!arguments.length)return o;arguments[0].call(o)},r}return t.prototype.trigger=function(n){var r={type:Qn.EventType[n.type],alpha:n.alpha,stress:n.stress};this.event.call(r.type,r)},t.prototype.kick=function(){var n=this,r=this.d3Context.timer(function(){return e.prototype.tick.call(n)&&r.stop()})},t.prototype.on=function(n,r){return typeof n=="string"?this.event.on(n,r):this.event.on(Qn.EventType[n],r),this},t}(Qn.Layout);lw.D3StyleLayoutAdaptor=Qne,Object.defineProperty(aw,"__esModule",{value:!0});var Jne=Cg,ere=lw;function tre(e){return!e||nre(e)?new Jne.D3StyleLayoutAdaptor:new ere.D3StyleLayoutAdaptor(e)}aw.d3adaptor=tre;function nre(e){var t=/^3\./;return e.version&&e.version.match(t)!==null}var Us={};Object.defineProperty(Us,"__esModule",{value:!0});var rre=Nt,cw=Vr,ire=El,Nj=function(){function e(t,n,r){this.id=t,this.rect=n,this.children=r,this.leaf=typeof r>"u"||r.length===0}return e}();Us.NodeWrapper=Nj;var uw=function(){function e(t,n,r,i,o){i===void 0&&(i=null),o===void 0&&(o=null),this.id=t,this.x=n,this.y=r,this.node=i,this.line=o}return e}();Us.Vert=uw;var dw=function(){function e(t,n){this.s=t,this.t=n;var r=e.findMatch(t,n),i=n.slice(0).reverse(),o=e.findMatch(t,i);r.length>=o.length?(this.length=r.length,this.si=r.si,this.ti=r.ti,this.reversed=!1):(this.length=o.length,this.si=o.si,this.ti=n.length-o.ti-o.length,this.reversed=!0)}return e.findMatch=function(t,n){for(var r=t.length,i=n.length,o={length:0,si:-1,ti:-1},s=new Array(r),a=0;a<r;a++){s[a]=new Array(i);for(var l=0;l<i;l++)if(t[a]===n[l]){var c=s[a][l]=a===0||l===0?1:s[a-1][l-1]+1;c>o.length&&(o.length=c,o.si=a-c+1,o.ti=l-c+1)}else s[a][l]=0}return o},e.prototype.getSequence=function(){return this.length>=0?this.s.slice(this.si,this.si+this.length):[]},e}();Us.LongestCommonSubsequence=dw;var ore=function(){function e(t,n,r){var i=this;r===void 0&&(r=12),this.originalnodes=t,this.groupPadding=r,this.leaves=null,this.nodes=t.map(function(f,m){return new Nj(m,n.getBounds(f),n.getChildren(f))}),this.leaves=this.nodes.filter(function(f){return f.leaf}),this.groups=this.nodes.filter(function(f){return!f.leaf}),this.cols=this.getGridLines("x"),this.rows=this.getGridLines("y"),this.groups.forEach(function(f){return f.children.forEach(function(m){return i.nodes[m].parent=f})}),this.root={children:[]},this.nodes.forEach(function(f){typeof f.parent>"u"&&(f.parent=i.root,i.root.children.push(f.id)),f.ports=[]}),this.backToFront=this.nodes.slice(0),this.backToFront.sort(function(f,m){return i.getDepth(f)-i.getDepth(m)});var o=this.backToFront.slice(0).reverse().filter(function(f){return!f.leaf});o.forEach(function(f){var m=rre.Rectangle.empty();f.children.forEach(function(w){return m=m.union(i.nodes[w].rect)}),f.rect=m.inflate(i.groupPadding)});var s=this.midPoints(this.cols.map(function(f){return f.pos})),a=this.midPoints(this.rows.map(function(f){return f.pos})),l=s[0],c=s[s.length-1],u=a[0],d=a[a.length-1],h=this.rows.map(function(f){return{x1:l,x2:c,y1:f.pos,y2:f.pos}}).concat(a.map(function(f){return{x1:l,x2:c,y1:f,y2:f}})),p=this.cols.map(function(f){return{x1:f.pos,x2:f.pos,y1:u,y2:d}}).concat(s.map(function(f){return{x1:f,x2:f,y1:u,y2:d}})),g=h.concat(p);g.forEach(function(f){return f.verts=[]}),this.verts=[],this.edges=[],h.forEach(function(f){return p.forEach(function(m){var w=new uw(i.verts.length,m.x1,f.y1);f.verts.push(w),m.verts.push(w),i.verts.push(w);for(var b=i.backToFront.length;b-- >0;){var k=i.backToFront[b],S=k.rect,C=Math.abs(w.x-S.cx()),_=Math.abs(w.y-S.cy());if(C<S.width()/2&&_<S.height()/2){w.node=k;break}}})}),g.forEach(function(f,m){i.nodes.forEach(function(_,P){_.rect.lineIntersections(f.x1,f.y1,f.x2,f.y2).forEach(function(I,M){var A=new uw(i.verts.length,I.x,I.y,_,f);i.verts.push(A),f.verts.push(A),_.ports.push(A)})});var w=Math.abs(f.y1-f.y2)<.1,b=function(_,P){return w?P.x-_.x:P.y-_.y};f.verts.sort(b);for(var k=1;k<f.verts.length;k++){var S=f.verts[k-1],C=f.verts[k];S.node&&S.node===C.node&&S.node.leaf||i.edges.push({source:S.id,target:C.id,length:Math.abs(b(S,C))})}})}return e.prototype.avg=function(t){return t.reduce(function(n,r){return n+r})/t.length},e.prototype.getGridLines=function(t){for(var n=[],r=this.leaves.slice(0,this.leaves.length);r.length>0;){var i=r.filter(function(s){return s.rect["overlap"+t.toUpperCase()](r[0].rect)}),o={nodes:i,pos:this.avg(i.map(function(s){return s.rect["c"+t]()}))};n.push(o),o.nodes.forEach(function(s){return r.splice(r.indexOf(s),1)})}return n.sort(function(s,a){return s.pos-a.pos}),n},e.prototype.getDepth=function(t){for(var n=0;t.parent!==this.root;)n++,t=t.parent;return n},e.prototype.midPoints=function(t){for(var n=t[1]-t[0],r=[t[0]-n/2],i=1;i<t.length;i++)r.push((t[i]+t[i-1])/2);return r.push(t[t.length-1]+n/2),r},e.prototype.findLineage=function(t){var n=[t];do t=t.parent,n.push(t);while(t!==this.root);return n.reverse()},e.prototype.findAncestorPathBetween=function(t,n){for(var r=this.findLineage(t),i=this.findLineage(n),o=0;r[o]===i[o];)o++;return{commonAncestor:r[o-1],lineages:r.slice(o).concat(i.slice(o))}},e.prototype.siblingObstacles=function(t,n){var r=this,i=this.findAncestorPathBetween(t,n),o={};i.lineages.forEach(function(a){return o[a.id]={}});var s=i.commonAncestor.children.filter(function(a){return!(a in o)});return i.lineages.filter(function(a){return a.parent!==i.commonAncestor}).forEach(function(a){return s=s.concat(a.parent.children.filter(function(l){return l!==a.id}))}),s.map(function(a){return r.nodes[a]})},e.getSegmentSets=function(t,n,r){for(var i=[],o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++){var l=s[a];l.edgeid=o,l.i=a;var c=l[1][n]-l[0][n];Math.abs(c)<.1&&i.push(l)}i.sort(function(p,g){return p[0][n]-g[0][n]});for(var u=[],d=null,h=0;h<i.length;h++){var l=i[h];(!d||Math.abs(l[0][n]-d.pos)>.1)&&(d={pos:l[0][n],segments:[]},u.push(d)),d.segments.push(l)}return u},e.nudgeSegs=function(t,n,r,i,o,s){var a=i.length;if(!(a<=1)){for(var l=i.map(function(k){return new cw.Variable(k[0][t])}),c=[],u=0;u<a;u++)for(var d=0;d<a;d++)if(u!==d){var h=i[u],p=i[d],g=h.edgeid,f=p.edgeid,m=-1,w=-1;t=="x"?o(g,f)&&(h[0][n]<h[1][n]?(m=d,w=u):(m=u,w=d)):o(g,f)&&(h[0][n]<h[1][n]?(m=u,w=d):(m=d,w=u)),m>=0&&c.push(new cw.Constraint(l[m],l[w],s))}var b=new cw.Solver(l,c);b.solve(),l.forEach(function(k,S){var C=i[S],_=k.position();C[0][t]=C[1][t]=_;var P=r[C.edgeid];C.i>0&&(P[C.i-1][1][t]=_),C.i<P.length-1&&(P[C.i+1][0][t]=_)})}},e.nudgeSegments=function(t,n,r,i,o){for(var s=e.getSegmentSets(t,n,r),a=0;a<s.length;a++){for(var l=s[a],c=[],u=0;u<l.segments.length;u++){var d=l.segments[u];c.push({type:0,s:d,pos:Math.min(d[0][r],d[1][r])}),c.push({type:1,s:d,pos:Math.max(d[0][r],d[1][r])})}c.sort(function(g,f){return g.pos-f.pos+g.type-f.type});var h=[],p=0;c.forEach(function(g){g.type===0?(h.push(g.s),p++):p--,p==0&&(e.nudgeSegs(n,r,t,h,i,o),h=[])})}},e.prototype.routeEdges=function(t,n,r,i){var o=this,s=t.map(function(c){return o.route(r(c),i(c))}),a=e.orderEdges(s),l=s.map(function(c){return e.makeSegments(c)});return e.nudgeSegments(l,"x","y",a,n),e.nudgeSegments(l,"y","x",a,n),e.unreverseEdges(l,s),l},e.unreverseEdges=function(t,n){t.forEach(function(r,i){var o=n[i];o.reversed&&(r.reverse(),r.forEach(function(s){s.reverse()}))})},e.angleBetween2Lines=function(t,n){var r=Math.atan2(t[0].y-t[1].y,t[0].x-t[1].x),i=Math.atan2(n[0].y-n[1].y,n[0].x-n[1].x),o=r-i;return(o>Math.PI||o<-Math.PI)&&(o=i-r),o},e.isLeft=function(t,n,r){return(n.x-t.x)*(r.y-t.y)-(n.y-t.y)*(r.x-t.x)<=0},e.getOrder=function(t){for(var n={},r=0;r<t.length;r++){var i=t[r];typeof n[i.l]>"u"&&(n[i.l]={}),n[i.l][i.r]=!0}return function(o,s){return typeof n[o]<"u"&&n[o][s]}},e.orderEdges=function(t){for(var n=[],r=0;r<t.length-1;r++)for(var i=r+1;i<t.length;i++){var o=t[r],s=t[i],a=new dw(o,s),l,c,u;if(a.length!==0){if(a.reversed&&(s.reverse(),s.reversed=!0,a=new dw(o,s)),(a.si<=0||a.ti<=0)&&(a.si+a.length>=o.length||a.ti+a.length>=s.length)){n.push({l:r,r:i});continue}a.si+a.length>=o.length||a.ti+a.length>=s.length?(l=o[a.si+1],u=o[a.si-1],c=s[a.ti-1]):(l=o[a.si+a.length-2],c=o[a.si+a.length],u=s[a.ti+a.length]),e.isLeft(l,c,u)?n.push({l:i,r}):n.push({l:r,r:i})}}return e.getOrder(n)},e.makeSegments=function(t){function n(c){return{x:c.x,y:c.y}}for(var r=function(c,u,d){return Math.abs((u.x-c.x)*(d.y-c.y)-(u.y-c.y)*(d.x-c.x))<.001},i=[],o=n(t[0]),s=1;s<t.length;s++){var a=n(t[s]),l=s<t.length-1?t[s+1]:null;(!l||!r(o,a,l))&&(i.push([o,a]),o=a)}return i},e.prototype.route=function(t,n){var r=this,i=this.nodes[t],o=this.nodes[n];this.obstacles=this.siblingObstacles(i,o);var s={};this.obstacles.forEach(function(w){return s[w.id]=w}),this.passableEdges=this.edges.filter(function(w){var b=r.verts[w.source],k=r.verts[w.target];return!(b.node&&b.node.id in s||k.node&&k.node.id in s)});for(var a=1;a<i.ports.length;a++){var l=i.ports[0].id,c=i.ports[a].id;this.passableEdges.push({source:l,target:c,length:0})}for(var a=1;a<o.ports.length;a++){var l=o.ports[0].id,c=o.ports[a].id;this.passableEdges.push({source:l,target:c,length:0})}var u=function(w){return w.source},d=function(w){return w.target},h=function(w){return w.length},p=new ire.Calculator(this.verts.length,this.passableEdges,u,d,h),g=function(w,b,k){var S=r.verts[w],C=r.verts[b],_=r.verts[k],P=Math.abs(_.x-S.x),I=Math.abs(_.y-S.y);return S.node===i&&S.node===C.node||C.node===o&&C.node===_.node?0:P>1&&I>1?1e3:0},f=p.PathFromNodeToNodeWithPrevCost(i.ports[0].id,o.ports[0].id,g),m=f.reverse().map(function(w){return r.verts[w]});return m.push(this.nodes[o.id].ports[0]),m.filter(function(w,b){return!(b<m.length-1&&m[b+1].node===i&&w.node===i||b>0&&w.node===o&&m[b-1].node===o)})},e.getRoutePath=function(t,n,r,i){var o={routepath:"M "+t[0][0].x+" "+t[0][0].y+" ",arrowpath:""};if(t.length>1)for(var s=0;s<t.length;s++){var a=t[s],l=a[1].x,c=a[1].y,u=l-a[0].x,d=c-a[0].y;if(s<t.length-1){Math.abs(u)>0?l-=u/Math.abs(u)*n:c-=d/Math.abs(d)*n,o.routepath+="L "+l+" "+c+" ";var h=t[s+1],p=h[0].x,g=h[0].y,f=h[1].x,m=h[1].y;u=f-p,d=m-g;var w=e.angleBetween2Lines(a,h)<0?1:0,b,k;Math.abs(u)>0?(b=p+u/Math.abs(u)*n,k=g):(b=p,k=g+d/Math.abs(d)*n);var S=Math.abs(b-l),C=Math.abs(k-c);o.routepath+="A "+S+" "+C+" 0 0 "+w+" "+b+" "+k+" "}else{var _=[l,c],P,I;Math.abs(u)>0?(l-=u/Math.abs(u)*i,P=[l,c+r],I=[l,c-r]):(c-=d/Math.abs(d)*i,P=[l+r,c],I=[l-r,c]),o.routepath+="L "+l+" "+c+" ",i>0&&(o.arrowpath="M "+_[0]+" "+_[1]+" L "+P[0]+" "+P[1]+" L "+I[0]+" "+I[1])}}else{var a=t[0],l=a[1].x,c=a[1].y,u=l-a[0].x,d=c-a[0].y,_=[l,c],P,I;Math.abs(u)>0?(l-=u/Math.abs(u)*i,P=[l,c+r],I=[l,c-r]):(c-=d/Math.abs(d)*i,P=[l+r,c],I=[l-r,c]),o.routepath+="L "+l+" "+c+" ",i>0&&(o.arrowpath="M "+_[0]+" "+_[1]+" L "+P[0]+" "+P[1]+" L "+I[0]+" "+I[1])}return o},e}();Us.GridRouter=ore;var Qu={};Object.defineProperty(Qu,"__esModule",{value:!0});var sre=El,hw=Bs,are=Nt,lre=Go,cre=function(){function e(t,n){this.source=t,this.target=n}return e.prototype.actualLength=function(t){var n=this;return Math.sqrt(t.reduce(function(r,i){var o=i[n.target]-i[n.source];return r+o*o},0))},e}();Qu.Link3D=cre;var ure=function(){function e(t,n,r){t===void 0&&(t=0),n===void 0&&(n=0),r===void 0&&(r=0),this.x=t,this.y=n,this.z=r}return e}();Qu.Node3D=ure;var dre=function(){function e(t,n,r){var i=this;r===void 0&&(r=1),this.nodes=t,this.links=n,this.idealLinkLength=r,this.constraints=null,this.useJaccardLinkLengths=!0,this.result=new Array(e.k);for(var o=0;o<e.k;++o)this.result[o]=new Array(t.length);t.forEach(function(s,a){for(var l=0,c=e.dims;l<c.length;l++){var u=c[l];typeof s[u]>"u"&&(s[u]=Math.random())}i.result[0][a]=s.x,i.result[1][a]=s.y,i.result[2][a]=s.z})}return e.prototype.linkLength=function(t){return t.actualLength(this.result)},e.prototype.start=function(t){var n=this;t===void 0&&(t=100);var r=this.nodes.length,i=new hre;this.useJaccardLinkLengths&&lre.jaccardLinkLengths(this.links,i,1.5),this.links.forEach(function(u){return u.length*=n.idealLinkLength});var o=new sre.Calculator(r,this.links,function(u){return u.source},function(u){return u.target},function(u){return u.length}).DistanceMatrix(),s=hw.Descent.createSquareMatrix(r,function(u,d){return o[u][d]}),a=hw.Descent.createSquareMatrix(r,function(){return 2});this.links.forEach(function(u){var d=u.source,h=u.target;return a[d][h]=a[h][d]=1}),this.descent=new hw.Descent(this.result,s),this.descent.threshold=.001,this.descent.G=a,this.constraints&&(this.descent.project=new are.Projection(this.nodes,null,null,this.constraints).projectFunctions());for(var l=0;l<this.nodes.length;l++){var c=this.nodes[l];c.fixed&&this.descent.locks.add(l,[c.x,c.y,c.z])}return this.descent.run(t),this},e.prototype.tick=function(){this.descent.locks.clear();for(var t=0;t<this.nodes.length;t++){var n=this.nodes[t];n.fixed&&this.descent.locks.add(t,[n.x,n.y,n.z])}return this.descent.rungeKutta()},e.dims=["x","y","z"],e.k=e.dims.length,e}();Qu.Layout3D=dre;var hre=function(){function e(){}return e.prototype.getSourceIndex=function(t){return t.source},e.prototype.getTargetIndex=function(t){return t.target},e.prototype.getLength=function(t){return t.length},e.prototype.setLength=function(t,n){t.length=n},e}(),Eg={};Object.defineProperty(Eg,"__esModule",{value:!0});var pw=kl,pre=Us;function fre(e,t,n,r){e.cola.start(0,0,0,10,!1);var i=gre(e.cola.nodes(),e.cola.groups(),n,r);return i.routeEdges(e.powerGraph.powerEdges,t,function(o){return o.source.routerNode.id},function(o){return o.target.routerNode.id})}Eg.gridify=fre;function gre(e,t,n,r){e.forEach(function(o){o.routerNode={name:o.name,bounds:o.bounds.inflate(-n)}}),t.forEach(function(o){o.routerNode={bounds:o.bounds.inflate(-r),children:(typeof o.groups<"u"?o.groups.map(function(s){return e.length+s.id}):[]).concat(typeof o.leaves<"u"?o.leaves.map(function(s){return s.index}):[])}});var i=e.concat(t).map(function(o,s){return o.routerNode.id=s,o.routerNode});return new pre.GridRouter(i,{getChildren:function(o){return o.children},getBounds:function(o){return o.bounds}},n-r)}function mre(e,t,n){var r;e.nodes.forEach(function(a,l){return a.index=l}),new pw.Layout().avoidOverlaps(!1).nodes(e.nodes).links(e.links).powerGraphGroups(function(a){r=a,r.groups.forEach(function(l){return l.padding=n})});var i=e.nodes.length,o=[],s=e.nodes.slice(0);return s.forEach(function(a,l){return a.index=l}),r.groups.forEach(function(a){var l=a.index=a.id+i;s.push(a),typeof a.leaves<"u"&&a.leaves.forEach(function(c){return o.push({source:l,target:c.index})}),typeof a.groups<"u"&&a.groups.forEach(function(c){return o.push({source:l,target:c.id+i})})}),r.powerEdges.forEach(function(a){o.push({source:a.source.index,target:a.target.index})}),new pw.Layout().size(t).nodes(s).links(o).avoidOverlaps(!1).linkDistance(30).symmetricDiffLinkLengths(5).convergenceThreshold(1e-4).start(100,0,0,0,!1),{cola:new pw.Layout().convergenceThreshold(.001).size(t).avoidOverlaps(!0).nodes(e.nodes).links(e.links).groupCompactness(1e-4).linkDistance(30).symmetricDiffLinkLengths(5).powerGraphGroups(function(a){r=a,r.groups.forEach(function(l){l.padding=n})}).start(50,0,100,0,!1),powerGraph:r}}Eg.powerGraphGridLayout=mre,function(e){function t(n){for(var r in n)e.hasOwnProperty(r)||(e[r]=n[r])}Object.defineProperty(e,"__esModule",{value:!0}),t(mg),t(aw),t(Bs),t(dt),t(Us),t(Zu),t(kl),t(Qu),t(Go),t(Ji),t(Gu),t(Cl),t(Nt),t(El),t(Vr),t(Eg)}(sj);const yre=(e,t)=>{x.useEffect(()=>{if(!t)return;const{colaNodes:n,colaLinks:r,constraints:i}=lne(e);e.selectNone();const o=new sj.Layout().nodes(n).links(r).avoidOverlaps(!0).linkDistance(l=>ane(l)).handleDisconnected(!0).constraints(i);let s;const a=()=>{cne(e,o),s=requestAnimationFrame(a)};return a(),()=>{cancelAnimationFrame(s)}},[t])},vre=Pe(()=>{const e=H(),[t,n]=x.useState(!1);return yre(e,t),x.useEffect(()=>{const r=()=>{n(i=>!i)};return window.addEventListener("toggleGraphLayoutEvent",r),()=>{window.removeEventListener("toggleGraphLayoutEvent",r)}},[]),y.jsx("div",{className:"custom-layout",children:y.jsx("div",{className:"custom-toolbar",children:y.jsx("button",{type:"button",title:"Toggle Graph Layout (G)",className:"custom-button","data-isactive":t,onClick:()=>n(!t),children:"Graph"})})})}),bre={actions(e,t){return t["toggle-graph-layout"]={id:"toggle-graph-layout",label:"Toggle Graph Layout",readonlyOk:!0,kbd:"g",onSelect(n){const r=new CustomEvent("toggleGraphLayoutEvent");window.dispatchEvent(r)}},t},keyboardShortcutsMenu(e,t,{actions:n}){return t.find(r=>r.id==="shortcuts-dialog.tools").children.push(U(n["toggle-graph-layout"])),t}};function wre(){return y.jsx("div",{className:"tldraw__editor",children:y.jsx(rne,{autoFocus:!0,shareZone:y.jsx(xre,{}),overrides:bre,children:y.jsx(vre,{})})})}const xre=Pe(()=>{const e=H(),{color:t,name:n}=e.user.getUserPreferences();return y.jsxs("div",{style:{pointerEvents:"all",display:"flex",width:"148px",margin:"4px 8px",border:"none"},children:[y.jsx("input",{style:{borderRadius:"9px 0px 0px 9px",border:"none",backgroundColor:"white",boxShadow:"0px 0px 4px rgba(0, 0, 0, 0.25)"},type:"color",value:t,onChange:r=>{e.user.updateUserPreferences({color:r.currentTarget.value})}}),y.jsx("input",{style:{width:"100%",borderRadius:"0px 9px 9px 0px",border:"none",backgroundColor:"white",boxShadow:"0px 0px 4px rgba(0, 0, 0, 0.25)"},value:n,onChange:r=>{e.user.updateUserPreferences({name:r.currentTarget.value})}})]})});Vg.createRoot(document.getElementById("root")).render(y.jsx(J.StrictMode,{children:y.jsx(wre,{})}));
